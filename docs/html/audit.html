

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reality Check Audit &mdash; Realitio  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Realitio  documentation" href="index.html"/>
        <link rel="prev" title="Contract Internals" href="contract_explanation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Realitio
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dapp.html">Using the Realitio dapp</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts.html">Using Realitio from a contract</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoding.html">How data is encoded</a></li>
<li class="toctree-l1"><a class="reference internal" href="availability.html">Unavailability and null responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="arbitrators.html">Arbitrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="fees.html">Fees and payments</a></li>
<li class="toctree-l1"><a class="reference internal" href="whitepaper.html">White paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="contract_explanation.html">Contract Internals</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reality Check Audit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#methodology">Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-observations">General observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scope-of-the-audit">Scope of the Audit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#audit">Audit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#first-pass">First Pass</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#l413-minor-bondmustbezero-is-always-true">L413 MINOR bondMustBeZero is always true</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l478-minor-improvement-clarify-current-winning-with-each-answer-given">L478 MINOR Improvement: clarify current winning with each answer given</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#second-pass">Second Pass</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#observation-1">Observation 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#observation-2">Observation 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recommendation">Recommendation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#medium-spoofing-the-reality-check-contract">MEDIUM Spoofing the reality check contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minor-realitycheckapi-defined-but-never-explicitly-implemented">MINOR RealityCheckAPI defined but never explicitly implemented</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#revision-after-feature-enhancement">Revision after Feature Enhancement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conclusions">Conclusions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#revision-after-audit">Revision after Audit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#eliminating-contract-realitycheckapi">Eliminating contract RealityCheckAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tying-arbitrator-to-a-single-reality-check-address">Tying Arbitrator to a single Reality Check address</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#final-conclusions">Final Conclusions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Realitio</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Reality Check Audit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/audit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reality-check-audit">
<h1>Reality Check Audit<a class="headerlink" href="#reality-check-audit" title="Permalink to this headline">¶</a></h1>
<p>Exported by Edmund Edgar from document at
<a class="reference external" href="https://docs.google.com/document/d/1__9q9k3iJ7XoRIvW9MHtHfN59Hv4CcDrUCH4qgAGxQk">https://docs.google.com/document/d/1__9q9k3iJ7XoRIvW9MHtHfN59Hv4CcDrUCH4qgAGxQk</a></p>
<div class="section" id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<p>Structured reading is the main method of assessment. The code has been read twice, (1) line by line from start to end focusing on local errors, gas consumption and efficiency. (2) the second time was during a one day workshop together with the ideator and implementer Edmund Edgar and Smart Contract Auditor Alex Kampa. The aim of this workshop was to uncover more sophisticated vulnerabilities due to timing, network constraints and economic imbalances.</p>
<p>The following definitions of alert levels are adopted to label vulnerabilities.</p>
<p>CRITICAL
has potential to harm user or owner</p>
<p>MEDIUM
has potential to impede proper functioning of the smart contract</p>
<p>MINOR
there is a better way to do this or is just a matter of diverging tastes</p>
</div>
<div class="section" id="general-observations">
<h2>General observations<a class="headerlink" href="#general-observations" title="Permalink to this headline">¶</a></h2>
<p>The coding style is clear and idiomatic. The design of the program is efficient as it is (1) storing only consensus relevant data and (2) minimizing <a href="#id1"><span class="problematic" id="id2">*</span></a>gas * needs in recurrently used code parts.</p>
<p>The author has paid attention to incorporate most of the good practices that the solidity developer community has found in the past. Low level errors are not present as the first pass shows (3 days of code reading)</p>
</div>
<div class="section" id="scope-of-the-audit">
<h2>Scope of the Audit<a class="headerlink" href="#scope-of-the-audit" title="Permalink to this headline">¶</a></h2>
<p>RealityCheck is a smart contract system that discovers truth by active disputes with <em>skin in the game</em>. A question is asked and a bounty is submitted for a correct answer. Concurrent answers put their own stake at risk. A dedicated arbiter can finally resolve disputes, if required.</p>
<p>Scope of the audit is a corpus of ~700 lines of Solidity:</p>
<p><a class="reference external" href="https://github.com/realitykeys/realitycheck/blob/master/truffle/contracts/Arbitrator.sol">https://github.com/realitykeys/realitycheck/blob/master/truffle/contracts/Arbitrator.sol</a></p>
<p><a class="reference external" href="https://github.com/realitykeys/realitycheck/blob/207278cecb4a99709dd7e6c1b601196ba11e676e/truffle/contracts/RealityCheck.sol">https://github.com/realitykeys/realitycheck/blob/207278cecb4a99709dd7e6c1b601196ba11e676e/truffle/contracts/RealityCheck.sol</a></p>
<p>Deployment, UI and other external modules are not part of the audit and can introduce vulnerabilities.</p>
</div>
<div class="section" id="audit">
<h2>Audit<a class="headerlink" href="#audit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-pass">
<h3>First Pass<a class="headerlink" href="#first-pass" title="Permalink to this headline">¶</a></h3>
<div class="section" id="l413-minor-bondmustbezero-is-always-true">
<h4>L413 MINOR bondMustBeZero is always true<a class="headerlink" href="#l413-minor-bondmustbezero-is-always-true" title="Permalink to this headline">¶</a></h4>
<p>Because function is not payable, modifier has no functionality after Solidity introduced the payable restriction and could be eliminated.</p>
</div>
<div class="section" id="l478-minor-improvement-clarify-current-winning-with-each-answer-given">
<h4>L478 MINOR Improvement: clarify current winning with each answer given<a class="headerlink" href="#l478-minor-improvement-clarify-current-winning-with-each-answer-given" title="Permalink to this headline">¶</a></h4>
<p>Each answerer would bear a share of the gas costs, while herethe winner would cover the costs on the entire answer chain.</p>
<p><em>Edmund Edgar: This was our original design, it’s much simpler. However it became problematic when added commit-&gt;reveal. If there is an unrevealed previous answer, you don’t know whether the user who gave it needs to be paid, because you don’t yet know what their answer is. An alternative would be to lock the question until the reveal is either supplied or times out and prevents the next answer being added, but this allows users to lock the question at low cost (eg you can answer with a very low fee, then not reveal until the reveal deadline).</em></p>
</div>
</div>
<div class="section" id="second-pass">
<h3>Second Pass<a class="headerlink" href="#second-pass" title="Permalink to this headline">¶</a></h3>
<p>The workshop started at 9.00AM CET. with a general introduction of the Reality Check platform and testing out the interface.</p>
<div class="section" id="observation-1">
<h4>Observation 1<a class="headerlink" href="#observation-1" title="Permalink to this headline">¶</a></h4>
<p>OUT OF SCOPE. There was a problem with updating the answers in the interface automatically. Roland Kofler had to refresh the page on several occasions (Google Chrome).</p>
</div>
<div class="section" id="observation-2">
<h4>Observation 2<a class="headerlink" href="#observation-2" title="Permalink to this headline">¶</a></h4>
<a class="reference internal image-reference" href="_images/question_box.png"><img alt="Reality Check Dapp question box" class="align-right" src="_images/question_box.png" style="width: 185.9px; height: 294.45px;" /></a>
<p>OUT OF SCOPE. When posting a question there are no labels describing the dropdown, making it a guesswork for the inexperienced user. The choice of having the description within the dropdowns does not provide enough context.</p>
</div>
<div class="section" id="recommendation">
<h4>Recommendation<a class="headerlink" href="#recommendation" title="Permalink to this headline">¶</a></h4>
<p>Holding a usability workshop with a <em>Thinking Aloud</em> Protocol to uncover potential problems.</p>
</div>
<div class="section" id="medium-spoofing-the-reality-check-contract">
<h4>MEDIUM Spoofing the reality check contract<a class="headerlink" href="#medium-spoofing-the-reality-check-contract" title="Permalink to this headline">¶</a></h4>
<p>The arbitrator contract is loosely coupled with RealityCheck, he always has the RealityCheck contract as a parameter. This provides flexibility but COULD bring inconsistencies.</p>
<p>The intent of an M:N dependency is to seamlessly transit from a reality check version to another.</p>
<p>The argument has been held that such an attack is only one of many manipulation attacks inherently possible in the Metamask/ Browser ecosystem. Because the other vulnerabilities are unresolved in such a setup, resolving this problem would still enable similar attacks.</p>
<p>Edmund Edgar: So the attack vector is that, can we fool the arbitrator about the address of the RealityCheck contract. Maybe a bigger issue for fooling regular users, eg if you hack my dapp source code etherdelta-style you can make them think they’re interacting with the real contract when really it’s the attacker’s contract. Knowing which contract you’re dealing with is kind-of the central flaw in the whole metamask security model right now, along with the fact that the user can’t really realistically tell what message they’re signing…I think tricking the arbitrator feels like kind-of a milder case of that, in that they’re a specialist user with (hopefully) unusually good security.</p>
<p>If the ONLY possible use of the RealityCheck system is seen in the context of a Web-Dapp with current level of security this argument is valid.</p>
<p><a href="#id3"><span class="problematic" id="id4">**</span></a>If there is a likely option that RealityCheck will be used in more automated (e.g. used by other contract systems or used with in IoT and secure hardware) a more robust approach to security is recommended. **</p>
<p><strong>This holds more true if RealityCheck should be part of a decentralized permissionless service ecosystem, many in the Ethereum community envision.</strong></p>
</div>
<div class="section" id="minor-realitycheckapi-defined-but-never-explicitly-implemented">
<h4>MINOR RealityCheckAPI defined but never explicitly implemented<a class="headerlink" href="#minor-realitycheckapi-defined-but-never-explicitly-implemented" title="Permalink to this headline">¶</a></h4>
<p>Currently the realitycheck contract is called by casting an address to the
* abstract contract *
RealityCheckAPI
. The abstract contract is never inherited, apparently Solidity does not check strongly for Type-safety. Runtime-typing is not an official Solidity feature:</p>
<p>Solidity is a statically typed language, which means that the type of each variable (state and local) needs to be specified (or at least known - see Type Deduction below) at compile-time. Solidity provides several elementary types which can be combined to form complex types.</p>
<p><a class="reference external" href="https://solidity.readthedocs.io/en/v0.4.21/types.html">https://solidity.readthedocs.io/en/v0.4.21/types.html</a></p>
<p>A more conventional way would be to enforce the implementation by stating that</p>
<p><cite>contract RealityKeys is RealityCheckAPI</cite></p>
<p>Recommendable is also using the interface keyword.
<a class="reference external" href="https://solidity.readthedocs.io/en/v0.4.21/contracts.html#interfaces">https://solidity.readthedocs.io/en/v0.4.21/contracts.html#interfaces</a></p>
</div>
</div>
<div class="section" id="revision-after-feature-enhancement">
<h3>Revision after Feature Enhancement<a class="headerlink" href="#revision-after-feature-enhancement" title="Permalink to this headline">¶</a></h3>
<p>The following enhancement was made on the 24th Feb 2018:</p>
<p><a class="reference external" href="https://github.com/realitykeys/realitycheck/commit/207278cecb4a99709dd7e6c1b601196ba11e676e#diff-78b329f919a5d781dd13643896fd950b">https://github.com/realitykeys/realitycheck/commit/207278cecb4a99709dd7e6c1b601196ba11e676e#diff-78b329f919a5d781dd13643896fd950b</a></p>
<p>The change allows an arbitrator to retrieve funds from the RealityCheck contract that are conceived as an anti-spam measure.</p>
<p>The change consists in adding:</p>
<ol class="arabic simple">
<li>A
payable
fallback function to
Arbitrator.sol</li>
<li>Adding a
function
callWithdraw(address realitycheck) onlyOwner
which allows the Arbiter to withdraw from the
RealityCheck.sol
contract to the Arbitrator Contract.</li>
<li>Adding withdraw() to the
RealityCheckAPI
contract in
Arbitrator.sol</li>
</ol>
<p>The enhancement bears no additional vulnerabilities.</p>
</div>
<div class="section" id="conclusions">
<h3>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this headline">¶</a></h3>
<p>There is a case for coupling Arbitrator and RealityCheck contract dependencies in a trustless way as one hopes RealityCheck will be used by the broader smart contract system as Oracle. It is left to the discretion and judgment of the RealityKeys team to pick this option.</p>
<p>Enforcing the implementation of RealityCheckAPI could also be recommended.</p>
</div>
<div class="section" id="revision-after-audit">
<h3>Revision after Audit<a class="headerlink" href="#revision-after-audit" title="Permalink to this headline">¶</a></h3>
<div class="section" id="eliminating-contract-realitycheckapi">
<h4>Eliminating contract RealityCheckAPI<a class="headerlink" href="#eliminating-contract-realitycheckapi" title="Permalink to this headline">¶</a></h4>
<p>The recommendation to explicitly inherit RealityCheckAPI was modified to directly reference the RealityCheck contract instead.</p>
<p><a class="reference external" href="https://github.com/realitykeys/realitycheck/commit/2fcd6f1746d7fcd25b79cf29e19f420d613fd84d">https://github.com/realitykeys/realitycheck/commit/2fcd6f1746d7fcd25b79cf29e19f420d613fd84d</a></p>
<p>Changes in
Arbitrator.sol
:</p>
<ol class="arabic simple">
<li>Contract
RealityCheckAPI
was removed</li>
<li>Casts to
RealityCheckAPI(realitycheck)
were replaced with
RealityCheck(realitycheck)</li>
</ol>
<p><strong>The change is not capable of introducing new vulnerabilities since the behavior of the contracts have not changed.</strong></p>
</div>
<div class="section" id="tying-arbitrator-to-a-single-reality-check-address">
<h4>Tying Arbitrator to a single Reality Check address<a class="headerlink" href="#tying-arbitrator-to-a-single-reality-check-address" title="Permalink to this headline">¶</a></h4>
<p>The recommendation of implementing a tighter coupling between Arbitrator and RealityCheck contracts were followed with the following commit:</p>
<p><a class="reference external" href="https://github.com/realitykeys/realitycheck/commit/a4068686b3edb7df5356b64ac29e9ff38952293e">https://github.com/realitykeys/realitycheck/commit/a4068686b3edb7df5356b64ac29e9ff38952293e</a></p>
<p>Changes in
Arbitrator.sol
:</p>
<ol class="arabic simple">
<li>A member variable
RealityCheck public realitycheck
was introduced</li>
<li>A setter function for this member variable was introduced:
function setRealityCheck(address addr) onlyOwner</li>
<li>A event logs the changes on this function
event LogSetRealityCheck</li>
<li>All parameters
address realitycheck
were removed from the function signatures</li>
<li>All casts to
RealityCheck(realitycheck)
were replaced by the member variable
realitycheck</li>
</ol>
<p>The change makes upgrades to new RealityCheck contracts explicit and part of the trust architecture of the contract. Besides setting the contract explicitly, no behavior has changed.</p>
<p><strong>The modification is therefore not capable of introducing new vulnerabilities.</strong></p>
</div>
</div>
</div>
<div class="section" id="final-conclusions">
<h2>Final Conclusions<a class="headerlink" href="#final-conclusions" title="Permalink to this headline">¶</a></h2>
<p>The recommendations were accepted by the RealityKeys Team. The following modifications didn’t bear potential to introduce new vulnerabilities.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="contract_explanation.html" class="btn btn-neutral" title="Contract Internals" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, KK Social Minds.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>