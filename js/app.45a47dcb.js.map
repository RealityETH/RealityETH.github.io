{"version":3,"file":"js/app.45a47dcb.js","mappings":"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","sources":["webpack://@reality.eth/dapp/webpack/runtime/chunk loaded","webpack://@reality.eth/dapp/./src/scripts/rpc.js","webpack://@reality.eth/dapp/./src/scripts/graph.js","webpack://@reality.eth/dapp/./src/scripts/index.js","webpack://@reality.eth/dapp/./src/scripts/common.js","webpack://@reality.eth/dapp/webpack/bootstrap","webpack://@reality.eth/dapp/webpack/runtime/amd options","webpack://@reality.eth/dapp/webpack/runtime/compat get default export","webpack://@reality.eth/dapp/webpack/runtime/define property getters","webpack://@reality.eth/dapp/webpack/runtime/global","webpack://@reality.eth/dapp/webpack/runtime/hasOwnProperty shorthand","webpack://@reality.eth/dapp/webpack/runtime/make namespace object","webpack://@reality.eth/dapp/webpack/runtime/node module decorator","webpack://@reality.eth/dapp/webpack/runtime/jsonp chunk loading","webpack://@reality.eth/dapp/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","'use strict';\n\nimport interact from 'interactjs';\nimport Ps from 'perfect-scrollbar';\n\nexport default function() {\n\nconst ethers = require(\"ethers\");\nconst timeago = require('timeago.js');\nconst timeAgo = new timeago();\nconst jazzicon = require('jazzicon');\nconst axios = require('axios');\nconst randomBytes = require('randombytes');\n\nrequire('jquery-ui/ui/widgets/datepicker.js');\nrequire('jquery-expander');\n\n$('body').addClass('via-node');\n\nlet provider;\nlet signer;\n\nconst rc_question = require('@reality.eth/reality-eth-lib/formatters/question.js');\nconst rc_template = require('@reality.eth/reality-eth-lib/formatters/template.js');\nconst rc_contracts = require('@reality.eth/contracts');\n\nlet TOKEN_INFO = {};\nlet CHAIN_INFO = {};\n\nlet TOKEN_JSON = {};\n\nlet IS_TOKEN_NATIVE = false;\nlet IS_WEB3_FALLBACK = false;\n\nlet ARBITRATOR_LIST_BY_CONTRACT = {};\nlet ARBITRATOR_VERIFIED_BY_CONTRACT = {};\nlet ARBITRATOR_FAILED_BY_CONTRACT = {};\nlet FOREIGN_PROXY_DATA = {};\nlet ARBITRATOR_METADATA = require('./arbitrator_metadata_legacy.json'); // Old contracts don't have this so hard-code it\n\nlet PENDING_USER_TXES_BY_CQID = {};\n\nconst TEMPLATE_CONFIG = rc_contracts.templateConfig();\nconst QUESTION_TYPE_TEMPLATES = TEMPLATE_CONFIG.base_ids;\n\n// Special ABIs for Kleros\nconst PROXIED_ARBITRATOR_ABI_OLD = require('./abi/kleros/ProxiedArbitratorOld.json');\nconst PROXIED_ARBITRATOR_ABI_NEW = require('./abi/kleros/ProxiedArbitratorNew.json');\n\nlet SUBMITTED_QUESTION_ID_BY_TIMESTAMP = {};\nlet USER_CLAIMABLE_BY_CONTRACT = {};\n\nlet CATEGORY = null;\nlet CONTRACT_TEMPLATE_CONTENT = {}; TEMPLATE_CONFIG.content;\n\nlet LAST_POLLED_BLOCK = null;\nlet IS_INITIAL_LOAD_DONE = false;\n\nlet USE_COMMIT_REVEAL = false;\n\nlet HOSTED_RPC_NODE = null;\n\nlet START_BLOCKS = {};\n\nlet CHAIN_ID = null;\nlet BLOCK_EXPLORER = null;\n\nconst FETCH_NUMBERS = [100, 2500, 5000];\n\nlet LAST_DISPLAYED_BLOCK_NUMBER = 0;\nlet CURRENT_BLOCK_NUMBER = 1;\n\nlet TOKEN_TICKER = null;\n\n// Question, as returned by questions()\nconst Qi_content_hash = 0;\nconst Qi_arbitrator = 1;\nconst Qi_opening_ts = 2;\nconst Qi_timeout = 3;\nconst Qi_finalization_ts = 4;\nconst Qi_is_pending_arbitration = 5;\nconst Qi_bounty = 6;\nconst Qi_best_answer = 7;\nconst Qi_history_hash = 8;\nconst Qi_bond = 9;\nconst Qi_min_bond = 10; // v3 or above only\n\nlet BLOCK_TIMESTAMP_CACHE = {};\n\n// Array of all questions that the user is interested in\nlet Q_MIN_ACTIVITY_BLOCKS = {};\n\n// These will be populated in onload, once the provider is loaded\nlet RC_INSTANCES = {};\nlet RC_INSTANCE_VERSIONS = {};\nlet RC_DEFAULT_ADDRESS = null;\nlet RC_DISPLAYED_CONTRACTS = [];\n\nlet ARBITRATOR_INSTANCE = null;\n\nlet ACCOUNT = null;\n\nlet DISPLAY_ENTRIES = {\n    'questions-active': {\n        'ids': [],\n        'vals': [],\n        'max_store': 50,\n        'max_show': 6\n    },\n    'questions-resolved': {\n        'ids': [],\n        'vals': [],\n        'max_store': 50,\n        'max_show': 6\n    },\n    'questions-closing-soon': {\n        'ids': [],\n        'vals': [],\n        'max_store': 50,\n        'max_show': 6\n    },\n    'questions-upcoming': {\n        'ids': [],\n        'vals': [],\n        'max_store': 50,\n        'max_show': 6\n    }\n}\n\n// data for question detail window\nlet QUESTION_DETAIL_CACHE = {};\nlet QUESTION_EVENT_TIMES = {}; // Hold timer IDs for things we display that need to be moved when finalized\n\nlet WINDOW_POSITION = [];\n\nfunction rand(min, max) {\n    return min + Math.floor(Math.random() * (max - min + 1));\n}\n\nfunction nonceFromSeed(paramstr) {\n\n    let seed = window.localStorage.getItem('commitment-seed');\n    if (seed == null) {\n        seed = randomBytes(32).toString('hex');\n        console.log('made seed', seed);\n        window.localStorage.setItem('commitment-seed', seed);\n    }\n\n    return uiHash(paramstr + seed);\n\n}\n\nasync function loadPendingTransactions(chain_id) {\n\n    let txliststr = window.localStorage.getItem('tx-'+chain_id);\n    //txliststr = '0x815a2c9da2280065fe317a913e0a6141c5a5e3342ec92e1e1c7115f3dd4d1ed6';\n    if (!txliststr) {\n        return;\n    }\n    // We don't use a delimiter as the 0x will delimit them\n    const txlist = txliststr.split('0x');\n    for (let i=0; i<txlist.length; i++) {\n        const txid = '0x' + txlist[i];\n        if (txid == '0x') {\n            continue;\n        }\n        // console.log('loadPendingTransactions txid', txid);\n        const tx = await provider.getTransaction(txid);\n        fillPendingUserTX(tx);\n    }\n    // console.log('PENDING_USER_TXES_BY_CQID', PENDING_USER_TXES_BY_CQID);\n    \n}\n\nfunction fillPendingUserTX(tx) {\n    \n    const txid = tx.hash;\n    const inst = RCInstance(tx.to);\n    if (!inst) {\n\tconsole.log('contract ',tx.to,' for txid not known', txid);\n\treturn;\n    }\n    const inf = inst.interface;\n    // console.log('inst is ', inst);\n    const dec = inf.parseTransaction(tx);\n    if (!dec) { \n\tconsole.log('could not parse tx', txid);\n    }\n    if (dec.functionFragment.name != 'submitAnswer' && dec.functionFragment.name != 'submitAnswerERC20') {\n\tconsole.log('txid',txid,'not submitAnswer, ignoring');\n    }\n    const cqid = cqToID(tx.to, dec.args.question_id);\n\n    // ERC20 will have the bond in the args, native will have it in the value\n    // TODO: native may be wrong if the arbitrator has a question fee\n    const bond = ('bond' in dec.args) ? dec.args.bond : dec.value;\n\n    const fake_history = {\n\t'args': {\n\t    'answer': dec.args.answer,\n\t    'question_id': dec.args.question_id,\n\t    'history_hash': null, // TODO Do we need this?\n\t    'user': ACCOUNT,\n\t    'bond': bond,\n\t    'ts': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)), // todo\n\t    'is_commitment': false // TODO\n\t},\n\t'event': 'LogNewAnswer',\n\t'blockNumber': tx.blockNumber,\n\t'txid': txid\n    };\n\n    if (!PENDING_USER_TXES_BY_CQID[cqid]) {\n\tPENDING_USER_TXES_BY_CQID[cqid] = {};\n    }\n    PENDING_USER_TXES_BY_CQID[cqid][bond.toHexString()] = fake_history;\n\n    // If we already had the question displayed when we discovered the pending transaction, update the window\n    if (QUESTION_DETAIL_CACHE[cqid]) {\n        QUESTION_DETAIL_CACHE[cqid] = mergeConfirmedTXes(QUESTION_DETAIL_CACHE[cqid]);\n        updateQuestionWindowIfOpen(QUESTION_DETAIL_CACHE[cqid]);\n    }\n\n    return true;\n\n}\n\nfunction mergeConfirmedTXes(question) {\n\n    // Make a lookup table of the history by bond\n    let history_bond_to_idx = {};\n    let history_unconfirmed_bond_to_idx = {};\n    if (question['history'] && question['history'].length > 0) {\n        for(let hi=0; hi<question['history'].length; hi++) {\n            if (!question['history'][hi].args) {\n                console.log('no args in history item',question['history'][hi]);\n                continue;\n            }\n            history_bond_to_idx[question['history'][hi].args.bond.toHexString()] = hi;\n        }\n    }\n    if (question['history_unconfirmed'] && question['history_unconfirmed'].length > 0) {\n        for(let ui=0; ui<question['history_unconfirmed'].length; ui++) {\n            if (!question['history_unconfirmed'][ui].args) {\n                console.log('no args in history_unconfirmed item',question['history_unconfirmed'][ui]);\n                continue;\n            }\n            history_unconfirmed_bond_to_idx[question['history_unconfirmed'][ui].args.bond.toHexString()] = ui;\n        }\n    }\n\n\n// If we have anything in the user pending pool that isn't in the unconfirmed list, add it to the unconfirmed pool\n    let pending_entries_by_bond = PENDING_USER_TXES_BY_CQID[contractQuestionID(question)];\n    if (pending_entries_by_bond) {\n        // console.log('got relevant pending_entries_by_bond', contractQuestionID(question), pending_entries_by_bond);\n        for (let b in pending_entries_by_bond) {\n            // If there's a confirmed history entry at that level, boot it\n            if (b in history_bond_to_idx) {\n                // If we have a reasonably deep number of confirmations, boot our pending TX which will clearly never be mined\n                // TODO: We might want to keep this somewhere and display that it failed instead of just pretending your failed tx never happened\n                const idx = history_bond_to_idx[b];\n                const purge_block_count = 20;\n                if ((question['history'][idx].blockNumber + purge_block_count) < CURRENT_BLOCK_NUMBER) {\n                    console.log('purging confirmed bond at level', b);\n                    clearPendingTXID(pending_entries_by_bond[b].txid, CHAIN_ID);\n                } else {\n                    console.log('pending tx confirmed but not purging yet in case of reorg, will purge at ', question['history'][idx].blockNumber + purge_block_count,', only at ',CURRENT_BLOCK_NUMBER, question['history'][idx]);\n                }\n                continue;\n            }\n            if (b in history_unconfirmed_bond_to_idx) {\n                console.log('unconfirmed list already has pending tx', b);\n                continue;\n            }\n            question['history_unconfirmed'].push(pending_entries_by_bond[b]);\n            console.log('added entry for bond', b);\n        }\n    }\n    return question;\n}\n\nfunction storePendingTXID(txid, chain_id) {\n    const MAX_PENDING_STORE = 20;\n    const ITEM_LENGTH = 66; // \"0x\" plus 32 hex characters\n    if (txid.length != ITEM_LENGTH) {\n        throw new Error(\"Unexpected txid length: \"+txid);\n    }\n    let current = window.localStorage.getItem('tx-'+chain_id);\n    if (current) {\n        if (current.includes(txid)) {\n            return true;\n        }\n        // To avoid running over storage, if we have more than MAX_PENDING_STORE, bin the earliest tx\n        if (current.length > (MAX_PENDING_STORE*ITEM_LENGTH)) {\n            current = current.substr(ITEM_LENGTH);\n        }\n    } else {\n        current = '';\n    }\n    window.localStorage.setItem('tx-'+chain_id, current + txid);\n    return true;\n}\n\nfunction clearPendingTXID(txid, chain_id) {\n    console.log('clearPendingTXID', txid, chain_id);\n    const ITEM_LENGTH = 66; // \"0x\" plus 32 hex characters\n    if (txid.length != ITEM_LENGTH) {\n        throw new Error(\"Unexpected txid length: \"+txid);\n    }\n    let current = window.localStorage.getItem('tx-'+chain_id);\n    window.localStorage.setItem('tx-'+chain_id, current.replace(txid, ''));\n}\n\n\nlet ZINDEX = 10;\n\nconst MONTH_LIST = [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'June',\n    'July',\n    'Aug',\n    'Sept',\n    'Oct',\n    'Nov',\n    'Dec'\n];\n\nfunction formatPossibleIPFSLink(u) {\n    if (!u) {\n        return '';\n    }\n    if (u.toLowerCase().substr(0, 7) == 'ipfs://') {\n        u = u.replace('ipfs://', 'https://ipfs.io/ipfs/');\n    } else {\n    }\n    return u;\n}\n\nfunction markArbitratorFailed(contract, addr, contract_question_id) {\n    ARBITRATOR_FAILED_BY_CONTRACT[contract.toLowerCase()][addr.toLowerCase()] = true;\n    if (contract_question_id) {\n        $('[data-contract-question-id=\"' + contract_question_id + '\"]').addClass('failed-arbitrator');\n    }\n}\n\nfunction setRcBrowserPosition(rcbrowser) {\n    // when position has been stored.\n    if (rcbrowser.hasClass('rcbrowser--qa-detail')) {\n        const contract_question_id = rcbrowser.attr('data-contract-question-id');\n        const [contract, question_id] = parseContractQuestionID(contract_question_id);\n        if (typeof WINDOW_POSITION[contract_question_id] !== 'undefined') {\n            const left = parseInt(WINDOW_POSITION[contract_question_id]['x']) + 'px';\n            const top = parseInt(WINDOW_POSITION[contract_question_id]['y']) + 'px';\n            rcbrowser.css('left', left);\n            rcbrowser.css('top', top);\n            return;\n        }\n    }\n\n    // when window is newly opend.\n    const winWidth = document.documentElement.clientWidth;\n    const winHeight = document.documentElement.clientHeight;\n    const paddingLeft = winWidth * 0.1;\n    const paddingTop = winHeight * 0.1;\n\n    let rcb_width = parseInt(rcbrowser.css('width').replace('px', ''));\n    let rcb_height = parseInt(rcbrowser.css('height').replace('px', ''));\n    let itemWidth = Math.min(rcb_width, winWidth * 0.9);\n    let itemHeight = Math.min(rcb_height, winHeight * 0.9);\n    let leftMax = winWidth - itemWidth - paddingLeft;\n    let topMax = winHeight - itemHeight - paddingTop;\n\n    if ((rcbrowser.attr('id') == 'post-a-question-window') || rcbrowser.hasClass('rcbrowser--qa-detail')) {\n        const left = (winWidth / 2) - (itemWidth / 2) + 'px';\n        const top = itemHeight / 10 + 'px';\n        rcbrowser.css('left', left);\n        rcbrowser.css('top', top);\n    }\n\n}\n\nfunction initScrollBars() {\n    const rcbrowsers = document.querySelectorAll('.rcbrowser-inner');\n\n    for (let i = 0, len = rcbrowsers.length; i < len; i += 1) {\n        // Initialize anything that isn't part of a template item.\n        // If it's a template item it should be initialized after it's cloned.\n        if (!$(rcbrowsers[i]).closest('.template-item').length) {\n            Ps.initialize(rcbrowsers[i]);\n        }\n    }\n\n    function changeSize() {\n        // TODO: Does this need to be added to items that are initialized later?\n        for (let i = 0, len = rcbrowsers.length; i < len; i += 1) {\n            Ps.update(rcbrowsers[i]);\n        }\n    }\n    window.addEventListener('resize', changeSize);\n}\n\ninitScrollBars();\n\n\n// draggable\ninteract('.rcbrowser-header').draggable({\n    // enable inertial throwing\n    inertia: false,\n    // keep the element within the area of it's parent\n    restrict: {\n        restriction: {\n            left: 0,\n            right: document.documentElement.clientWidth,\n            top: 0,\n            bottom: document.documentElement.clientHeight\n        },\n        endOnly: true,\n        elementRect: {\n            top: 0,\n            left: 0,\n            bottom: 1,\n            right: 1\n        }\n    },\n    // enable autoScroll\n    autoScroll: false,\n\n    // call this function on every dragmove event\n    onmove: dragMoveListener\n});\n\nfunction dragMoveListener(event) {\n    const target = event.target.parentNode.parentNode;\n    // keep the dragged position in the data-x/data-y attributes\n    const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;\n    const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\n\n    // translate the element\n    let top = parseInt(target.style.top);\n    if (top + y < 1) {\n        target.style.webkitTransform =\n            target.style.transform =\n            'translate(' + x + 'px, -' + top + 'px)';\n    } else {\n        target.style.webkitTransform =\n            target.style.transform =\n            'translate(' + x + 'px, ' + y + 'px)';\n    }\n\n    // update the posiion attributes\n    target.setAttribute('data-x', x);\n    target.setAttribute('data-y', y);\n}\n\nfunction RCStartBlock(ctr) {\n    return START_BLOCKS[ctr.toLowerCase()]; \n}\n\nfunction RCInstance(ctr, signed) {\n    if (!ctr) {\n        throw new Error(\"contract address not supplied\", ctr);\n    }\n    let ret = RC_INSTANCES[ctr.toLowerCase()];;\n    if (!ret) {\n        throw new Error(\"contract not found:\" + ctr + \":\"+ signed);\n    }\n    if (signed) {\n        return ret.connect(signer);\n    } \n    return ret;\n}\n\nfunction populateTOSSection(container, tos) {\n\n    const tos_section = container.find('div.arbitrator-tos');\n    if (tos) {\n        tos_section.find('.arbitrator-tos-link').attr('href', formatPossibleIPFSLink(tos));\n        container.addClass('has-arbitrator-tos');\n    } else {\n        tos_section.find('.arbitrator-tos-link').attr('href', '');\n        container.removeClass('has-arbitrator-tos');\n    }\n\n}\n\n$(document).on('change', 'input.arbitrator-other', function() {\n    const arb_text = $(this).val();\n    const sel_cont = $(this).closest('.select-container');\n    if (/^(0x)?[0-9a-f]{1,40}$/i.test(arb_text)) {\n        const ar = ARBITRATOR_INSTANCE.attach(arb_text);\n        ar.functions.realitio().then(async function(rcaddr_arr) {\n            const rcaddr = rcaddr_arr[0];\n            if (rcaddr != RCInstance(RC_DEFAULT_ADDRESS).address) {\n                console.log('reality check mismatch', rcaddr, RCInstance(RC_DEFAULT_ADDRESS).address);\n                return;\n            }\n\n            const metadata = await loadArbitratorMetaData(arb_text);\n            const tos = ('tos' in metadata) ? metadata['tos'] : null;\n\n            populateTOSSection(sel_cont, tos);\n\n            RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(arb_text).then(function(fee_arr) {\n                const fee = fee_arr[0];\n                populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), fee, null, tos);\n            }).catch(function() {\n                populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), ethers.BigNumber.from(0), null, tos);\n            });\n\n        }).catch(function(err) {\n            markArbitratorFailed(RC_DEFAULT_ADDRESS, arb_text);\n        });\n\n    } else {\n        populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), ethers.BigNumber.from(0));\n    }\n});\n\n$(document).on('change', 'select.arbitrator', function() {\n    console.log('arbitrator: ' + $(this).val());\n    if ($(this).val() == 'other') {\n        $(this).closest('form').find('input.arbitrator-other').show();\n    } else {\n        populateArbitratorOptionLabel($(this).find('option.arbitrator-other-select'), ethers.BigNumber.from(0));\n        $(this).closest('form').find('input.arbitrator-other').hide();\n    }\n    const op = $(this).find('option:selected');\n    const tos_url = op.attr('data-tos-url');\n    // console.log('tos_url', tos_url, 'op', op);\n\n    populateTOSSection($(this).closest('.select-container'), tos_url);\n});\n\n$(document).on('click', '.rcbrowser', function() {\n    ZINDEX += 1;\n    $(this).css('z-index', ZINDEX);\n    $('.ui-datepicker').css('z-index', ZINDEX + 1);\n    $(this).find('.question-setting-warning').find('.balloon').css('z-index', ++ZINDEX);\n    $(this).find('.question-setting-info').find('.balloon').css('z-index', ZINDEX);\n});\n\n// see all notifications\n$(function() {\n    $('.see-all-notifications').click(function() {\n        $(this).closest('#your-question-answer-window').removeClass('display-top-only').addClass('display-all');\n        return false;\n    });\n    $('.hide-lower-notifications').click(function() {\n        $(this).closest('#your-question-answer-window').addClass('display-top-only').removeClass('display-all');\n        return false;\n    });\n});\n\n\n/*-------------------------------------------------------------------------------------*/\n// window for posting a question\n\n$('#your-qa-button,.your-qa-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    getAccount().then(function() {\n        const yourwin = $('#your-question-answer-window');\n        yourwin.css('z-index', ++ZINDEX);\n        yourwin.addClass('is-open');\n        const winheight = (yourwin.height() > $(window).height()) ? $(window).height() : yourwin.height();\n        yourwin.css('height', winheight + 'px');\n        Ps.update(yourwin.find('.rcbrowser-inner').get(0));\n        $('.tooltip').removeClass('is-visible');\n        $('body').removeClass('pushing');\n        markViewedToDate();\n    });\n});\n\n$('#help-center-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#help-center-window').css('z-index', ++ZINDEX).addClass('is-open');\n});\n\nfunction setViewedBlockNumber(network_id, block_number) {\n    window.localStorage.setItem('viewedBlockNumber' + network_id, block_number);\n}\n\nfunction getViewedBlockNumber(network_id) {\n    return window.localStorage.getItem('viewedBlockNumber' + network_id);\n}\n\nfunction markViewedToDate() {\n    const vbn = parseInt(getViewedBlockNumber(CHAIN_ID));\n    if (vbn >= LAST_DISPLAYED_BLOCK_NUMBER) {\n        LAST_DISPLAYED_BLOCK_NUMBER = vbn;\n    } else {\n        setViewedBlockNumber(CHAIN_ID, LAST_DISPLAYED_BLOCK_NUMBER);\n    }\n}\n\nfunction humanToDecimalizedBigNumber(num, force_eth) {\n    const decimals = force_eth ? 18 : TOKEN_INFO[TOKEN_TICKER]['decimals'];\n    return ethers.utils.parseUnits(num, decimals);\n}\n\nfunction decimalizedBigNumberToHuman(num, force_eth) {\n    const decimals = force_eth ? 18 : TOKEN_INFO[TOKEN_TICKER]['decimals'];\n    return ethers.utils.formatUnits(num, decimals).replace(/\\.0+$/,'');\n}\n\nfunction humanReadableWei(amt) {\n    return decimalizedBigNumberToHuman(amt, true) + ' ETH';\n}\n\n$('#help-center-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#help-center-window').css('z-index', 0).removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n});\n\n\n$('#chain-list-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#chain-list-window').css('z-index', ++ZINDEX).addClass('is-open');\n});\n\n$('#chain-list-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#chain-list-window').css('z-index', 0).removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n});\n\n$('.chain-item a').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cid = $(this).closest('.chain-item').attr('data-chain-id')\n    window.location.hash = '!/network/'+cid;\n    window.location.reload(true);\n})\n\n$('#your-question-answer-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#your-question-answer-window').css('z-index', 0);\n    $('#your-question-answer-window').removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n    $('body').removeClass('pushing');\n    $('.tooltip').removeClass('is-visible');\n    markViewedToDate();\n});\n\n$('#post-a-question-button,.post-a-question-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let question_window = $('#post-a-question-window-template').clone().attr('id', 'post-a-question-window');\n    question_window.find('.rcbrowser__close-button').click(function() {\n        question_window.remove();\n        document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n    });\n\n    getAccount().then(function() {\n\n        $('#post-a-question-window-template').before(question_window);\n        $('#opening-ts-datepicker').datepicker({\n            dateFormat: 'yy-mm-dd',\n            onSelect: function(dateText) {\n                $(this).css('background-color', '#ffffff');\n            }\n        });\n\n        if (!question_window.hasClass('is-open')) {\n            question_window.css('z-index', ++ZINDEX);\n            question_window.addClass('is-open');\n            question_window.css('height', question_window.height() + 'px');\n            setRcBrowserPosition(question_window);\n        }\n        if (CATEGORY) {\n            question_window.find(\"[name='question-category']\").val(CATEGORY);\n        }\n\n        Ps.initialize(question_window.find('.rcbrowser-inner').get(0));\n\n        $(\"textarea[name='question-body']\").on('change keyup paste', function() {\n            if ($(this).val()==\"\"){\n                $(this).parent().addClass('is-error');\n            } else {\n                $(this).parent().removeClass('is-error');\n            }\n        });\n\n        $(\"select[name='question-category']\").change(function(){\n            $(this).addClass(\"selected\");\n\n            let optionLabel = \"Category: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n\n            $(this).parent().removeClass('is-error');\n        });\n\n        $(\"select[name='question-type']\").change(function(){\n            let optionLabel = \"Question Type: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n\n        $(\"select[name='step-delay']\").change(function(){\n            let optionLabel = \"Countdown: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n\n        $(\"select[name='arbitrator']\").change(function(){\n            $(this).addClass(\"selected\");\n            let optionLabel = \"Arbitrator: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n    });\n});\n\n$('#browse-question-button,.browse-question-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').addClass('page-qa');\n    $('#site-slogan-normal').css('display', 'none');\n    $('#site-slogan-browse-qa').css('display', 'block');\n    $('#site-introduction__buttons').css('visibility', 'hidden');\n});\n\n$('#site-logo').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').removeClass('page-qa');\n    $('#site-slogan-normal').css('display', 'block');\n    $('#site-slogan-browse-qa').css('display', 'none');\n    $('#site-introduction__buttons').css('visibility', 'visible');\n});\n\n$(document).on('click', '#post-a-question-window .close-question-window', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#post-a-question-window').css('z-index', 0);\n    $('#post-a-question-window').removeClass('is-open');\n});\n\n$(document).on('click', '#post-a-question-window .post-question-submit', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    await getAccount();\n\n    let win = $('#post-a-question-window');\n    const question_body = win.find('.question-body');\n    const reward_val = win.find('.question-reward').val();\n    const timeout = win.find('.step-delay');\n    const timeout_val = parseInt(timeout.val());\n    let arbitrator = win.find('.arbitrator').val();\n\n    const expected_question_fee_attr = win.find('.arbitrator option:selected').attr('data-question-fee');\n    const expected_question_fee = expected_question_fee_attr ? ethers.BigNumber.from(expected_question_fee_attr) : ethers.BigNumber.from(0);\n\n    if (arbitrator == 'other') {\n        arbitrator = win.find('input.arbitrator-other').val();\n    }\n    const question_type = win.find('.question-type');\n    const answer_options = win.find('.answer-option');\n    const opening_ts_val = win.find('.opening-ts').val();\n\n    const category = win.find('div.select-container--question-category select');\n    let outcomes = [];\n    for (let i = 0; i < answer_options.length; i++) {\n        outcomes[i] = answer_options[i].value;\n    }\n    const reward = (reward_val == '') ? ethers.BigNumber.from(0) : humanToDecimalizedBigNumber(reward_val);\n\n    if (!validate(win)) {\n        return;\n    }\n\n    const qtype = question_type.val();\n    const template_id = rc_template.defaultTemplateIDForType(qtype);\n    const qtext = rc_question.encodeText(qtype, question_body.val(), outcomes, category.val());\n    let opening_ts = 0;\n    if (opening_ts_val != '') {\n        opening_ts = new Date(opening_ts_val);\n        opening_ts = parseInt(opening_ts / 1000);\n    }\n\n    const rcver = RC_INSTANCE_VERSIONS[RC_DEFAULT_ADDRESS.toLowerCase()];\n\n    let min_bond = ethers.BigNumber.from(0);\n    if (win.hasClass('version-supports-min-bond')) {\n        const min_bond_val = win.find('.question-min-bond').val();\n        min_bond = humanToDecimalizedBigNumber(min_bond_val);\n    }\n\n    const question_id = rc_question.questionID(template_id, qtext, arbitrator, timeout_val, opening_ts, ACCOUNT, 0, min_bond.toHexString(), RC_DEFAULT_ADDRESS, rcver);\n    //console.log('question_id inputs for id ', question_id, template_id, qtext, arbitrator, timeout_val, opening_ts, ACCOUNT, 0);\n    //console.log('content_hash inputs for content hash ', rc_question.contentHash(template_id, opening_ts, qtext), template_id, opening_ts, qtext);\n\n    const is_ok = await validateArbitratorForContract(RC_DEFAULT_ADDRESS, arbitrator);\n    if (!is_ok) {\n        console.log('bad arbitrator');\n        return;\n    }\n\n    const fee_response = await RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(arbitrator);\n    // console.log('got fee response', fee_response, 'for arb', arbitrator);\n    const fee = fee_response[0];\n    if (!fee.eq(expected_question_fee)) {\n        console.log('fee has changed');\n        populateArbitratorOptionLabel(win.find('.arbitrator option:selected'), fee);\n        return;\n    }\n\n    const handleAskQuestionTX = async function(tx_response) {\n        //console.log('sent tx with id', txid);\n\n        const txid = tx_response.hash;\n        const contract = RC_DEFAULT_ADDRESS;\n\n        // Make a fake log entry\n        const fake_log = {\n            'entry': 'LogNewQuestion',\n            'blockNumber': 0, // unconfirmed\n            'args': {\n                'question_id': question_id,\n                'user': ACCOUNT,\n                'arbitrator': arbitrator,\n                'timeout': ethers.BigNumber.from(timeout_val),\n                'content_hash': rc_question.contentHash(template_id, opening_ts, qtext),\n                'template_id': ethers.BigNumber.from(template_id),\n                'question': qtext,\n                'created': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)),\n                'opening_ts': ethers.BigNumber.from(parseInt(opening_ts))\n            },\n            'address': contract \n        }\n        const fake_call = [];\n        fake_call[Qi_finalization_ts] = ethers.BigNumber.from(0);\n        fake_call[Qi_is_pending_arbitration] = false;\n        fake_call[Qi_arbitrator] = arbitrator;\n        fake_call[Qi_timeout] = ethers.BigNumber.from(timeout_val);\n        fake_call[Qi_content_hash] = rc_question.contentHash(template_id, parseInt(opening_ts), qtext),\n        fake_call[Qi_bounty] = reward;\n        fake_call[Qi_best_answer] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_bond] = ethers.BigNumber.from(0);\n        fake_call[Qi_min_bond] = min_bond;\n        fake_call[Qi_history_hash] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_opening_ts] = ethers.BigNumber.from(opening_ts);\n\n        let q = filledQuestionDetail(contract, question_id, 'question_log', 0, fake_log);\n        q = filledQuestionDetail(contract, question_id, 'question_call', 0, fake_call);\n        q = filledQuestionDetail(contract, question_id, 'question_json', 0, rc_question.populatedJSONForTemplate(CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id], qtext, true));\n\n        // Turn the post question window into a question detail window\n        let rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        win.html(rcqa.html());\n        win = populateQuestionWindow(win, q, false);\n\n        // TODO: Once we have code to know which network we're on, link to a block explorer\n        win.find('.pending-question-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        win.find('.pending-question-txid a').text(txid.substr(0, 12) + \"...\");\n        win.addClass('unconfirmed-transaction').addClass('has-warnings');\n        win.attr('data-pending-txid', txid);\n\n        const contract_question_id = contractQuestionID(q);\n\n        win.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {};\n            WINDOW_POSITION[contract_question_id]['x'] = left;\n            WINDOW_POSITION[contract_question_id]['y'] = top;\n            win.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        set_hash_param({'question': contractQuestionID(q)});\n\n        const window_id = 'qadetail-' + contractQuestionID(q);\n        win.removeClass('rcbrowser--postaquestion').addClass('rcbrowser--qa-detail');\n        win.attr('id', window_id);\n        win.attr('data-contract-question-id', contractQuestionID(q));\n        Ps.initialize(win.find('.rcbrowser-inner').get(0));\n\n        // Once confirmed, slot into the front page\n        await tx_response.wait();\n        await delay(3000);\n\n        handleQuestionLog(fake_log);\n\n    }\n\n    const signedRC = RCInstance(RC_DEFAULT_ADDRESS, true);\n    let tx_response = null;\n    if (IS_TOKEN_NATIVE) { \n        if (min_bond.gt(0)) {\n            tx_response = await signedRC.functions.askQuestionWithMinBond(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, min_bond, {\n                from: ACCOUNT,\n                // gas: 200000,\n                value: reward.add(fee)\n            });\n        } else {\n            tx_response = await signedRC.functions.askQuestion(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, {\n                from: ACCOUNT,\n                // gas: 200000,\n                value: reward.add(fee)\n            });\n        }\n    } else {\n        const cost = reward.add(fee);\n        await ensureAmountApproved(RCInstance(RC_DEFAULT_ADDRESS).address, ACCOUNT, cost);\n        if (min_bond.gt(0)) {\n            tx_response = await signedRC.functions.askQuestionWithMinBondERC20(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, min_bond, cost, {\n                from: ACCOUNT,\n                // gas: 200000,\n            })\n        } else {\n            tx_response = await signedRC.functions.askQuestionERC20(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, cost, {\n                from: ACCOUNT,\n                // gas: 200000,\n            })\n        }\n    }\n    handleAskQuestionTX(tx_response);\n\n});\n\nfunction isArbitratorValid(arb) {\n    let found = false;\n    let arbitrator_addrs = $('select.arbitrator').children();\n    arbitrator_addrs.each(function() {\n        if ($(this).val().toLowerCase() == arb.toLowerCase()) {\n            found = true;\n            return false;\n        }\n    });\n    return found;\n}\n\n// Check if an arbitrator is valid when we have not yet had time to contact all the arbitrator contracts\n// This is used for fast rendering of the warnings on the list page.\n// TODO: We should really go back through them later and set warnings on anything that turned out to be bad\nfunction isArbitratorValidFast(contract, test_arb) {\n    for (const a in ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()]) {\n        if (a.toLowerCase() == test_arb.toLowerCase()) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction arbitratorAddressToText(contract, addr) {\n    for (const a in ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()]) {\n        if (a.toLowerCase() == addr.toLowerCase()) {\n            return ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()][a.toLowerCase()];\n        }\n    }\n    return addr;\n}\n\nfunction isArbitrationPending(question) {\n    return (question.is_pending_arbitration);\n}\n\n// Return true if a user has started a commit or given an answer\n// NB Returns true even if the answer has timed out\nfunction isAnswerActivityStarted(question) {\n    if (isAnswered(question)) {\n        return true;\n    }\n    const history_hash = ethers.BigNumber.from(question.history_hash);\n    return (history_hash.gt(0));\n}\n\nfunction historyItemForCurrentAnswer(question) {\n    if (question['history'].length) {\n        for (let i=question['history'].length-1; i >= 0; i--) {\n            const item = question['history'][i].args;\n            if (!item.is_commitment || item.revealed_block) {\n                return item;\n            }\n        }\n    }\n    return null;\n}\n\nfunction isTopAnswerRevealable(question) {\n    // console.log('in isTopAnswerRevealable');\n    if (!isAnswerActivityStarted(question)) {\n        return false;\n    }\n    // console.log('history', question['history']);\n    if (question['history'].length == 0) {\n        return false;\n    }\n    const idx = question['history'].length - 1;\n    const item = question['history'][idx].args;\n    if (!item.is_commitment) {\n        return false;\n    }\n    if (item.revealed_block) {\n        return false;\n    }\n    if (isCommitExpired(question, item['ts'].toNumber())) {\n        return false;\n    }\n    return true;\n}\n\nfunction hasUnrevealedCommits(question) {\n    if (!isAnswerActivityStarted(question)) {\n        return false;\n    }\n    if (question['history'].length) {\n        for (let i=0; i<question['history'].length; i++) {\n            const item = question['history'][i].args;\n            if (item.is_commitment && !item.revealed_block) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n// Return true if there's a completed answer...\n// ...or if there's an uncommitted answer that hasn't timed out yet\n// TODO: Check for timeouts\nfunction isAnsweredOrAnswerActive(question) {\n    if (isAnswered(question)) {\n        return true;\n    }\n    const history_hash = ethers.BigNumber.from(question.history_hash);\n    return (history_hash.gt(0));\n}\n\nfunction isAnswered(question) {\n    const finalization_ts = question.finalization_ts.toNumber();\n    return (finalization_ts > 1);\n}\n\nfunction commitExpiryTS(question, posted_ts) {\n    const commit_secs = question.timeout.div(8);\n    return posted_ts.add(commit_secs);\n}\n\nfunction isCommitExpired(question, posted_ts) {\n    const commit_secs = question.timeout.toNumber() / 8;\n    // console.log('commit secs are ', commit_secs);\n    return new Date().getTime() > (( posted_ts + commit_secs ) * 1000);\n}\n\nfunction isFinalized(question) {\n    if (isArbitrationPending(question)) {\n        return false;\n    }\n    const fin = question.finalization_ts.toNumber()\n    const res = ((fin > 1) && (fin * 1000 < new Date().getTime()));\n    return res;\n}\n\n// Return true if the question looks like it could be reopened.\n// Doesn't check whether it already has been.\nfunction isReopenCandidate(question) {\n    if (!isFinalized(question)) {\n        return false;\n    }\n    if (question.best_answer != rc_question.getAnsweredTooSoonValue()) {\n        return false;\n    }\n    if (!rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[question.contract.toLowerCase()], 'reopen-question')) {\n        return false;\n    }\n    return true;\n}\n\n// Assumes we already filled the data\nfunction isReopenable(question) {\n    // TODO: Check if it can be re-reopened\n    // console.log('reopened_by is ', question.reopened_by);\n    // console.log('last_reopened_by is ', question.last_reopened_by);\n    if (question.reopened_by && question.reopened_by != '0x0000000000000000000000000000000000000000000000000000000000000000') {\n        // console.log('already reopened');\n        return false;\n    }\n    if (question.is_reopener) {\n        // console.log('already reopening something else');\n        return false;\n    }\n    return isReopenCandidate(question);\n}\n\n$(document).on('click', '.answer-claim-button', function() {\n\n    const contract = $(this).closest('.contract-claim-section').attr('data-contract');\n\n    const is_single_question = !$(this).hasClass('claim-all');\n\n    const doClaim = function(contract, is_single_question, question_detail) {\n\n        let claim_args = {};\n        let claiming = {};\n        if (is_single_question) {\n\n            claiming = possibleClaimableItems(question_detail);\n            claim_args = claiming;\n\n            //console.log('try9ing to claim ', claimable['total'].toString());\n            if (claim_args['total'].isZero()) {\n                //console.log('nothing to claim');\n                // Nothing there, so force a refresh\n                openQuestionWindow(contractQuestionID(question_detail));\n                if (USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n                    delete USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question_id];\n                }\n            }\n\n        } else {\n\n            claiming = USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()];\n            claim_args = mergePossibleClaimable(claiming);\n\n        }\n\n        // estimateGas gives us a number that credits the eventual storage refund.\n        // However, this is only supplied at the end of the transaction, so we need to send more to get us to that point.\n        // MetaMask seems to add a bit extra, but it's not enough.\n        // Get the number via estimateGas, then add 60000 per question, which should be the max storage we free.\n\n        // For now hard-code a fairly generous allowance\n        // Tried earlier with single answerer:\n        //  1 answer 48860\n        //  2 answers 54947\n        //  5 answers 73702\n\n        const gas = 140000 + (30000 * claim_args['history_hashes'].length);\n        const signedRC = RCInstance(contract, true); \n        console.log('claiming:', claim_args['question_ids'], claim_args['answer_lengths'], claim_args['history_hashes'], claim_args['answerers'], claim_args['bonds'], claim_args['answers']);\n        signedRC.functions.claimMultipleAndWithdrawBalance(claim_args['question_ids'], claim_args['answer_lengths'], claim_args['history_hashes'], claim_args['answerers'], claim_args['bonds'], claim_args['answers'], {\n            from: ACCOUNT \n            //gas: gas\n        }).then(function(tx_response) {\n            const txid = tx_response.hash;\n            //console.log('claiming is ',claiming);\n            //console.log('claim result txid', txid);\n            for (const qid in claiming) {\n                if (claiming.hasOwnProperty(qid)) {\n                    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n                        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n                    }\n                    if (USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][qid]) {\n                        USER_CLAIMABLE_BY_CONTRACT[contract][qid].txid = txid;\n                    }\n                }\n            }\n            updateClaimableDisplay(contract);\n            updateUserBalanceDisplay();\n        });\n    }\n\n    if (is_single_question) {\n        const contract_question_id = $(this).closest('.rcbrowser--qa-detail').attr('data-contract-question-id');\n        const [ctr, question_id] = parseContractQuestionID(contract_question_id);\n        if (ctr != contract) {\n            throw new Error(\"Contract ID mismatch\", ctr, contract);\n        }\n        ensureQuestionDetailFetched(contract, question_id).then(function(qdata) {\n            doClaim(contract, is_single_question, qdata);\n        });\n    } else {\n        // TODO: Should we be refetching all the questions we plan to claim for?\n        doClaim(contract, is_single_question);\n    }\n\n});\n\nfunction validate(win) {\n    let valid = true;\n\n    const qtext = win.find('.question-body');\n    if (qtext.val() == '') {\n        qtext.closest('div').addClass('is-error');\n        valid = false;\n    } else {\n        qtext.closest('div').removeClass('is-error');\n    }\n\n    let reward = win.find('.question-reward');\n    if (reward.val() === '') {\n        reward.parent().parent().addClass('is-error');\n        valid = false;\n    } else {\n        reward.parent().parent().removeClass('is-error');\n    }\n\n    if (win.hasClass('version-supports-min-bond')) {\n        let min_bond_inp = win.find('.question-min-bond');\n        let is_bond_err = false;\n        try {\n            // Parse the number and make sure it works\n            humanToDecimalizedBigNumber(min_bond_inp.val());\n        } catch (e) {\n            console.log('min bond parse err', e);\n            is_bond_err = true;\n        }\n        if (is_bond_err) {\n            min_bond_inp.parent().parent().addClass('is-error');\n            valid = false;\n        } else {\n            min_bond_inp.parent().parent().removeClass('is-error');\n        }\n    }\n\n    let options_num = 0;\n    const question_type = win.find('.question-type');\n    const answer_options = $('.answer-option').toArray();\n    for (let i = 0; i < answer_options.length; i++) {\n        if (answer_options[i].value !== '') {\n            options_num += 1;\n        }\n    }\n\n    if (win.find('.answer-option-container').hasClass('is-open') && question_type.val().indexOf('select') != -1 && options_num < 2) {\n        $('.edit-option-inner').addClass('is-error');\n        valid = false;\n    } else {\n        $('.edit-option-inner').removeClass('is-error');\n    }\n\n    const select_ids = ['.question-type', '.arbitrator', '.step-delay', '.question-category'];\n    for (const id of select_ids) {\n        if (win.find(id).val() == \"default\") {\n            win.find(id).parent().addClass('is-error');\n            valid = false;\n        } else {\n            win.find(id).parent().removeClass('is-error');\n        }\n    }\n\n    //console.log('valid is ', valid);\n    return valid;\n}\n\n/*-------------------------------------------------------------------------------------*/\n// make questions list\n\n$('div.loadmore-button').on('click', function(e) {\n    const sec = $(this).attr('data-questions');\n    //console.log('loading more sec', sec);\n\n    const old_max = DISPLAY_ENTRIES[sec]['max_show'];\n    const new_max = old_max + 3;\n\n    const num_in_doc = $('#' + sec).find('.questions__item').length;\n\n    DISPLAY_ENTRIES[sec]['max_show'] = new_max;\n\n    // TODO: We may need to refetch to populate this store\n    DISPLAY_ENTRIES[sec]['max_store'] = DISPLAY_ENTRIES[sec]['max_store'] + 3;\n\n    for (let i = num_in_doc; i < new_max && i < DISPLAY_ENTRIES[sec]['ids'].length; i++) {\n        const nextid = DISPLAY_ENTRIES[sec]['ids'][i];\n        const [next_ctr, next_question_id] = parseContractQuestionID(nextid);\n        let previd = null;\n        if (i > 0) {\n            previd = DISPLAY_ENTRIES[sec]['ids'][i + 1];\n        }\n        //console.log('populatewith', previd, nextid, QUESTION_DETAIL_CACHE);\n        // TODO: Handle multiple contracts\n        ensureQuestionDetailFetched(next_ctr, next_question_id, 1, 1, 1, -1).then(function(qdata) {\n            populateSection(sec, qdata, previd);\n        });\n    }\n\n});\n\n// This gets called when we discover an event that may be related to the user.\n// We may or may not have already seen this event.\n// We may or may not have known that the event was related to the user already.\n// We may or may not have fetched information about the question.\nasync function handlePotentialUserAction(entry, is_watch) {\n    //console.log('handlePotentialUserAction for entry', entry.args.user, entry, is_watch);\n\n    if (entry.invalid_data) { \n        console.log('skipping invalid log entry');\n        return;\n    }\n\n    if (!ACCOUNT) {\n        return;\n    }\n\n    if ((entry['event'] == 'LogNewTemplate') || (entry['event'] == 'LogWithdraw')) {\n        return;\n    }\n\n    if (!entry || !entry.args || !entry.args['question_id'] || !entry.blockNumber) {\n        console.log('expected content not found in entry', !entry, !entry.args, !entry.args['question_id'], !entry.blockNumber, entry);\n        return;\n    }\n\n    const contract = entry.address;\n\n    // This is the same for all events\n    const question_id = entry.args['question_id'];\n    const contract_question_id = cqToID(contract, question_id);\n    // console.log('handlePotentialUserAction made contract_question_id', contract_question_id);\n\n    // If this is the first time we learned that the user is involved with this question, we need to refetch all the other related logs\n    // ...in case we lost one due to a race condition (ie we had already got the event before we discovered we needed it)\n    // TODO: The filter could be tigher on the case where we already knew we had it, but we didn't know how soon the user was interested in it\n    if ((!Q_MIN_ACTIVITY_BLOCKS[contract_question_id]) || (entry.blockNumber < Q_MIN_ACTIVITY_BLOCKS[contract_question_id])) {\n        // Event doesn't, in itself, have anything to show we are interested in it\n        // NB we may be interested in it later if some other event shows that we should be interested in this question.\n        if (!isForCurrentUser(entry)) {\n            // console.log('entry', entry.args['question_id'], 'not interesting to account', entry, account);\n            return;\n        }\n\n        //console.log('blockNumber was ', entry.blockNumber);\n        Q_MIN_ACTIVITY_BLOCKS[contract_question_id] = entry.blockNumber;\n\n        fetchUserEventsAndHandle(null, entry.address, question_id, RCStartBlock(contract), 'latest');\n\n        updateUserBalanceDisplay();\n\n    }\n\n    let lastViewedBlockNumber = 0;\n    if (getViewedBlockNumber(CHAIN_ID)) {\n        lastViewedBlockNumber = parseInt(getViewedBlockNumber(CHAIN_ID));\n    }\n    if (entry.blockNumber > lastViewedBlockNumber) {\n        $('body').addClass('pushing');\n    }\n\n    let is_population_done = false;\n\n    // User action\n    //console.log('got event as user action', entry);\n    if ((entry['event'] == 'LogNewAnswer') && (SUBMITTED_QUESTION_ID_BY_TIMESTAMP[contract_question_id] > 0)) {\n        delete SUBMITTED_QUESTION_ID_BY_TIMESTAMP[contract_question_id];\n        const question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, entry.blockNumber, entry.blockNumber);\n        displayQuestionDetail(question);\n        renderUserAction(question, entry, is_watch);\n    } else {\n        // console.log('fetch for notifications: ', question_id, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n        const question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER)\n        if ((entry['event'] == 'LogNewAnswer') || (entry['event'] == 'LogClaim') || (entry['event'] == 'LogFinalize')) {\n            // console.log('got event, checking effect on claims', entry, question, is_watch, contract);\n            if (updateClaimableDataForQuestion(question, entry, is_watch)) {\n                updateClaimableDisplay(contract);\n                updateUserBalanceDisplay();\n            }\n        }\n        //console.log('rendering entry', entry);\n        renderUserAction(question, entry, is_watch);\n        //console.log('got error fetching: ', question_id, e);\n    }\n\n}\n\nfunction updateClaimableDataForQuestion(question, answer_entry, is_watch) {\n    const contract = question.contract;\n    const poss = possibleClaimableItems(question);\n    //console.log('made poss for question', poss, question.question_id);\n    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n    }\n    if (poss['total'].isZero()) {\n        delete USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question.question_id];\n    } else {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question.question_id] = poss;\n    }\n    return true; // TODO: Make this only return true if it changed something\n}\n\nasync function updateClaimableDisplay(contract) {\n    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n    }\n    const unclaimed = mergePossibleClaimable(USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], false);\n    // console.log('updateClaimableDisplay with user_claimable, unclaimed', USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], unclaimed);\n    const claiming = mergePossibleClaimable(USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], true);\n    const sec = $('.contract-claim-section').filter('[data-contract=' + contract.toLowerCase() + ']'); \n    if (claiming.total.gt(0)) {\n        const txids = claiming.txids;\n        sec.find('.answer-claiming-container').find('.claimable-eth').text(decimalizedBigNumberToHuman(claiming.total));\n        const txid = txids.join(', '); // TODO: Handle multiple links properly\n        sec.find('.answer-claiming-container').find('a.txid').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        sec.find('.answer-claiming-container').find('a.txid').text(txid.substr(0, 12) + \"...\");\n        sec.find('.answer-claiming-container').show();\n    } else {\n        sec.find('.answer-claiming-container').fadeOut();\n    }\n\n    const balance_arr = await RCInstance(contract).functions.balanceOf(ACCOUNT); \n    const balance = balance_arr[0];\n    const ttl = balance.add(unclaimed.total);\n    if (ttl.gt(0)) {\n        sec.find('.answer-claim-button.claim-all').find('.claimable-eth').text(decimalizedBigNumberToHuman(ttl));\n        sec.find('.answer-claim-button.claim-all').show();\n    } else {\n        sec.find('.answer-claim-button.claim-all').fadeOut();\n    }\n\n}\n\nfunction mergePossibleClaimable(posses, pending) {\n    const combined = {\n        'txids': [],\n        'total': ethers.BigNumber.from(0),\n        'question_ids': [],\n        'answer_lengths': [],\n        'answers': [],\n        'answerers': [],\n        'bonds': [],\n        'history_hashes': []\n    }\n    for (const qid in posses) {\n        if (posses.hasOwnProperty(qid)) {\n            if (!pending && posses[qid].txid) {\n                continue;\n            }\n            if (pending && !posses[qid].txid) {\n                continue;\n            }\n            combined['total'] = combined['total'].add(posses[qid].total);\n            combined['question_ids'].push(...posses[qid].question_ids);\n            combined['answer_lengths'].push(...posses[qid].answer_lengths);\n            combined['answers'].push(...posses[qid].answers);\n            combined['answerers'].push(...posses[qid].answerers);\n            combined['bonds'].push(...posses[qid].bonds);\n            combined['history_hashes'].push(...posses[qid].history_hashes);\n            if (posses[qid].txid) {\n                if (combined['txids'].indexOf(posses[qid].txid) === -1) {\n                    combined['txids'].push(posses[qid].txid);\n                }\n            }\n        }\n    }\n    return combined;\n}\n\nfunction scheduleFinalizationDisplayUpdate(contract, question) {\n    //console.log('in scheduleFinalizationDisplayUpdate', question);\n    // TODO: The layering of this is a bit weird, maybe it should be somewhere else?\n    if (!isFinalized(question) && isAnswered(question) && !isArbitrationPending(question)) {\n        const question_id = question.question_id;\n        const contract_question_id = contractQuestionID(question);\n        let is_done = false;\n        if (QUESTION_EVENT_TIMES[contract_question_id]) {\n            if (QUESTION_EVENT_TIMES[contract_question_id].finalization_ts == question.finalization_ts) {\n                //console.log('leaving existing timeout for question', question_id)\n                is_done = true;\n            } else {\n                clearTimeout(QUESTION_EVENT_TIMES[contract_question_id].timeout_id);\n                //console.log('clearing timeout for question', question_id)\n            }\n        }\n        if (!is_done) {\n            //console.log('scheduling');\n            // Run 1 second after the finalization timestamp\n            const update_time = (1000 + (question.finalization_ts.toNumber() * 1000) - new Date().getTime());\n            //console.log('update_time is ', update_time);\n            const timeout_id = setTimeout(function() {\n                // TODO: Call again here in case it changed and we missed it\n                clearTimeout(QUESTION_EVENT_TIMES[contract_question_id].timeout_id);\n                delete QUESTION_EVENT_TIMES[contract_question_id];\n\n                ensureQuestionDetailFetched(question.contract, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER).then(function(question) {\n\n                    if (isFinalized(question)) {\n                        updateQuestionWindowIfOpen(question);\n                        updateRankingSections(question, 'finalization_ts', question.finalization_ts);\n\n                        // The notification code sorts by block number\n                        // So get the current block\n                        // But also add the timestamp for display\n                        provider.getBlock('latest', function(err, result) {\n                            // There no blockchain event for this, but otherwise it looks to the UI like a normal event\n                            // Make a pretend log to feed to the notifications handling function.\n                            BLOCK_TIMESTAMP_CACHE[result.number] = result.timestamp\n                            const fake_entry = {\n                                event: 'LogFinalize',\n                                blockNumber: result.number,\n                                timestamp: question.finalization_ts.toNumber(),\n                                address: question.contract,\n                                args: {\n                                    question_id: question.question_id,\n                                }\n                            }\n                            // console.log('sending fake entry', fake_entry, question);\n                            if (updateClaimableDataForQuestion(question, fake_entry, true)) {\n                                updateClaimableDisplay(contract);\n                                updateUserBalanceDisplay();\n                            }\n\n                            renderNotifications(question, fake_entry);\n                        });\n                    }\n\n                });\n\n            }, update_time);\n            QUESTION_EVENT_TIMES[contract_question_id] = {\n                'finalization_ts': question.finalization_ts,\n                'timeout_id': timeout_id\n            };\n        }\n    } else {\n        //console.log('scheduling not doing: ', isFinalized(question), isAnswered(question));\n    }\n\n}\n\nfunction isAnythingUnrevealed(question) {\n    console.log('isAnythingUnrevealed pretending everything is revealed');\n    return false;\n}\n\nasync function _ensureAnswerRevealsFetched(contract, question_id, freshness, start_block, question, found_at_block) {\n    const called_block = found_at_block ? found_at_block : CURRENT_BLOCK_NUMBER;\n    let earliest_block = 0;\n    let bond_indexes = {};\n    //console.log('checking his', question['history']);\n    for (let i=0; i<question['history'].length; i++) {\n        if (question['history'][i].args['is_commitment']) {\n            if (!question['history'][i].args['revealed_block']) {\n                const bond_hex = question['history'][i].args['bond'].toHexString(); // TODO-check-0x\n                // console.log('_ensureAnswerRevealsFetched found commitment, block', earliest_block, 'bond', bond_hex);\n                bond_indexes[bond_hex] = i;\n                if (earliest_block == 0 || earliest_block > question['history'][i].blockNumber) {\n                    earliest_block = question['history'][i].blockNumber;\n                }\n            }\n        }\n    }\n    // console.log('earliest_block', earliest_block);\n    if (earliest_block > 0) {\n        const reveal_filter = RCInstance(contract).filters.LogAnswerReveal(question_id);\n        const answer_arr = await RCInstance(contract).queryFilter(reveal_filter, start_block, 'latest');\n        // console.log('got reveals', answer_arr);\n        for(let j=0; j<answer_arr.length; j++) {\n            const bond_hex = answer_arr[j].args['bond'].toHexString(); // TODO-check-0x\n            const idx = bond_indexes[bond_hex];\n            // Copy the object as we are not allowed to extend the original one\n            let args = Object.assign({}, question['history'][idx].args);\n            // console.log(question_id, bond.toHexString(), 'update answer, before->after:', question['history'][idx].answer, answer_arr[j].args['answer']);\n            args['revealed_block'] = answer_arr[j].blockNumber;\n            args['answer'] = answer_arr[j].args['answer'];\n            const commitment_id = rc_question.commitmentID(question_id, answer_arr[j].args['answer_hash'], bond_hex);\n            args['commitment_id'] = commitment_id;\n            question['history'][idx].args = args;\n            delete bond_indexes[bond_hex];\n        }\n        QUESTION_DETAIL_CACHE[contractQuestionID(question)] = question; // TODO : use filledQuestionDetail here? \n        //console.log('populated question, result is', question);\n        //console.log('bond_indexes once done', bond_indexes);\n    } \n    return question;\n}\n\n\nfunction filledQuestionDetail(contract, question_id, data_type, freshness, data) {\n\n    if (!question_id) {\n        console.log(contract, question_id, data_type, freshness, data);\n        throw Error(\"filledQuestionDetail called without question_id, wtf\")\n    }\n\n    // Freshness should look like this:\n    // {question_log: 0, question_call: 12345, answers: -1}\n\n    // Freshness is used to tell us at what block the data was current.\n    // Since events can arrive out of order, we may get data that was older than what we already have, which we should ignore.\n    // When querying data, freshness is used to tell us how new we need the data to be, ie if we already have data for a block, we don't need to fetch it again.\n\n    // A request for freshness of -1 indicates that we don't need to fetch the data for a particular request.\n\n    // Data should look like this:\n    // {question_log: {}, question_call: {}, answers: []} )\n\n    // TODO: Maybe also need detected_last_changes for when we know data will change, but don't want to fetch it unless we need it\n\n    let question = {\n        'freshness': {\n            'question_log': -1,\n            'question_json': -1,\n            'question_call': -1,\n            'answers': -1\n        },\n        'history': [],\n        'history_unconfirmed': []\n    };\n    question.question_id = question_id;\n    question.contract = contract;\n    const contract_question_id = contractQuestionID(question);\n    if (QUESTION_DETAIL_CACHE[contract_question_id]) {\n        question = QUESTION_DETAIL_CACHE[contract_question_id];\n    }\n\n    switch (data_type) {\n\n        case 'question_log':\n            if (data && (freshness >= question.freshness.question_log)) {\n                question.freshness.question_log = freshness;\n                //question.question_id = data.args['question_id'];\n                question.arbitrator = data.args['arbitrator'];\n                question.creation_ts = data.args['created'];\n                question.question_creator = data.args['user'];\n                question.question_created_block = data.blockNumber;\n                question.content_hash = data.args['content_hash'];\n                try {\n                    question.question_text = data.args['question'];\n                } catch (e) {\n                    question.question_text = '[ABI decoding Error]';\n                    console.log(e, data.args);\n                }                \n                question.template_id = data.args['template_id'].toNumber();\n                question.block_mined = data.blockNumber;\n                question.opening_ts = ethers.BigNumber.from(data.args['opening_ts']);\n                question.contract = data.address;\n                question.version_number = RC_INSTANCE_VERSIONS[question.contract.toLowerCase()];\n                if ('reopener_of_question_id' in data.args) {\n                    question.reopener_of_question_id = data.args['reopener_of_question_id'];\n                }\n                //question.bounty = data.args['bounty'];\n            }\n            break;\n\n        case 'question_json':\n            if (data && (freshness >= question.freshness.question_json)) {\n                question.freshness.question_json = freshness;\n                question.question_json = data;\n                question.has_invalid_option = rc_question.hasInvalidOption(data, question.version_number);\n                question.has_too_soon_option = rc_question.hasAnsweredTooSoonOption(data, question.version_number);\n            }\n            break;\n\n        case 'question_call':\n            //console.log('in case question_call');\n            if (data && (freshness >= question.freshness.question_call)) {\n                //console.log('call data new, not setting', freshness, ' vs ', question.freshness.question_call, question)\n                // Question ID is tacked on after the call.\n                // This never changes, so it doesn't matter whether it's filled by the logs or by the call.\n                question.freshness.question_call = freshness;\n                //question.question_id = question_id;\n                question.finalization_ts = ethers.BigNumber.from(data[Qi_finalization_ts]);\n                question.is_pending_arbitration = data[Qi_is_pending_arbitration];\n                question.arbitrator = data[Qi_arbitrator];\n                question.timeout = ethers.BigNumber.from(data[Qi_timeout]);\n                question.content_hash = data[Qi_content_hash];\n                question.bounty = data[Qi_bounty];\n                question.best_answer = data[Qi_best_answer];\n                question.bond = data[Qi_bond];\n                question.history_hash = data[Qi_history_hash];\n                if (rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[question.contract.toLowerCase()], 'min-bond')) {\n                    question.min_bond = data[Qi_min_bond];\n                } else {\n                    question.min_bond = ethers.BigNumber.from(0);\n                }\n                //console.log('set question', question_id, question);\n            } else {\n                //console.log('call data too old, not setting', freshness, ' vs ', question.freshness.question_call, question)\n            }\n            break;\n\n        case 'answers':\n            if (data && (freshness >= question.freshness.answers)) {\n                // If the history shrank, ignore the new data unless it's much newer than the old data\n                // This works around an issue where stuff disappears due to a laggy node\n                if (data.length < question['history'].length && (CURRENT_BLOCK_NUMBER - freshness < 100)) { \n                    console.log('ignoring data that got shorter', data, question['history']);\n                } else {\n                    question.freshness.answers = freshness;\n                    question['history'] = data;\n                }\n            }\n\n            question = mergeConfirmedTXes(question);\n\n            if (data.length && question['history_unconfirmed'].length) {\n                for (let j = 0; j < question['history_unconfirmed'].length; j++) {\n                    let ubond = question['history_unconfirmed'][j].args.bond;\n                    for (let i = 0; i < question['history'].length; i++) {\n                        // If there's something unconfirmed with an equal or lower bond, remove it\n                        if (data[i].args.bond.gte(ubond)) {\n                            console.log('removing unconfirmed entry due to equal or higher bond from confirmed');\n                            question['history_unconfirmed'].splice(j, 1);\n                        }\n                    }\n                }\n            }\n            break;\n\n        case 'answers_unconfirmed':\n            //console.log('adding answers_unconfirmed');\n            // Ignore the age and just see if we have it already\n            for (let i = 0; i < question['history'].length; i++) {\n                //console.log('already have a higher bond, removing');\n                // If there's something confirmed with an equal or higher bond, ignore the unconfirmed one\n                if (question['history'][i].args.bond.gte(data.args.bond)) {\n                    break;\n                }\n            }\n            //console.log('adding data to history_unconfirmed');\n            question['history_unconfirmed'].push(data);\n            break;\n\n        case 'reopener_question':\n            const reopened_by = data[0];\n            const also_too_soon = data[1];\n            const is_reopener = data[2];\n            // Ignore this if it was also answered too soon\n            // TODO: We should probably store the reopened_by somehow\n            question.reopened_by = null;\n            question.last_reopened_by = '0x0000000000000000000000000000000000000000000000000000000000000000';\n            if (reopened_by && reopened_by != '0x0000000000000000000000000000000000000000000000000000000000000000') {\n                // last_reopened_by always holds whatever the contract thinks it was opened by\n                // reopened_by only holds it if it's still active\n                question.last_reopened_by = reopened_by;\n                if (!also_too_soon) {\n                    question.reopened_by = reopened_by;\n                }\n            } \n            question.is_reopener = is_reopener;\n            break;\n\n    }\n\n    QUESTION_DETAIL_CACHE[contract_question_id] = question;\n\n    //console.log('was called filledQuestionDetail', question_id, data_type, freshness, data);\n    //console.log('returning question', question);\n\n    return question;\n\n}\n\nfunction isDataFreshEnough(contract_question_id, data_type, freshness) {\n    //console.log('looking at isDataFreshEnough for ', question_id, data_type, freshness);\n    // We set -1 when we don't need the data at all\n    if (freshness == -1) {\n        // console.log('-1, not needed');\n        return true;\n    }\n    if (!QUESTION_DETAIL_CACHE[contract_question_id]) {\n        // console.log('question not found, definitely fetch');\n        return false;\n    }\n    if (QUESTION_DETAIL_CACHE[contract_question_id].freshness[data_type] >= freshness) {\n        // console.log('is fresh', QUESTION_DETAIL_CACHE[contract_question_id].freshness, freshness)\n        return true;\n    } \n    // question_json never changes so 1 should be enough\n    if (data_type == 'question_json' && QUESTION_DETAIL_CACHE[contract_question_id].freshness[data_type] > 0) {\n        // console.log('questino_json always fresh');\n        return true;\n    }\n    // console.log('is not fresh', QUESTION_DETAIL_CACHE[contract_question_id].freshness[data_type], data_type, freshness)\n    return false;\n}\n\n// No freshness as this only happens once per question\nasync function _ensureQuestionLogFetched(contract, question_id, freshness, found_at_block) {\n    const called_block = found_at_block ? found_at_block : CURRENT_BLOCK_NUMBER;\n    const contract_question_id = cqToID(contract, question_id);\n    if (isDataFreshEnough(contract_question_id, 'question_log', freshness)) {\n        // console.log('_ensureQuestionLogFetched return from cache ', contract_question_id, QUESTION_DETAIL_CACHE[contract_question_id]);\n        return QUESTION_DETAIL_CACHE[contract_question_id];\n    } else {\n        // console.log('_ensureQuestionLogFetched fetch fresh ', contract_question_id);\n        const question_filter = RCInstance(contract).filters.LogNewQuestion(question_id);\n        //const question_arr = await RCInstance(contract).queryFilter(question_filter, RCStartBlock(contract), 'latest');\n        const question_arr = await RCInstance(contract).queryFilter(question_filter, RCStartBlock(contract), 'latest');\n        if (question_arr.length == 0) {\n            throw new Error(\"Question log not found, maybe try again later\");\n        }\n        if (question_arr.invalid_data) { \n            throw new Error(\"Invalid data\");\n        }\n        const blocknum = question_arr[0].blockNumber;\n\n        let question = null;\n        const arr = question_arr[0];\n        // See if this question already reopens something else\n        if (rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[contract.toLowerCase()], 'reopen-question')) {\n            // The call will tell us if it reopens something\n            const ro_result = await RCInstance(contract).functions.reopener_questions(question_id);\n            const is_reopener = ro_result[0];\n            // We need to query the log to find out what it reopens.\n            // The event should be in the same block (and transaction) as the question creation.\n            let qarr = {};\n            qarr.address = question_arr[0].address;\n            qarr.blockNumber = question_arr[0].blockNumber;\n            qarr.args = Object.assign({}, question_arr[0].args);\n            if (is_reopener) {\n                const reopen_filter = RCInstance(contract).filters.LogReopenQuestion(question_id);\n                const reopen_arr = await RCInstance(contract).queryFilter(reopen_filter, blocknum, blocknum);\n                const reopened_question_id = reopen_arr[0].args.reopened_question_id;\n                // This isn't in the original log so just tack it on as if it is\n\n                qarr.args.reopener_of_question_id = reopened_question_id;\n                // console.log('will fill', reopened_question_id);\n            }            \n            question = filledQuestionDetail(contract, question_id, 'question_log', called_block, qarr);\n        } else {\n            question = filledQuestionDetail(contract, question_id, 'question_log', called_block, question_arr[0]);\n        }\n\n        return question;\n    }\n}\n\nasync function _ensureQuestionDataFetched(contract, question_id, freshness, found_at_block) {\n    const called_block = found_at_block ? found_at_block : CURRENT_BLOCK_NUMBER;\n    const contract_question_id = cqToID(contract, question_id);\n    if (isDataFreshEnough(contract_question_id, 'question_call', freshness)) {\n        // console.log('_ensureQuestionDataFetched return from cache ', contract_question_id, freshness, QUESTION_DETAIL_CACHE[contract_question_id]);\n        return (QUESTION_DETAIL_CACHE[contract_question_id]);\n    } else {\n        // console.log('_ensureQuestionDataFetched fetch fresh', contract_question_id, freshness, QUESTION_DETAIL_CACHE[contract_question_id]);\n        const result = await RCInstance(contract).functions.questions(question_id);\n        if (ethers.BigNumber.from(result[Qi_content_hash]).eq(0)) {\n            throw new Error(\"question not found in call, maybe try again later\", question_id);\n        }\n        let q = await filledQuestionDetail(contract, question_id, 'question_call', called_block, result);\n\n        if (isReopenCandidate(q)) {\n            // console.log('getting reopener question for', q.question_id, q.contract);\n            const reopener_q_result = await RCInstance(q.contract).functions.reopened_questions(question_id);\n            const reopener_q = reopener_q_result[0];\n            let also_too_soon = null;\n            let is_reopener = false;\n            if (reopener_q != '0x0000000000000000000000000000000000000000000000000000000000000000') {\n                const replacement_data = await RCInstance(q.contract).functions.questions(reopener_q);\n                // Just populate enough for isFinalized\n                // TODO: Maybe better to just do this the normal way...\n                const rq = {\n                    'is_pending_arbitration': replacement_data[Qi_is_pending_arbitration],\n                    'finalization_ts':  ethers.BigNumber.from(replacement_data[Qi_finalization_ts]),\n                    'best_answer': replacement_data[Qi_best_answer]\n                }\n                const is_replacement_finalized = isFinalized(rq);\n                if (is_replacement_finalized) {\n                    if (rq.best_answer == rc_question.getAnsweredTooSoonValue()) {\n                        also_too_soon = true;\n                    } else {\n                        //console.log('best answer is not answeredTooSoonVal', rq);\n                    }\n                } \n            } else {\n                // Not yet reopened but this may be reopening some other question, in which case it can't be reopened yet\n                const is_reopener_result = await RCInstance(q.contract).functions.reopener_questions(question_id);\n                is_reopener = is_reopener_result[0];\n            }\n\n            q = await filledQuestionDetail(contract, question_id, 'reopener_question', called_block, [reopener_q, also_too_soon, is_reopener]);\n        }\n\n        await loadArbitratorMetaData(q.arbitrator); // We keep a separate cache from this, it should usually already be in there\n        return q;\n        /*\n        rc.questions.call(question_id).then(function(result) {\n            var question = filledQuestionDetail(question_id, 'question_call', called_block, result);\n            resolve(question);\n        }).catch(function(err) {\n            console.log('error in data');\n            reject(err);\n        });\n        */\n    }\n}\n\nasync function _ensureQuestionTemplateFetched(contract, question_id, template_id, qtext, freshness) {\n    //console.log('ensureQuestionDetailFetched', template_id, CONTRACT_TEMPLATE_CONTENT[template_id], qtext);\n    const contract_question_id = cqToID(contract, question_id);\n    if (isDataFreshEnough(contract_question_id, 'question_json', freshness)) {\n        // console.log('_ensureQuestionTemplateFetched return from cache ', contract_question_id, QUESTION_DETAIL_CACHE[contract_question_id]);\n        return QUESTION_DETAIL_CACHE[contract_question_id];\n    } else {\n        // console.log('_ensureQuestionTemplateFetched fetch fresh', contract_question_id, QUESTION_DETAIL_CACHE[contract_question_id]);\n        if (CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id]) {\n            const question = filledQuestionDetail(contract, question_id, 'question_json', 1, rc_question.populatedJSONForTemplate(CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id], qtext, true));\n            return (question);\n        } else {\n            // The category text should be in the log, but the contract has the block number\n            // This allows us to make a more efficient pin-point log call for the template content\n            const template_block_num_bn_arr = await RCInstance(contract).functions.templates(template_id);\n            const template_block_num = template_block_num_bn_arr[0].toNumber();\n            const template_filter = RCInstance(contract).filters.LogNewTemplate(template_id);\n            const cat_logs = await RCInstance(contract).queryFilter(template_filter, template_block_num, template_block_num);\n            if (cat_logs.length == 1) {\n                //console.log('adding template content', cat_arr, 'template_id', template_id);\n                CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id] = cat_logs[0].args.question_text;\n                //console.log(CONTRACT_TEMPLATE_CONTENT);\n                let populatedq = null;\n                try {\n                    populatedq = rc_question.populatedJSONForTemplate(CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id], qtext, true)\n                } catch (e) {\n                    console.log('error populating template', CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id], qtext, e);\n                }\n                const question = filledQuestionDetail(contract, question_id, 'question_json', 1, populatedq);\n                return question;\n/*\n                console.log('error fetching template - unexpected cat length');\n                reject(new Error(\"Category response unexpected length\"));\n                catch(function(err) {\n                    console.log('error fetching template');\n                    reject(err);\n                });\n*/\n            }\n        }\n    }\n}\n\nasync function _ensureAnswersFetched(contract, question_id, freshness, start_block, injected_data, found_at_block) {\n    const called_block = found_at_block ? found_at_block : CURRENT_BLOCK_NUMBER;\n    const contract_question_id = cqToID(contract, question_id);\n    if (isDataFreshEnough(contract_question_id, 'answers', freshness)) {\n        //console.log('_ensureAnswersFetched from cache ', contract_question_id, 'because ', CURRENT_BLOCK_NUMBER, ' vs ', freshness);\n        return (QUESTION_DETAIL_CACHE[contract_question_id]);\n    } \n    //console.log('_ensureAnswersFetched fresh ', contract_question_id, 'because ', CURRENT_BLOCK_NUMBER, ' vs ', freshness);\n    const answer_filter = RCInstance(contract).filters.LogNewAnswer(null, question_id);\n    const answer_arr = await RCInstance(contract).queryFilter(answer_filter, start_block, 'latest');\n\n                /*\n                if (error) {\n                    console.log('error in get');\n                    reject(error);\n                } \n                */\n    // In theory this should get us everything but sometimes it seems to lag\n    // If this is triggered by an event, and the get didn't return the event, add it to the list ourselves\n    let done_txhashes = {};\n    if (injected_data && injected_data['answers'] && injected_data['answers'].length) {\n        let inj_ans_arr = injected_data['answers'];\n        for (let i=0; i<inj_ans_arr.length; i++ ) {\n            const inj_ans = inj_ans_arr[i];\n            for (let j=0; j<answer_arr.length; j++ ) {\n                const ans = answer_arr[j];\n                if (ans.args.bond.eq(inj_ans.args.bond)) {\n                    if (ans.transactionHash != inj_ans.transactionHash) {\n                        // Replaced by a new entry, old one got orphaned\n                        answer_arr[j] = inj_ans_arr[i];\n                    }\n                }\n                done_txhashes[answer_arr[j].transactionHash] = true;\n            }\n            if (!done_txhashes[inj_ans.transactionHash]) {\n                answer_arr.push(inj_ans);\n            }\n        }\n    }\n    // console.log('made answer_arr', answer_arr);\n    const question = filledQuestionDetail(contract, question_id, 'answers', called_block, answer_arr);\n    const q = _ensureAnswerRevealsFetched(contract, question_id, freshness, start_block, question);\n    return q;\n}\n\n// question_log is optional, pass it in when we already have it\nasync function ensureQuestionDetailFetched(ctr, question_id, ql, qi, qc, al, injected_data, found_at_block) {\n\n    if (!RC_INSTANCES[ctr.toLowerCase()]) {\n        throw new Error(\"contract \"+ctr+\" not found in list, not sure how we gott that for question \"+question_id);\n    }\n\n    if (ql == undefined) ql = 1;\n    if (qi == undefined) qi = 1;\n    if (qc == undefined) qc = CURRENT_BLOCK_NUMBER;\n    if (al == undefined) al = CURRENT_BLOCK_NUMBER;\n\n    if (!question_id) {\n        throw new Error('no questin_id, wtf');\n    }\n\n    const called_block = found_at_block ? found_at_block : CURRENT_BLOCK_NUMBER;\n    //console.log('ensureQuestionDetailFetched with called_block', called_block);\n    //return new Promise((resolve, reject) => {\n//console.log('need qc, here goes');\n    const qlog = await _ensureQuestionLogFetched(ctr, question_id, ql);\n//console.log('ok, got qc, now try qi');\n    const qdat = await _ensureQuestionDataFetched(ctr, question_id, qc);\n//console.log('got qi, next qt, qi is', qi);\n    const qtempl = await _ensureQuestionTemplateFetched(ctr, question_id, qdat.template_id, qdat.question_text, qdat);\n//console.log('got qt, now q');\n    const qans = await _ensureAnswersFetched(ctr, question_id, al, qdat.question_created_block, injected_data, called_block);\n//console.log('all done, q is', q);\n     //   resolve(q);\n    //});\n    return qans;\n    \n\n\n    /*\n        _ensureQuestionLogFetched(question_id, ql).then(function(q) {\n            return _ensureQuestionDataFetched(question_id, qc);\n        }).then(function(q) {\n            return _ensureQuestionTemplateFetched(question_id, q.template_id, q.question_text, qi);\n        }).then(function(q) {\n            return _ensureAnswersFetched(question_id, al, q.question_created_block, injected_data);\n        }).then(function(q) {\n            resolve(q);\n        }).catch(function(e) {\n            console.log('cauught error', question_id, e);\n            reject(e);\n        });\n    */\n}\n\nfunction delay(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nasync function ensureAmountApproved(spender, account, amount) {\n    console.log('checking if we need extra approval for amount', amount.toHexString());\n    const erc20 = getERC20TokenInstance();\n\n    const mybal = await erc20.functions.balanceOf(account);\n    console.log('balance is ', mybal.toString());\n\n    const allowed_arr = await erc20.functions.allowance(account, spender);\n    const allowed = allowed_arr[0];\n    if (allowed.gte(amount)) {\n        console.log('already got enough, continuing', allowed.toHexString());\n        return allowed;\n    } else {\n        console.log('not enough to cover cost, approving', amount, spender);\n        const signedERC20 = erc20.connect(signer);\n        const tx = await signedERC20.functions.approve(spender, amount);\n        await tx.wait(); \n        // At this point we have received the approval's transaction hash and can proceed with next transaction.\n        // However, Metamask may need some time to pick up this transaction, \n        // which is needed to validate next transactions, and 3 seconds is considered a \"safe\" waiting time.\n        // Metamask will still display the error however, but it can be ignored\n        await delay(3000);\n        console.log('approval done')\n        return amount;\n    }\n}\n\n// TODO: Fire this on a timer, and also on the withdrawal event\nasync function updateUserBalanceDisplay() {\n    if (!ACCOUNT) {\n        return;\n    }\n\n    let bal = 0;\n    if (IS_TOKEN_NATIVE) {\n        // console.log('updating balacne for', account);\n        bal = await provider.getBalance(ACCOUNT);\n    } else {\n            /*\n            todo: should we have error handling\n            if (error === null) {\n                $('.account-balance').text(web3js.fromWei(result.toNumber(), 'ether'));\n            }\n            */\n        const erc20 = getERC20TokenInstance();\n        const bal_arr = await erc20.functions.balanceOf(ACCOUNT);\n        bal = bal_arr[0];\n    }\n\n    $('.account-balance').text(decimalizedBigNumberToHuman(bal));\n}\n\nfunction getERC20TokenInstance() {\n    return new ethers.Contract(TOKEN_JSON.address, TOKEN_JSON.abi, provider);\n}\n\nfunction populateSection(section_name, question, before_item) {\n\n    const question_id = question.question_id;\n    const idx = DISPLAY_ENTRIES[section_name].ids.indexOf(question_id);\n    //console.log('idx is ',idx);\n    if (idx > DISPLAY_ENTRIES[section_name].max_show) {\n        //console.log('over max show, skip', question_id);\n        return;\n    }\n\n    const question_item_id = section_name + '-question-' + contractQuestionID(question);\n    const before_item_id = section_name + '-question-' + before_item\n\n    const target_question_id = 'qadetail-' + contractQuestionID(question);\n\n    const section = $('#' + section_name);\n\n    // If the item is already in the document but in the wrong place, remove it.\n    // If it's already in the right place, do nothing\n    const existing_in_doc = section.find('#' + question_item_id);\n    if (existing_in_doc.length) {\n        if (existing_in_doc.next().attr('id') == before_item_id) {\n            //console.log('already before item', before_item_id);\n            return;\n        } else {\n            //console.log('already in doc, removing', question_item_id);\n            existing_in_doc.remove();\n        }\n    } else {\n        //console.log('not in doc yet, adding', question_id,' at ', question_item_id);\n        //console.log('item to insert before is here? ', before_item_id, section.find('#' + before_item_id).length);\n    }\n\n    const is_found = (section.find('#' + before_item_id).length > 0);\n    let entry = $('.questions__item.template-item').clone();\n\n    entry = populateSectionEntry(entry, question);\n\n    if (ARBITRATOR_FAILED_BY_CONTRACT[question.contract.toLowerCase()] && ARBITRATOR_FAILED_BY_CONTRACT[question.contract.toLowerCase()][question.arbitrator.toLowerCase()]) {\n        entry.addClass('failed-arbitrator');\n    } \n\n    entry.attr('id', question_item_id).removeClass('template-item');\n    entry.css('display', 'none');\n\n    //console.log('adding entry', question_item_id, 'before item', before_item);\n    if (before_item && is_found) {\n        section.find('#' + before_item_id).before(entry);\n    } else {\n        section.children('.questions-list').append(entry);\n    }\n\n    activateSection(section_name);\n\n    entry.fadeIn(1000);\n    if (DISPLAY_ENTRIES[section_name]['ids'].length > 3) {\n        if (section.find('.loadmore-button').css('display') == 'none') {\n            section.children('.questions-list').find('.questions__item:last-child').remove();\n        }\n    }\n    if (section.children('.questions-list').find('.questions__item').length >= DISPLAY_ENTRIES[section_name]['ids'].length) {\n        section.find('.loadmore-button').css('display', 'none');\n    } else {\n        section.find('.loadmore-button').css('display', 'block');\n    }\n    while (section.children('.questions-list').find('.questions__item').length > DISPLAY_ENTRIES[section_name].max_show) {\n        //console.log('too long, removing');\n        section.children('.questions-list').find('.questions__item:last-child').remove()\n    }\n\n    // question settings warning balloon\n    let balloon_html = '';\n    if (question.timeout < 86400) {\n        balloon_html += 'The timeout is very low.<br /><br />This means there may not be enough time for people to correct mistakes or lies.<br /><br />';\n    }\n    if (isFinalized(question) && question.bounty.add(question.bond).lt(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']))) {\n        balloon_html += 'The reward was very low and no substantial bond was posted.<br /><br />This means there may not have been enough incentive to post accurate information.<br /><br />';\n    }\n    const valid_arbitrator = isArbitratorValidFast(question.contract, question.arbitrator);\n    if (!valid_arbitrator) {\n        balloon_html += 'This arbitrator is unknown.';\n    }\n    const contract_question_id = contractQuestionID(question);\n    if (balloon_html) {\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').css('display', 'block');\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').css('z-index', 5);\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').find('.balloon').html(balloon_html);\n    }\n\n}\n\nfunction activateSection(section_name) {\n    $('div#questions-container').find('.main-nav li a').each(function() {\n        if ($(this).attr('data-menu') == section_name) {\n            $(this).addClass('activated');\n        }\n    });\n}\n\nfunction updateSectionEntryDisplay(question) {\n    $('div.questions__item[data-contract-question-id=\"' + contractQuestionID(question) + '\"]').each(function() {\n        //console.log('updateSectionEntryDisplay update question', question.question_id);\n        populateSectionEntry($(this), question);\n    });\n}\n\nfunction populateSectionEntry(entry, question) {\n\n    const question_id = question.question_id;\n    const question_json = question.question_json;\n    const posted_ts = question.creation_ts;\n    const arbitrator = question.arbitrator;\n    const timeout = question.timeout;\n    const bounty = decimalizedBigNumberToHuman(question.bounty);\n    const is_arbitration_pending = isArbitrationPending(question);\n    const is_finalized = isFinalized(question);\n    const best_answer = question.best_answer;\n    const bond = question.bond;\n\n    let options = '';\n    if (typeof question_json['outcomes'] !== 'undefined') {\n        for (let i = 0; i < question_json['outcomes'].length; i++) {\n            options = options + i + ':' + question_json['outcomes'][i] + ', ';\n        }\n    }\n\n    entry.attr('data-contract-question-id', contractQuestionID(question));\n    //entry.find('.questions__item__title').attr('data-target-id', target_question_id);\n\n    entry.find('.question-title').text(question_json['title']).expander({\n        expandText: '',\n        slicePoint: 140\n    });\n    entry.find('.question-bounty').text(bounty);\n\n    entry.find('.bond-value').text(decimalizedBigNumberToHuman(bond));\n\n    // For these purposes we just ignore any outstanding commits\n    if (isAnswered(question)) {\n        entry.find('.questions__item__answer').text(rc_question.getAnswerString(question_json, best_answer));\n        entry.addClass('has-answer');\n    } else {\n        entry.find('.questions__item__answer').text('');\n        entry.removeClass('has-answer');\n    }\n\n    if (isQuestionBeforeOpeningDate(question)) {\n        entry.addClass('not-yet-open');\n    }\n\n    const is_answered = isAnswered(question);\n\n    if (is_answered) {\n        entry.addClass('has-answers').removeClass('no-answers');\n    } else {\n        entry.removeClass('has-answers').addClass('no-answers');\n    }\n\n    timeago.cancel(entry.find('.timeago'));\n    if (isArbitrationPending(question)) {\n        entry.addClass('arbitration-pending');\n    } else {\n        entry.removeClass('arbitration-pending');\n        if (is_answered) {\n            timeago.cancel(entry.find('.closing-time-label .timeago'));\n            entry.find('.closing-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(entry.find('.closing-time-label .timeago'));\n        } else {\n            entry.find('.created-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.creation_ts));\n            timeAgo.render(entry.find('.created-time-label .timeago'));\n        }\n    }\n    \n    if (isQuestionBeforeOpeningDate(question)) {\n        entry.find('.opening-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.opening_ts));\n        timeAgo.render(entry.find('.opening-time-label .timeago'));\n    }\n\n    return entry;\n\n}\n\nfunction depopulateSection(section_name, question_id) {\n    //console.log('depopulating', section_name, question_id);\n\n    const question_item_id = section_name + '-question-' + question_id;\n    const section = $('#' + section_name);\n\n    const item = section.find('#' + question_item_id);\n    if (item.length) {\n        item.remove();\n        // Add the next entry to the bottom\n        const current_last_qid = section.find('.questions__item').last().attr('data-contract-question-id');\n        const current_last_idx = DISPLAY_ENTRIES[section_name]['ids'].indexOf(current_last_qid);\n        const next_idx = current_last_idx + 1;\n        if (DISPLAY_ENTRIES[section_name]['ids'].length > next_idx) {\n            const add_qid = DISPLAY_ENTRIES[section_name]['ids'][next_idx];\n            const qdata = QUESTION_DETAIL_CACHE[add_qid];\n            populateSection(section_name, qdata, current_last_qid);\n        }\n    }\n\n}\n\n// Calculate a ranking to handle active display\n// Intended to try to bring interesting open questions to the top\nfunction calculateActiveRank(created, bounty, bond) {\n\n    // Everything should be populated with BigNumbers but in the event that something isn't due to some log query issue etc, just skip that question\n    const err = ethers.BigNumber.from(0);\n    if (typeof created === 'undefined') {\n        console.log('calculateActiveRank skipping undefined created');\n        return err;\n    }\n    if (typeof bond === 'undefined') {\n        console.log('calculateActiveRank skipping undefined bond');\n        return err;\n    }\n    if (typeof bounty === 'undefined') {\n        console.log('calculateActiveRank skipping undefined bounty');\n        return err;\n    }\n\n    // Initial rank is bounty add bond.\n    // Bond is uprated by 4 times compared to reward\n    let rank = bounty.add(bond.mul(ethers.BigNumber.from(4)));\n\n    const now = new Date();\n    const now_bn = ethers.BigNumber.from(parseInt(now.getTime() / 1000));\n    const age = now_bn.sub(created);\n\n    // Scale up anything under 24 hours so that 10 mins counts as 0.01 ETH of reward,  or 0.002 of bond\n    if (age.lt(ethers.BigNumber.from(86400))) {\n        const secs = ethers.BigNumber.from(86400).sub(age);\n        const boost = secs.div(ethers.BigNumber.from(600)).mul(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']));\n        rank = rank.add(boost);\n    }\n\n    // Anything else goes by time posted\n    rank = rank.add(created);\n\n    // console.log('rank', rank.toNumber());\n    return rank;\n\n}\n\nasync function handleQuestionLog(item) {\n    const question_id = item.args.question_id;\n    const contract = item.address;\n    //console.log('in handleQuestionLog', question_id);\n    const created = item.args.created\n\n    // Populate with the data we got\n    //console.log('before filling in handleQuestionLog', QUESTION_DETAIL_CACHE[question_id]);\n    let question = filledQuestionDetail(contract, question_id, 'question_log', item.blockNumber, item);\n    //console.log('after filling in handleQuestionLog', QUESTION_DETAIL_CACHE[question_id]);\n\n    // Then fetch anything else we need to display\n    question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, item.blockNumber, -1)\n\n    // console.log('updateQuestionWindowIfOpen after ensureQuestionDetailFetched for', contract, question_id, 'returned', question, 'block num is', item.blockNumber );\n    updateQuestionWindowIfOpen(question);\n\n    if (CATEGORY && question.question_json.category != CATEGORY) {\n        //console.log('mismatch for cat', category, question.question_json.category);\n        return;\n    } else {\n        //console.log('category match', category, question.question_json.category);\n    }\n\n    const is_finalized = isFinalized(question);\n\n    // Pending arbitration doesn't exactly fit but it fits better than the other categories\n    const is_before_opening = isQuestionBeforeOpeningDate(question) || isArbitrationPending(question);\n    const bounty = question.bounty;\n    const opening_ts = question.opening_ts;\n\n    if (is_finalized) {\n        const insert_before = update_ranking_data('questions-resolved', contractQuestionID(question), question.finalization_ts, 'desc');\n        if (insert_before !== -1) {\n            // TODO: If we include this we have to handle the history too\n            populateSection('questions-resolved', question, insert_before);\n            $('#questions-resolved').find('.scanning-questions-category').css('display', 'none');\n            if (DISPLAY_ENTRIES['questions-resolved']['ids'].length > 3 && $('#questions-resolved').find('.loadmore-button').css('display') == 'none') {\n                $('#questions-resolved').find('.loadmore-button').css('display', 'block');\n            }\n        }\n\n    } else if (is_before_opening) {\n\n        const insert_before = update_ranking_data('questions-upcoming', contractQuestionID(question), opening_ts, 'asc');\n        if (insert_before !== -1) {\n            populateSection('questions-upcoming', question, insert_before);\n            $('#questions-upcoming').find('.scanning-questions-category').css('display', 'none');\n            if (DISPLAY_ENTRIES['questions-upcoming']['ids'].length > 3 && $('#questions-upcoming').find('.loadmore-button').css('display') == 'none') {\n                $('#questions-upcoming').find('.loadmore-button').css('display', 'block');\n            }\n        }\n\n    } else {\n\n        if (!question.is_pending_arbitration) {\n            const insert_before = update_ranking_data('questions-active', contractQuestionID(question), calculateActiveRank(created, question.bounty, question.bond), 'desc');\n            if (insert_before !== -1) {\n                populateSection('questions-active', question, insert_before);\n                $('#questions-active').find('.scanning-questions-category').css('display', 'none');\n                if (DISPLAY_ENTRIES['questions-active']['ids'].length > 3 && $('#questions-active').find('.loadmore-button').css('display') == 'none') {\n                    $('#questions-active').find('.loadmore-button').css('display', 'block');\n                }\n            }\n        }\n\n        if (isAnswered(question)) {\n            const insert_before = update_ranking_data('questions-closing-soon', contractQuestionID(question), question.finalization_ts, 'asc');\n            if (insert_before !== -1) {\n                populateSection('questions-closing-soon', question, insert_before);\n                $('#questions-closing-soon').find('.scanning-questions-category').css('display', 'none');\n                if (DISPLAY_ENTRIES['questions-closing-soon']['ids'].length > 3 && $('#questions-closing-soon').find('.loadmore-button').css('display') == 'none') {\n                    $('#questions-closing-soon').find('.loadmore-button').css('display', 'block');\n                }\n            }\n        }\n\n        scheduleFinalizationDisplayUpdate(contract, question);\n        reflectDisplayEntryChanges();\n        //console.log(DISPLAY_ENTRIES);\n    }\n\n}\n\n// Inserts into the right place in the stored rankings.\n// If it comes after another stored item, return the ID of that item.\n// If it doesn't belong in storage because it is too low for the ranking, return -1\n// TODO: ??? If it is already in storage and does not need to be updated, return -2\nfunction update_ranking_data(arr_name, id, val, ord) {\n\n    // Check if we already have it\n    const existing_idx = DISPLAY_ENTRIES[arr_name]['ids'].indexOf(id);\n    if (existing_idx !== -1) {\n        //console.log('not found in list');\n\n        // If it is unchanged, return a code saying there is nothing to do\n        if (val.eq(DISPLAY_ENTRIES[arr_name]['vals'][existing_idx])) {\n            //console.log('nothing to do, val was unchanged at', val, DISPLAY_ENTRIES[arr_name]['vals'][existing_idx]);\n            return -1; // TODO: make this -2 so the caller can handle this case differently?\n        }\n\n        // If we are already in the list and have the same value, remove and try to add again\n        // This can happen if the variable we sort by is updated\n        DISPLAY_ENTRIES[arr_name]['ids'].splice(existing_idx, 1);\n        DISPLAY_ENTRIES[arr_name]['vals'].splice(existing_idx, 1);\n    }\n\n    //console.log('update_ranking_data', arr_name, id, val.toString());\n    const arr = DISPLAY_ENTRIES[arr_name]['vals']\n        //console.log('start with array ', arr);\n\n    const max_entries = DISPLAY_ENTRIES[arr_name]['max_store'];\n\n    // If the list is full and we're lower, give up\n    if (arr.length >= max_entries) {\n        //console.log('list full and lower, give up');\n        const last_entry = arr[arr.length - 1];\n        if (last_entry.gte(val)) {\n            //  console.log('we are full and last entry is at least as high')\n            return -1;\n        }\n    }\n\n    // go through from the top until we find something we're higher than\n    for (let i = 0; i < arr.length; i++) {\n        //console.log('see if ', val.toString(), ' is at least as great as ', arr[i].toString());\n        if ((ord == 'desc' && val.gte(arr[i])) || (ord == 'asc' && val.lte(arr[i]))) {\n            // found a spot, we're higher than the current occupant of this index\n            // we'll return its ID to know where to insert in the document\n            const previd = DISPLAY_ENTRIES[arr_name]['ids'][i];\n\n            //console.log('found, splice in before ', previd, 'old', val.toString(), 'new', arr[i].toString());\n\n            // insert at the replaced element's index, bumping everything down\n            DISPLAY_ENTRIES[arr_name]['ids'].splice(i, 0, id);\n            DISPLAY_ENTRIES[arr_name]['vals'].splice(i, 0, val);\n\n            // if the array is now too long, dump the final element\n            if (arr.length > max_entries) {\n                DISPLAY_ENTRIES[arr_name]['ids'].pop();\n                DISPLAY_ENTRIES[arr_name]['vals'].pop();\n            }\n            return previd;\n        }\n\n    }\n\n    //console.log('not found, add to end');\n    // lower than everything but there's still space, so add to the end\n    DISPLAY_ENTRIES[arr_name]['ids'].push(id);\n    DISPLAY_ENTRIES[arr_name]['vals'].push(val);\n    return null;\n\n}\n\n/*-------------------------------------------------------------------------------------*/\n// question detail window\n\nfunction initQuestionTypeUI() {\n\n    $(document).on('change', '.question-type', function(e) {\n        const win = $(this).closest('.rcbrowser');\n        const container = win.find('.answer-option-container');\n        if (win.find('.question-type').val() == 'single-select' || win.find('.question-type').val() == 'multiple-select') {\n            if (!container.hasClass('is-open')) {\n                container.css('display', 'block');\n                container.addClass('is-open');\n                container.addClass('is-bounce');\n            }\n        } else {\n            container.css('display', 'none');\n            container.removeClass('is-open');\n            container.removeClass('is-bounce');\n            win.find('.first-answer-option').children().val('');\n            win.find('.input-container--answer-option').remove();\n        }\n        Ps.update(win.find('.rcbrowser-inner').get(0));\n    });\n\n    $(document).on('click', '.add-option-button', function(e) {\n        const win = $(this).closest('.rcbrowser');\n        const element = $('<div>');\n        element.addClass('input-container input-container--answer-option');\n        const input = '<input type=\"text\" name=\"editOption0\" class=\"rcbrowser-input answer-option form-item\" placeholder=\"Enter an answer...\">';\n        element.append(input);\n        win.find('.error-container--answer-option').before(element);\n        element.addClass('is-bounce');\n        Ps.update(win.find('.rcbrowser-inner').get(0));\n    });\n\n}\n\ninitQuestionTypeUI();\n\n\n$(document).on('click', '.questions__item__title', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const contract_question_id = $(this).closest('.questions__item').attr('data-contract-question-id');\n\nconsole.log('open window', contract_question_id);\n    // Should repopulate and bring to the front if already open\n    openQuestionWindow(contract_question_id);\n\n});\n\n$(document).on('click', '.mini-action-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const contract_question_id = $(this).closest('.questions__item').attr('data-contract-question-id');\n\n    // Should repopulate and bring to the front if already open\n    openQuestionWindow(contract_question_id);\n\n});\n\n$(document).on('click', '.your-qa__questions__item', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const contract_question_id = $(this).closest('.your-qa__questions__item').attr('data-contract-question-id');\n\n    openQuestionWindow(contract_question_id);\n\n});\n\nfunction parseContractQuestionID(id, fallback_contract) {\n    // console.log('fallback_contract', fallback_contract);\n    id = id.toLowerCase();\n    const bits = id.split('-');\n    if (bits.length === 2) {\n        return bits; \n    }\n    if (bits.length === 1) {\n        // console.log('try fallback');\n        if (fallback_contract) {\n            console.log('using fallback contract');\n            return [fallback_contract.toLowerCase(), bits[0]]; \n        }\n    } else {\n        console.log('bits length was', bits.length, bits);\n        throw new Error(\"Could not parse contract-question-id \" + id); \n    }\n}\n\nfunction contractQuestionID(question) {\n    return cqToID(question.contract, question.question_id);\n}\n\nfunction cqToID(contract, question_id) {\n    return contract.toLowerCase() + '-' + question_id.toLowerCase();\n}\n\nasync function openQuestionWindow(contract_question_id) {\n\n    const [contract_addr, question_id] = parseContractQuestionID(contract_question_id);\n\n    // console.log('quick load');\n    // To respond quickly, start by fetching with even fairly old data and no logs\n    let question = await ensureQuestionDetailFetched(contract_addr, question_id, 1, 1, 1, -1)\n    displayQuestionDetail(question);\n\n    // console.log('now reload');\n    // Get the window open first with whatever data we have\n    // Then repopulate with the most recent of everything anything has changed\n    question = await ensureQuestionDetailFetched(contract_addr, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER)\n    updateQuestionWindowIfOpen(question);\n    /*\n    .catch(function(e){\n        console.log(e);\n    });\n    */\n}\n\nfunction updateQuestionWindowIfOpen(question) {\n\n    //console.log('updateQuestionWindowIfOpen', question);\n    const window_id = 'qadetail-' + contractQuestionID(question);\n    let rcqa = $('#' + window_id);\n    if (rcqa.length) {\n        rcqa = populateQuestionWindow(rcqa, question, true);\n    }\n\n}\n\nfunction displayQuestionDetail(question_detail) {\n\n    const question_id = question_detail.question_id;\n    const contract_question_id = contractQuestionID(question_detail);\n    //console.log('question_id', question_id);\n\n    // If already open, refresh and bring to the front\n    const window_id = 'qadetail-' + contract_question_id\n    let rcqa = $('#' + window_id);\n    if (rcqa.length) {\n        rcqa = populateQuestionWindow(rcqa, question_detail, true);\n        rcqa.css('z-index', ++ZINDEX);\n    } else {\n        rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        rcqa.attr('id', window_id);\n        rcqa.attr('data-contract-question-id', contract_question_id);\n\n        rcqa.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {\n                'x': left,\n                'y': top\n            };\n            rcqa.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        rcqa.removeClass('template-item');\n\n        rcqa = populateQuestionWindow(rcqa, question_detail, false);\n\n        $('#qa-detail-container').append(rcqa);\n\n        rcqa.css('display', 'block');\n        rcqa.addClass('is-open');\n        rcqa.css('z-index', ++ZINDEX);\n        rcqa.css('height', \"80%\");\n        rcqa.css('max-height', \"80%\");\n        setRcBrowserPosition(rcqa);\n        Ps.initialize(rcqa.find('.rcbrowser-inner').get(0));\n    }\n\n    // console.log('set_hash_param', contractQuestionID(question_detail));\n    set_hash_param({'question': contractQuestionID(question_detail)});\n\n}\n\nfunction setupDatetimeDatePicker(rcqa) {\n\n    let precision = rcqa.attr('data-datetime-precision');\n    if (!precision) {\n        precision = 'd';\n    }\n    const date_format = (precision == 'Y') ? 'yy' : ( (precision == 'm') ? 'yy-mm' : 'yy-mm-dd' )\n\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        rcqa.addClass('has-time-input');\n        const plh = {\n            'H': '00',\n            'i': '00:00',\n            's': '00:00:00'\n        }\n        rcqa.find('input.datetime-input-time').attr('placeholder', plh[precision]).attr('maxlength', plh[precision].length);;\n    }\n\n    const dtplh = {\n        'Y': '2000',\n        'm': '2000-01',\n        'd': '2000-01-01',\n        'H': '2000-01-01',\n        'i': '2000-01-01',\n        's': '2000-01-01'\n    }\n    rcqa.find('input.datetime-input-date').attr('placeholder', dtplh[precision]).attr('maxlength', dtplh[precision].length).attr('data-precision', precision);\n\n    // TODO: Set the precision of the date and use it for date and time\n    if (rcqa.find('[name=\"input-answer\"]').hasClass('rcbrowser-input--date--answer')) {\n        rcqa.find('[name=\"input-answer\"]').datepicker({\n            dateFormat: date_format,\n            beforeShow: function(input, inst) {\n                if ($(this).closest('.input-container').hasClass('invalid-selected')) {\n                    return false;\n                }\n            }, \n            onSelect: function(dateText) {\n                $(this).closest('.input-container').removeClass('is-error');\n            }\n        });\n    }\n\n}\n\nfunction category_text(question_json, target_el) {\n    const cat = question_json['category'];\n    let cat_txt = '';\n    if (cat == '') {\n        cat_txt = 'Unassigned';\n    } else {\n        cat_txt = $(\"#filter-list\").find(\"[data-category='\" + cat + \"']\").text();\n        if (cat_txt == '') {\n            cat_txt = '\"' + cat + '\"';\n        }\n    }\n    if (target_el) {\n        cat_txt = target_el.attr('data-prefix-text') + cat_txt;\n    }\n    return cat_txt;\n}\n\n// Returns arbitration metadata from the cache\n// Assumes it's already been loaded\nfunction arbitrationMetaDataFromCache(arb_addr) {\n    if (arb_addr.toLowerCase() in ARBITRATOR_METADATA) {\n        //console.log('found metadata for', arb_addr);\n        return ARBITRATOR_METADATA[arb_addr.toLowerCase()];\n    }\n    if (arb_addr.toLowerCase() == '0x0000000000000000000000000000000000000000') {\n        return {};\n    }\n    //console.log('no metadata for', arb_addr, ARBITRATOR_METADATA);\n    return null;\n}\n\nasync function loadArbitratorMetaData(arb_addr) {\n    const cached_md = arbitrationMetaDataFromCache(arb_addr);\n    if (cached_md) {\n        return cached_md;\n    }\n    //console.log('fetching metadata for arbitrator', arb_addr);\n    let metadata_json = {};\n    try {\n        const arb = ARBITRATOR_INSTANCE.attach(arb_addr);\n        const md_arr = await arb.functions.metadata();\n        const md = md_arr[0];\n        try {\n            if (md != '' && md != ' ') {\n                metadata_json = JSON.parse(md);\n            }\n        } catch (e) {\n            console.log('arbitrator', arb_addr, 'returned some metadata but it could not be parsed:', md);\n        }\n    } catch (e) {\n        console.log('Got an error trying to fetch arbitrator metadata, this is expected with some arbitrators', arb_addr);\n    }\n    ARBITRATOR_METADATA[arb_addr.toLowerCase()] = metadata_json;\n    // console.log('loaded metadata', arb_addr, metadata_json);\n    return metadata_json;\n}\n\nfunction isTitleLong(title) {\n    if (title.length > 300) {\n        return true;\n    }\n    const words = title.split(' ');\n    for (let i=0; i<words.length; i++) {\n        if (words[i].length > 50) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction populateQuestionWindow(rcqa, question_detail, is_refresh) {\n\n    // console.log('populateQuestionWindow with detail ', question_detail, is_refresh);\n    const question_id = question_detail.question_id;\n    const question_json = question_detail.question_json;\n    const question_type = question_json['type'];\n\n    //console.log('current list last item in history, which is ', question_detail['history'])\n    const idx = question_detail['history'].length - 1;\n\n    if (question_detail.has_invalid_option) {\n        rcqa.addClass('has-invalid-option');\n    }\n    if (question_detail.has_too_soon_option) {\n        rcqa.addClass('has-too-soon-option');\n    }\n\n    const cat_el = rcqa.find('.rcbrowser-main-header-category');\n    cat_el.text(category_text(question_json, cat_el)); \n\n    let date = new Date();\n    date.setTime(question_detail.creation_ts * 1000);\n    const date_str = MONTH_LIST[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n\n    rcqa.find('.rcbrowser-main-header-date').text(date_str);\n\n    if (isTitleLong(question_json['title'])) {\n        rcqa.addClass('long-title')\n    } else {\n        rcqa.removeClass('long-title')\n    }\n    rcqa.find('.question-title').text(question_json['title']).expander({\n        slicePoint: 200\n    });\n    rcqa.find('.reward-value').text(decimalizedBigNumberToHuman(question_detail.bounty));\n\n    if (question_detail.block_mined > 0) {\n        rcqa.removeClass('unconfirmed-transaction').removeClass('has-warnings');\n    }\n\n    const metadata = arbitrationMetaDataFromCache(question_detail.arbitrator);\n    if (metadata && 'tos' in metadata && metadata['tos']) {\n        populateTOSSection(rcqa, metadata['tos']);\n    } else {\n        populateTOSSection(rcqa, null);\n    }\n\n    let bond = ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']).div(2);\n    if (question_detail.min_bond && question_detail.min_bond.gt(0)) {\n        bond = question_detail.min_bond.div(2);\n    } else if (question_detail.bounty && question_detail.bounty.gt(0)) {\n        bond = question_detail.bounty.div(2);\n    }\n\n    if (isReopenable(question_detail)) {\n        rcqa.addClass('reopenable').removeClass('reopened');\n        console.log('add reopen section');\n    } else {\n        rcqa.removeClass('reopenable');\n        if (question_detail.reopened_by) {\n            rcqa.attr('data-reopened-by-question-id', cqToID(question_detail.contract, question_detail.reopened_by));\n            rcqa.addClass('reopened');\n        } else {\n            rcqa.removeClass('reopened');\n        }\n    }\n\n    if (question_detail.reopener_of_question_id) {\n        rcqa.addClass('reopener');\n        rcqa.attr('data-reopener-of-question-id', cqToID(question_detail.contract, question_detail.reopener_of_question_id));\n    }\n\n    if (isAnswerActivityStarted(question_detail)) {\n\n        const current_container = rcqa.find('.current-answer-container');\n\n        if (isAnswered(question_detail)) {\n            // label for show the current answer.\n            const label = rc_question.getAnswerString(question_json, question_detail.best_answer);\n            current_container.find('.current-answer-body').find('.current-answer').text(label);\n        }\n\n        bond = question_detail.bond;\n\n        if (question_detail['history'].length) {\n            //console.log('updateing aunswer');\n            const current_answer = historyItemForCurrentAnswer(question_detail);\n            if (current_answer) {\n                current_container.attr('id', 'answer-' + current_answer.answer);\n\n                timeago.cancel(current_container.find('.current-answer-item').find('.timeago')); // cancel the old timeago timer if there is one\n                current_container.find('.current-answer-item').find('.timeago').attr('datetime', rc_question.convertTsToString(current_answer.ts));\n                timeAgo.render(current_container.find('.current-answer-item').find('.timeago'));\n\n                // answerer data\n                const ans_data = rcqa.find('.current-answer-container').find('.answer-data');\n                ans_data.find('.answerer').text(current_answer.user);\n                const avjazzicon = jazzicon(32, parseInt(current_answer.user.toLowerCase().slice(2, 10), 16));\n                ans_data.find('.answer-data__avatar').html(avjazzicon);\n                if (current_answer.user == ACCOUNT) {\n                    ans_data.addClass('current-account');\n                } else {\n                    ans_data.removeClass('current-account');\n                }\n                ans_data.find('.answer-bond-value').text(decimalizedBigNumberToHuman(current_answer.bond));\n            }\n\n            const last_ans = question_detail['history'][idx].args;\n            const unrevealed_answer_container = rcqa.find('.unrevealed-top-answer-container');\n            if (last_ans.is_commitment && !last_ans.revealed_block) {\n                unrevealed_answer_container.find('.answer-bond-value').text(decimalizedBigNumberToHuman(last_ans.bond));\n                unrevealed_answer_container.find('.reveal-time.timeago').attr('datetime', rc_question.convertTsToString(commitExpiryTS(question_detail, last_ans['ts'])));\n                timeAgo.render(unrevealed_answer_container.find('.reveal-time.timeago'));\n                unrevealed_answer_container.find('.answerer').text(last_ans['user']);\n                const avjazzicon = jazzicon(32, parseInt(last_ans['user'].toLowerCase().slice(2, 10), 16));\n                unrevealed_answer_container.find('.answer-data__avatar').html(avjazzicon);\n            } else {\n                unrevealed_answer_container.find('.answer-bond-value').text('');\n                unrevealed_answer_container.find('.reveal-time.timeago').attr('datetime', 0);\n                unrevealed_answer_container.find('.answer-data__avatar').html('');\n                unrevealed_answer_container.find('.answerer').text('');\n                timeago.cancel(unrevealed_answer_container.find('.reveal-time.timeago')); \n            }\n\n            // TODO: Do duplicate checks and ensure order in case stuff comes in weird\n            for (let i = 0; i < idx; i++) {\n                const ans = question_detail['history'][i].args;\n                const hist_id = 'question-window-history-item-' + uiHash(question_id + ans.answer + ans.bond.toHexString());\n                if (rcqa.find('#' + hist_id).length) {\n                    //console.log('already in list, skipping', hist_id, ans);\n                    continue;\n                }\n                //console.log('not already in list, adding', hist_id, ans);\n                const hist_tmpl = rcqa.find('.answer-item.answered-history-item.template-item');\n                const hist_item = hist_tmpl.clone();\n                hist_item.attr('id', hist_id);\n                hist_item.find('.answerer').text(ans['user']);\n\n                const avjazzicon = jazzicon(32, parseInt(ans['user'].toLowerCase().slice(2, 10), 16));\n\n                hist_item.find('.answer-data__avatar').html(avjazzicon);\n\n                if (ans.is_commitment && !ans.revealed_block) {\n                    console.log('got a commitmet');\n                    if (isCommitExpired(question_detail, ans['ts'].toNumber())) {\n                        hist_item.find('.current-answer').text('Reveal timed out');\n                        hist_item.addClass('expired-commit');\n                    } else {\n                        hist_item.find('.current-answer').text('Wait for reveal...');\n                        hist_item.addClass('unrevealed-commit');\n                    }\n                } else {\n                    hist_item.find('.current-answer').text(rc_question.getAnswerString(question_json, ans.answer));\n                    hist_item.removeClass('unrevealed-commit');\n                }\n\n                hist_item.find('.answer-bond-value').text(decimalizedBigNumberToHuman(ans.bond));\n                hist_item.find('.answer-time.timeago').attr('datetime', rc_question.convertTsToString(ans['ts']));\n                timeAgo.render(hist_item.find('.answer-time.timeago'));\n                hist_item.removeClass('template-item');\n                hist_tmpl.after(hist_item);\n            }\n\n        }\n    }\n\n    rcqa.find('.bond-value').text(decimalizedBigNumberToHuman(question_detail.bond));\n    // Set the dispute value on a slight delay\n    // This ensures the latest entry was updated and the user had time to see it when arbitration was requested\n    window.setTimeout(function() {\n        rcqa.find('.arbitration-button').attr('data-last-seen-bond', question_detail.bond.toHexString());\n    }, 2000);\n\n    // question settings warning balloon\n    let balloon_html = '';\n    if (question_detail.timeout < 86400) {\n        balloon_html += 'The timeout is very low.<br /><br />This means there may not be enough time for people to correct mistakes or lies.<br /><br />';\n    }\n    if (isFinalized(question_detail) && question_detail.bounty.add(question_detail.bond).lt(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']))) {\n        balloon_html += 'The reward was very low and no substantial bond was posted.<br /><br />This means there may not have been enough incentive to post accurate information.<br /><br />';\n    }\n    const valid_arbitrator = isArbitratorValidFast(question_detail.contract, question_detail.arbitrator);\n\n    if (ARBITRATOR_FAILED_BY_CONTRACT[question_detail.contract.toLowerCase()] && ARBITRATOR_FAILED_BY_CONTRACT[question_detail.contract.toLowerCase()][question_detail.arbitrator.toLowerCase()]) {\n        rcqa.addClass('failed-arbitrator');\n    }\n\n    if (!valid_arbitrator) {\n        balloon_html += 'We do not recognize this arbitrator.<br />Do not believe this information unless you trust them.';\n    }\n    if (balloon_html) {\n        rcqa.find('.question-setting-warning').css('display', 'block');\n        rcqa.find('.question-setting-warning').find('.balloon').css('z-index', ++ZINDEX);\n        rcqa.find('.question-setting-warning').find('.balloon').html(balloon_html);\n    }\n\n    let questioner = question_detail.question_creator\n    let timeout = question_detail.timeout;\n    let balloon = rcqa.find('.question-setting-info').find('.balloon')\n    balloon.find('.setting-info-bounty').text(decimalizedBigNumberToHuman(question_detail.bounty));\n    balloon.find('.setting-info-min-bond').text(decimalizedBigNumberToHuman(question_detail.min_bond));\n    balloon.find('.setting-info-bond').text(decimalizedBigNumberToHuman(question_detail.bond));\n    balloon.find('.setting-info-timeout').text(rc_question.secondsTodHms(question_detail.timeout));\n    balloon.find('.setting-info-content-hash').text(question_detail.content_hash);\n    balloon.find('.setting-info-question-id').text(question_detail.question_id);\n    balloon.find('.setting-info-contract-address').text(question_detail.contract);\n    balloon.find('.setting-info-arbitrator').text(arbitratorAddressToText(question_detail.contract, question_detail.arbitrator));\n    balloon.find('.setting-info-questioner').text(questioner);\n    balloon.find('.setting-info-created-ts').text(new Date(question_detail.creation_ts*1000).toUTCString().replace('GMT', 'UTC'));\n    let opening_ts_str = 'Unset';\n    if (question_detail.opening_ts.gt(0)) {\n        opening_ts_str = new Date(question_detail.opening_ts*1000).toUTCString().replace('GMT', 'UTC');\n    }\n    balloon.find('.setting-info-opening-ts').text(opening_ts_str);\n    balloon.css('z-index', ++ZINDEX);\n\n    const unconfirmed_container = rcqa.find('.unconfirmed-answer-container');\n    if (question_detail['history_unconfirmed'].length) {\n\n        const unconfirmed_answer = question_detail['history_unconfirmed'][question_detail['history_unconfirmed'].length - 1].args;\n\n        const txid = question_detail['history_unconfirmed'][question_detail['history_unconfirmed'].length - 1].txid;\n        unconfirmed_container.find('.pending-answer-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        unconfirmed_container.find('.pending-answer-txid a').text(txid.substr(0, 12) + \"...\");\n        unconfirmed_container.attr('data-pending-txid', txid);\n\n        timeago.cancel(unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago')); // cancel the old timeago timer if there is one\n        unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago').attr('datetime', rc_question.convertTsToString(unconfirmed_answer.ts));\n        timeAgo.render(unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago'));\n\n        // answerer data\n        const ans_data = rcqa.find('.unconfirmed-answer-container').find('.answer-data');\n        ans_data.find('.answerer').text(unconfirmed_answer.user);\n        const avjazzicon = jazzicon(32, parseInt(unconfirmed_answer.user.toLowerCase().slice(2, 10), 16));\n        ans_data.find('.answer-data__avatar').html(avjazzicon);\n        if (unconfirmed_answer.user == ACCOUNT) {\n            ans_data.addClass('unconfirmed-account');\n        } else {\n            ans_data.removeClass('unconfirmed-account');\n        }\n        ans_data.find('.answer-bond-value').text(decimalizedBigNumberToHuman(unconfirmed_answer.bond));\n\n        // label for show the unconfirmed answer.\n        const label = rc_question.getAnswerString(question_json, unconfirmed_answer.answer);\n        unconfirmed_container.find('.unconfirmed-answer-body').find('.unconfirmed-answer').text(label);\n\n        rcqa.addClass('has-unconfirmed-answer');\n\n    } else {\n\n        rcqa.removeClass('has-unconfirmed-answer');\n\n    }\n\n    // Arbitrator\n    if (question_detail.arbitrator.toLowerCase() == question_detail.contract.toLowerCase()) {\n        rcqa.addClass('no-arbitrator');\n    } else if (!isArbitrationPending(question_detail) && !isFinalized(question_detail)) {\n        console.log('getting arb stuff')\n        const arb = ARBITRATOR_INSTANCE.attach(question_detail.arbitrator);\n        // Normal arbitrators should respond correctly to getDisputeFee()\n        arb.functions.getDisputeFee(question_id).then(function(fee_arr) {\n            const fee = fee_arr[0];\n            console.log('got arbitration fee, rendering', fee)\n            //rcqa.find('.arbitrator').text(question_detail.arbitrator);\n            rcqa.find('.arbitration-fee').text(decimalizedBigNumberToHuman(fee, true));\n            rcqa.find('.arbitration-button').removeClass('unpopulated');\n            if (CHAIN_INFO.nativeCurrency && CHAIN_INFO.nativeCurrency.symbol) {\n                rcqa.find('.token-always-native').text(CHAIN_INFO.nativeCurrency.symbol);\n            }\n        }).catch(async function(err) {\n            // If it doesn't implement the getDisputeFee method, we might want to use foreignProxy\n            // If anything about this fails we just mark the arbitrator failed and tell the user to be careful.\n            // TODO: We should really be initially loading the metadata\n            // This will tell us if we have a foreign proxy or not\n\n            // Non-standard arbitrators should tell us how they're non-standard with their metadata\n            // console.log('caught error with getDisputeFee, question was', question_detail, err);\n            const metadata = await loadArbitratorMetaData(question_detail.arbitrator);\n            if (metadata.foreignProxy) {\n                const fp_abi = [\n                  \"function foreignProxy() view returns (address)\",\n                  \"function foreignChainId() view returns (uint256)\"\n                ];\n                const fpArb = new ethers.Contract(question_detail.arbitrator, fp_abi, provider);\n                const foreign_proxy_arr = await fpArb.functions.foreignProxy();\n                const foreign_proxy = foreign_proxy_arr[0];\n                console.log('using foreign proxy', foreign_proxy);\n                const foreign_chain_id_arr = await fpArb.functions.foreignChainId()\n                const foreign_chain_id = foreign_chain_id_arr[0].toNumber();\n                const btn = rcqa.find('.arbitration-button-foreign-proxy');\n                btn.click(async function(evt) {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n\n                    const question_latest = await ensureQuestionDetailFetched(question_detail.contract, question_detail.question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n                    if (!question_latest) {\n                        console.log('Error, question detail not found');\n                        return false;\n                    }\n                    if (question_latest.bond.eq(0)) {\n                        $('body').addClass('error-request-arbitration-without-answer-error').addClass('error');\n                        return false;\n                    }\n                    const url_data = question_latest;\n                    url_data['network_id'] = foreign_chain_id\n                    url_data['foreign_proxy'] = foreign_proxy;\n                    //delete url_data['history_unconfirmed'];\n                    console.log('fpwin', url_data);\n                    const proxy_url = 'index.html#!/foreign-proxy/' + encodeURIComponent(JSON.stringify(url_data));\n                    console.log('proxy_url', proxy_url);\n                    window.open(proxy_url);\n                });\n                btn.removeClass('unpopulated').attr('data-foreign-proxy', foreign_proxy).attr('data-foreign-chain-id', foreign_chain_id);\n            } else {\n                // If it doesn't implement foreign proxy either, it's a contract or address without the proper interface.\n                // console.log('arbitrator failed with error', err);\n                markArbitratorFailed(question_detail.contract, question_detail.arbitrator, contractQuestionID(question_detail));\n            }\n        });\n    }\n\n    if (isQuestionBeforeOpeningDate(question_detail)) {\n        rcqa.find('.add-reward-button').removeClass('is-open')\n    } else {\n        rcqa.find('.add-reward-button').addClass('is-open')\n    }\n    \n    if (!is_refresh) {\n        // answer form\n        const ans_frm = makeSelectAnswerInput(question_json, question_detail.opening_ts.toNumber(), question_detail.has_invalid_option, question_detail.has_too_soon_option);\n        ans_frm.addClass('is-open');\n        ans_frm.removeClass('template-item');\n        rcqa.find('.answered-history-container').after(ans_frm);\n    }\n\n    // If the user has edited the field, never repopulate it underneath them\n    const bond_field = rcqa.find('.rcbrowser-input--number--bond.form-item');\n    if (!bond_field.hasClass('edited')) {\n        // console.log('min bond /2', bond.toString());\n        bond_field.val(decimalizedBigNumberToHuman(bond.mul(2)));\n    }\n\n    rcqa = updateQuestionState(question_detail, rcqa);\n\n    if (isFinalized(question_detail)) {\n        const tot = totalClaimable(question_detail);\n        if (tot.eq(0)) {\n            rcqa.removeClass('is-claimable');\n        } else {\n            rcqa.addClass('is-claimable');\n            rcqa.find('.answer-claim-button .claimable-eth').text(decimalizedBigNumberToHuman(tot));\n        }\n    } else {\n        rcqa.removeClass('is-claimable');\n    }\n\n    if (question_json.type == 'datetime') {\n        let precision = 'd';\n        if ('precision' in question_json) {\n            precision = question_json['precision']; \n        }\n        rcqa.attr('data-datetime-precision', precision);\n    }\n    \n    setupDatetimeDatePicker(rcqa);\n\n    //console.log(claimableItems(question_detail));\n\n    return rcqa;\n\n}\n\nfunction totalClaimable(question_detail) {\n    const poss = possibleClaimableItems(question_detail);\n    return poss['total'];\n}\n\n/*\nIf you get anything from the list, return the whole thing\n*/\nfunction possibleClaimableItems(question_detail) {\n\n    let ttl = ethers.BigNumber.from(0);\n    let is_your_claim = false;\n\n    if (ethers.BigNumber.from(question_detail.history_hash).eq(0)) {\n        //console.log('everything already claimed', question_detail.history_hash);\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    if (!isFinalized(question_detail)) {\n        //console.log('not finalized', question_detail);\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    //console.log('should be able to claim question ', question_detail);\n    //console.log('history_hash', question_detail.history_hash);\n\n    let question_ids = [];\n    let answer_lengths = [];\n    let claimable_bonds = [];\n    let claimable_answers = [];\n    let claimable_answerers = [];\n    let claimable_history_hashes = [];\n\n    let is_first = true;\n    let num_claimed = 0;\n    let is_yours = false;\n\n    let final_answer = question_detail.best_answer;\n    for (let i = question_detail['history'].length - 1; i >= 0; i--) {\n\n        // TODO: Check the history hash, and if we haven't reached it, keep going until we do\n        // ...since someone may have claimed partway through\n\n        let answer = null;\n        // Only set on reveal, otherwise the answer field still holds the commitment ID for commitments\n        if (question_detail['history'][i].args.commitment_id) { \n            answer = question_detail['history'][i].args.commitment_id;\n        } else {\n            answer = question_detail['history'][i].args.answer;\n        }\n        const answerer = question_detail['history'][i].args.user;\n        const bond = question_detail['history'][i].args.bond;\n        const history_hash = question_detail['history'][i].args.history_hash;\n\n        if (is_yours) {\n            // Somebody takes over your answer\n            if (answerer != ACCOUNT && final_answer == answer) {\n                is_yours = false;\n                //console.log(ttl.toString(), 'sub', bond.toString());\n                ttl = ttl.sub(bond); // pay them their bond\n            } else {\n                //console.log(ttl.toString(), 'add', bond.toString());\n                ttl = ttl.add(bond); // take their bond\n            }\n        } else {\n            // You take over someone else's answer\n            if (answerer == ACCOUNT && final_answer == answer) {\n                is_yours = true;\n                //console.log(ttl.toString(), 'add', bond.toString());\n                ttl = ttl.add(bond); // your bond back\n            }\n        }\n        if (is_first && is_yours) {\n            //console.log('adding your bounty');\n            //console.log(ttl.toString(), 'add', question_detail.bounty.toString());\n            ttl = ttl.add(question_detail.bounty);\n        }\n\n        claimable_bonds.push(bond);\n        claimable_answers.push(answer);\n        claimable_answerers.push(answerer);\n        claimable_history_hashes.push(history_hash);\n\n        is_first = false;\n    }\n\n    // Nothing for you to claim, so return nothing\n    if (!ttl.gt(0)) {\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    question_ids.push(question_detail.question_id);\n    answer_lengths.push(claimable_bonds.length);\n\n    //console.log('item 0 should match question', claimable_history_hashes[0], question_detail.history_hash);\n\n    // For the history hash, each time we need to provide the previous hash in the history\n    // So delete the first item, and add 0x0 to the end.\n    claimable_history_hashes.shift();\n    claimable_history_hashes.push(\"0x0000000000000000000000000000000000000000000000000000000000000000\");\n\n    // TODO: Someone may have claimed partway, so we should really be checking against the contract state\n\n    return {\n        'txid': null,\n        'total': ttl,\n        'question_ids': question_ids,\n        'answer_lengths': answer_lengths,\n        'answers': claimable_answers,\n        'answerers': claimable_answerers,\n        'bonds': claimable_bonds,\n        'history_hashes': claimable_history_hashes\n    }\n\n}\n\nfunction renderTimeAgo(i, ts) {\n    const old_attr = i.find('.timeago').attr('datetime');\n    if (old_attr != '') {\n        timeago.cancel(i.find('.timeago'));\n    }\n    i.find('.timeago').attr('datetime', rc_question.convertTsToString(ts));\n    timeAgo.render(i.find('.timeago'));\n}\n\n// Anything in the document with this class gets updated\n// For when there's a single thing changed, and it's not worth doing a full refresh\nfunction updateAnyDisplay(contract_question_id, txt, cls) {\n    $(\"[data-contract-question-id='\" + contract_question_id + \"']\").find('.' + cls).text(txt);\n}\n\n/*\nFinds any item with timeago and the given block number\nFetches the timestamp for the block if not already cached\nPopulates the timestamp attribute\nCalls the callback on it\n*/\nfunction populateWithBlockTimeForBlockNumber(item, num, cbk) {\n\n    if (BLOCK_TIMESTAMP_CACHE[num]) {\n        cbk(item, BLOCK_TIMESTAMP_CACHE[num]);\n    } else {\n        provider.getBlock('latest', function(err, result) {\n            if (err || !result) {\n                console.log('getBlock err', err, result);\n                return;\n            }\n            BLOCK_TIMESTAMP_CACHE[num] = result.timestamp\n            cbk(item, result.timestamp);\n        });\n    }\n\n}\n\n// At this point the data we need should already be stored in QUESTION_DETAIL_CACHE\nfunction renderUserAction(question, entry, is_watch) {\n\n    // Keep track of the last block number whose result we could see by clicking on the user link\n    if (entry.blockNumber > LAST_DISPLAYED_BLOCK_NUMBER) {\n        LAST_DISPLAYED_BLOCK_NUMBER = entry.blockNumber;\n    }\n\n    // This will include events that we didn't specifically trigger, but we are intereseted in\n    renderNotifications(question, entry);\n\n    // Only show here if we asked the question (questions section) or gave the answer (answers section)\n    if (entry['event'] == 'LogNewQuestion' || entry['event'] == 'LogNewAnswer') {\n        if (isForCurrentUser(entry)) {\n            renderUserQandA(question, entry);\n            if (is_watch) {\n                if (entry.blockNumber > parseInt(getViewedBlockNumber(CHAIN_ID))) {\n                    $('.tooltip').addClass('is-visible');\n                }\n            }\n        }\n    }\n\n}\n\nfunction answersByMaxBond(answer_logs) {\n    let ans = {};\n    for (let i = 0; i < answer_logs.length; i++) {\n        const an = answer_logs[i];\n        const aval = an.args.answer;\n        const bond = an.args.bond;\n        if (ans[aval] && ans[aval].args.bond.gt(bond)) {\n            continue;\n        }\n        ans[aval] = an;\n    }\n    return ans;\n}\n\nfunction resetAccountUI() {\n    USER_CLAIMABLE_BY_CONTRACT = {};\n    Q_MIN_ACTIVITY_BLOCKS = {};\n    $('#your-question-answer-window').find('.account-specific').remove();\n    $('.answer-claim-button.claim-all').find('.claimable-eth').text('');\n    $('.answer-claim-button.claim-all').hide();\n}\n\nfunction insertNotificationItem(evt, notification_id, ntext, block_number, contract, question_id, is_positive, timestamp) {\n\n    if ($('.no-notifications-item').length > 0) {\n        $('.no-notifications-item').remove();\n        $('.see-all-notifications').css('visibility', 'visible');\n    }\n\n    const notifications = $('#your-question-answer-window').find('.notifications');\n    if (document.getElementById(notification_id)) {\n        // Already in the doc;\n        return true;\n    }\n\n    //console.log('insertNotificationItem has contractd', contract,' from evt', evt);\n\n    const existing_notification_items = notifications.find('.notifications-item');\n\n    const item_to_insert = $('#your-question-answer-window .notifications-template-container .notifications-item.template-item').clone();\n    item_to_insert.addClass('notification-event-' + evt);\n    item_to_insert.attr('id', notification_id);\n    item_to_insert.attr('data-contract-question-id', cqToID(contract, question_id));\n\n    item_to_insert.find('.notification-text').text(ntext).expander();\n    item_to_insert.attr('data-block-number', block_number);\n    item_to_insert.removeClass('template-item').addClass('populated-item');\n    item_to_insert.addClass('account-specific');\n\n    // Template item has a positive badge\n    // Turn it from green to red if something bad happened\n    if (!is_positive) {\n        item_to_insert.find('.notification-badge').removeClass('notification-badge--positive').addClass('notification-badge--negative');\n    }\n\n    let inserted = false;\n    existing_notification_items.each(function() {\n        const exi = $(this);\n        //console.log('compare', exi.attr('data-block-number'),' with our block number', block_number);\n        if (exi.attr('data-block-number') <= block_number) {\n            exi.before(item_to_insert);\n            inserted = true;\n            return false;\n        }\n        return true;\n    });\n\n    if (!inserted) {\n        notifications.append(item_to_insert);\n    }\n\n    // If we faked the event then we already have the timestamp\n    // We still use the latest block number for sorting purposes.\n    if (timestamp) {\n        renderTimeAgo(item_to_insert, timestamp);\n    } else {\n        populateWithBlockTimeForBlockNumber(item_to_insert, block_number, renderTimeAgo);\n    }\n\n}\n\n// We use the standard ethereum hashing for IDs used in the UI but we could use anything, it's just to make unique IDs\nfunction uiHash(str) {\n    return ethers.utils.solidityKeccak256([\"string\"], [str]);\n}\n\nfunction renderNotifications(qdata, entry) {\n\n    const contract = entry.address;\n    const question_id = qdata.question_id;\n    //console.log('renderNotification', action, entry, qdata);\n\n    const question_json = qdata.question_json;\n\n    const your_qa_window = $('#your-question-answer-window');\n\n    // TODO: Handle whether you asked the question\n\n    const qfilter = RCInstance(contract).filters.LogNewQuestion(question_id);\n\n    let ntext = '';\n    const evt = entry['event']\n    let notification_id = null;\n    let is_positive = true;\n    switch (evt) {\n        case 'LogNewQuestion':\n            notification_id = uiHash('LogNewQuestion' + entry.args.question_text + entry.args.arbitrator + ethers.BigNumber.from(entry.args.timeout).toHexString());\n            ntext = 'You asked a question - \"' + question_json['title'] + '\"';\n            insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n            break;\n\n        case 'LogNewAnswer':\n            notification_id = uiHash('LogNewAnswer' + entry.args.question_id + entry.args.user + entry.args.bond.toHexString());\n            if (entry.args.user == ACCOUNT) {\n                if (entry.args.is_commitment) {\n                    ntext = 'You committed to answering a question - \"' + question_json['title'] + '\"';\n                } else {\n                    ntext = 'You answered a question - \"' + question_json['title'] + '\"';\n                }\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n            } else {\n                RCInstance(contract).queryFilter(qfilter, RCStartBlock(contract), 'latest').then(function(result2) {\n                    if (result2[0].args.user == ACCOUNT) {\n                        ntext = 'Someone answered your question';\n                    } else if (qdata['history'][qdata['history'].length - 2].args.user == ACCOUNT) {\n                        is_positive = false;\n                        ntext = 'Your answer was overwritten';\n                    }\n                    if (typeof ntext !== 'undefined') {\n                        ntext += ' - \"' + question_json['title'] + '\"';\n                        insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, is_positive);\n                    }\n                });\n            }\n            break;\n\n        case 'LogAnswerReveal':\n            notification_id = uiHash('LogAnswerReveal' + entry.args.question_id + entry.args.user + entry.args.bond.toHexString());\n            if (entry.args.user == ACCOUNT) {\n                ntext = 'You revealed an answer to a question - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n            } else {\n                RCInstance(contract).queryFilter(qfilter, RCStartBlock(contract), 'latest').then(function(result2) {\n                    if (result2[0].args.user == ACCOUNT) {\n                        ntext = 'Someone revealed their answer to your question';\n                    } else if (qdata['history'][qdata['history'].length - 2].args.user == ACCOUNT) {\n                        is_positive = false;\n                        ntext = 'Your answer was overwritten';\n                    }\n                    if (typeof ntext !== 'undefined') {\n                        ntext += ' - \"' + question_json['title'] + '\"';\n                        insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, is_positive);\n                    }\n                });\n            }\n            break;\n\n        case 'LogFundAnswerBounty':\n            notification_id = uiHash('LogFundAnswerBounty' + entry.args.question_id + entry.args.bounty.toHexString() + entry.args.bounty_added.toHexString() + entry.args.user);\n            if (entry.args.user == ACCOUNT) {\n                ntext = 'You added reward - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n            } else {\n                RCInstance(contract).queryFilter(qfilter, RCStartBlock(contract), 'latest').then(function(result2) {\n                    if (result2[0].args.user == ACCOUNT) {\n                        ntext = 'Someone added reward to your question';\n                    } else {\n                        const prev_hist_idx = qdata['history'].length - 2;\n                        if ((prev_hist_idx >= 0) && (qdata['history'][prev_hist_idx].args.user == ACCOUNT)) {\n                            ntext = 'Someone added reward to the question you answered';\n                        }\n                    }\n                    if (typeof ntext !== 'undefined') {\n                        ntext += ' - \"' + question_json['title'] + '\"';\n                        insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n                    }\n                });\n            }\n            break;\n\n        case 'LogNotifyOfArbitrationRequest':\n            notification_id = uiHash('LogNotifyOfArbitrationRequest' + entry.args.question_id);\n            if (entry.args.user == ACCOUNT) {\n                ntext = 'You requested arbitration - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true);\n            } else {\n                RCInstance(contract).queryFilter(qfilter, RCStartBlock(contract), 'latest').then(function(result2) {\n                    const history_idx = qdata['history'].length - 2;\n                    if (result2[0].args.user == ACCOUNT) {\n                        ntext = 'Someone requested arbitration to your question';\n                    } else {\n                        if ((history_idx >= 0) && (qdata['history'][history_idx].args.user == ACCOUNT)) {\n                            ntext = 'Someone requested arbitration to the question you answered';\n                            is_positive = false;\n                        } else {\n                            ntext = 'Someone requested arbitration to the question';\n                        }\n                    }\n                });\n            }\n            break;\n\n        case 'LogFinalize':\n            console.log('in LogFinalize', entry, contract);\n            notification_id = uiHash('LogFinalize' + entry.args.question_id + entry.args.answer);\n            let timestamp = null;\n            // Fake timestamp for our fake finalize event\n            if (entry.timestamp) {\n                timestamp = entry.timestamp;\n            }\n            RCInstance(contract).queryFilter(qfilter, RCStartBlock(contract), 'latest').then(function(result2) {\n                if (result2[0].args.user == ACCOUNT) {\n                    ntext = 'Your question is finalized';\n                } else if (qdata['history'] && qdata['history'][qdata['history'].length - 2].args.user == ACCOUNT) {\n                    ntext = 'The question you answered is finalized';\n                } else {\n                    ntext = 'A question was finalized';\n                }\n                if (typeof ntext !== 'undefined') {\n                    ntext += ' - \"' + question_json['title'] + '\"';\n                    insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.args.question_id, true, timestamp);\n                }\n            });\n    }\n\n}\n\nfunction insertQAItem(contract, question_id, item_to_insert, question_section, block_number) {\n\n    const contract_question_id = cqToID(contract, question_id);\n    question_section.find('.your-qa__questions__item[data-contract-question-id=' + contract_question_id + ']').remove();\n\n    const question_items = question_section.find('.your-qa__questions__item');\n    let inserted = false;\n    question_items.each(function(idx, item) {\n        if ($(item).hasClass('template-item')) {\n            return true;\n        }\n        if ($(item).attr('data-block-number') <= block_number) {\n            $(item).before(item_to_insert);\n            inserted = true;\n            //console.log('inserted in loop');\n            return false;\n        } else {\n            return true;\n        }\n    });\n    if (!inserted) {\n        question_section.append(item_to_insert);\n        //console.log('inserted through fall through');\n    }\n    populateWithBlockTimeForBlockNumber(item_to_insert, block_number, renderTimeAgo);\n\n}\n\nfunction renderQAItemAnswer(contract, question_id, answer_history, question_json, is_finalized) {\n    const question_section = $('#your-question-answer-window').find('.your-qa__questions');\n    const answer_section = $('#your-question-answer-window').find('.your-qa__answers');\n    const sections = [question_section, answer_section];\n    const contract_question_id = cqToID(contract, question_id);\n\n    sections.forEach(function(section) {\n        const target = section.find('div[data-contract-question-id=' + contract_question_id + ']');\n        if (answer_history.length > 0) {\n            let user_answer;\n            for (let i = answer_history.length - 1; i >= 0; i--) {\n                if (answer_history[i].args.user == ACCOUNT) {\n                    user_answer = answer_history[i].args.answer;\n                    break;\n                }\n            }\n            let latest_answer = answer_history[answer_history.length - 1].args.answer;\n            target.find('.latest-answer-text').text(rc_question.getAnswerString(question_json, latest_answer));\n            if (typeof user_answer !== 'undefined') {\n                target.find('.user-answer-text').text(rc_question.getAnswerString(question_json, user_answer));\n            } else {\n                target.find('.your-qa__questions__item-body--user').css('display', 'none');\n            }\n\n            if (user_answer == latest_answer) {\n                target.find('.different-latest-answer-container').hide();\n            }\n\n            target.find('.your-qa__questions__item-body--latest').css('display', 'block');\n        } else {\n            target.find('.your-qa__questions__item-body--latest').css('display', 'none');\n            target.find('.your-qa__questions__item-body--user').css('display', 'none');\n        }\n\n        if (is_finalized) {\n            target.find('.your-qa__questions__item-status').addClass('.your-qa__questions__item-status--resolved');\n            target.find('.your-qa__questions__item-status').text('Resolved');\n        } else {\n            target.find('.your-qa__questions__item-status').text(answer_history.length + ' Answers');\n        }\n    });\n\n}\n\nfunction renderUserQandA(qdata, entry) {\n\n    const question_id = qdata.question_id;\n    const answer_history = qdata['history'];\n\n    const question_json = qdata.question_json;\n    const contract_question_id = cqToID(entry.address, question_id);\n\n    let question_section;\n    if (entry['event'] == 'LogNewQuestion') {\n        question_section = $('#your-question-answer-window').find('.your-qa__questions .your-qa__questions-inner');\n    } else if (entry['event'] == 'LogNewAnswer') {\n        question_section = $('#your-question-answer-window').find('.your-qa__answers .your-qa__answers-inner');\n    }\n    if (question_section.find('.no-your-qa__questions__item').length > 0) {\n        question_section.find('.no-your-qa__questions__item').remove();\n    }\n\n    const qitem = question_section.find('.your-qa__questions__item.template-item').clone();\n    qitem.attr('data-contract-question-id', contract_question_id);\n    qitem.find('.question-text').text(question_json['title']).expander();\n    qitem.attr('data-block-number', entry.blockNumber);\n    qitem.removeClass('template-item');\n    qitem.addClass('account-specific');\n    insertQAItem(qdata.contract, question_id, qitem, question_section, entry.blockNumber);\n\n    const is_finalized = isFinalized(qdata);\n    renderQAItemAnswer(qdata.contract, question_id, answer_history, question_json, is_finalized);\n\n    const updateBlockTimestamp = function(item, ts) {\n        let date = new Date();\n        date.setTime(ts * 1000);\n        let date_str = MONTH_LIST[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear() +\n            ' ' + date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();\n        item.find('.item-date').text(date_str);\n    }\n    populateWithBlockTimeForBlockNumber(qitem, entry.blockNumber, updateBlockTimestamp);\n}\n\nfunction makeSelectAnswerInput(question_json, opening_ts, has_invalid, has_answered_too_soon) {\n    const type = question_json['type'];\n    const options = question_json['outcomes'];\n\n    let ans_frm;\n    if (opening_ts && isBeforeOpeningDate(opening_ts)) {\n        const template_name = '.answer-form-container.before-opening.template-item';\n        ans_frm = $(template_name).clone();\n        ans_frm.removeClass('template-item');\n        ans_frm.find('.opening-time-label .timeago').attr('datetime', rc_question.convertTsToString(opening_ts));\n        timeAgo.render(ans_frm.find('.opening-time-label .timeago'));\n    } else {\n        const template_name = '.answer-form-container.' + question_json['type'] + '.template-item';\n        ans_frm = $(template_name).clone();\n        ans_frm.removeClass('template-item');\n\n        switch (type) {\n            case 'single-select':\n                for (let i = 0; i < options.length; i++) {\n                    const option_elm = $('<option>');\n                    option_elm.val(i);\n                    option_elm.text(options[i]);\n                    ans_frm.find('.select-answer').find('.invalid-select').before(option_elm);\n                }\n                break;\n            case 'multiple-select':\n                for (let i = options.length - 1; i >= 0; i--) {\n                    const elmtpl = ans_frm.find('.input-entry.template-item');\n                    const elm = elmtpl.clone();\n                    elm.removeClass('template-item');\n                    const elinput = elm.find('input');\n                    elinput.attr('name', 'input-answer');\n                    elinput.val(i);\n                    const ellabel = elm.find('span');\n                    ellabel.text(options[i]);\n                    // Here we copy the content and throw away the container\n                    elmtpl.after(elm);\n                }\n                break;\n        }\n    }\n\n    if (!has_invalid) {\n        ans_frm.find('.invalid-select').remove();\n    }\n    if (!has_answered_too_soon) {\n        ans_frm.find('.too-soon-select').remove();\n    }\n\n    return ans_frm;\n}\n\n// show final answer button\n// TODO: Pass in the current data from calling question if we have it to avoid the unnecessary call\nfunction updateQuestionState(question, question_window) {\n    if (isAnswered(question)) {\n        question_window.addClass('has-answer');\n    } else {\n        question_window.removeClass('has-answer');\n    }\n\n    if (hasUnrevealedCommits(question)) {\n        question_window.addClass('has-unrevealed-commits');\n    } else {\n        question_window.removeClass('has-unrevealed-commits');\n    }\n\n    if (isTopAnswerRevealable(question)) {\n        question_window.addClass('top-entry-unrevealed');\n    } else {\n        question_window.removeClass('top-entry-unrevealed');\n    }\n\n    if (isAnsweredOrAnswerActive(question)) {\n        if (isFinalized(question)) {\n            timeago.cancel(question_window.find('.resolved-at-value.timeago'));\n            question_window.find('.resolved-at-value').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(question_window.find('.resolved-at-value.timeago')); // TODO: Does this work if we haven't displayed the item yet?\n        } else {\n            timeago.cancel(question_window.find('.answer-deadline.timeago'));\n            question_window.find('.answer-deadline').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(question_window.find('.answer-deadline.timeago')); // TODO: Does this work if we haven't displayed the item yet?\n        }\n    } \n\n    // The first item is the current answer\n    // However we don't show it as current answer if it's unrevealed\n    if (question['history'].length > 1 || (question['history'].length  == 1 && hasUnrevealedCommits(question) ) ) {\n        question_window.addClass('has-history');\n    } else {\n        question_window.removeClass('has-history');\n    }\n\n    if (isArbitrationPending(question)) {\n        question_window.removeClass('question-state-open').addClass('question-state-pending-arbitration').removeClass('question-state-finalized');\n    } else {\n        if (!isFinalized(question)) {\n            question_window.addClass('question-state-open').removeClass('question-state-pending-arbitration').removeClass('question-state-finalized');\n        } else {\n            question_window.removeClass('question-state-open').removeClass('question-state-pending-arbitration').addClass('question-state-finalized');\n        }\n    }\n\n    return question_window;\n\n}\n\nfunction isBeforeOpeningDate(opening_ts) {\n    const opening_date = opening_ts * 1000\n    const now = new Date();\n    \n    return now.getTime() < opening_date\n}\n\nfunction isQuestionBeforeOpeningDate(question_detail) {    \n    return isBeforeOpeningDate(question_detail.opening_ts.toNumber())\n}\n\n// TODO\n// This is currently not called, as we just fetch everything back from logs\n// Potentially resurrect it with a more efficient flow\n// Also potentially do it before confirmation (See issue #44)\nfunction pushWatchedAnswer(answer) {\n    const question_id = answer.args.question_id;\n    let already_exists = false;\n    const length = QUESTION_DETAIL_CACHE[question_id]['history'].length;\n\n    for (let i = 0; i < length; i++) {\n        if (QUESTION_DETAIL_CACHE[question_id]['history'][i].args.answer == answer.args.answer) {\n            already_exists = true;\n            break;\n        }\n    }\n\n    if (!already_exists) {\n        QUESTION_DETAIL_CACHE[question_id]['history'].push(answer);\n    }\n}\n\n$(document).on('click', '.answer-item', function() {\n    //console.log('.answer-item clicked');\n    if ($(this).find('.answer-data').hasClass('is-bounce')) {\n        $(this).find('.answer-data').removeClass('is-bounce');\n        $(this).find('.answer-data').css('display', 'none');\n    } else {\n        $(this).find('.answer-data').addClass('is-bounce');\n        $(this).find('.answer-data').css('display', 'block');\n    }\n});\n\n// Do an initial validity check\nfunction isAnswerInputLookingValid(parent_div, question_json) {\n\n    if (parent_div.find('.invalid-selected').length > 0) {\n        return true;\n    }\n    if (parent_div.find('.too-soon-selected').length > 0) {\n        return true;\n    }\n\n    const answer_element = parent_div.find('[name=\"input-answer\"]');\n    if (question_json['type'] == 'uint') {\n        if (answer_element.val() == '') {\n            console.log('empty number');\n            return false;\n        } \n    } else if (question_json['type'] == 'bool') {\n        if ((answer_element.val() == '') || (answer_element.val() == 'default')) {\n            console.log('empty bool');\n            return false;\n        } \n    } else if (question_json['type'] == 'datetime') {\n        const dt_invalids = areDatetimeElementsInvalid(answer_element);            \n        if (dt_invalids[0] || dt_invalids[1]) {\n            console.log('bad datetime');\n            return false;\n        }\n    }\n    return true;\n\n}\n\nfunction formattedAnswerFromForm(parent_div, question_json) {\n\n    let new_answer;\n    const answer_element = parent_div.find('[name=\"input-answer\"]');\n\n    // Selects will just have \"invalid\" as an option in the pull-down.\n    // However, if there is no select we instead use a link underneath the input, and toggle the data-invalid-selected class on the input\n    const has_invalid_selection = (answer_element.attr('data-invalid-selected') == '1');\n    if (has_invalid_selection) {\n        new_answer = rc_question.getInvalidValue(question_json);\n        console.log('invalid selected, so submitting the invalid value ', new_answer);\n        return new_answer;\n    }\n\n    // Selects will just have \"invalid\" as an option in the pull-down.\n    // However, if there is no select we instead use a link underneath the input, and toggle the data-invalid-selected class on the input\n    const has_answered_too_soon_select = (answer_element.attr('data-too-soon-selected') == '1');\n    if (has_answered_too_soon_select) {\n        new_answer = rc_question.getAnsweredTooSoonValue(question_json);\n        console.log('answered too soon selected, so submitting the answered too soon value ', new_answer);\n        return new_answer;\n    }\n\n    if (question_json['type'] == 'multiple-select') {\n        let answer_input = [];\n        parent_div.find('.input-container--checkbox input[type=checkbox]').each(function() {\n            if ($(this).closest('label').hasClass('template-item')) {\n                return;\n            }\n            answer_input.push($(this).is(':checked'));\n        });\n        new_answer = rc_question.answerToBytes32(answer_input, question_json);\n    } else if (question_json['type'] == 'datetime') {\n        if (answer_element.val() == '') {\n            return null;\n        }\n        const ts = datetimeElementToTS(answer_element);\n        new_answer = rc_question.answerToBytes32(ts, question_json);\n    } else {\n        new_answer = rc_question.answerToBytes32(answer_element.val(), question_json);\n    }\n    console.log('submitting answer', new_answer);\n    return new_answer;\n\n}\n\nfunction areDatetimeElementsInvalid(answer_element) {\n    const precision = answer_element.attr('data-precision');\n    let ts;\n    let is_date_invalid = false;\n    let is_time_invalid = false;\n    try {\n        const dval = answer_element.val();\n        if (dval == '') {\n            throw new Exception(\"Date empty\");\n        }\n        let answer_date = new Date(dval);\n        ts = answer_date.getTime() / 1000;\n    } catch (e) {\n        is_date_invalid = true; \n    }\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        let time_element = answer_element.closest('.input-container').find('input.datetime-input-time');\n        let timets;\n        try {\n            const tval = time_element.val();\n            if (tval == '') {\n                throw new Exception(\"time empty\");\n            }\n            const dtd = new Date('1970-01-02T' + tval + 'Z'); // Use 02 not 01 because I'm not sure what happens if we're ahead of utc\n            timets = (dtd.getTime() / 1000) - 86400;\n        } catch (e) {\n            is_time_invalid = true;\n        }\n        //console.log('made time', timets);\n        // ts = ts + timets;\n    }\n    return [is_date_invalid, is_time_invalid];\n}\n\nfunction datetimeElementToTS(answer_element) {\n    let answer_date = new Date(answer_element.val());\n    let ts = answer_date.getTime() / 1000;\n    const precision = answer_element.attr('data-precision');\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        let time_element = answer_element.closest('.input-container').find('input.datetime-input-time');\n        //console.log('time el is ', time_element, 'val is ',time_element.val());\n        const dtd = new Date('1970-01-02T' + time_element.val()+ 'Z'); // Use 02 not 01 because I'm not sure what happens if we're ahead of utc\n        const timets = (dtd.getTime() / 1000) - 86400;\n        //console.log('made time', timets);\n        ts = ts + timets;\n    }\n    return ts; \n}\n\n// post an answer\n$(document).on('click', '.post-answer-button', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const parent_div = $(this).parents('div.rcbrowser--qa-detail');\n    await getAccount()\n\n    const contract_question_id = parent_div.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n\n    let bond = ethers.BigNumber.from(0);\n    const bond_field = parent_div.find('input[name=\"questionBond\"]');\n    try {\n        bond = humanToDecimalizedBigNumber(bond_field.val());\n    } catch (err) {\n        console.log('Could not parse bond field value', bond_field.val());\n    }\n    console.log('continuing with bond as ', bond.toString());\n    let is_err = false;\n\n    const block_before_send = CURRENT_BLOCK_NUMBER;\n\n    const question = ensureQuestionDetailFetched(contract, question_id, 1, 1, 1, -1)\n    .catch(function() {\n        // If the question is unconfirmed, go with what we have\n        console.log('caught failure, trying unconfirmed');\n        return ensureQuestionDetailFetched(contract, question_id, 0, 0, 0, -1)\n    })\n    .then(function(current_question) {\n        //console.log('got current_question', current_question);\n\n        let current_answer;\n        let new_answer;\n\n        // This may not be defined for an unconfirmed question\n        if (current_question.bond == null) {\n            current_question.bond = ethers.BigNumber.from(0);\n        }\n\n        const question_json = current_question.question_json;\n        //console.log('got question_json', question_json);\n\n        if (!isAnswerInputLookingValid(parent_div, question_json)) {\n            parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n            return;\n        }\n\n\n        const minNum = ethers.BigNumber.from('0x'+rc_question.minNumber(question_json).integerValue().toString(16));\n        const maxNum = ethers.BigNumber.from('0x'+rc_question.maxNumber(question_json).integerValue().toString(16));\n        new_answer = formattedAnswerFromForm(parent_div, question_json);\n        const invalid_value = rc_question.getInvalidValue(question_json);\n        const answered_too_soon_value = rc_question.getAnsweredTooSoonValue(question_json);\n\n        let ans;\n        let err = false;\n        switch (question_json['type']) {\n            case 'bool':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (err || !(ans.eq(ethers.BigNumber.from(0)) || ans.eq(ethers.BigNumber.from(1)) || ans.eq(ethers.BigNumber.from(invalid_value)) || ans.eq(ethers.BigNumber.from(answered_too_soon_value)))) {\n                    parent_div.find('div.select-container.select-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'uint':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (!err) {\n                    if (!ans.eq(ethers.BigNumber.from(invalid_value)) && !ans.eq(ethers.BigNumber.from(answered_too_soon_value)) && (ans.lt(minNum) || ans.gt(maxNum))) {\n                        err = true;\n                    } else if (ans.lt(ethers.BigNumber.from(0))) {\n                        err = true;\n                    }\n                }\n                if (err) {\n                    parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'int':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (!err) {\n                    if (!ans.eq(ethers.BigNumber.from(invalid_value)) && !ans.eq(ethers.BigNumber.from(answered_too_soon_value)) && (ans.lt(minNum) || ans.gt(maxNum))) {\n                        err = true;\n                    }\n                }\n                if (err) {\n                    parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'single-select':\n                const sing_container = parent_div.find('div.select-container.select-container--answer');\n                const sing_select = sing_container.find('select[name=\"input-answer\"]');\n                if (sing_select.prop('selectedIndex') == 0) {\n                    sing_container.addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'multiple-select':\n                const mult_container = parent_div.find('div.input-container.input-container--checkbox');\n                const checked = mult_container.find('input[name=\"input-answer\"]:checked');\n                if (!invalid_value && checked.length == 0) {\n                    mult_container.addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'datetime': \nconsole.log('datetime is ', new_answer, ethers.BigNumber.from(new_answer).toString());\n                if (new_answer === null) {\n                    const dt_container = parent_div.find('div.input-container.input-container--answer');\n                    dt_container.addClass('is-error');\n                    is_err = true;\n                }\n        }\n\n        // UI shouldn't let you do this\n        if (new_answer == invalid_value && !rc_question.hasInvalidOption(question_json, current_question.version_number)) {\n            console.log('invalid not supported');\n            is_err = true;\n        }\n\n        if (new_answer == answered_too_soon_value && !rc_question.hasAnsweredTooSoonOption(question_json, current_question.version_number)) {\n            console.log('answered too soon not supported');\n            is_err = true;\n        }\n\n        let min_amount = current_question.bond.mul(2)\n        if (bond.lt(min_amount)) {\nconsole.log('val fail', min_amount, current_question);\n            parent_div.find('div.input-container.input-container--bond').addClass('is-error');\n            parent_div.find('div.input-container.input-container--bond').find('.min-amount').text(decimalizedBigNumberToHuman(min_amount));\n            is_err = true;\n        }\n\n        if (is_err) throw ('err on submitting answer');\n\n        SUBMITTED_QUESTION_ID_BY_TIMESTAMP[question_id] = new Date().getTime();\n\n        // Remove the edited note to allow the field to be automatically populated again\n        bond_field.removeClass('edited'); \n\n        const handleAnswerSubmit = function(tx_response) {\n            const txid = tx_response.hash;\n            storePendingTXID(txid, CHAIN_ID);\n            const contract = tx_response.to;\n            clearForm(parent_div, question_json);\n            const fake_history = {\n                'args': {\n                    'answer': new_answer,\n                    'question_id': question_id,\n                    'history_hash': null, // TODO Do we need this?\n                    'user': ACCOUNT,\n                    'bond': bond,\n                    'ts': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)),\n                    'is_commitment': false\n                },\n                'event': 'LogNewAnswer',\n                'blockNumber': block_before_send,\n                'txid': txid\n            };\n\n\t    console.log('fillPendingUserTX', tx_response);\n\t    fillPendingUserTX(tx_response);\n\t    console.log('made PENDING_USER_TXES_BY_CQID', PENDING_USER_TXES_BY_CQID);\n\n            const question = filledQuestionDetail(contract, question_id, 'answers_unconfirmed', block_before_send, fake_history);\n            //console.log('after answer made question', question);\n\n            ensureQuestionDetailFetched(contract, question_id, 1, 1, block_before_send, block_before_send).then(function(question) {\n                updateQuestionWindowIfOpen(question);\n            }).catch(function() {\n                // Question may be unconfirmed, if so go with what we have\n                ensureQuestionDetailFetched(contract, question_id, 0, 0, 0, -1).then(function(question) {\n                    updateQuestionWindowIfOpen(contract, question);\n                });\n            });\n        };\n\n        const rc = RCInstance(contract, true);\n        if (USE_COMMIT_REVEAL) {\n            const answer_plaintext = new_answer;\n            const nonce = nonceFromSeed(uiHash(question_id + answer_plaintext + bond));\n            const answer_hash = rc_question.answerHash(answer_plaintext, nonce);\n\n            console.log('answerHash for is ',rc_question.answerHash(answer_plaintext, nonce));\n\n            console.log('made nonce', nonce);\n            console.log('made answer plaintext', answer_plaintext);\n            console.log('made bond', bond);\n            console.log('made answer_hash', answer_hash);\n\n            const commitment_id = rc_question.commitmentID(question_id, answer_hash, bond.toHexString());\n            console.log('resulting  commitment_id', commitment_id);\n\n            // TODO: We wait for the txid here, as this is not expected to be the main UI pathway.\n            // If USE_COMMIT_REVEAL becomes common, we should add a listener and do everything asychronously....\n            if (IS_TOKEN_NATIVE) {\n                return rc.functions.submitAnswerCommitment(question_id, answer_hash, current_question.bond, ACCOUNT, {\n                    from: ACCOUNT, \n                    // gas:200000, \n                    value:bond\n                }).then( function(tx_res) {\n                    console.log('got submitAnswerCommitment tx, waiting for confirmation', tx_res);\n                    tx_res.wait().then(function(tx_res) {\n                        rc.functions.submitAnswerReveal(question_id, answer_plaintext, nonce, bond, {\n                            from: ACCOUNT\n                            //gas:200000\n                        })\n                        .then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                    });\n                });\n            } else {\n                ensureAmountApproved(rc.address, ACCOUNT, bond).then(function() {\n                    return rc.functions.submitAnswerCommitmentERC20(question_id, answer_hash, current_question.bond, ACCOUNT, bond, {from:ACCOUNT}).then( function(tx_res) {\n                        console.log('got submitAnswerCommitment tx_res, waiting for confirmation', tx_res);\n                        tx_res.wait().then(function(tx_res) {\n                            rc.functions.submitAnswerReveal(question_id, answer_plaintext, nonce, bond, {from: ACCOUNT})\n                            .then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                        });\n                    });\n                });\n            }\n        } else {\n            if (IS_TOKEN_NATIVE) {\n                rc.functions.submitAnswer(question_id, new_answer, current_question.bond, {\n                    from: ACCOUNT,\n                    //gas: 200000,\n                    value: bond\n                }).then(function(tx_res) { handleAnswerSubmit(tx_res) });\n            } else {\n                ensureAmountApproved(rc.address, ACCOUNT, bond).then(function() {\n                    rc.functions.submitAnswerERC20(question_id, new_answer, current_question.bond, bond, {\n                        from: ACCOUNT\n                        //gas: 200000,\n                    }).then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                });\n            }\n        }\n    });\n    /*\n    .catch(function(e){\n        console.log(e);\n    });\n    */\n});\n\n$(document).on('click', '.reopen-question-submit', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const parent_div = $(this).parents('div.rcbrowser--qa-detail');\n\n    const contract_question_id = parent_div.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n\n    // reopenQuestion(uint256 template_id, string memory question, address arbitrator, uint32 timeout, uint32 opening_ts, uint256 nonce, uint256 min_bond, bytes32 reopens_question_id)\n\n    await getAccount()\n    // TODO: Recheck in case it's already opened\n\n    const old_question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, 1, -1);\n\n    const handleReopenQuestionTX = async function(tx_response, old_question) {\n        parent_div.addClass('reopening');\n        await tx_response.wait();\n        parent_div.removeClass('reopening');\n\n        // Give the node time to catch up after we get the event\n        await delay(6000);\n\n        // Force a refresh\n        const question = await ensureQuestionDetailFetched(old_question.contract, old_question.question_id);\n        openQuestionWindow(contractQuestionID(old_question));\n    };\n\n\n    /*\n    const handleReopenQuestionTX = function(tx_response, old_question) {\n        //console.log('sent tx with id', txid);\n\n        const txid = tx_response.hash;\n        const contract = old_question.contract;\n\n        // Make a fake log entry\n        const fake_log = {\n            'entry': 'LogNewQuestion',\n            'blockNumber': 0, // unconfirmed\n            'args': {\n                'question_id': question_id,\n                'user': ACCOUNT,\n                'arbitrator': old_question.arbitrator,\n                'timeout': ethers.BigNumber.from(old_question.timeout),\n                'content_hash': old_question.content_hash,\n                'template_id': old_question.template_id,\n                'question': old_question.question_text,\n                'created': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)),\n                'opening_ts': old_question.opening_ts\n            },\n            'address': contract \n        }\n        const fake_call = [];\n        fake_call[Qi_finalization_ts] = ethers.BigNumber.from(0);\n        fake_call[Qi_is_pending_arbitration] = false;\n        fake_call[Qi_arbitrator] = old_question.arbitrator;\n        fake_call[Qi_timeout] = ethers.BigNumber.from(old_question.timeout);\n        fake_call[Qi_content_hash] = old_question.content_hash;\n        fake_call[Qi_bounty] = ethers.BigNumber.from(0);;\n        fake_call[Qi_best_answer] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_bond] = ethers.BigNumber.from(0);\n        fake_call[Qi_min_bond] = old_question.min_bond;\n        fake_call[Qi_history_hash] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_opening_ts] = ethers.BigNumber.from(old_question.opening_ts);\n\n        let q = filledQuestionDetail(contract, question_id, 'question_log', 0, fake_log);\n        q = filledQuestionDetail(contract, question_id, 'question_call', 0, fake_call);\n        q = filledQuestionDetail(contract, question_id, 'question_json', 0, rc_question.populatedJSONForTemplate(CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][old_question.template_id], old_question.question_text));\n\n        // Turn the post question window into a question detail window\n        let rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        win.html(rcqa.html());\n        win = populateQuestionWindow(win, q, false);\n\n        // TODO: Once we have code to know which network we're on, link to a block explorer\n        win.find('.pending-question-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        win.find('.pending-question-txid a').text(txid.substr(0, 12) + \"...\");\n        win.addClass('unconfirmed-transaction').addClass('has-warnings');\n        win.attr('data-pending-txid', txid);\n\n        const contract_question_id = contractQuestionID(q);\n\n        win.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {};\n            WINDOW_POSITION[contract_question_id]['x'] = left;\n            WINDOW_POSITION[contract_question_id]['y'] = top;\n            win.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        set_hash_param({'question': contractQuestionID(q)});\n\n        const window_id = 'qadetail-' + contractQuestionID(q);\n        win.removeClass('rcbrowser--postaquestion').addClass('rcbrowser--qa-detail');\n        win.attr('id', window_id);\n        win.attr('data-contract-question-id', contractQuestionID(q));\n        Ps.initialize(win.find('.rcbrowser-inner').get(0));\n\n        // TODO: Add handling for tx_response.wait() \n        // See https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse\n\n    }\n    */\n\n    // TODO: Check if the arbitrator has a fee\n    const fee = ethers.BigNumber.from(0);\n\n    // We only want to reopen a question once, plus once for each time it was reopened then settled too soon.\n    // Hash that we don't get a zero which clashes with the normal askQuestion\n    const nonce_food = old_question.question_id + old_question.last_reopened_by ? old_question.last_reopened_by : \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n    const nonce = ethers.utils.keccak256('0x' + nonce_food.replace('0x', ''));\n    // const nonce = ethers.utils.keccak256(ethers.BigNumber.from(parseInt(Date.now())).toHexString());\n\n    // TODO: The same question may be asked multiple times by the same account, so set the nonce as something other than zero\n    // You only ever want to \n\n    const signedRC = RCInstance(contract, true);\n    //console.log(old_question.template_id, old_question.question_text, old_question.arbitrator, old_question.timeout, old_question.opening_ts, 0, old_question.min_bond);\n    const tx_response = await signedRC.functions.reopenQuestion(old_question.template_id, old_question.question_text, old_question.arbitrator, old_question.timeout, old_question.opening_ts, nonce, old_question.min_bond, old_question.question_id, {\n        from: ACCOUNT,\n        // gas: 200000,\n    //    value: fee\n    });\n\n    handleReopenQuestionTX(tx_response, old_question);\n\n});\n\n$(document).on('click', '.reopened-question-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cqid = $(this).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-reopened-by-question-id');\n    console.log('open window for', cqid);\n    openQuestionWindow(cqid);\n});\n\n$(document).on('click', '.reopener-question-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cqid = $(this).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-reopener-of-question-id');\n    console.log('open window for', cqid);\n    openQuestionWindow(cqid);\n});\n\nfunction clearForm(parent_div, question_json) {\n    parent_div.find('div.input-container.input-container--answer').removeClass('is-error');\n    parent_div.find('div.select-container.select-container--answer').removeClass('is-error');\n    parent_div.find('div.input-container.input-container--bond').removeClass('is-error');\n    parent_div.find('div.input-container.input-container--checkbox').removeClass('is-error');\n    parent_div.find('.answer-payment-value').text('');\n    parent_div.removeClass('has-someone-elses-answer').removeClass('has-your-answer');\n\n    switch (question_json['type']) {\n        case 'bool':\n            parent_div.find('select[name=\"input-answer\"]').prop('selectedIndex', 0);\n            break;\n        case 'uint':\n            parent_div.find('input[name=\"input-answer\"]').val('');\n            break;\n        case 'int':\n            parent_div.find('input[name=\"input-answer\"]').val('');\n            break;\n        case 'single-select':\n            parent_div.find('select[name=\"input-answer\"]').prop('selectedIndex', 0);\n            break;\n        case 'multiple-select':\n            const container = parent_div.find('div.input-container.input-container--checkbox');\n            container.find('input[name=\"input-answer\"]:checked').prop('checked', false);\n            break;\n    }\n}\n\n\n// open/close/add reward\n$(document).on('click', '.add-reward-button', function(e) {\n    const container = $(this).closest('.rcbrowser--qa-detail').find('.add-reward-container');\n    container.addClass('is-open');\n    container.addClass('is-bounce');\n    container.css('display', 'block');\n});\n\n$(document).on('click', '.add-reward__close-button', function(e) {\n    const container = $(this).closest('.rcbrowser--qa-detail').find('.add-reward-container');\n    container.removeClass('is-open');\n    container.removeClass('is-bounce');\n    container.css('display', 'none');\n});\n\n$(document).on('click', '.notifications-item', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n    //console.log('notifications-item clicked');\n    e.preventDefault();\n    e.stopPropagation();\n    openQuestionWindow($(this).attr('data-contract-question-id'));\n});\n\n$(document).on('click', '.rcbrowser-submit.rcbrowser-submit--add-reward', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const rcqa = $(this).closest('.rcbrowser--qa-detail');\n    const [contract, question_id] = parseContractQuestionID(rcqa.attr('data-contract-question-id'));\n    const reward_inp = $(this).parent('div').prev('div.input-container').find('input[name=\"question-reward\"]').val();\n\n    let err = false;\n    let reward = ethers.BigNumber.from(0);\n    try {\n        reward = humanToDecimalizedBigNumber(reward_inp);\n    } catch(e) {\n        console.log('reward data conversion error', e);\n        err = true;\n    }\n\n    const signedRC = RCInstance(contract, true);\n    if (err || reward <= 0) {\n        $(this).parent('div').prev('div.input-container').addClass('is-error');\n    } else {\n        await getAccount();\n        if (!IS_TOKEN_NATIVE) {\n            await ensureAmountApproved(contract, ACCOUNT, reward);\n        }\n        let tx_response = null;\n        if (IS_TOKEN_NATIVE) {\n            tx_response = await signedRC.fundAnswerBounty(question_id, {from: ACCOUNT, value: reward});\n        } else {\n            tx_response = await signedRC.fundAnswerBountyERC20(question_id, reward, {from: ACCOUNT})\n        }\n        await tx_response.wait();\n        //console.log('fund bounty', result);\n        const container = rcqa.find('.add-reward-container');\n        //console.log('removing open', container.length, container);\n        container.removeClass('is-open');\n        container.removeClass('is-bounce');\n        container.css('display', 'none');\n    }\n});\n\n/*-------------------------------------------------------------------------------------*/\n// arbitration\n$(document).on('click', '.arbitration-button', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const lnk = this;\n    await getAccount();\n\n    const contract_question_id = $(lnk).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n    const question_detail = await ensureQuestionDetailFetched(contract, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n    if (!question_detail) {\n        console.log('Error, question detail not found');\n        return false;\n    }\n\n    const last_seen_bond_hex = $(lnk).attr('data-last-seen-bond'); \n    if (!last_seen_bond_hex) {\n        console.log('Error, last seen bond not populated, aborting arbitration request');\n        return false;\n    }\n\n    if (question_detail.bond.gt(ethers.BigNumber.from(last_seen_bond_hex))) {\n        console.log('Answer has changed, please click again');\n        return false;\n    }\n\n    if (question_detail.bond.eq(0)) {\n        $('body').addClass('error-request-arbitration-without-answer-error').addClass('error');\n        return false;\n    }\n\n    //if (!question_detail.is_arbitration_pending) {}\n    const arb = ARBITRATOR_INSTANCE.attach(question_detail.arbitrator);\n    arb.functions.getDisputeFee(question_id).then(function(fee_arr) {\n        const arbitration_fee = fee_arr[0];\n        //console.log('got fee', arbitration_fee.toString());\n        console.log('requestArbitration(',question_id, ethers.BigNumber.from(last_seen_bond_hex), ACCOUNT, arbitration_fee);\n\n        const signed_arbitrator = arb.connect(signer);\n        signed_arbitrator.requestArbitration(question_id, ethers.BigNumber.from(last_seen_bond_hex), {from: ACCOUNT, value: arbitration_fee}).then(function(result) {\n            console.log('arbitration is requested.', result);\n        });\n    }).catch(function(err) {\n        console.log('arbitrator failed with error', err);\n        markArbitratorFailed(contract, question_detail.arbitrator, contract_question_id);\n    });\n});\n\nfunction show_bond_payments(ctrl) {\n    const frm = ctrl.closest('div.rcbrowser--qa-detail')\n    const contract_question_id = frm.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n    //console.log('got question_id', question_id);\n    ensureQuestionDetailFetched(contract, question_id).then(function(question) {\n        const question_json = question.question_json;\n        const existing_answers = answersByMaxBond(question['history']);\n        const new_answer = formattedAnswerFromForm(frm, question_json);\n        //console.log('new_answer', new_answer);\n        //console.log('existing_answers', existing_answers);\n        let payable = 0;\n        if (existing_answers[new_answer]) {\n            payable = existing_answers[new_answer].args.bond;\n            if (existing_answers[new_answer].args.user == ACCOUNT) {\n                frm.addClass('has-your-answer').removeClass('has-someone-elses-answer');\n                frm.find('.answer-credit-info .answer-payment-value').text(decimalizedBigNumberToHuman(payable));\n            } else {\n                frm.addClass('has-someone-elses-answer').removeClass('has-your-answer');\n                frm.find('.answer-debit-info .answer-payment-value').text(decimalizedBigNumberToHuman(payable));\n            }\n            frm.attr('data-answer-payment-value', payable.toHexString());\n        } else {\n            frm.removeClass('has-your-answer').removeClass('has-someone-elses-answer');\n            frm.find('.answer-payment-value').text('');\n            frm.attr('data-answer-payment-value', '');\n        }\n    }).catch(function(e) {\n        console.log('Could not fetch question, but continuing as it may be unconfirmed', question_id, e);\n    });\n\n}\n\n$('.rcbrowser-textarea').on('keyup', function(e) {\n    if ($(this).val() !== '') {\n        $(this).closest('div').removeClass('is-error');\n    }\n});\n\n$(document).on('keyup', '.rcbrowser-input.rcbrowser-input--number', function(e) {\n    let value = humanToDecimalizedBigNumber($(this).val());\n    //console.log($(this));\n    const bond_validation = function(ctrl){\n        ctrl.addClass('edited');\n        const contract_question_id = ctrl.closest('.rcbrowser.rcbrowser--qa-detail').attr('data-contract-question-id');\n        const [contract, question_id] = parseContractQuestionID(contract_question_id);\n        const current_idx = QUESTION_DETAIL_CACHE[contract_question_id]['history'].length - 1;\n        let current_bond = ethers.BigNumber.from(QUESTION_DETAIL_CACHE[contract_question_id].min_bond.div(2));\n        if (current_idx >= 0) {\n            current_bond = QUESTION_DETAIL_CACHE[contract_question_id]['history'][current_idx].args.bond;\n        }\n\n        const min_bond = current_bond.mul(2);\n        if (ctrl.val() === '' || value.lt(min_bond)) {\n            // console.log('The minimum bond is ', min_bond, 'rejecting value ',value);\n            ctrl.parent().parent().addClass('is-error');\n            ctrl.parent('div').next('div').find('.min-amount').text(decimalizedBigNumberToHuman(min_bond));\n        } else {\n            // console.log('The minimum bond is ', min_bond, 'accepting value ',value);\n            ctrl.parent().parent().removeClass('is-error');\n        }\n        show_bond_payments(ctrl);\n    }\n\n    if ($(this).val() === '') {\n        if ($(this).hasClass('rcbrowser-input--number--bond')) {\n            bond_validation($(this));\n        } else {\n            $(this).parent().parent().addClass('is-error');\n        }\n    }\n\n    if (($(this).closest('#post-a-question-window').length || $(this).hasClass('rcbrowser-input--number--answer'))\n        && value.lt(0)) {\n        $(this).parent().parent().addClass('is-error');\n    } else if ($(this).hasClass('rcbrowser-input--add-reward') && value.lte(0)) {\n        $(this).parent().parent().addClass('is-error');\n    } else if ($(this).hasClass('rcbrowser-input--number--bond')) {\n        bond_validation($(this));\n    } else {\n        $(this).parent().parent().removeClass('is-error');\n    }\n});\n\n$(document).on('click', '.invalid-switch-container a.invalid-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        if (!cont.hasClass('invalid-selected') && !cont.hasClass('too-soon-selected')) {\n            inp.attr('data-old-placeholder', inp.attr('placeholder'));\n        }\n        inp.val('');\n        inp.attr('readonly', true);\n        inp.attr('placeholder', 'Invalid');\n        inp.removeAttr('data-too-soon-selected');\n        inp.attr('data-invalid-selected', '1'); // will be read in processing\n    });\n    cont.addClass('invalid-selected').removeClass('too-soon-selected').removeClass('is-error');\n});\n\n$(document).on('click', '.invalid-switch-container a.valid-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        inp.attr('readonly', false);\n        let placeholder = inp.attr('data-old-placeholder');\n        if (typeof placeholder === typeof undefined || placeholder === false) {\n            placeholder = '';\n        }\n        inp.attr('placeholder', placeholder);\n        inp.removeAttr('data-old-placeholder');\n        inp.removeAttr('data-invalid-selected'); // will be read in processing\n    });\n    cont.removeClass('invalid-selected').removeClass('too-soon-selected').removeClass('is-error')\n});\n\n$(document).on('click', '.too-soon-switch-container a.too-soon-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        if (!cont.hasClass('invalid-selected') && !cont.hasClass('too-soon-selected')) {\n            inp.attr('data-old-placeholder', inp.attr('placeholder'));\n        }\n        inp.val('');\n        inp.attr('readonly', true);\n        inp.attr('placeholder', 'Answered too soon');\n        inp.attr('data-too-soon-selected', '1'); // will be read in processing\n        inp.removeAttr('data-invalid-selected');\n    });\n    cont.addClass('too-soon-selected').removeClass('invalid-selected').removeClass('is-error')\n});\n\n$(document).on('click', '.too-soon-switch-container a.not-too-soon-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        inp.attr('readonly', false);\n        let placeholder = inp.attr('data-old-placeholder');\n        if (typeof placeholder === typeof undefined || placeholder === false) {\n            placeholder = '';\n        }\n        inp.attr('placeholder', placeholder);\n        inp.removeAttr('data-old-placeholder');\n        inp.removeAttr('data-too-soon-selected'); // will be read in processing\n    });\n    cont.removeClass('too-soon-selected').removeClass('invalid-selected').removeClass('is-error');\n});\n\n$(document).on('change', '#post-question-window .question-type,.step-delay,.arbitrator', function(e) {\n    if ($(this).prop('selectedIndex') != 0) {\n        $(this).parent().removeClass('is-error');\n    }\n});\n\n$(document).on('change', 'select[name=\"input-answer\"]', function(e) {\n    if ($(this).prop('selectedIndex') != 0) {\n        $(this).parent().removeClass('is-error');\n        show_bond_payments($(this));\n    }\n});\n\n$(document).on('change', 'input[name=\"input-answer\"]:checkbox', function() {\n    const parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n    const container = parent_div.find('div.input-container.input-container--checkbox');\n    const checked = container.find('input[name=\"input-answer\"]:checked');\n    if (checked.length > 0) {\n        container.removeClass('is-error');\n    }\n    show_bond_payments($(this), checked);\n});\n\n// For now we force a reload\n// Probably better to handle the section arrays per category and display without moving\n$('#filter-list a').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cat = $(this).attr('data-category');\n    if (cat == 'all') {\n        window.location.hash = '';\n        set_hash_param({'category': null})\n    } else {\n        set_hash_param({'category': cat})\n    }\n    location.reload();\n});\n\n\n// This should be called with a question array containing, at a minimum, up-to-date versions of the changed_field and finalization_ts.\n// A full repopulate will work, but so will an array with these fields overwritten from a log event.\nfunction updateRankingSections(question, changed_field, changed_val) {\n    //console.log('in updateRankingSections', question, changed_field, changed_val);\n    // latest only change on new question\n    // resolved changes on finalization, this happens either with a timer or with arbitration. Also removes items from other section.\n    // closing soon changes when we add an answer\n    // high reward changes if we add reward. TODO: Should maybe include bond value, in which case it would also change on new answer\n\n    const question_id = question.question_id;\n    //console.log('updateRankingSections', question_id, changed_field, changed_val);\n    if (changed_field == 'finalization_ts') {\n        if (isFinalized(question)) {\n            //console.log('isFinalized');\n            const sections = ['questions-active', 'questions-closing-soon', 'questions-upcoming'];\n            for (let i = 0; i < sections.length; i++) {\n                const s = sections[i];\n                //console.log('doing section', s);\n                const existing_idx = DISPLAY_ENTRIES[s].ids.indexOf(question_id);\n                if (existing_idx !== -1) {\n                    DISPLAY_ENTRIES[s].ids.splice(existing_idx, 1);\n                    DISPLAY_ENTRIES[s].vals.splice(existing_idx, 1);\n                    //console.log('depopulating', s, question_id);\n                    depopulateSection(s, question_id);\n                }\n            }\n            const insert_before = update_ranking_data('questions-resolved', contractQuestionID(question), question.finalization_ts, 'desc');\n            //console.log('insert_before iss ', insert_before);\n            if (insert_before !== -1) {\n                //console.log('poulating', question);\n                // TODO: If question may not be populated, maybe we should refetch here first\n                populateSection('questions-resolved', question, insert_before);\n            }\n        } else {\n            //console.log('updating closing soon with timestamp', question_id, question.finalization_ts.toString());\n            const insert_before = update_ranking_data('questions-closing-soon', contractQuestionID(question), question.finalization_ts, 'asc');\n            //console.log('insert_before was', insert_before);\n            if (insert_before !== -1) {\n                populateSection('questions-closing-soon', question, insert_before);\n            }\n\n        }\n\n    } \n    if (changed_field == 'bounty' || changed_field == 'finalization_ts') {\n        //var insert_before = update_ranking_data('questions-upcoming', question_id, question.bounty.add(question.bond), 'desc');\n        const insert_before = update_ranking_data('questions-upcoming', contractQuestionID(question), question.opening_ts, 'desc');\n        //console.log('update for new bounty', question.bounty, 'insert_before is', insert_before);\n        if (insert_before !== -1) {\n            populateSection('questions-upcoming', question, insert_before);\n        }\n    }\n\n    // Things that don't need adding or removing, but may still need the content updating\n    updateSectionEntryDisplay(question);\n    reflectDisplayEntryChanges();\n    // TODO: Need to update sections that haven't changed position, but changed data\n\n}\n\n\nasync function handleEvent(error, result) {\n\n    if (result.invalid_data) { \n        console.log('skipping invalid log entry');\n        return;\n    }\n\n    // Check the action to see if it is interesting, if it is then populate notifications etc\n    handlePotentialUserAction(result, true);\n\n    const contract = result.address;\n\n    // Handles front page event changes.\n    // NB We need to reflect other changes too...\n    const evt = result['event'];\n    if (evt == 'LogNewTemplate') {\n        const template_id = result.args.template_id;\n        const question_text = result.args.question_text;\n        CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id] = question_text;\n        return;\n    } else if (evt == 'LogNewQuestion') {\n        handleQuestionLog(result);\n    } else if (evt == 'LogWithdraw') {\n        updateUserBalanceDisplay();\n    } else {\n        const question_id = result.args.question_id;\n\n        switch (evt) {\n\n            case 'LogNewAnswer':\n                let args = Object.assign({}, result.args);\n                if (args.is_commitment) {\n                    console.log('got commitment', result);\n                    args.commitment_id = args.answer;\n                    // TODO: Get deadline\n                    args.answer = null;\n                    // break;\n                }\n                result.args = args;\n\n                result = await waitForBlock(result);\n                //console.log('got LogNewAnswer, block ', result.blockNumber);\n                //console.log('runnign ensureQuestionDetailFetched with result for answers', result);\n                const question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, result.blockNumber, result.blockNumber, {'answers': [result]})\n                //console.log('result wasy ', question);\n                updateQuestionWindowIfOpen(question);\n                //console.log('should be getting latest', question, result.blockNumber);\n                scheduleFinalizationDisplayUpdate(contract, question);\n                updateRankingSections(question, 'finalization_ts', question.finalization_ts)\n                break;\n\n            case 'LogFundAnswerBounty':\n                ensureQuestionDetailFetched(contract, question_id, 1, 1, result.blockNumber, -1).then(function(question) {\n                    //console.log('updating with question', question);\n                    updateQuestionWindowIfOpen(question);\n                    updateRankingSections(question, 'bounty', question.bounty)\n                });\n                break;\n\n            default:\n                ensureQuestionDetailFetched(contract, question_id, 1, 1, result.blockNumber, -1).then(function(question) {\n                    updateQuestionWindowIfOpen(question);\n                    updateRankingSections(question, 'finalization_ts', question.finalization_ts)\n                });\n\n        }\n\n    }\n\n}\n\n\n/*-------------------------------------------------------------------------------------*/\n// initial process\n\nfunction pageInit(only_contract) {\n\n    if ($('body').hasClass('foreign-proxy')) {\n        return;\n    }\n\n    //console.log('in pageInit for account', account);\n\n    /*\n        1) Start watching for all actions.\n           This will include questions that the user answered or funded, which will update list of user question_ids.\n           These will be pass into the ranking tables as they come it.\n           Ranking tables may temporarily flash with new actions, which will later be buried under others which we later fetch\n           We can handle this on the display side if it turns out to be a problem.\n\n        2) Get historical logs of user actions.\n           These may include duplicates of things we got from the watch() call.\n\n        3) Get other historical questions and update the rankings.\n           These may include duplicates of things we got from the watch() call.\n\n        NB When we come to display the user actions, we may have only a partial list of the questions they may have answered\n           This may be because the question info hasn't arrived yet\n           We will use a targetted get() to fill in anything we are missing at that time.\n\n    */\n\n/*\nTODO restore\n    var RealityCheckRealitio = contract(rc_json);\n    RealityCheckRealitio.setProvider(new Web3.providers.HttpProvider(HOSTED_RPC_NODE));\n    console.log('using network', HOSTED_RPC_NODE);\n    RealityCheckRealitio.deployed().then(function(instance) {\n        rcrealitio = instance;\n\n        var evts = rcrealitio.allEvents({}, {\n            fromBlock: 'latest',\n            toBlock: 'latest'\n        })\n\n        evts.watch(function(error, result) {\n            if (!error && result) {\n                console.log('got watch event', error, result);\n                // Give the node we're calling some time to catch up\n                window.setTimeout(\n                    function() {\n                        handleEvent(error, result);\n                    }, 5000\n                );\n            }\n        });\n\n    });\n*/\n\n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-active-answered'); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-active-unanswered'); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-upcoming'); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-resolved'); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-awaiting-arbitration'); \n\n    // Now the rest of the questions\n    LAST_POLLED_BLOCK = CURRENT_BLOCK_NUMBER;\n    for(let i=0; i<RC_DISPLAYED_CONTRACTS.length; i++) {\n        const ctr = RC_DISPLAYED_CONTRACTS[i];\n        fetchAndDisplayQuestionsFromLogs(ctr, CURRENT_BLOCK_NUMBER, 0);\n    }\n\n};\n\n\nfunction reflectDisplayEntryChanges() {\n    //console.log('checking DISPLAY_ENTRIES', DISPLAY_ENTRIES);\n    //look at current sections and update blockchain scanning message to\n    //no questions found if no items exist\n    const detypes = Object.keys(DISPLAY_ENTRIES);\n    // console.log('no questions cateogry, DISPLAY_ENTRIES for detype', DISPLAY_ENTRIES, detypes);\n    for (let i=0; i<detypes.length; i++) {\n        const detype = detypes[i];\n        const has_items = ($('#' + detype).find('div.questions-list div.questions__item').length > 0);\n        if (has_items) {\n            $('#' + detype).find('.no-questions-category').css('display', 'none');\n            $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n        } else {\n            if (IS_INITIAL_LOAD_DONE) {\n                $('#' + detype).find('.no-questions-category').css('display', 'block');\n                $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n            } else {\n                $('#' + detype).find('.no-questions-category').css('display', 'none');\n                $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n            }\n        }\n\n    } \n}\n\nasync function fetchAndDisplayQuestionFromGraph(displayed_contracts, ranking) {\n    //console.log('fetchAndDisplayQuestionFromGraph', displayed_contracts, ranking);\n\n    const ts_now = parseInt(new Date()/1000);\n    const contract_str = JSON.stringify(displayed_contracts);\n    const ranking_where = {\n        'questions-active-answered': `{contract_in: ${contract_str}, isPendingArbitration: false, answerFinalizedTimestamp_gt: ${ts_now}, openingTimestamp_lte: ${ts_now}}`,\n        'questions-active-unanswered': `{contract_in: ${contract_str}, isPendingArbitration: false, answerFinalizedTimestamp: null, openingTimestamp_lte: ${ts_now}}`,\n        'questions-upcoming': `{contract_in: ${contract_str}, isPendingArbitration: false, openingTimestamp_gt: ${ts_now}}`,\n        'questions-resolved': `{contract_in: ${contract_str}, answerFinalizedTimestamp_lt: ${ts_now}}`,\n        'questions-awaiting-arbitration': `{contract_in: ${contract_str}, isPendingArbitration: true}`,\n    }\n\n    const ranking_order = {\n        'questions-active-answered': 'lastBond', \n        'questions-active-unanswered': 'createdTimestamp',\n        'questions-upcoming': 'createdTimestamp',\n        'questions-resolved': 'answerFinalizedTimestamp',\n        'questions-awaiting-arbitration': 'lastBond'\n    }\n\n    const where = ranking_where[ranking];\n    const orderBy = ranking_order[ranking];\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n\n    const query = `\n      {\n        questions(first: 10, where: ${where}, orderBy: ${orderBy}, orderDirection: desc) {\n            id,\n            questionId,\n            contract,\n            createdBlock\n        }\n      }  \n      `;\n\n    // console.log('sending graph query', ranking, query);\n    const res = await axios.post(network_graph_url, {query: query});\n    // console.log('graph res', ranking, res.data);\n    for (const q of res.data.data.questions) {\n        const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n        for (let i = 0; i < result.length; i++) {\n            handlePotentialUserAction(result[i], false);\n            handleQuestionLog(result[i]);\n        }\n    }\n}\n\nasync function fetchAndDisplayQuestionsFromLogs(contract, end_block, fetch_i) {\n\n    // get how many to fetch off fetch_numbers, until we run off the end then use the last num\n    const fetch_num = (fetch_i < FETCH_NUMBERS.length) ? FETCH_NUMBERS[fetch_i] : FETCH_NUMBERS[FETCH_NUMBERS.length - 1];\n\n    let start_block = end_block - fetch_num;\n    if (start_block < RCStartBlock(contract)) {\n        start_block = RCStartBlock(contract);\n    }\n    if (end_block <= RCStartBlock(contract)) {\n\n        console.log('History read complete back to block', RCStartBlock(contract));\n\n        IS_INITIAL_LOAD_DONE = true;\n        window.setTimeout( reflectDisplayEntryChanges, 10000 );\n        $('body').addClass('initial-loading-done');\n\n        scheduleFallbackTimer();\n        runPollingLoop(RCInstance(contract));\n\n        //$('body').addClass('is-page-loaded');\n\n        return;\n    }\n\n    //console.log('fetchAndDisplayQuestionsFromLogs', start_block, end_block, fetch_i);\n\n    const question_posted = RCInstance(contract).filters.LogNewQuestion();\n    const result = await RCInstance(contract).queryFilter(question_posted, start_block, end_block);\n        /* \n        if (error === null && typeof result !== 'undefined') {\n        */\n    for (let i = 0; i < result.length; i++) {\n        if (result[i].invalid_data) {\n            continue;\n        }\n        handlePotentialUserAction(result[i], false);\n        handleQuestionLog(result[i]);\n    }\n        /*\n        } else {\n            console.log(error);\n        }\n        */\n\n    if (fetch_i % 100 == 0) {\n        console.log('fetch range (output will skip the next 99 fetches)', contract, start_block, end_block, fetch_i);\n    }\n    fetchAndDisplayQuestionsFromLogs(contract, start_block - 1, fetch_i + 1);\n}\n\nfunction runPollingLoop(contract_instance) {\n\n    console.log('skipping runPollingLoop, block ', LAST_POLLED_BLOCK);\nreturn;\n    console.log('runPollingLoop, block ', LAST_POLLED_BLOCK);\n    //console.log('filters', contract_instance.filters);\n\n    const filter_all = {\n        address: contract_instance.address,\n        fromBlock: LAST_POLLED_BLOCK - 10,\n        toBlock: \"latest\"\n    }\n\n\n    /*\n    console.log('in runPollingLoop from ', LAST_POLLED_BLOCK);\n    var evts = contract_instance.allEvents({}, {\n        fromBlock: LAST_POLLED_BLOCK - 20, // account for lag\n        toBlock: 'latest'\n    })\n    */\n\n    // And query:\n    provider.getLogs(filter_all).then((logs) => {\n        console.log('filter_all got evts', logs);\n        LAST_POLLED_BLOCK = CURRENT_BLOCK_NUMBER;\n        for (let i = 0; i < logs.length; i++) {\n            handleEvent(null, logs[i]);\n        }\n        window.setTimeout(runPollingLoop, 30000, contract_instance);\n        console.log(logs);\n    });\n\n    /*\n    evts.get(function(error, result) {\n        console.log('got evts', error, result);\n        LAST_POLLED_BLOCK = CURRENT_BLOCK_NUMBER;\n        if (error === null && typeof result !== 'undefined') {\n            for (var i = 0; i < result.length; i++) {\n                handleEvent(error, result[i]);\n            }\n        } else {\n            console.log(error);\n        }\n        window.setTimeout(runPollingLoop, 30000, contract_instance);\n    });\n    */\n\n}\n\n\n// Sometimes things go wrong getting events\n// To mitigate the damage, run a refresh of the currently-open window etc\n\n\n// ISSUE: This sometimes blows away an unconfirmed answer\n// Options\n //- make sure we preserve the unconfirmed history when refetching\n //- accept that the history has vanished from the fetch, but never erase from the window unless confirmed \nfunction scheduleFallbackTimer() {\n     window.setInterval( function() {\n        //console.log('checking for open windows');\n        $('div.rcbrowser--qa-detail.is-open').each(async function() {\n             const contract_question_id = $(this).attr('data-contract-question-id');\n             const [contract, question_id] = parseContractQuestionID(contract_question_id);\n             console.log('updating window on timer for question', question_id);\n             if (question_id) {\n                const question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n                updateQuestionWindowIfOpen(question);\n                scheduleFinalizationDisplayUpdate(contract, question);\n                updateRankingSections(question, 'finalization_ts', question.finalization_ts)\n             }\n        });\n    }, 20000);\n}\n\nasync function handleUserFilterItem(rcinst, filter, start_block, end_block) {\n\n    const results = await rcinst.queryFilter(filter, start_block, end_block);\n    for (let i = 0; i < results.length; i++) {\n        //console.log('handlePotentialUserAction', i, results[i]);\n        handlePotentialUserAction(results[i], false);\n    }\n\n    /*\n    TODO: Use to have error handling like:\n    bounty_funded.get(function(error, result) {\n        if (error === null && typeof result !== 'undefined') {\n            for (var i = 0; i < result.length; i++) {\n                handlePotentialUserAction(result[i]);\n            }\n        } else {\n            console.log(error);\n        }\n    });\n    */\n\n\n \n}\n\nfunction fetchUserEventsAndHandle(acc, contract, question_id, start_block, end_block) {\n// TODO: If question id, make sure we have the right contract, etc\n    // console.log('fetching user events for contract', contract, acc, start_block, end_block);\n    const rcinst = RCInstance(contract);\n\n    handleUserFilterItem(rcinst, rcinst.filters.LogNewAnswer(null, question_id, null, acc));\n    handleUserFilterItem(rcinst, rcinst.filters.LogAnswerReveal(question_id, acc));\n    handleUserFilterItem(rcinst, rcinst.filters.LogFundAnswerBounty(question_id, null, null, acc));\n    handleUserFilterItem(rcinst, rcinst.filters.LogNotifyOfArbitrationRequest(question_id, acc));\n    if (question_id) {\n        // No user param\n        handleUserFilterItem(rcinst, rcinst.filters.LogFinalize(question_id));\n    }\n\n}\n\nfunction isForCurrentUser(entry) {\n    const actor_arg = 'user';\n    return (entry.args[actor_arg] == ACCOUNT);\n}\n\nfunction parseHash() {\n    // Alternate args should be names and values\n    if (location.hash.substring(0, 3) != '#!/') {\n        return {};\n    }\n    const arg_arr = location.hash.substring(3).split('/');\n    const args = {};\n    for (let i = 0; i < arg_arr.length + 1; i = i + 2) {\n        const n = arg_arr[i];\n        const v = arg_arr[i + 1];\n        if (n && v) {\n            args[n] = v;\n        }\n    }\n    return args;\n}\n\nfunction set_hash_param(args) {\n    let current_args = parseHash();\n    let h = '!';\n    for (const a in args) {\n        if (args.hasOwnProperty(a)) {\n            current_args[a] = args[a];\n        }\n    }\n    for (const ca in current_args) {\n        if (current_args.hasOwnProperty(ca)) {\n            if (current_args[ca] != null) {\n                h = h + '/' + ca + '/' + current_args[ca];\n            }\n        }\n    }\n    document.location.hash = h;\n}\n\nfunction populateArbitratorOptionLabel(op, fee, txt, tos) {\n    if (txt) {\n        op.attr('data-text-main', txt);\n    } else {\n        txt = op.attr('data-text-main');\n    }\n    if (fee.gt(ethers.BigNumber.from(0))) {\n        txt = txt + ' (' + humanReadableWei(fee) + ')';\n    }\n    op.text(txt);\n    op.attr('data-question-fee', fee.toHexString());\n    if (tos) {\n        op.attr('data-tos-url', formatPossibleIPFSLink(tos));\n    }\n}\n\nfunction appendBeforeOption(sel, weight) {\n    let last_el = null;\n    // Go down the select until we find something with a higher weight than ourselves, then slot in before that\n    // There should always be something there because we have the \"other\" option at 1000001\n    sel.find('option').each(function(){\n        const el = $(this);\n        if (parseInt(el.attr('data-weight')) > parseInt(weight)) {\n            last_el = el;\n            return false;\n        }\n    });\n    // Always append before the final option if there were no others\n    return last_el;\n}\n\nfunction populateArbitratorSelect(arb_contract, network_arbs) {\n    console.log('got network_arbs', network_arbs);\n    $(\"select[name='arbitrator']\").each(function() {\n        const as = $(this);\n        const a_template = as.find('.arbitrator-template-item');\n        const a_select = $(this);\n        const other_option = a_template.parent().find('.arbitrator-other-select');\n        a_template.remove();\n\n        // Assign weights governing the order in the select, lowest to be displayed last.\n        // The contract address used for \"no arbitrator\" should be displayed last (and will be set to 1000000)\n        // The \"other\" option will be 1000001, already in the HTML\n        let arb_weights = {};\n        let arb_i = 0;\n        for(const na in network_arbs) {\n            arb_weights[na.toLowerCase()] = arb_i;\n            arb_i++;\n        }\n\n        $.each(network_arbs, function(na_addr, na_title) {\n            if (na_addr.toLowerCase() == RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase()) {\n                const arb_item = a_template.clone().removeClass('arbitrator-template-item').addClass('arbitrator-option');\n                arb_item.attr('data-weight', '1000000');\n                populateArbitratorOptionLabel(arb_item, ethers.BigNumber.from(0), na_title, \"\");\n                arb_item.val(na_addr);\n                other_option.before(arb_item);\n                return true;\n            }\n            const mya = arb_contract.attach(na_addr);\n            mya.functions.realitio().then(function(call_response) {\n                const rc_addr = call_response[0];\n                console.log('arb has rc addr', rc_addr);\n                const is_arb_valid = (rc_addr.toLowerCase() == RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase());\n                ARBITRATOR_VERIFIED_BY_CONTRACT[RC_DEFAULT_ADDRESS.toLowerCase()][na_addr.toLowerCase()] = is_arb_valid;\n                // For faster loading, we give arbitrators in our list the benefit of the doubt when rendering the page list arbitrator warning\n                // For this we'll check our original list for the network, then just check against the failed list\n                // TODO: Once loaded, we should really go back through the page and update anything failed\n                if (!is_arb_valid) {\n                    markArbitratorFailed(RC_DEFAULT_ADDRESS, na_addr);\n                }\n                console.log(ARBITRATOR_VERIFIED_BY_CONTRACT);\n                return is_arb_valid;\n            }).then(function(is_arb_valid) {\n                if (is_arb_valid) {\n                    RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(na_addr).then(async function(fee_call_response) {\n                        const fee = fee_call_response[0];\n                        const metadata = await loadArbitratorMetaData(na_addr);\n                        const tos = ('tos' in metadata) ? metadata['tos'] : null;\n                        const arb_item = a_template.clone().removeClass('arbitrator-template-item').addClass('arbitrator-option');\n                        arb_item.val(na_addr);\n                        if (na_addr.toLowerCase() in arb_weights) {\n                            arb_item.attr('data-weight', arb_weights[na_addr.toLowerCase()]);\n                        }\n                        populateArbitratorOptionLabel(arb_item, fee, na_title, tos);\n                        //if (arb_item.attr('data-weight') == '1') {\n                        //    arb_item.attr('selected', true);\n                        //}\n                        const append_before = appendBeforeOption(a_select, arb_item.attr('data-weight'));\n                        // append before the item with the highest weight greater than this one\n                        append_before.before(arb_item);\n                    });\n                } else {\n                    console.log('Arbitrator does not work for this contract:', na_addr);\n                }\n            }).catch(function(err) {\n                console.log('arbitrator failed with error', err);\n                markArbitratorFailed(RC_DEFAULT_ADDRESS, na_addr);\n            });\n        });\n    });\n}\n\nfunction waitForBlock(result) {\n    return new Promise(function(resolve, reject) {\n        (function attempt(triesLeft, result) {\n            if (CURRENT_BLOCK_NUMBER >= result.blockNumber) {\n                // console.log('at ',CURRENT_BLOCK_NUMBER);\n                return resolve(result);\n            } else if (!triesLeft) {\n                // console.log('out of tries',CURRENT_BLOCK_NUMBER);\n                return reject('gave up waiting for the network to catch up');\n            } else {\n                console.log('node is lagging, waiting for it to catch up', CURRENT_BLOCK_NUMBER, result.blockNumber);\n                setTimeout(attempt.bind(null, triesLeft-1, result), 1000);\n            }\n        })(360, result); // number of retries if first time fails\n    });\n}\n\nasync function validateArbitratorForContract(contract, arb_addr) {\n    if (ARBITRATOR_VERIFIED_BY_CONTRACT[contract.toLowerCase()] && ARBITRATOR_VERIFIED_BY_CONTRACT[contract.toLowerCase()][arb_addr.toLowerCase()]) {\n        return true;\n    }\n    const ar = ARBITRATOR_INSTANCE.attach(arb_addr);\n    const rslt_arr = await ar.functions.realitio();\n    const rslt = rslt_arr[0];\n    return (RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase() == rslt.toLowerCase());\n}\n\nfunction initChain(cid) {\n    console.log('Initializing for chain', cid);\n    CHAIN_ID = cid;\n    const net_cls = '.network-id-' + cid;\n\tconsole.log('jquery', $);\n\tconsole.log('network_stautus', $('.network-status'+net_cls), net_cls);\n\tconsole.log('body.size', $('body').length);\n    if ($('.network-status'+net_cls).length == 0) {\n        return false;\n    }\n    $('.network-status'+net_cls).show();\n    $('.network-status-container').addClass('initialized');\n\n    const current_chain_text = $('.network-status'+net_cls).text();\n    $('.current-chain-text').text(current_chain_text);\n    $('.chain-item.network-id-'+cid).addClass('selected-chain');\n\n    if (typeof ethereum !== 'undefined') {\n        ethereum.on('chainChanged', () => {\n          document.location.reload()\n        })\n    }\n\n    return true;\n}\n\nfunction getAccount(fail_soft) {\n    console.log('in getAccount');\n    return new Promise((resolve, reject)=>{\n        if (ACCOUNT) {\n            resolve(ACCOUNT);\n        }\n\n        if (typeof ethereum === 'undefined') {\n            if (!fail_soft) {\n                $('body').addClass('error-no-metamask-plugin').addClass('error');\n            }\n            reject('Could not find an up-to-date version of metamask, account functionality disabled.');\n        }\n\n        ethereum.enable().then(function() {\n\n            ethereum.on('accountsChanged', function (accounts) {\n                ACCOUNT = null;                     \n                resetAccountUI();\n                getAccount();\n            })\n\n            provider.listAccounts().then(function(acc) {\n                console.log('accounts were', acc);\n                if (acc && acc.length > 0) {\n                    //console.log('accounts', acc);\n                    ACCOUNT = acc[0];\n                    $('.account-balance-link').attr('href', BLOCK_EXPLORER + '/address/' + ACCOUNT);\n                } else {\n                    if (!IS_WEB3_FALLBACK) {\n                        console.log('no accounts');\n                        $('body').addClass('error-no-metamask-accounts').addClass('error');\n                    }\n                }\n\n                accountInit(ACCOUNT);\n                resolve(ACCOUNT);\n            });\n\n        });\n    });\n}\n\nfunction accountInit(account) {\n\n    for(let i=0; i<RC_DISPLAYED_CONTRACTS.length; i++) {\n        const ctr = RC_DISPLAYED_CONTRACTS[i];\n        fetchUserEventsAndHandle(account, ctr, null, RCStartBlock(ctr), 'latest');\n    }\n\n    updateUserBalanceDisplay();\n\n}\n\nfunction initContractSelect(available_configs, selected_config, show_all) {\n    const sel = $('select#contract-selection');\n    let only_have_default = true;\n    for(const ac in available_configs) {\n        const acobj = available_configs[ac];\n        const is_selected = (ac.toLowerCase() == selected_config.address.toLowerCase());\n        if (!is_selected) {\n            only_have_default = false;\n        }\n        let op = $('<option>');\n        op.attr('value', ac).text('reality.eth v'+acobj.version_number);\n        if (!show_all) {\n            if (is_selected) {\n                op.prop('selected', 'selected');\n            }\n        }\n        sel.append(op);\n    }\n\n    sel.attr('data-old-val', sel.val());\n    if (only_have_default) {\n        sel.find('.all-contracts').remove();\n    }\n    sel.removeClass('uninitialized');\n}\n\n// We show the claim button section for each contract\n// It's a bit hokey but having multiple contracts to claim from should be pretty unusual\nfunction setupContractClaimSections(rc_contracts) {\n    for(let i=0; i<rc_contracts.length; i++) {\n        const rcaddr = rc_contracts[i];\n        const tmpl = $('.contract-claim-section-template');\n        const sec = tmpl.clone();\n        sec.attr('data-contract', rcaddr.toLowerCase());\n        sec.removeClass('contract-claim-section-template');\n        tmpl.after(sec);\n    }\n}\n\nfunction initToken(curr) {\n    $('.token-ticker-text').text(TOKEN_TICKER);\n    for(const t in TOKEN_INFO) {\n        const op = $('<option>');\n        op.attr('value', t).text(t);\n        if (t == curr) {\n            if (TOKEN_INFO[t].is_native) {\n                console.log('is_native');\n                IS_TOKEN_NATIVE = true;\n            } else {\n                console.log('not native');\n            }\n            op.prop('selected', 'selected');\n        }\n        $('select#token-selection').append(op);\n    }\n    //$('select#token-selection').val(curr);\n}\n\nfunction displayForeignProxy(datastr) {\n    $('body').addClass('foreign-proxy');\n    const dec = decodeURIComponent(datastr);\n    const qdata = JSON.parse(dec);\n    for (const d in qdata) {\n        if (qdata[d].type && qdata[d].type == 'BigNumber') {\n            qdata[d] = ethers.BigNumber.from(qdata[d].hex); \n        }\n    }\n    FOREIGN_PROXY_DATA = qdata;\n    $('body').attr('data-foreign-proxy-network-id', qdata['network_id']);\n    const netid_label = 'network-id-'+parseInt(qdata['network_id']);\n    const txt = $('.network-status-container .network-status.'+netid_label).first().text();\n    console.log(netid_label, txt);\n    const fpsec = $('div.foreign-proxy-section');\n    const qjson = qdata.question_json;\n    fpsec.find('.foreign-proxy-network-text').text(txt);\n    fpsec.find('.question-title').text(qjson['title']);\n    console.log('ss', $('div.foreign-proxy-section .foreign-proxy-network-text').length);\n    console.log('displayForeignProxy', qdata);\n}\n\nasync function foreignProxyInitChain(cid) {\nconsole.log('in foreignProxyInitChain');\n    if (!$('body').hasClass('foreign-proxy')) {\n        return;\n    }\n    if (parseInt(cid) != $('body').attr('data-foreign-proxy-network-id')) {\n        $('body').addClass('foreign-proxy-network-mismatch');\n        return;\n    }\n    const arb_addr = FOREIGN_PROXY_DATA['foreign_proxy'];\n    const question_id = FOREIGN_PROXY_DATA.question_id;\n    let arbitrator;\n\n    console.log('foreign proxy arbitrator is', arb_addr, 'bond', FOREIGN_PROXY_DATA.bond, 'qid', question_id);\n\n    let dispute_exists = false;\n    let old_version = false;\n\n    // The Kleros mainnet contract for this has some extra features that we want to display like showing the status of the request\n    let arb = new ethers.Contract(arb_addr, PROXIED_ARBITRATOR_ABI_NEW, provider);\n\n    console.log('Checking for an existing dispute');\n    try {\n        console.log('Trying new contract API');\n        const existing_arr = await arb.functions.arbitrationIDToDisputeExists(ethers.BigNumber.from(question_id));\n        // console.log('got ', existing_arr, question_id);\n        dispute_exists = existing_arr[0];\n    } catch (e) {\n        console.log('Error trying new contract API, trying old API');\n        arb = new ethers.Contract(arb_addr, PROXIED_ARBITRATOR_ABI_OLD, provider);\n        old_version = true;\n        const existing_arr = await arb.functions.questionIDToDisputeExists(question_id);\n        dispute_exists = existing_arr[0];\n    }\n\n    // See if it was requested but hasn't been handled yet\n    if (!dispute_exists) {\n        const arb_req_filter = arb.filters.ArbitrationRequested(question_id);\n        const arb_requests = await arb.queryFilter(arb_req_filter);\n        if (arb_requests.length > 0) {\n            for(const arb_req in arb_requests) {\n                const req_addr = arb_requests[arb_req].args._requester;\n                const existing_2 = await arb.functions.arbitrationRequests(ethers.BigNumber.from(question_id), req_addr);\n                if (existing_2.status && existing_2.status > 0 && existing_2.status < 4) { // Created and not failed\n                    dispute_exists = true;\n                    break;\n                }\n            }        \n        }\n    }\n\n    console.log('existing dispute_exists?', dispute_exists);\n    if (dispute_exists) {\n        $('body').addClass('foreign-proxy-transaction-complete').removeClass('foreign-proxy-ready').removeClass('foreign-proxy-transaction-sent');\n        return;\n    } else {\n        try {\n            const fee_arr = await arb.functions.getDisputeFee(question_id);\n            const fee = fee_arr[0];\n            $('.proxy-arbitration-fee').text(humanReadableWei(fee));\n            $('.proxy-request-arbitration-button').attr('data-question-fee', fee.toHexString());\n            $('.proxy-contested-answer').text(rc_question.getAnswerString(FOREIGN_PROXY_DATA.question_json, FOREIGN_PROXY_DATA.best_answer));\n           \n            $('.proxy-request-arbitration-button').click(function() {\n                console.log('fee si', fee.toHexString());\n                // Normally would be, but Kleros didn't like the max_previous method\n                //  arb.requestArbitration(question_id, ethers.BigNumber.from(last_seen_bond_hex, 16), {from:ACCOUNT, value: arbitration_fee})\n                const SignedArbitrator = arb.connect(signer);\n                if (false && old_version) {\n                    console.log('Sending arbitration request using old API');\n                    // console.log('using best answer', FOREIGN_PROXY_DATA.best_answer);\n                    SignedArbitrator.functions.requestArbitration(question_id, FOREIGN_PROXY_DATA.best_answer, {from:ACCOUNT, value: fee}).then(function(result_tx) {\n                        $('body').addClass('foreign-proxy-transaction-sent').removeClass('foreign-proxy-ready');\n                    });\n                } else {\n                    console.log('Sending arbitration request using new API');\n                    SignedArbitrator.functions.requestArbitration(question_id, FOREIGN_PROXY_DATA.bond, {from:ACCOUNT, value: fee}).then(function(result_tx) {\n                        $('body').addClass('foreign-proxy-transaction-sent').removeClass('foreign-proxy-ready');\n                    });\n                }\n            });\n\n            $('body').addClass('foreign-proxy-ready');\n        } catch (err) {\n            console.log('Arbitrator failed with error', err);\n            markArbitratorFailed(RC_DEFAULT_ADDRESS, arb_addr);\n        }\n    }\n}\n\nfunction displayWrongChain(specified, detected) {\n    console.log('displayWrongChain', specified, detected);\n    let specified_network_txt = $('.network-status.network-id-'+specified).text();\n    let detected_network_txt = $('.network-status.network-id-'+detected).text();\n    if (specified_network_txt == '') {\n        specified_network_txt = '[unknown network]';\n    }\n    if (detected_network_txt == '') {\n        detected_network_txt = 'another network';\n    }\n    console.log(specified_network_txt, detected_network_txt);\n\n    const wallet_info = rc_contracts.walletAddParameters(specified);\n    if (wallet_info) {\n        const lnk = $('<a>');\n        lnk.text($('.add-network-button').text());\n        lnk.bind('click', function(evt) {\n            console.log('add net');\n            evt.stopPropagation();\n            console.log('getting', specified);\n            ethereum.request({\n                method: 'wallet_addEthereumChain',\n                params: [wallet_info]\n            }).then((result) => {\n                console.log('result was', result);\n                location.reload();\t\n            }).catch((error) => {\n                console.log('error', error)\n            });\n            return false;\n        });\n        $('.add-network-button').empty().append(lnk);\n    }\n\n    $('.network-specified-text').text(specified_network_txt);\n    $('.network-detected-text').text(detected_network_txt);\n    $('body').addClass('error-not-specified-network').addClass('error');\n\n    return;\n}\n\nwindow.addEventListener('load', async function() {\n\n    let cid;\n\n    const args = parseHash();\n    if (args['token'] && args['token'] != 'ETH') {\n        TOKEN_TICKER = args['token'];\n    }\n    \n    // Get a provider from metamask etc if possible, we'll detect the network ID from it\n    // If there isn't one, use the specified network with the hosted RPC node\n    if (window.ethereum) {\n        provider = new ethers.providers.Web3Provider(window.ethereum)\n    } else  {\n        IS_WEB3_FALLBACK = true;\n\n        // Default to mainnet\n        let want_cid = 1;\n        if (args['network'] && parseInt(args['network'])) {\n            want_cid = parseInt(args['network']);\n        }\n\n        CHAIN_INFO = rc_contracts.chainData(want_cid);\n        // TODO: Handle a supplied unsupported network\n        HOSTED_RPC_NODE = CHAIN_INFO['hostedRPC'];\n        cid = want_cid;\n\n        provider = new ethers.providers.JsonRpcProvider(HOSTED_RPC_NODE);\n        console.log('no window.ethereum, using node ', HOSTED_RPC_NODE);\n    }\n\n    signer = provider.getSigner()\n\n    if (args['foreign-proxy']) {\n        displayForeignProxy(args['foreign-proxy']);\n    }\n\n    provider.on(\"block\", (blockNumber) => {\n        if (blockNumber > CURRENT_BLOCK_NUMBER) {\n            CURRENT_BLOCK_NUMBER = blockNumber;\n            //console.log('updated CURRENT_BLOCK_NUMBER to ', CURRENT_BLOCK_NUMBER);\n        }\n    })\n\n    provider.on(\"network\", async function(network, old_network_id) {\n\n        cid = network.chainId;\n\n        if (old_network_id) {\n            window.location.reload();\n        }\n        console.log('cid is ', cid);\n\n        if (args['category']) {\n            $(\"#filter-list\").find(\"[data-category='\" + args['category'] + \"']\").addClass(\"selected\")\n        } else {\n            $(\"#filter-list\").find(\"[data-category='all']\").addClass(\"selected\")\n        }\n\n        if (args['network'] && (parseInt(args['network']) != parseInt(cid))) {\n            if (!rc_contracts.isChainSupported(parseInt(args['network']))) {\n                $('body').addClass('error-invalid-network').addClass('error');\n                return;\n            } else {\n                displayWrongChain(parseInt(args['network']), parseInt(cid));\n            }\n            return;\n        }\n\n        if (!rc_contracts.isChainSupported(cid)) {\n            $('body').addClass('error-invalid-network').addClass('error');\n            return;\n        }\n\n        if (!TOKEN_TICKER) {\n            TOKEN_TICKER = rc_contracts.defaultTokenForChain(cid);\n            console.log('picked token', TOKEN_TICKER);\n        }\n\n        const all_rc_configs = rc_contracts.realityETHConfigs(cid, TOKEN_TICKER);\n        let rc_config = null;\n        let show_all = true;\n        if (args['contract']) {\n            for(const cfg_addr in all_rc_configs) {\n                // If we got a valid version number for the contract, switch that out for the address and pretend we got that\n                if (args['contract'] == 'v' + all_rc_configs[cfg_addr].version_number) {\n                    args['contract'] = cfg_addr;\n                }\n                if (cfg_addr.toLowerCase() == args['contract'].toLowerCase()) {\n                    rc_config = all_rc_configs[cfg_addr];\n                    show_all = false;\n                    break;\n                }\n            }\n        }\n\n        for(const cfg_addr in all_rc_configs) {\n            const cfg = all_rc_configs[cfg_addr]; \n            START_BLOCKS[cfg.address.toLowerCase()] = cfg.block;\n            RC_INSTANCE_VERSIONS[cfg.address.toLowerCase()] = cfg.version_number;\n        }\n\n        // If not found, load the default\n        if (!rc_config) {\n            rc_config = rc_contracts.realityETHConfig(cid, TOKEN_TICKER);\n        }\n        \n        if (!rc_config) {\n            $('body').addClass('error-invalid-network-for-token').addClass('error');\n            return;\n        }\n\n        initContractSelect(all_rc_configs, rc_config, show_all);\n\n        TOKEN_INFO = rc_contracts.chainTokenList(cid);\nconsole.log('TOKEN_INFO', TOKEN_INFO);\n        console.log('got token info', TOKEN_INFO);\n\n        const rc_json = rc_contracts.realityETHInstance(rc_config);\n        const arb_json = rc_contracts.arbitratorInstance();\n\n        if (!rc_json) {\n            console.log('Token not recognized', TOKEN_TICKER);\n            return;\n        }\n\n        initToken(TOKEN_TICKER);\n        if (!IS_TOKEN_NATIVE) {\n            TOKEN_JSON = rc_contracts.erc20Instance(rc_config);\n        }\n\n        CHAIN_INFO = rc_contracts.chainData(cid);\n        HOSTED_RPC_NODE = CHAIN_INFO['hostedRPC'];\n        BLOCK_EXPLORER = CHAIN_INFO['blockExplorerUrls'][0];\n\n        if (!initChain(cid)) {\n            $('body').addClass('error-invalid-network').addClass('error');\n            return;\n        } \n\n        if (!$('body').hasClass('foreign-proxy')) {\n            $('select#token-selection').removeClass('uninitialized');\n        }\n\n        USE_COMMIT_REVEAL = (parseInt(args['commit']) == 1);\n\n        if (args['category']) {\n            CATEGORY = args['category'];\n            $('body').addClass('category-' + category);\n            const cat_txt = $(\"#filter-list\").find(\"[data-category='\" + category + \"']\").text();\n            $('#filterby').text(cat_txt);\n        }\n\n        RC_DEFAULT_ADDRESS = rc_json.address;\n        for(const cfg_addr in all_rc_configs) {\n            const cfg = all_rc_configs[cfg_addr];\n            const inst = rc_contracts.realityETHInstance(cfg);\n            RC_INSTANCES[cfg_addr.toLowerCase()] = new ethers.Contract(cfg_addr, inst.abi, provider);\n            if (show_all || cfg_addr == RC_DEFAULT_ADDRESS) {\n                RC_DISPLAYED_CONTRACTS.push(cfg_addr);\n            }\n\n            // Everyone gets the initial config\n            CONTRACT_TEMPLATE_CONTENT[cfg_addr.toLowerCase()] = TEMPLATE_CONFIG.content;\n\n            ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()][cfg_addr.toLowerCase()] = 'No arbitration (highest bond wins)';\n            ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()][cfg_addr.toLowerCase()] = true;\n            ARBITRATOR_FAILED_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            if ('arbitrators' in cfg) {\n                for(const arb_addr in cfg['arbitrators']) {\n                    ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()][arb_addr.toLowerCase()] = cfg['arbitrators'][arb_addr];\n                    ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()][arb_addr.toLowerCase()] = true;\n                }\n            } else {\n                console.log('no arbs in config', cfg);\n            }\n\n        }\n        //console.log('arb init', ARBITRATOR_LIST_BY_CONTRACT, ARBITRATOR_FAILED_BY_CONTRACT, ARBITRATOR_VERIFIED_BY_CONTRACT);\n        \n        // Set up dummy contract objects, we'll make copies of them with the correct addresses when we need them\n        ARBITRATOR_INSTANCE = new ethers.Contract(rc_json.address, arb_json.abi, provider); \n        populateArbitratorSelect(ARBITRATOR_INSTANCE, ARBITRATOR_LIST_BY_CONTRACT[RC_DEFAULT_ADDRESS.toLowerCase()]);\n        foreignProxyInitChain(cid);\n\n        const block = await provider.getBlock('latest');\n\n        if (block.number > CURRENT_BLOCK_NUMBER) {\n            CURRENT_BLOCK_NUMBER = block.number;\n        }\n\n        if (rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[RC_DEFAULT_ADDRESS.toLowerCase()], 'min-bond')) {\n            $('.rcbrowser--postaquestion').addClass('version-supports-min-bond');\n        } \n\n        const limit_to_contract = show_all ? null : RC_DEFAULT_ADDRESS;\n\n        pageInit(limit_to_contract);\n\n        if (args['question']) {\n            try {\n                const [ctr, qid] = parseContractQuestionID(args['question'], RC_DEFAULT_ADDRESS);\n                const question = await ensureQuestionDetailFetched(ctr, qid);\n                openQuestionWindow(contractQuestionID(question));\n            } catch (err) {\n                console.log('could not open question in URL', err);\n            }\n        }\n\n        setupContractClaimSections(RC_DISPLAYED_CONTRACTS);\n\n        // NB If this fails we'll try again when we need to do something using the account\n        getAccount(true);\n\n        loadPendingTransactions(cid);\n        \n        for(let i=0; i<RC_DISPLAYED_CONTRACTS.length; i++) {\n            const rcaddr = RC_DISPLAYED_CONTRACTS[i];\n            // Listen for all events\n            RCInstance(rcaddr).on(\"*\", function(eventObject) {\n                console.log('got all events for contract ', rcaddr, eventObject);\n                handleEvent(null, eventObject);\n            });\n        }\n\n        //runPollingLoop(RealityCheck);\n    });\n});\n\n$('.continue-read-only-message').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').removeClass('error-no-metamask-plugin').removeClass('error');\n});\n\n$('.continue-message').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const clear_cls = $(this).attr('data-clear-error');\n    if (clear_cls) {\n        $('body').removeClass('error-' + clear_cls);\n    }\n    $('body').removeClass('error');\n});\n\n$('#token-selection').change(function(e) { \n    e.preventDefault();\n    e.stopPropagation();\n    const tkn = $(this).val();\n    if (tkn == TOKEN_TICKER) {\n        // already selected\n        return;\n    }\n    window.location.hash = '#!/token/'+tkn;\n    location.reload();\n});\n\n$('#contract-selection').change(function(e) { \n    e.preventDefault();\n    e.stopPropagation();\n    const ctr = $(this).val();\n    if ($(this).attr('data-old-val') == ctr) {\n        // already selected\n        return;\n    }\n    if (ctr == '') {\n        set_hash_param({'contract': null});\n    } else {\n        set_hash_param({'contract': ctr});\n    }\n    location.reload();\n});\n\n// When on the legacy site, show the moved warning, use the full link url\nif (window.location.href.indexOf('realitio') != -1) {\n    $('.moved-to-reality-eth').show();\n    $('.logo .logo-link').attr('href', $('.logo .logo-link').attr('data-full-url'));\n} else if (window.location.href.indexOf('ipfs.io') != -1) {\n    $('.logo .logo-link').attr('href', $('.logo .logo-link').attr('data-full-url'));\n}\n\nfunction setCookie(cname, cvalue, exdays) {\n  const d = new Date();\n  d.setTime(d.getTime() + (exdays*24*60*60*1000));\n  let expires = \"expires=\"+ d.toUTCString();\n  document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n}\n\n$('.graph-node-switch-link').click(function() {\n    if ($('body').hasClass('via-node')) {\n        setCookie('graph', 1, 365*10);\n    } else {\n        setCookie('graph', 0, 365*10);\n    }\n    location.reload();\n});\n\n};\n","'use strict';\n\nimport interact from 'interactjs';\nimport Ps from 'perfect-scrollbar';\n\n\n\nexport default function() {\n\nconst ethers = require(\"ethers\");\nconst timeago = require('timeago.js');\nconst timeAgo = new timeago();\nconst jazzicon = require('jazzicon');\nconst axios = require('axios');\nconst randomBytes = require('randombytes');\n\nrequire('jquery-ui/ui/widgets/datepicker.js');\nrequire('jquery-expander');\n\n$('body').addClass('via-graph');\n\nlet provider;\nlet signer;\n\nconst rc_question = require('@reality.eth/reality-eth-lib/formatters/question.js');\nconst rc_template = require('@reality.eth/reality-eth-lib/formatters/template.js');\nconst rc_contracts = require('@reality.eth/contracts');\n\n// Never try to refetch data if we have some less than this many milliseconds old\nlet DEFAULT_MAX_CACHE_MS = 1000; \n\n// When we get stuff that was recently fetched, fetch from the last fetch we did, but make it a bit earlier in case there was a reorg\nconst REORG_ALLOWANCE_SECS = 180 \n\n// When the user is doing something we poll fast for changes\n// If they just leave the window open we slow down\nconst POLLING_INTERVAL_ACTIVE = 15;\nconst POLLING_INTERVAL_IDLE = 300;\n\n// How many seconds things should be idle before we switch to the idle speed\nconst SECS_TO_UX_IDLE_STATE = 180;\n\nlet POLLING_INTERVAL = POLLING_INTERVAL_ACTIVE;\n\nlet LAST_ACTION_TS = 0;\n\nlet TOKEN_INFO = {};\nlet CHAIN_INFO = {};\n\nlet TOKEN_JSON = {};\n\nlet IS_TOKEN_NATIVE = false;\nlet IS_WEB3_FALLBACK = false;\n\nlet ARBITRATOR_LIST_BY_CONTRACT = {};\nlet ARBITRATOR_VERIFIED_BY_CONTRACT = {};\nlet ARBITRATOR_FAILED_BY_CONTRACT = {};\nlet FOREIGN_PROXY_DATA = {};\nlet ARBITRATOR_METADATA = require('./arbitrator_metadata_legacy.json'); // Old contracts don't have this so hard-code it\n\nlet PENDING_USER_TXES_BY_CQID = {};\n\nconst TEMPLATE_CONFIG = rc_contracts.templateConfig();\nconst QUESTION_TYPE_TEMPLATES = TEMPLATE_CONFIG.base_ids;\n\n// Special ABIs for Kleros\nconst PROXIED_ARBITRATOR_ABI_OLD = require('./abi/kleros/ProxiedArbitratorOld.json');\nconst PROXIED_ARBITRATOR_ABI_NEW = require('./abi/kleros/ProxiedArbitratorNew.json');\n\n\nlet SUBMITTED_QUESTION_ID_BY_TIMESTAMP = {};\nlet USER_CLAIMABLE_BY_CONTRACT = {};\n\nlet CATEGORY = null;\nlet CONTRACT_TEMPLATE_CONTENT = {}; TEMPLATE_CONFIG.content;\n\nlet LAST_POLLED_BLOCK = null;\nlet LAST_POLLED_USER_TS = null;\nlet IS_INITIAL_LOAD_DONE = false;\n\nlet USE_COMMIT_REVEAL = false;\n\nlet HOSTED_RPC_NODE = null;\n\nlet START_BLOCKS = {};\n\nlet CHAIN_ID = null;\nlet BLOCK_EXPLORER = null;\n\nconst FETCH_NUMBERS = [100, 2500, 5000];\n\nlet LAST_DISPLAYED_BLOCK_NUMBER = 0;\nlet CURRENT_BLOCK_NUMBER = 1;\n\nlet TOKEN_TICKER = null;\n\n// Question, as returned by questions()\nconst Qi_content_hash = 0;\nconst Qi_arbitrator = 1;\nconst Qi_opening_ts = 2;\nconst Qi_timeout = 3;\nconst Qi_finalization_ts = 4;\nconst Qi_is_pending_arbitration = 5;\nconst Qi_bounty = 6;\nconst Qi_best_answer = 7;\nconst Qi_history_hash = 8;\nconst Qi_bond = 9;\nconst Qi_min_bond = 10; // v3 or above only\n\nlet BLOCK_TIMESTAMP_CACHE = {};\n\n// Array of all questions that the user is interested in\nlet Q_MIN_ACTIVITY_BLOCKS = {};\n\n// These will be populated in onload, once the provider is loaded\nlet RC_INSTANCES = {};\nlet RC_INSTANCE_VERSIONS = {};\nlet RC_DEFAULT_ADDRESS = null;\nlet RC_DISPLAYED_CONTRACTS = [];\n\nlet ARBITRATOR_INSTANCE = null;\n\nlet ACCOUNT = null;\n\nconst MAX_STORE = 10;\n\nlet DISPLAY_ENTRIES = {\n    'questions-active': {\n        'ids': [],\n        'vals': [],\n        'max_show': 6,\n        'max_store': MAX_STORE\n    },\n    'questions-resolved': {\n        'ids': [],\n        'vals': [],\n        'max_show': 6,\n        'max_store': MAX_STORE\n    },\n    'questions-closing-soon': {\n        'ids': [],\n        'vals': [],\n        'max_show': 6,\n        'max_store': MAX_STORE\n    },\n    'questions-upcoming': {\n        'ids': [],\n        'vals': [],\n        'max_show': 6,\n        'max_store': MAX_STORE\n    }\n}\n\n// data for question detail window\nlet QUESTION_DETAIL_CACHE = {};\nlet QUESTION_EVENT_TIMES = {}; // Hold timer IDs for things we display that need to be moved when finalized\n\nlet WINDOW_POSITION = [];\n\nfunction rand(min, max) {\n    return min + Math.floor(Math.random() * (max - min + 1));\n}\n\nfunction nonceFromSeed(paramstr) {\n\n    let seed = window.localStorage.getItem('commitment-seed');\n    if (seed == null) {\n        seed = randomBytes(32).toString('hex');\n        console.log('made seed', seed);\n        window.localStorage.setItem('commitment-seed', seed);\n    }\n\n    return uiHash(paramstr + seed);\n\n}\n\nasync function loadPendingTransactions(chain_id) {\n\n    let txliststr = window.localStorage.getItem('tx-'+chain_id);\n    //txliststr = '0x815a2c9da2280065fe317a913e0a6141c5a5e3342ec92e1e1c7115f3dd4d1ed6';\n    if (!txliststr) {\n        return;\n    }\n    // We don't use a delimiter as the 0x will delimit them\n    const txlist = txliststr.split('0x');\n    for (let i=0; i<txlist.length; i++) {\n        const txid = '0x' + txlist[i];\n        if (txid == '0x') {\n            continue;\n        }\n        // console.log('loadPendingTransactions txid', txid);\n        const tx = await provider.getTransaction(txid);\n        fillPendingUserTX(tx);\n    }\n    // console.log('PENDING_USER_TXES_BY_CQID', PENDING_USER_TXES_BY_CQID);\n    \n}\n\nfunction fillPendingUserTX(tx) {\n    \n    const txid = tx.hash;\n    const inst = RCInstance(tx.to);\n    if (!inst) {\n\tconsole.log('contract ',tx.to,' for txid not known', txid);\n\treturn;\n    }\n    const inf = inst.interface;\n    // console.log('inst is ', inst);\n    const dec = inf.parseTransaction(tx);\n    if (!dec) { \n\tconsole.log('could not parse tx', txid);\n    }\n    if (dec.functionFragment.name != 'submitAnswer' && dec.functionFragment.name != 'submitAnswerERC20') {\n\tconsole.log('txid',txid,'not submitAnswer, ignoring');\n    }\n    const cqid = cqToID(tx.to, dec.args.question_id);\n\n    // ERC20 will have the bond in the args, native will have it in the value\n    // TODO: native may be wrong if the arbitrator has a question fee\n    const bond = ('bond' in dec) ? dec.bond : dec.value;\n\n    const fake_history = {\n        'answer': dec.args.answer,\n        'question_id': dec.args.question_id,\n        'history_hash': null, // TODO Do we need this?\n        'user': ACCOUNT,\n        'bond': bond,\n        'ts': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)), // todo\n        'is_commitment': false, // TODO\n\t'event': 'LogNewAnswer',\n\t'blockNumber': tx.blockNumber,\n\t'txid': txid\n    };\n\n    if (!PENDING_USER_TXES_BY_CQID[cqid]) {\n\tPENDING_USER_TXES_BY_CQID[cqid] = {};\n    }\n    PENDING_USER_TXES_BY_CQID[cqid][bond.toHexString()] = fake_history;\n\n    // If we already had the question displayed when we discovered the pending transaction, update the window\n    if (QUESTION_DETAIL_CACHE[cqid]) {\n        QUESTION_DETAIL_CACHE[cqid] = mergeConfirmedTXes(QUESTION_DETAIL_CACHE[cqid]);\n        updateQuestionWindowIfOpen(QUESTION_DETAIL_CACHE[cqid]);\n    }\n\n    return true;\n\n}\n\nfunction mergeConfirmedTXes(question) {\n\n    // Make a lookup table of the history by bond\n    let history_bond_to_idx = {};\n    let history_unconfirmed_bond_to_idx = {};\n    if (question['history'] && question['history'].length > 0) {\n        for(let hi=0; hi<question['history'].length; hi++) {\n            if (!question['history'][hi]) {\n                console.log('no args in history item',question['history'][hi]);\n                continue;\n            }\n            history_bond_to_idx[question['history'][hi].bond.toHexString()] = hi;\n        }\n    }\n    if (question['history_unconfirmed'] && question['history_unconfirmed'].length > 0) {\n        for(let ui=0; ui<question['history_unconfirmed'].length; ui++) {\n            if (!question['history_unconfirmed'][ui]) {\n                console.log('no args in history_unconfirmed item',question['history_unconfirmed'][ui]);\n                continue;\n            }\n            history_unconfirmed_bond_to_idx[question['history_unconfirmed'][ui].bond.toHexString()] = ui;\n        }\n    }\n\n\n// If we have anything in the user pending pool that isn't in the unconfirmed list, add it to the unconfirmed pool\n    let pending_entries_by_bond = PENDING_USER_TXES_BY_CQID[contractQuestionID(question)];\n    if (pending_entries_by_bond) {\n        // console.log('got relevant pending_entries_by_bond', contractQuestionID(question), pending_entries_by_bond);\n        for (let b in pending_entries_by_bond) {\n            // If there's a confirmed history entry at that level, boot it\n            if (b in history_bond_to_idx) {\n                // If we have a reasonably deep number of confirmations, boot our pending TX which will clearly never be mined\n                // TODO: We might want to keep this somewhere and display that it failed instead of just pretending your failed tx never happened\n                const idx = history_bond_to_idx[b];\n                const purge_block_count = 20;\n                if (true || (question['history'][idx].blockNumber + purge_block_count) < CURRENT_BLOCK_NUMBER) {\n                    // console.log('purging confirmed bond at level (ignoring purge block count for now)', b);\n                    clearPendingTXID(pending_entries_by_bond[b].txid, CHAIN_ID);\n                } else {\n                    // console.log('pending tx confirmed but not purging yet in case of reorg, will purge at ', question['history'][idx].blockNumber + purge_block_count,', only at ',CURRENT_BLOCK_NUMBER, question['history'][idx]);\n                }\n                continue;\n            }\n            if (b in history_unconfirmed_bond_to_idx) {\n                // console.log('unconfirmed list already has pending tx', b);\n                continue;\n            }\n            question['history_unconfirmed'].push(pending_entries_by_bond[b]);\n            console.log('added entry for bond', b);\n        }\n    }\n    return question;\n}\n\nfunction clearClobberedUnconfirmed(question) {\n    const unconf = question['history_unconfirmed'];\n    const conf = question['history'];\n    if (!unconf || unconf.length == 0) {\n        return question;\n    }\n    const highest_bond = question.bond;\n\n    // console.log('highest_bond is ', highest_bond);\n\n    // unconf = unconf.sort((a, b) => (a.bond.gt(b.bond)) ? 1 : -1);\n\n    let unconf2 = [];\n    for(const bidx in unconf) {\n        const b = unconf[bidx];\n        if (b.bond.lte(highest_bond)) {\n            break;\n        }\n        unconf2.push(b);\n    }\n\n    question['history_unconfirmed'] = unconf2;\n    return question;\n}\n\nfunction storePendingTXID(txid, chain_id) {\n    const MAX_PENDING_STORE = 20;\n    const ITEM_LENGTH = 66; // \"0x\" plus 32 hex characters\n    if (txid.length != ITEM_LENGTH) {\n        throw new Error(\"Unexpected txid length: \"+txid);\n    }\n    let current = window.localStorage.getItem('tx-'+chain_id);\n    if (current) {\n        if (current.includes(txid)) {\n            return true;\n        }\n        // To avoid running over storage, if we have more than MAX_PENDING_STORE, bin the earliest tx\n        if (current.length > (MAX_PENDING_STORE*ITEM_LENGTH)) {\n            current = current.substr(ITEM_LENGTH);\n        }\n    } else {\n        current = '';\n    }\n    window.localStorage.setItem('tx-'+chain_id, current + txid);\n    return true;\n}\n\nfunction clearPendingTXID(txid, chain_id) {\n    console.log('clearPendingTXID', txid, chain_id);\n    const ITEM_LENGTH = 66; // \"0x\" plus 32 hex characters\n    if (txid.length != ITEM_LENGTH) {\n        throw new Error(\"Unexpected txid length: \"+txid);\n    }\n    let current = window.localStorage.getItem('tx-'+chain_id);\n    window.localStorage.setItem('tx-'+chain_id, current.replace(txid, ''));\n}\n\n\nlet ZINDEX = 10;\n\nconst MONTH_LIST = [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'June',\n    'July',\n    'Aug',\n    'Sept',\n    'Oct',\n    'Nov',\n    'Dec'\n];\n\nfunction formatPossibleIPFSLink(u) {\n    if (!u) {\n        return '';\n    }\n    if (u.toLowerCase().substr(0, 7) == 'ipfs://') {\n        u = u.replace('ipfs://', 'https://ipfs.io/ipfs/');\n    } else {\n    }\n    return u;\n}\n\nfunction markArbitratorFailed(contract, addr, contract_question_id) {\n    ARBITRATOR_FAILED_BY_CONTRACT[contract.toLowerCase()][addr.toLowerCase()] = true;\n    if (contract_question_id) {\n        $('[data-contract-question-id=\"' + contract_question_id + '\"]').addClass('failed-arbitrator');\n    }\n}\n\nfunction setRcBrowserPosition(rcbrowser) {\n    // when position has been stored.\n    if (rcbrowser.hasClass('rcbrowser--qa-detail')) {\n        const contract_question_id = rcbrowser.attr('data-contract-question-id');\n        const [contract, question_id] = parseContractQuestionID(contract_question_id);\n        if (typeof WINDOW_POSITION[contract_question_id] !== 'undefined') {\n            const left = parseInt(WINDOW_POSITION[contract_question_id]['x']) + 'px';\n            const top = parseInt(WINDOW_POSITION[contract_question_id]['y']) + 'px';\n            rcbrowser.css('left', left);\n            rcbrowser.css('top', top);\n            return;\n        }\n    }\n\n    // when window is newly opend.\n    const winWidth = document.documentElement.clientWidth;\n    const winHeight = document.documentElement.clientHeight;\n    const paddingLeft = winWidth * 0.1;\n    const paddingTop = winHeight * 0.1;\n\n    let rcb_width = parseInt(rcbrowser.css('width').replace('px', ''));\n    let rcb_height = parseInt(rcbrowser.css('height').replace('px', ''));\n    let itemWidth = Math.min(rcb_width, winWidth * 0.9);\n    let itemHeight = Math.min(rcb_height, winHeight * 0.9);\n    let leftMax = winWidth - itemWidth - paddingLeft;\n    let topMax = winHeight - itemHeight - paddingTop;\n\n    if ((rcbrowser.attr('id') == 'post-a-question-window') || rcbrowser.hasClass('rcbrowser--qa-detail')) {\n        const left = (winWidth / 2) - (itemWidth / 2) + 'px';\n        const top = itemHeight / 10 + 'px';\n        rcbrowser.css('left', left);\n        rcbrowser.css('top', top);\n    }\n\n}\n\nfunction initScrollBars() {\n    const rcbrowsers = document.querySelectorAll('.rcbrowser-inner');\n\n    for (let i = 0, len = rcbrowsers.length; i < len; i += 1) {\n        // Initialize anything that isn't part of a template item.\n        // If it's a template item it should be initialized after it's cloned.\n        if (!$(rcbrowsers[i]).closest('.template-item').length) {\n            Ps.initialize(rcbrowsers[i]);\n        }\n    }\n\n    function changeSize() {\n        // TODO: Does this need to be added to items that are initialized later?\n        for (let i = 0, len = rcbrowsers.length; i < len; i += 1) {\n            Ps.update(rcbrowsers[i]);\n        }\n    }\n    window.addEventListener('resize', changeSize);\n}\n\ninitScrollBars();\n\n\n// draggable\ninteract('.rcbrowser-header').draggable({\n    // enable inertial throwing\n    inertia: false,\n    // keep the element within the area of it's parent\n    restrict: {\n        restriction: {\n            left: 0,\n            right: document.documentElement.clientWidth,\n            top: 0,\n            bottom: document.documentElement.clientHeight\n        },\n        endOnly: true,\n        elementRect: {\n            top: 0,\n            left: 0,\n            bottom: 1,\n            right: 1\n        }\n    },\n    // enable autoScroll\n    autoScroll: false,\n\n    // call this function on every dragmove event\n    onmove: dragMoveListener\n});\n\nfunction dragMoveListener(event) {\n    const target = event.target.parentNode.parentNode;\n    // keep the dragged position in the data-x/data-y attributes\n    const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;\n    const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\n\n    // translate the element\n    let top = parseInt(target.style.top);\n    if (top + y < 1) {\n        target.style.webkitTransform =\n            target.style.transform =\n            'translate(' + x + 'px, -' + top + 'px)';\n    } else {\n        target.style.webkitTransform =\n            target.style.transform =\n            'translate(' + x + 'px, ' + y + 'px)';\n    }\n\n    // update the posiion attributes\n    target.setAttribute('data-x', x);\n    target.setAttribute('data-y', y);\n}\n\nfunction RCStartBlock(ctr) {\n    return START_BLOCKS[ctr.toLowerCase()]; \n}\n\nfunction RCInstance(ctr, signed) {\n    if (!ctr) {\n        throw new Error(\"contract address not supplied\", ctr);\n    }\n    let ret = RC_INSTANCES[ctr.toLowerCase()];;\n    if (!ret) {\n        throw new Error(\"contract not found:\" + ctr + \":\"+ signed);\n    }\n    if (signed) {\n        return ret.connect(signer);\n    } \n    return ret;\n}\n\nfunction populateTOSSection(container, tos) {\n\n    const tos_section = container.find('div.arbitrator-tos');\n    if (tos) {\n        tos_section.find('.arbitrator-tos-link').attr('href', formatPossibleIPFSLink(tos));\n        container.addClass('has-arbitrator-tos');\n    } else {\n        tos_section.find('.arbitrator-tos-link').attr('href', '');\n        container.removeClass('has-arbitrator-tos');\n    }\n\n}\n\n$(document).on('change', 'input.arbitrator-other', function() {\n    const arb_text = $(this).val();\n    const sel_cont = $(this).closest('.select-container');\n    if (/^(0x)?[0-9a-f]{1,40}$/i.test(arb_text)) {\n        const ar = ARBITRATOR_INSTANCE.attach(arb_text);\n        ar.functions.realitio().then(async function(rcaddr_arr) {\n            const rcaddr = rcaddr_arr[0];\n            if (rcaddr != RCInstance(RC_DEFAULT_ADDRESS).address) {\n                console.log('reality check mismatch', rcaddr, RCInstance(RC_DEFAULT_ADDRESS).address);\n                return;\n            }\n\n            const metadata = await loadArbitratorMetaData(arb_text);\n            const tos = ('tos' in metadata) ? metadata['tos'] : null;\n\n            populateTOSSection(sel_cont, tos);\n\n            RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(arb_text).then(function(fee_arr) {\n                const fee = fee_arr[0];\n                populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), fee, null, tos);\n            }).catch(function() {\n                populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), ethers.BigNumber.from(0), null, tos);\n            });\n\n        }).catch(function(err) {\n            markArbitratorFailed(RC_DEFAULT_ADDRESS, arb_text);\n        });\n\n    } else {\n        populateArbitratorOptionLabel(sel_cont.find('option.arbitrator-other-select'), ethers.BigNumber.from(0));\n    }\n});\n\n$(document).on('change', 'select.arbitrator', function() {\n    console.log('arbitrator: ' + $(this).val());\n    if ($(this).val() == 'other') {\n        $(this).closest('form').find('input.arbitrator-other').show();\n    } else {\n        populateArbitratorOptionLabel($(this).find('option.arbitrator-other-select'), ethers.BigNumber.from(0));\n        $(this).closest('form').find('input.arbitrator-other').hide();\n    }\n    const op = $(this).find('option:selected');\n    const tos_url = op.attr('data-tos-url');\n    // console.log('tos_url', tos_url, 'op', op);\n\n    populateTOSSection($(this).closest('.select-container'), tos_url);\n});\n\n$(document).on('click', '.rcbrowser', function() {\n    ZINDEX += 1;\n    $(this).css('z-index', ZINDEX);\n    $('.ui-datepicker').css('z-index', ZINDEX + 1);\n    $(this).find('.question-setting-warning').find('.balloon').css('z-index', ++ZINDEX);\n    $(this).find('.question-setting-info').find('.balloon').css('z-index', ZINDEX);\n});\n\n// see all notifications\n$(function() {\n    $('.see-all-notifications').click(function() {\n        $(this).closest('#your-question-answer-window').removeClass('display-top-only').addClass('display-all');\n        return false;\n    });\n    $('.hide-lower-notifications').click(function() {\n        $(this).closest('#your-question-answer-window').addClass('display-top-only').removeClass('display-all');\n        return false;\n    });\n});\n\n\n/*-------------------------------------------------------------------------------------*/\n// window for posting a question\n\n$('#your-qa-button,.your-qa-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    getAccount().then(function() {\n        const yourwin = $('#your-question-answer-window');\n        yourwin.css('z-index', ++ZINDEX);\n        yourwin.addClass('is-open');\n        const winheight = (yourwin.height() > $(window).height()) ? $(window).height() : yourwin.height();\n        yourwin.css('height', winheight + 'px');\n        Ps.update(yourwin.find('.rcbrowser-inner').get(0));\n        $('.tooltip').removeClass('is-visible');\n        $('body').removeClass('pushing');\n        markViewedToDate();\n    });\n});\n\n$('#help-center-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#help-center-window').css('z-index', ++ZINDEX).addClass('is-open');\n});\n\nfunction setViewedBlockNumber(network_id, block_number) {\n    window.localStorage.setItem('viewedBlockNumber' + network_id, block_number);\n}\n\nfunction getViewedBlockNumber(network_id) {\n    return window.localStorage.getItem('viewedBlockNumber' + network_id);\n}\n\nfunction markViewedToDate() {\n    const vbn = parseInt(getViewedBlockNumber(CHAIN_ID));\n    if (vbn >= LAST_DISPLAYED_BLOCK_NUMBER) {\n        LAST_DISPLAYED_BLOCK_NUMBER = vbn;\n    } else {\n        setViewedBlockNumber(CHAIN_ID, LAST_DISPLAYED_BLOCK_NUMBER);\n    }\n}\n\nfunction humanToDecimalizedBigNumber(num, force_eth) {\n    const decimals = force_eth ? 18 : TOKEN_INFO[TOKEN_TICKER]['decimals'];\n    return ethers.utils.parseUnits(num, decimals);\n}\n\nfunction decimalizedBigNumberToHuman(num, force_eth) {\n    const decimals = force_eth ? 18 : TOKEN_INFO[TOKEN_TICKER]['decimals'];\n    return ethers.utils.formatUnits(num, decimals).replace(/\\.0+$/,'');\n}\n\nfunction humanReadableWei(amt) {\n    return decimalizedBigNumberToHuman(amt, true) + ' ETH';\n}\n\n$('#help-center-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#help-center-window').css('z-index', 0).removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n});\n\n$('#chain-list-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#chain-list-window').css('z-index', ++ZINDEX).addClass('is-open');\n});\n\n$('#chain-list-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#chain-list-window').css('z-index', 0).removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n});\n\n$('.chain-item a').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cid = $(this).closest('.chain-item').attr('data-chain-id')\n    window.location.hash = '!/network/'+cid;\n    window.location.reload(true);\n})\n\n$('#your-question-answer-window .rcbrowser__close-button').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#your-question-answer-window').css('z-index', 0);\n    $('#your-question-answer-window').removeClass('is-open');\n    document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n    $('body').removeClass('pushing');\n    $('.tooltip').removeClass('is-visible');\n    markViewedToDate();\n});\n\n$('#post-a-question-button,.post-a-question-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let question_window = $('#post-a-question-window-template').clone().attr('id', 'post-a-question-window');\n    question_window.find('.rcbrowser__close-button').click(function() {\n        question_window.remove();\n        document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n    });\n\n    getAccount().then(function() {\n\n        $('#post-a-question-window-template').before(question_window);\n        $('#opening-ts-datepicker').datepicker({\n            dateFormat: 'yy-mm-dd',\n            onSelect: function(dateText) {\n                $(this).css('background-color', '#ffffff');\n            }\n        });\n\n        if (!question_window.hasClass('is-open')) {\n            question_window.css('z-index', ++ZINDEX);\n            question_window.addClass('is-open');\n            question_window.css('height', question_window.height() + 'px');\n            setRcBrowserPosition(question_window);\n        }\n        if (CATEGORY) {\n            question_window.find(\"[name='question-category']\").val(CATEGORY);\n        }\n\n        Ps.initialize(question_window.find('.rcbrowser-inner').get(0));\n\n        $(\"textarea[name='question-body']\").on('change keyup paste', function() {\n            if ($(this).val()==\"\"){\n                $(this).parent().addClass('is-error');\n            } else {\n                $(this).parent().removeClass('is-error');\n            }\n        });\n\n        $(\"select[name='question-category']\").change(function(){\n            $(this).addClass(\"selected\");\n\n            let optionLabel = \"Category: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n\n            $(this).parent().removeClass('is-error');\n        });\n\n        $(\"select[name='question-type']\").change(function(){\n            let optionLabel = \"Question Type: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n\n        $(\"select[name='step-delay']\").change(function(){\n            let optionLabel = \"Countdown: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n\n        $(\"select[name='arbitrator']\").change(function(){\n            $(this).addClass(\"selected\");\n            let optionLabel = \"Arbitrator: \";\n\n            $(\"option\", this).each(function() {\n                const option = $(this).text().split(optionLabel)[1];\n                if (option){ $(this).text(option);}\n            });\n\n            const optionText = $(\"option:selected\",this).text();\n            $(\"option:selected\", this).text(optionLabel + optionText);\n        });\n    });\n});\n\n$('#browse-question-button,.browse-question-link').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').addClass('page-qa');\n    $('#site-slogan-normal').css('display', 'none');\n    $('#site-slogan-browse-qa').css('display', 'block');\n    $('#site-introduction__buttons').css('visibility', 'hidden');\n});\n\n$('#site-logo').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').removeClass('page-qa');\n    $('#site-slogan-normal').css('display', 'block');\n    $('#site-slogan-browse-qa').css('display', 'none');\n    $('#site-introduction__buttons').css('visibility', 'visible');\n});\n\n$(document).on('click', '#post-a-question-window .close-question-window', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('#post-a-question-window').css('z-index', 0);\n    $('#post-a-question-window').removeClass('is-open');\n});\n\n$(document).on('click', '#post-a-question-window .post-question-submit', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    await getAccount();\n\n    let win = $('#post-a-question-window');\n    const question_body = win.find('.question-body');\n    const reward_val = win.find('.question-reward').val();\n    const timeout = win.find('.step-delay');\n    const timeout_val = parseInt(timeout.val());\n    let arbitrator = win.find('.arbitrator').val();\n\n    const expected_question_fee_attr = win.find('.arbitrator option:selected').attr('data-question-fee');\n    const expected_question_fee = expected_question_fee_attr ? ethers.BigNumber.from(expected_question_fee_attr) : ethers.BigNumber.from(0);\n\n    if (arbitrator == 'other') {\n        arbitrator = win.find('input.arbitrator-other').val();\n    }\n    const question_type = win.find('.question-type');\n    const answer_options = win.find('.answer-option');\n    const opening_ts_val = win.find('.opening-ts').val();\n\n    const category = win.find('div.select-container--question-category select');\n    let outcomes = [];\n    for (let i = 0; i < answer_options.length; i++) {\n        outcomes[i] = answer_options[i].value;\n    }\n    const reward = (reward_val == '') ? ethers.BigNumber.from(0) : humanToDecimalizedBigNumber(reward_val);\n\n    if (!validate(win)) {\n        return;\n    }\n\n    const qtype = question_type.val();\n    const template_id = rc_template.defaultTemplateIDForType(qtype);\n    const qtext = rc_question.encodeText(qtype, question_body.val(), outcomes, category.val());\n    let opening_ts = 0;\n    if (opening_ts_val != '') {\n        opening_ts = new Date(opening_ts_val);\n        opening_ts = parseInt(opening_ts / 1000);\n    }\n\n    const rcver = RC_INSTANCE_VERSIONS[RC_DEFAULT_ADDRESS.toLowerCase()];\n\n    let min_bond = ethers.BigNumber.from(0);\n    if (win.hasClass('version-supports-min-bond')) {\n        const min_bond_val = win.find('.question-min-bond').val();\n        min_bond = humanToDecimalizedBigNumber(min_bond_val);\n    }\n\n    const question_id = rc_question.questionID(template_id, qtext, arbitrator, timeout_val, opening_ts, ACCOUNT, 0, min_bond.toHexString(), RC_DEFAULT_ADDRESS, rcver);\n    //console.log('question_id inputs for id ', question_id, template_id, qtext, arbitrator, timeout_val, opening_ts, ACCOUNT, 0);\n    //console.log('content_hash inputs for content hash ', rc_question.contentHash(template_id, opening_ts, qtext), template_id, opening_ts, qtext);\n\n    const is_ok = await validateArbitratorForContract(RC_DEFAULT_ADDRESS, arbitrator);\n    if (!is_ok) {\n        console.log('bad arbitrator');\n        return;\n    }\n\n    const fee_response = await RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(arbitrator);\n    // console.log('got fee response', fee_response, 'for arb', arbitrator);\n    const fee = fee_response[0];\n    if (!fee.eq(expected_question_fee)) {\n        console.log('fee has changed');\n        populateArbitratorOptionLabel(win.find('.arbitrator option:selected'), fee);\n        return;\n    }\n\n    const handleAskQuestionTX = async function(tx_response) {\n        //console.log('sent tx with id', txid);\n\n        const txid = tx_response.hash;\n        const contract = RC_DEFAULT_ADDRESS;\n\n        const fake_question = {\n            id: contract + '-' + question_id,\n            questionId: question_id,\n            contract: contract,\n            createdBlock: 0,\n            createdTimestamp: \"\"+parseInt(new Date().getTime()/1000), // Make this look like graph does\n            data: qtext,\n            arbitrator: arbitrator,\n            openingTimestamp: ethers.BigNumber.from(parseInt(opening_ts)),\n            timeout: ethers.BigNumber.from(timeout_val),\n            bounty: reward,\n            currentAnswer: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n            currentAnswerBond: null,\n            currentAnswerTimestamp: null,\n            historyHash: \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n            contentHash: rc_question.contentHash(template_id, parseInt(opening_ts), qtext),\n            lastBond: 0,\n            minBond: min_bond,\n            cumulativeBonds: 0,\n            arbitrationRequestedTimestamp: 0,\n            arbitrationRequestedBy: null,\n            isPendingArbitration: false,\n            arbitrationOccurred: false,\n            answerFinalizedTimestamp: null,\n            currentScheduledFinalizationTimestamp: null,\n            template: {\n                templateId: template_id, \n                questionText: CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][template_id] // TODO: Make sure this is fetched - should be if we're only using existing questions or our listed templates\n            }\n        }\n\n        let q = filledQuestion(fake_question)\n\n        // Turn the post question window into a question detail window\n        let rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        win.html(rcqa.html());\n        win = populateQuestionWindow(win, q, false);\n\n        // TODO: Once we have code to know which network we're on, link to a block explorer\n        win.find('.pending-question-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        win.find('.pending-question-txid a').text(txid.substr(0, 12) + \"...\");\n        win.addClass('unconfirmed-transaction').addClass('has-warnings');\n        win.attr('data-pending-txid', txid);\n\n        const contract_question_id = contractQuestionID(q);\n\n        win.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {};\n            WINDOW_POSITION[contract_question_id]['x'] = left;\n            WINDOW_POSITION[contract_question_id]['y'] = top;\n            win.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        set_hash_param({'question': contractQuestionID(q)});\n\n        const window_id = 'qadetail-' + contractQuestionID(q);\n        win.removeClass('rcbrowser--postaquestion').addClass('rcbrowser--qa-detail');\n        win.attr('id', window_id);\n        win.attr('data-contract-question-id', contractQuestionID(q));\n        Ps.initialize(win.find('.rcbrowser-inner').get(0));\n\n        // Once confirmed, slot into the front page\n        await tx_response.wait();\n        await delay(3000);\n\n        handleQuestion(fake_question);\n\n    }\n\n    const signedRC = RCInstance(RC_DEFAULT_ADDRESS, true);\n    let tx_response = null;\n    if (IS_TOKEN_NATIVE) { \n        if (min_bond.gt(0)) {\n            tx_response = await signedRC.functions.askQuestionWithMinBond(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, min_bond, {\n                from: ACCOUNT,\n                // gas: 200000,\n                value: reward.add(fee)\n            });\n        } else {\n            tx_response = await signedRC.functions.askQuestion(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, {\n                from: ACCOUNT,\n                // gas: 200000,\n                value: reward.add(fee)\n            });\n        }\n    } else {\n        const cost = reward.add(fee);\n        await ensureAmountApproved(RCInstance(RC_DEFAULT_ADDRESS).address, ACCOUNT, cost);\n        if (min_bond.gt(0)) {\n            tx_response = await signedRC.functions.askQuestionWithMinBondERC20(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, min_bond, cost, {\n                from: ACCOUNT,\n                // gas: 200000,\n            })\n        } else {\n            tx_response = await signedRC.functions.askQuestionERC20(template_id, qtext, arbitrator, timeout_val, opening_ts, 0, cost, {\n                from: ACCOUNT,\n                // gas: 200000,\n            })\n        }\n    }\n    handleAskQuestionTX(tx_response);\n\n});\n\nfunction isArbitratorValid(arb) {\n    let found = false;\n    let arbitrator_addrs = $('select.arbitrator').children();\n    arbitrator_addrs.each(function() {\n        if ($(this).val().toLowerCase() == arb.toLowerCase()) {\n            found = true;\n            return false;\n        }\n    });\n    return found;\n}\n\n// Check if an arbitrator is valid when we have not yet had time to contact all the arbitrator contracts\n// This is used for fast rendering of the warnings on the list page.\n// TODO: We should really go back through them later and set warnings on anything that turned out to be bad\nfunction isArbitratorValidFast(contract, test_arb) {\n    for (const a in ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()]) {\n        if (a.toLowerCase() == test_arb.toLowerCase()) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction arbitratorAddressToText(contract, addr) {\n    for (const a in ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()]) {\n        if (a.toLowerCase() == addr.toLowerCase()) {\n            return ARBITRATOR_LIST_BY_CONTRACT[contract.toLowerCase()][a.toLowerCase()];\n        }\n    }\n    return addr;\n}\n\nfunction isArbitrationPending(question) {\n    return (question.is_pending_arbitration);\n}\n\n// Return true if a user has started a commit or given an answer\n// NB Returns true even if the answer has timed out\nfunction isAnswerActivityStarted(question) {\n    if (isAnswered(question)) {\n        return true;\n    }\n    const history_hash = ethers.BigNumber.from(question.history_hash);\n    return (history_hash.gt(0));\n}\n\nfunction historyItemForCurrentAnswer(question) {\n    if (question['history'].length) {\n        for (let i=question['history'].length-1; i >= 0; i--) {\n            const item = question['history'][i];\n            // console.log('considering item', item,' for question', question);\n            if (!item.is_commitment || item.revealed_block) {\n                return item;\n            }\n        }\n    }\n    return null;\n}\n\nfunction isTopAnswerRevealable(question) {\n    // console.log('in isTopAnswerRevealable');\n    if (!isAnswerActivityStarted(question)) {\n        return false;\n    }\n    // console.log('history', question['history']);\n    if (question['history'].length == 0) {\n        return false;\n    }\n    const idx = question['history'].length - 1;\n    const item = question['history'][idx];\n    if (!item.is_commitment) {\n        return false;\n    }\n    if (item.revealed_block) {\n        return false;\n    }\n    if (isCommitExpired(question, item['ts'].toNumber())) {\n        return false;\n    }\n    return true;\n}\n\nfunction hasUnrevealedCommits(question) {\n    if (!isAnswerActivityStarted(question)) {\n        return false;\n    }\n    if (question['history'].length) {\n        for (let i=0; i<question['history'].length; i++) {\n            const item = question['history'][i];\n            if (item.is_commitment && !item.revealed_block) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n// Return true if there's a completed answer...\n// ...or if there's an uncommitted answer that hasn't timed out yet\n// TODO: Check for timeouts\nfunction isAnsweredOrAnswerActive(question) {\n    if (isAnswered(question)) {\n        return true;\n    }\n    const history_hash = ethers.BigNumber.from(question.history_hash);\n    return (history_hash.gt(0));\n}\n\nfunction isAnswered(question) {\n    const finalization_ts = question.finalization_ts.toNumber();\n    const is_pending_arbitration = question.is_pending_arbitration;\n    return (finalization_ts > 1 || is_pending_arbitration);\n}\n\nfunction commitExpiryTS(question, posted_ts) {\n    const commit_secs = question.timeout.div(8);\n    return posted_ts.add(commit_secs);\n}\n\nfunction isCommitExpired(question, posted_ts) {\n    const commit_secs = question.timeout.toNumber() / 8;\n    // console.log('commit secs are ', commit_secs);\n    return new Date().getTime() > (( posted_ts + commit_secs ) * 1000);\n}\n\nfunction isFinalized(question) {\n    if (isArbitrationPending(question)) {\n        return false;\n    }\n    const fin = question.finalization_ts.toNumber()\n    const res = ((fin > 1) && (fin * 1000 < new Date().getTime()));\n    return res;\n}\n\n// Return true if the question looks like it could be reopened.\n// Doesn't check whether it already has been.\nfunction isReopenCandidate(question) {\n    if (!isFinalized(question)) {\n        return false;\n    }\n    if (question.best_answer != rc_question.getAnsweredTooSoonValue()) {\n        return false;\n    }\n    if (!rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[question.contract.toLowerCase()], 'reopen-question')) {\n        return false;\n    }\n    return true;\n}\n\n// Assumes we already filled the data\nfunction isReopenable(question) {\n    // TODO: Check if it can be re-reopened\n    // console.log('reopened_by is ', question.reopened_by);\n    // console.log('last_reopened_by is ', question.last_reopened_by);\n    if (question.reopened_by && question.reopened_by != '0x0000000000000000000000000000000000000000000000000000000000000000') {\n        // console.log('already reopened');\n        return false;\n    }\n    if (question.is_reopener) {\n        // console.log('already reopening something else');\n        return false;\n    }\n    return isReopenCandidate(question);\n}\n\n$(document).on('click', '.answer-claim-button', async function() {\n\n    updateLastActionTS();\n\n    const contract = $(this).closest('.contract-claim-section').attr('data-contract');\n\n    const is_single_question = !$(this).hasClass('claim-all');\n\n    const doClaim = function(contract, is_single_question, question_detail) {\n\n        let claim_args = {};\n        let claiming = {};\n        if (is_single_question) {\n\n            claiming = possibleClaimableItems(question_detail);\n            claim_args = claiming;\n\n            //console.log('try9ing to claim ', claimable['total'].toString());\n            if (claim_args['total'].isZero()) {\n                //console.log('nothing to claim');\n                // Nothing there, so force a refresh\n                openQuestionWindow(contractQuestionID(question_detail));\n                if (USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n                    delete USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question_id];\n                }\n            }\n\n        } else {\n\n            claiming = USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()];\n            claim_args = mergePossibleClaimable(claiming);\n\n        }\n\n        // estimateGas gives us a number that credits the eventual storage refund.\n        // However, this is only supplied at the end of the transaction, so we need to send more to get us to that point.\n        // MetaMask seems to add a bit extra, but it's not enough.\n        // Get the number via estimateGas, then add 60000 per question, which should be the max storage we free.\n\n        // For now hard-code a fairly generous allowance\n        // Tried earlier with single answerer:\n        //  1 answer 48860\n        //  2 answers 54947\n        //  5 answers 73702\n\n        const gas = 140000 + (30000 * claim_args['history_hashes'].length);\n        const signedRC = RCInstance(contract, true); \n        console.log('claiming:', claim_args['question_ids'], claim_args['answer_lengths'], claim_args['history_hashes'], claim_args['answerers'], claim_args['bonds'], claim_args['answers']);\n        signedRC.functions.claimMultipleAndWithdrawBalance(claim_args['question_ids'], claim_args['answer_lengths'], claim_args['history_hashes'], claim_args['answerers'], claim_args['bonds'], claim_args['answers'], {\n            from: ACCOUNT \n            //gas: gas\n        }).then(function(tx_response) {\n            const txid = tx_response.hash;\n            //console.log('claiming is ',claiming);\n            //console.log('claim result txid', txid);\n            for (const qid in claiming) {\n                if (claiming.hasOwnProperty(qid)) {\n                    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n                        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n                    }\n                    if (USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][qid]) {\n                        USER_CLAIMABLE_BY_CONTRACT[contract][qid].txid = txid;\n                    }\n                }\n            }\n            updateClaimableDisplay(contract);\n            updateUserBalanceDisplay();\n        });\n    }\n\n    if (is_single_question) {\n        const contract_question_id = $(this).closest('.rcbrowser--qa-detail').attr('data-contract-question-id');\n        const [ctr, question_id] = parseContractQuestionID(contract_question_id);\n        if (ctr != contract) {\n            throw new Error(\"Contract ID mismatch\", ctr, contract);\n        }\n        await ensureQuestionDetailFetched(contract, question_id)\n        doClaim(contract, is_single_question, qdata);\n    } else {\n        // TODO: Should we be refetching all the questions we plan to claim for?\n        doClaim(contract, is_single_question);\n    }\n\n});\n\nfunction validate(win) {\n    let valid = true;\n\n    const qtext = win.find('.question-body');\n    if (qtext.val() == '') {\n        qtext.closest('div').addClass('is-error');\n        valid = false;\n    } else {\n        qtext.closest('div').removeClass('is-error');\n    }\n\n    let reward = win.find('.question-reward');\n    if (reward.val() === '') {\n        reward.parent().parent().addClass('is-error');\n        valid = false;\n    } else {\n        reward.parent().parent().removeClass('is-error');\n    }\n\n    if (win.hasClass('version-supports-min-bond')) {\n        let min_bond_inp = win.find('.question-min-bond');\n        let is_bond_err = false;\n        try {\n            // Parse the number and make sure it works\n            humanToDecimalizedBigNumber(min_bond_inp.val());\n        } catch (e) {\n            console.log('min bond parse err', e);\n            is_bond_err = true;\n        }\n        if (is_bond_err) {\n            min_bond_inp.parent().parent().addClass('is-error');\n            valid = false;\n        } else {\n            min_bond_inp.parent().parent().removeClass('is-error');\n        }\n    }\n\n    let options_num = 0;\n    const question_type = win.find('.question-type');\n    const answer_options = $('.answer-option').toArray();\n    for (let i = 0; i < answer_options.length; i++) {\n        if (answer_options[i].value !== '') {\n            options_num += 1;\n        }\n    }\n\n    if (win.find('.answer-option-container').hasClass('is-open') && question_type.val().indexOf('select') != -1 && options_num < 2) {\n        $('.edit-option-inner').addClass('is-error');\n        valid = false;\n    } else {\n        $('.edit-option-inner').removeClass('is-error');\n    }\n\n    const select_ids = ['.question-type', '.arbitrator', '.step-delay', '.question-category'];\n    for (const id of select_ids) {\n        if (win.find(id).val() == \"default\") {\n            win.find(id).parent().addClass('is-error');\n            valid = false;\n        } else {\n            win.find(id).parent().removeClass('is-error');\n        }\n    }\n\n    //console.log('valid is ', valid);\n    return valid;\n}\n\n\n$('div.loadmore-button').on('click', async function(e) {\n    const sec = $(this).attr('data-questions');\n    //console.log('loading more sec', sec);\n\n    const old_max = DISPLAY_ENTRIES[sec]['max_show'];\n    const new_max = old_max + 3;\n\n    const num_in_doc = $('#' + sec).find('.questions__item').length;\n\n    DISPLAY_ENTRIES[sec]['max_show'] = new_max;\n\n    const old_max_store = DISPLAY_ENTRIES[sec]['max_store'];\n\n    // TODO: We may need to refetch to populate this store\n    DISPLAY_ENTRIES[sec]['max_store'] = DISPLAY_ENTRIES[sec]['max_store'] + 3;\n\n    for (let i = num_in_doc; i < new_max && i < DISPLAY_ENTRIES[sec]['ids'].length; i++) {\n        const nextid = DISPLAY_ENTRIES[sec]['ids'][i];\n        const [next_ctr, next_question_id] = parseContractQuestionID(nextid);\n        let previd = null;\n        if (i > 0) {\n            previd = DISPLAY_ENTRIES[sec]['ids'][i + 1];\n        }\n\n        // Mostly these will come direct from the cache\n        let question = await ensureQuestionDetailFetched(next_ctr, next_question_id, (60*60*1000));\n        populateSection(sec, question, previd);\n    }\n\n    // Increase storage for next time\n    // TODO: Only fetch the relevant section\n    fetchQuestionListsFromGraph(old_max_store);\n\n});\n\nfunction updateClaimableDataForQuestion(question) {\n    const contract = question.contract;\n    const poss = possibleClaimableItems(question);\n    //console.log('made poss for question', poss, question.question_id);\n    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n    }\n    if (poss['total'].isZero()) {\n        delete USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question.question_id];\n    } else {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()][question.question_id] = poss;\n    }\n    return true; // TODO: Make this only return true if it changed something\n}\n\nasync function updateClaimableDisplay(contract) {\n\n    if (!USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()]) {\n        USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()] = {};\n    }\n    const unclaimed = mergePossibleClaimable(USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], false);\n    // console.log('updateClaimableDisplay with user_claimable, unclaimed', contract, USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], unclaimed);\n    const claiming = mergePossibleClaimable(USER_CLAIMABLE_BY_CONTRACT[contract.toLowerCase()], true);\n    const sec = $('.contract-claim-section').filter('[data-contract=' + contract.toLowerCase() + ']'); \n    if (claiming.total.gt(0)) {\n        const txids = claiming.txids;\n        sec.find('.answer-claiming-container').find('.claimable-eth').text(decimalizedBigNumberToHuman(claiming.total));\n        const txid = txids.join(', '); // TODO: Handle multiple links properly\n        sec.find('.answer-claiming-container').find('a.txid').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        sec.find('.answer-claiming-container').find('a.txid').text(txid.substr(0, 12) + \"...\");\n        sec.find('.answer-claiming-container').show();\n    } else {\n        sec.find('.answer-claiming-container').fadeOut();\n    }\n\n    const balance_arr = await RCInstance(contract).functions.balanceOf(ACCOUNT); \n    const balance = balance_arr[0];\n    const ttl = balance.add(unclaimed.total);\n//console.log('claimable ttol is ',ttl, ttl.toNumber());\n    if (ttl.gt(0)) {\n        sec.find('.answer-claim-button.claim-all').find('.claimable-eth').text(decimalizedBigNumberToHuman(ttl));\n        sec.find('.answer-claim-button.claim-all').show();\n    } else {\n        sec.find('.answer-claim-button.claim-all').fadeOut();\n    }\n\n}\n\nfunction mergePossibleClaimable(posses, pending) {\n    const combined = {\n        'txids': [],\n        'total': ethers.BigNumber.from(0),\n        'question_ids': [],\n        'answer_lengths': [],\n        'answers': [],\n        'answerers': [],\n        'bonds': [],\n        'history_hashes': []\n    }\n    for (const qid in posses) {\n        if (posses.hasOwnProperty(qid)) {\n            if (!pending && posses[qid].txid) {\n                continue;\n            }\n            if (pending && !posses[qid].txid) {\n                continue;\n            }\n            combined['total'] = combined['total'].add(posses[qid].total);\n            combined['question_ids'].push(...posses[qid].question_ids);\n            combined['answer_lengths'].push(...posses[qid].answer_lengths);\n            combined['answers'].push(...posses[qid].answers);\n            combined['answerers'].push(...posses[qid].answerers);\n            combined['bonds'].push(...posses[qid].bonds);\n            combined['history_hashes'].push(...posses[qid].history_hashes);\n            if (posses[qid].txid) {\n                if (combined['txids'].indexOf(posses[qid].txid) === -1) {\n                    combined['txids'].push(posses[qid].txid);\n                }\n            }\n        }\n    }\n    return combined;\n}\n\nfunction isAnythingUnrevealed(question) {\n    console.log('isAnythingUnrevealed pretending everything is revealed');\n    return false;\n}\n\nfunction filledAnswer(item, fetched_ms) {\n\n    // For now we make this look like what we get from a log event\n    let ans = {};\n    if (item.isCommitment) {\n        ans.commitment_id = item.commitmentId;\n        ans.is_commitment = true;\n        ans.revealed_block = item.revealedBlock\n    } else {\n        ans.is_commitment = false;\n        ans.commitment_id = null;\n        ans.revealed_block = null;\n    }\n    ans.answer = item.answer;\n    // ans.isUnrevealed = = item.isUnrevealed; // TODO: use this later\n    ans.bond = ethers.BigNumber.from(item.bond);\n    ans.history_hash = item.historyHash;\n\n    ans.user = item.user; \n    ans.ts = ethers.BigNumber.from(item.timestamp);\n\n    // txid isn't filled from the graph, only from our unconfirmed transactions\n    ans.txid = item.txid;\n\n    ans.fetched_ms = fetched_ms;\n\n    return ans;\n\n}\n\nfunction ensureTemplateCached(contract, template_id, content) {\n    contract = contract.toLowerCase();\n    template_id = parseInt(template_id);\n    if (!CONTRACT_TEMPLATE_CONTENT[contract]) {\n        CONTRACT_TEMPLATE_CONTENT[contract] = {};\n    }\n    CONTRACT_TEMPLATE_CONTENT[contract][\"\"+template_id] = content;\n}\n\nfunction filledQuestion(item, fetched_ms) {\n\n    let question = {'history_unconfirmed': []};\n\n    const cqid = cqToID(item.contract, item.questionId);\n    // console.log('filledQuestion', cqid);\n\n    // If we already have a question cached, start with that so we don't clobber its unconfirmed history etc\n    if (QUESTION_DETAIL_CACHE[cqid]) {\n        question = QUESTION_DETAIL_CACHE[cqid];\n    } \n\n    question.arbitrator = item.arbitrator;\n    question.question_id = item.questionId;\n    question.creation_ts = ethers.BigNumber.from(item.createdTimestamp);\n    question.question_creator = item.user;\n    question.question_created_block = item.createdBlock;\n    question.content_hash = item.contentHash;\n    question.question_text= item.data;\n    question.template_id = item.template.templateId;\n    question.block_mined = item.createdBlock;\n    question.fetched_ms = fetched_ms;\n\n    ensureTemplateCached(item.contract, item.template.templateId, item.template.questionText);\n\n    if (item.openingTimestamp) {\n        question.opening_ts = ethers.BigNumber.from(item.openingTimestamp);\n    } else {\n        question.opening_ts = ethers.BigNumber.from(0);\n    }\n\n    question.contract = item.contract;\n    question.version_number = RC_INSTANCE_VERSIONS[question.contract.toLowerCase()];\n    if (item.reopens) {\n        question.reopener_of_question_id = item.reopens.id;\n    }\n    if (item.reopenedBy) {\n        question.reopened_by = item.reopenedBy.id;\n    }\n    //question.bounty = data.args['bounty'];\n\n    try {\n        // question.question_json = JSON.parse(item.json_str);\n        question.question_json = rc_question.populatedJSONForTemplate(item.template.questionText, item.data, true);\n        question.has_invalid_option = rc_question.hasInvalidOption(question.question_json, question.version_number);\n        question.has_too_soon_option = rc_question.hasAnsweredTooSoonOption(question.question_json, question.version_number);\n    } catch (e) {\n        console.log('error parsing json', e);\n        return null;\n        // question.question_json = null;\n    }\n  \n    if (item.answerFinalizedTimestamp) {\n        question.finalization_ts = ethers.BigNumber.from(item.answerFinalizedTimestamp); // GRAPH_TODO - check this is what we need\n    } else {\n        question.finalization_ts = ethers.BigNumber.from(0);\n    }\n\n    question.is_pending_arbitration = item.isPendingArbitration;\n    question.timeout = ethers.BigNumber.from(item.timeout);\n    question.bounty = ethers.BigNumber.from(item.bounty);\n    question.best_answer = item.currentAnswer;\n    question.bond = ethers.BigNumber.from(item.lastBond);\n    question.history_hash = item.historyHash;\n\n    if (!question.history_hash) {\n        question.history_hash = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n    }\n\n    question.min_bond = ethers.BigNumber.from(item.minBond);\n    question.history = [];\n    for(let respi in item.responses) {\n        question.history.push(filledAnswer(item.responses[respi], fetched_ms));\n    }\n    question.history = question.history.sort((a, b) => (a.bond.gt(b.bond)) ? 1 : -1);\n\n    question = mergeConfirmedTXes(question);\n    question = clearClobberedUnconfirmed(question);\n    // console.log('filledQuestion made', question, item);\n\n    // TODO: Make sure the graph knows whether a question still has funds and query that here\n    if (ACCOUNT && isFinalized(question)) {\n        updateClaimableDataForQuestion(question); \n    }\n\n    QUESTION_DETAIL_CACHE[cqid] = question;\n\n    return question;\n\n}\n\nfunction delay(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nasync function ensureAmountApproved(spender, account, amount) {\n    console.log('checking if we need extra approval for amount', amount.toHexString());\n    const erc20 = getERC20TokenInstance();\n\n    const mybal = await erc20.functions.balanceOf(account);\n    console.log('balance is ', mybal.toString());\n\n    const allowed_arr = await erc20.functions.allowance(account, spender);\n    const allowed = allowed_arr[0];\n    if (allowed.gte(amount)) {\n        console.log('already got enough, continuing', allowed.toHexString());\n        return allowed;\n    } else {\n        console.log('not enough to cover cost, approving', amount, spender);\n        const signedERC20 = erc20.connect(signer);\n        const tx = await signedERC20.functions.approve(spender, amount);\n        await tx.wait(); \n        // At this point we have received the approval's transaction hash and can proceed with next transaction.\n        // However, Metamask may need some time to pick up this transaction, \n        // which is needed to validate next transactions, and 3 seconds is considered a \"safe\" waiting time.\n        // Metamask will still display the error however, but it can be ignored\n        await delay(3000);\n        console.log('approval done')\n        return amount;\n    }\n}\n\nasync function updateUserBalanceDisplay() {\n    if (!ACCOUNT) {\n        return;\n    }\n\n    let bal = 0;\n    if (IS_TOKEN_NATIVE) {\n        // console.log('updating balacne for', account);\n        bal = await provider.getBalance(ACCOUNT);\n    } else {\n            /*\n            todo: should we have error handling\n            if (error === null) {\n                $('.account-balance').text(web3js.fromWei(result.toNumber(), 'ether'));\n            }\n            */\n        const erc20 = getERC20TokenInstance();\n        const bal_arr = await erc20.functions.balanceOf(ACCOUNT);\n        bal = bal_arr[0];\n    }\n\n    $('.account-balance').text(decimalizedBigNumberToHuman(bal));\n}\n\nfunction getERC20TokenInstance() {\n    return new ethers.Contract(TOKEN_JSON.address, TOKEN_JSON.abi, provider);\n}\n\nfunction populateSection(section_name, question, before_item) {\n\n    const question_id = question.question_id;\n    const idx = DISPLAY_ENTRIES[section_name].ids.indexOf(question_id);\n    //console.log('idx is ',idx);\n    if (idx > DISPLAY_ENTRIES[section_name].max_show) {\n        //console.log('over max show, skip', question_id);\n        return;\n    }\n\n    const question_item_id = section_name + '-question-' + contractQuestionID(question);\n    const before_item_id = section_name + '-question-' + before_item\n\n    const target_question_id = 'qadetail-' + contractQuestionID(question);\n\n    const section = $('#' + section_name);\n\n    // If the item is already in the document but in the wrong place, remove it.\n    // If it's already in the right place, do nothing\n    const existing_in_doc = section.find('#' + question_item_id);\n    if (existing_in_doc.length) {\n        if (existing_in_doc.next().attr('id') == before_item_id) {\n            //console.log('already before item', before_item_id);\n            return;\n        } else {\n            //console.log('already in doc, removing', question_item_id);\n            existing_in_doc.remove();\n        }\n    } else {\n        //console.log('not in doc yet, adding', question_id,' at ', question_item_id);\n        //console.log('item to insert before is here? ', before_item_id, section.find('#' + before_item_id).length);\n    }\n\n    const is_found = (section.find('#' + before_item_id).length > 0);\n    let entry = $('.questions__item.template-item').clone();\n\n    entry = populateSectionEntry(entry, question);\n\n    if (ARBITRATOR_FAILED_BY_CONTRACT[question.contract.toLowerCase()] && ARBITRATOR_FAILED_BY_CONTRACT[question.contract.toLowerCase()][question.arbitrator.toLowerCase()]) {\n        entry.addClass('failed-arbitrator');\n    } \n\n    entry.attr('id', question_item_id).removeClass('template-item');\n    entry.css('display', 'none');\n\n    //console.log('adding entry', question_item_id, 'before item', before_item);\n    if (before_item && is_found) {\n        section.find('#' + before_item_id).before(entry);\n    } else {\n        section.children('.questions-list').append(entry);\n    }\n\n    activateSection(section_name);\n\n    entry.fadeIn(1000);\n    if (DISPLAY_ENTRIES[section_name]['ids'].length > 3) {\n        if (section.find('.loadmore-button').css('display') == 'none') {\n            section.children('.questions-list').find('.questions__item:last-child').remove();\n        }\n    }\n    if (section.children('.questions-list').find('.questions__item').length >= DISPLAY_ENTRIES[section_name]['ids'].length) {\n        section.find('.loadmore-button').css('display', 'none');\n    } else {\n        section.find('.loadmore-button').css('display', 'block');\n    }\n    while (section.children('.questions-list').find('.questions__item').length > DISPLAY_ENTRIES[section_name].max_show) {\n        //console.log('too long, removing');\n        section.children('.questions-list').find('.questions__item:last-child').remove()\n    }\n\n    // question settings warning balloon\n    let balloon_html = '';\n    if (question.timeout < 86400) {\n        balloon_html += 'The timeout is very low.<br /><br />This means there may not be enough time for people to correct mistakes or lies.<br /><br />';\n    }\n    if (isFinalized(question) && question.bounty.add(question.bond).lt(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']))) {\n        balloon_html += 'The reward was very low and no substantial bond was posted.<br /><br />This means there may not have been enough incentive to post accurate information.<br /><br />';\n    }\n    const valid_arbitrator = isArbitratorValidFast(question.contract, question.arbitrator);\n    if (!valid_arbitrator) {\n        balloon_html += 'This arbitrator is unknown.';\n    }\n    const contract_question_id = contractQuestionID(question);\n    if (balloon_html) {\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').css('display', 'block');\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').css('z-index', 5);\n        $('div[data-contract-question-id=' + contract_question_id + ']').find('.question-setting-warning').find('.balloon').html(balloon_html);\n    }\n\n}\n\nfunction activateSection(section_name) {\n    $('div#questions-container').find('.main-nav li a').each(function() {\n        if ($(this).attr('data-menu') == section_name) {\n            $(this).addClass('activated');\n        }\n    });\n}\n\nfunction updateSectionEntryDisplay(question) {\n    $('div.questions__item[data-contract-question-id=\"' + contractQuestionID(question) + '\"]').each(function() {\n        //console.log('updateSectionEntryDisplay update question', question.question_id);\n        populateSectionEntry($(this), question);\n    });\n}\n\nfunction populateSectionEntry(entry, question) {\n\n    const question_id = question.question_id;\n    const question_json = question.question_json;\n    const posted_ts = ethers.BigNumber.from(question.creation_ts);\n    const arbitrator = question.arbitrator;\n    const timeout = question.timeout;\n    const bounty = decimalizedBigNumberToHuman(question.bounty);\n    const is_arbitration_pending = isArbitrationPending(question);\n    const is_finalized = isFinalized(question);\n    const best_answer = question.best_answer;\n    const bond = question.bond;\n\n    let options = '';\n    if (typeof question_json['outcomes'] !== 'undefined') {\n        for (let i = 0; i < question_json['outcomes'].length; i++) {\n            options = options + i + ':' + question_json['outcomes'][i] + ', ';\n        }\n    }\n\n    entry.attr('data-contract-question-id', contractQuestionID(question));\n    //entry.find('.questions__item__title').attr('data-target-id', target_question_id);\n\n    entry.find('.question-title').text(question_json['title']).expander({\n        expandText: '',\n        slicePoint: 140\n    });\n    entry.find('.question-bounty').text(bounty);\n\n    entry.find('.bond-value').text(decimalizedBigNumberToHuman(bond));\n\n    // For these purposes we just ignore any outstanding commits\n    if (isAnswered(question)) {\n        entry.find('.questions__item__answer').text(rc_question.getAnswerString(question_json, best_answer));\n        entry.addClass('has-answer');\n    } else {\n        entry.find('.questions__item__answer').text('');\n        entry.removeClass('has-answer');\n    }\n\n    if (isQuestionBeforeOpeningDate(question)) {\n        entry.addClass('not-yet-open');\n    }\n\n    const is_answered = isAnswered(question);\n\n    if (is_answered) {\n        entry.addClass('has-answers').removeClass('no-answers');\n    } else {\n        entry.removeClass('has-answers').addClass('no-answers');\n    }\n\n    timeago.cancel(entry.find('.timeago'));\n    if (isArbitrationPending(question)) {\n        entry.addClass('arbitration-pending');\n    } else {\n        entry.removeClass('arbitration-pending');\n        if (is_answered) {\n            timeago.cancel(entry.find('.closing-time-label .timeago'));\n            entry.find('.closing-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(entry.find('.closing-time-label .timeago'));\n        } else {\n            entry.find('.created-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.creation_ts));\n            timeAgo.render(entry.find('.created-time-label .timeago'));\n        }\n    }\n    \n    if (isQuestionBeforeOpeningDate(question)) {\n        entry.find('.opening-time-label .timeago').attr('datetime', rc_question.convertTsToString(question.opening_ts));\n        timeAgo.render(entry.find('.opening-time-label .timeago'));\n    }\n\n    return entry;\n\n}\n\nfunction depopulateSection(section_name, question_id) {\n    //console.log('depopulating', section_name, question_id);\n\n    const question_item_id = section_name + '-question-' + question_id;\n    const section = $('#' + section_name);\n\n    const item = section.find('#' + question_item_id);\n    if (item.length) {\n        item.remove();\n        // Add the next entry to the bottom\n        const current_last_qid = section.find('.questions__item').last().attr('data-contract-question-id');\n        const current_last_idx = DISPLAY_ENTRIES[section_name]['ids'].indexOf(current_last_qid);\n        const next_idx = current_last_idx + 1;\n        if (DISPLAY_ENTRIES[section_name]['ids'].length > next_idx) {\n            const add_qid = DISPLAY_ENTRIES[section_name]['ids'][next_idx];\n            const qdata = QUESTION_DETAIL_CACHE[add_qid];\n            populateSection(section_name, qdata, current_last_qid);\n        }\n    }\n\n}\n\n// Calculate a ranking to handle active display\n// Intended to try to bring interesting open questions to the top\nfunction calculateActiveRank(created, bounty, bond) {\n\n    // Everything should be populated with BigNumbers but in the event that something isn't due to some log query issue etc, just skip that question\n    const err = ethers.BigNumber.from(0);\n    if (typeof created === 'undefined') {\n        console.log('calculateActiveRank skipping undefined created');\n        return err;\n    }\n    if (typeof bond === 'undefined') {\n        console.log('calculateActiveRank skipping undefined bond');\n        return err;\n    }\n    if (typeof bounty === 'undefined') {\n        console.log('calculateActiveRank skipping undefined bounty');\n        return err;\n    }\n\n    // Initial rank is bounty add bond.\n    // Bond is uprated by 4 times compared to reward\n    let rank = bounty.add(bond.mul(ethers.BigNumber.from(4)));\n\n    const now = new Date();\n    const now_bn = ethers.BigNumber.from(parseInt(now.getTime() / 1000));\n    const age = now_bn.sub(created);\n\n    // Scale up anything under 24 hours so that 10 mins counts as 0.01 ETH of reward,  or 0.002 of bond\n    if (age.lt(ethers.BigNumber.from(86400))) {\n        const secs = ethers.BigNumber.from(86400).sub(age);\n        const boost = secs.div(ethers.BigNumber.from(600)).mul(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']));\n        rank = rank.add(boost);\n    }\n\n    // Anything else goes by time posted\n    rank = rank.add(created);\n\n    // console.log('rank', rank.toNumber());\n    return rank;\n\n}\n\nasync function handleQuestion(item, fetched_ms) {\n\n    const question_id = item.questionId;\n\n    const contract = item.contract;\n    //console.log('in handleQuestionLog', question_id);\n    const created = item.createdTimestamp;\n\n    // Populate with the data we got\n    //console.log('before filling in handleQuestionLog', QUESTION_DETAIL_CACHE[question_id]);\n    let question = filledQuestion(item, fetched_ms);\n    if (!question) {\n        console.log('skipping unparseable question', question.question_id);\n        return;\n    }\n    updateQuestionWindowIfOpen(question);\n\n//console.log('filledQuestion', question);\n    //console.log('after filling in handleQuestionLog', QUESTION_DETAIL_CACHE[question_id]);\n\n    // Then fetch anything else we need to display\n//    question = await ensureQuestionDetailFetched(contract, question_id, 1, 1, item.blockNumber, -1)\n\n    // console.log('updateQuestionWindowIfOpen after ensureQuestionDetailFetched for', contract, question_id, 'returned', question, 'block num is', item.blockNumber );\n    // updateQuestionWindowIfOpen(question);\n\n    if (CATEGORY && question.question_json.category != CATEGORY) {\n        //console.log('mismatch for cat', category, question.question_json.category);\n        return;\n    } else {\n        //console.log('category match', category, question.question_json.category);\n    }\n\n    const is_finalized = isFinalized(question);\n\n    // Pending arbitration doesn't exactly fit but it fits better than the other categories\n    const is_before_opening = isQuestionBeforeOpeningDate(question) || isArbitrationPending(question);\n    const bounty = question.bounty;\n    const opening_ts = question.opening_ts;\n\n    if (is_finalized) {\n\n        const insert_before = update_ranking_data('questions-resolved', contractQuestionID(question), question.finalization_ts, 'desc');\n        if (insert_before !== -1) {\n            // TODO: If we include this we have to handle the history too\n            populateSection('questions-resolved', question, insert_before);\n            $('#questions-resolved').find('.scanning-questions-category').css('display', 'none');\n            if (DISPLAY_ENTRIES['questions-resolved']['ids'].length > 3 && $('#questions-resolved').find('.loadmore-button').css('display') == 'none') {\n                $('#questions-resolved').find('.loadmore-button').css('display', 'block');\n            }\n        }\n\n    } else if (is_before_opening) {\n\n        const insert_before = update_ranking_data('questions-upcoming', contractQuestionID(question), opening_ts, 'asc');\n        if (insert_before !== -1) {\n            populateSection('questions-upcoming', question, insert_before);\n            $('#questions-upcoming').find('.scanning-questions-category').css('display', 'none');\n            if (DISPLAY_ENTRIES['questions-upcoming']['ids'].length > 3 && $('#questions-upcoming').find('.loadmore-button').css('display') == 'none') {\n                $('#questions-upcoming').find('.loadmore-button').css('display', 'block');\n            }\n        }\n\n    } else {\n\n        if (!question.is_pending_arbitration) {\n            const insert_before = update_ranking_data('questions-active', contractQuestionID(question), calculateActiveRank(created, question.bounty, question.bond), 'desc');\n            if (insert_before !== -1) {\n                populateSection('questions-active', question, insert_before);\n                $('#questions-active').find('.scanning-questions-category').css('display', 'none');\n                if (DISPLAY_ENTRIES['questions-active']['ids'].length > 3 && $('#questions-active').find('.loadmore-button').css('display') == 'none') {\n                    $('#questions-active').find('.loadmore-button').css('display', 'block');\n                }\n            }\n        }\n\n        if (isAnswered(question)) {\n            const insert_before = update_ranking_data('questions-closing-soon', contractQuestionID(question), question.finalization_ts, 'asc');\n            if (insert_before !== -1) {\n                populateSection('questions-closing-soon', question, insert_before);\n                $('#questions-closing-soon').find('.scanning-questions-category').css('display', 'none');\n                if (DISPLAY_ENTRIES['questions-closing-soon']['ids'].length > 3 && $('#questions-closing-soon').find('.loadmore-button').css('display') == 'none') {\n                    $('#questions-closing-soon').find('.loadmore-button').css('display', 'block');\n                }\n            }\n        }\n\n    }\n\n    reflectDisplayEntryChanges();\n\n}\n\n// Inserts into the right place in the stored rankings.\n// If it comes after another stored item, return the ID of that item.\n// If it doesn't belong in storage because it is too low for the ranking, return -1\n// TODO: ??? If it is already in storage and does not need to be updated, return -2\nfunction update_ranking_data(arr_name, id, val, ord) {\n\n    // Check if we already have it\n    const existing_idx = DISPLAY_ENTRIES[arr_name]['ids'].indexOf(id);\n    if (existing_idx !== -1) {\n        //console.log('not found in list');\n\n        // If it is unchanged, return a code saying there is nothing to do\n        if (val.eq(DISPLAY_ENTRIES[arr_name]['vals'][existing_idx])) {\n            //console.log('nothing to do, val was unchanged at', val, DISPLAY_ENTRIES[arr_name]['vals'][existing_idx]);\n            return -1; // TODO: make this -2 so the caller can handle this case differently?\n        }\n\n        // If we are already in the list and have the same value, remove and try to add again\n        // This can happen if the variable we sort by is updated\n        DISPLAY_ENTRIES[arr_name]['ids'].splice(existing_idx, 1);\n        DISPLAY_ENTRIES[arr_name]['vals'].splice(existing_idx, 1);\n    }\n\n    //console.log('update_ranking_data', arr_name, id, val.toString());\n    const arr = DISPLAY_ENTRIES[arr_name]['vals']\n        //console.log('start with array ', arr);\n\n    const max_entries = DISPLAY_ENTRIES[arr_name]['max_store'];\n\n    // If the list is full and we're lower, give up\n    if (arr.length >= max_entries) {\n        //console.log('list full and lower, give up');\n        const last_entry = arr[arr.length - 1];\n        if (last_entry.gte(val)) {\n            //  console.log('we are full and last entry is at least as high')\n            return -1;\n        }\n    }\n\n    // go through from the top until we find something we're higher than\n    for (let i = 0; i < arr.length; i++) {\n        //console.log('see if ', val.toString(), ' is at least as great as ', arr[i].toString());\n        if ((ord == 'desc' && val.gte(arr[i])) || (ord == 'asc' && val.lte(arr[i]))) {\n            // found a spot, we're higher than the current occupant of this index\n            // we'll return its ID to know where to insert in the document\n            const previd = DISPLAY_ENTRIES[arr_name]['ids'][i];\n\n            //console.log('found, splice in before ', previd, 'old', val.toString(), 'new', arr[i].toString());\n\n            // insert at the replaced element's index, bumping everything down\n            DISPLAY_ENTRIES[arr_name]['ids'].splice(i, 0, id);\n            DISPLAY_ENTRIES[arr_name]['vals'].splice(i, 0, val);\n\n            // if the array is now too long, dump the final element\n            if (arr.length > max_entries) {\n                DISPLAY_ENTRIES[arr_name]['ids'].pop();\n                DISPLAY_ENTRIES[arr_name]['vals'].pop();\n            }\n            return previd;\n        }\n\n    }\n\n    //console.log('not found, add to end');\n    // lower than everything but there's still space, so add to the end\n    DISPLAY_ENTRIES[arr_name]['ids'].push(id);\n    DISPLAY_ENTRIES[arr_name]['vals'].push(val);\n    return null;\n\n}\n\n/*-------------------------------------------------------------------------------------*/\n// question detail window\n\nfunction initQuestionTypeUI() {\n\n    $(document).on('change', '.question-type', function(e) {\n        const win = $(this).closest('.rcbrowser');\n        const container = win.find('.answer-option-container');\n        if (win.find('.question-type').val() == 'single-select' || win.find('.question-type').val() == 'multiple-select') {\n            if (!container.hasClass('is-open')) {\n                container.css('display', 'block');\n                container.addClass('is-open');\n                container.addClass('is-bounce');\n            }\n        } else {\n            container.css('display', 'none');\n            container.removeClass('is-open');\n            container.removeClass('is-bounce');\n            win.find('.first-answer-option').children().val('');\n            win.find('.input-container--answer-option').remove();\n        }\n        Ps.update(win.find('.rcbrowser-inner').get(0));\n    });\n\n    $(document).on('click', '.add-option-button', function(e) {\n        const win = $(this).closest('.rcbrowser');\n        const element = $('<div>');\n        element.addClass('input-container input-container--answer-option');\n        const input = '<input type=\"text\" name=\"editOption0\" class=\"rcbrowser-input answer-option form-item\" placeholder=\"Enter an answer...\">';\n        element.append(input);\n        win.find('.error-container--answer-option').before(element);\n        element.addClass('is-bounce');\n        Ps.update(win.find('.rcbrowser-inner').get(0));\n    });\n\n}\n\ninitQuestionTypeUI();\n\n\n$(document).on('click', '.questions__item__title', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const contract_question_id = $(this).closest('.questions__item').attr('data-contract-question-id');\n\nconsole.log('open window', contract_question_id);\n    // Should repopulate and bring to the front if already open\n    openQuestionWindow(contract_question_id);\n\n});\n\n$(document).on('click', '.mini-action-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const contract_question_id = $(this).closest('.questions__item').attr('data-contract-question-id');\n\n    // Should repopulate and bring to the front if already open\n    openQuestionWindow(contract_question_id);\n\n});\n\n$(document).on('click', '.your-qa__questions__item', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n\n    updateLastActionTS();\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const contract_question_id = $(this).closest('.your-qa__questions__item').attr('data-contract-question-id');\n\n    openQuestionWindow(contract_question_id);\n\n});\n\nfunction parseContractQuestionID(id, fallback_contract) {\n    // console.log('fallback_contract', fallback_contract);\n    id = id.toLowerCase();\n    const bits = id.split('-');\n    if (bits.length === 2) {\n        return bits; \n    }\n    if (bits.length === 1) {\n        // console.log('try fallback');\n        if (fallback_contract) {\n            console.log('using fallback contract');\n            return [fallback_contract.toLowerCase(), bits[0]]; \n        }\n    } else {\n        console.log('bits length was', bits.length, bits);\n        throw new Error(\"Could not parse contract-question-id \" + id); \n    }\n}\n\nfunction contractQuestionID(question) {\n    return cqToID(question.contract, question.question_id);\n}\n\nfunction ctToId(contract, template_id) {\n    const template_id_hex = ethers.BigNumber.from(template_id).toHexString(); // TODO: Check padding etc with bigger numbers\n    return contract.toLowerCase() + template_id_hex;\n}\n\nfunction cqToID(contract, question_id) {\n    return contract.toLowerCase() + '-' + question_id.toLowerCase();\n}\n\nasync function openQuestionWindow(contract_question_id) {\n\n    const [contract_addr, question_id] = parseContractQuestionID(contract_question_id);\n\n    // console.log('quick load');\n    // To respond quickly, start by fetching with even fairly old data and no logs\n    let question = await ensureQuestionDetailFetched(contract_addr, question_id, 60*60*24*1000);\n\n    displayQuestionDetail(question);\n\n    // Get the window open first with whatever data we have\n    // Then repopulate with the most recent of everything anything has changed\n    console.log('Refetching with minimal caching to be sure');\n    question = await ensureQuestionDetailFetched(contract_addr, question_id, 1000);\n    updateQuestionWindowIfOpen(question);\n}\n\nfunction updateQuestionWindowIfOpen(question) {\n\n    const window_id = 'qadetail-' + contractQuestionID(question);\n    let rcqa = $('#' + window_id);\n    if (rcqa.length) {\n    console.log('updateQuestionWindowIfOpen', question);\n        rcqa = populateQuestionWindow(rcqa, question, true);\n    }\n\n}\n\nfunction displayQuestionDetail(question_detail) {\n\n    const question_id = question_detail.question_id;\n    const contract_question_id = contractQuestionID(question_detail);\n    //console.log('question_id', question_id);\n\n    // If already open, refresh and bring to the front\n    const window_id = 'qadetail-' + contract_question_id\n    let rcqa = $('#' + window_id);\n    if (rcqa.length) {\n        rcqa = populateQuestionWindow(rcqa, question_detail, true);\n        rcqa.css('z-index', ++ZINDEX);\n    } else {\n        rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        rcqa.attr('id', window_id);\n        rcqa.attr('data-contract-question-id', contract_question_id);\n\n        rcqa.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {\n                'x': left,\n                'y': top\n            };\n            rcqa.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        rcqa.removeClass('template-item');\n\n        rcqa = populateQuestionWindow(rcqa, question_detail, false);\n\n        $('#qa-detail-container').append(rcqa);\n\n        rcqa.css('display', 'block');\n        rcqa.addClass('is-open');\n        rcqa.css('z-index', ++ZINDEX);\n        rcqa.css('height', \"80%\");\n        rcqa.css('max-height', \"80%\");\n        setRcBrowserPosition(rcqa);\n        Ps.initialize(rcqa.find('.rcbrowser-inner').get(0));\n    }\n\n    // console.log('set_hash_param', contractQuestionID(question_detail));\n    set_hash_param({'question': contractQuestionID(question_detail)});\n\n}\n\nfunction setupDatetimeDatePicker(rcqa) {\n\n    let precision = rcqa.attr('data-datetime-precision');\n    if (!precision) {\n        precision = 'd';\n    }\n    const date_format = (precision == 'Y') ? 'yy' : ( (precision == 'm') ? 'yy-mm' : 'yy-mm-dd' )\n\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        rcqa.addClass('has-time-input');\n        const plh = {\n            'H': '00',\n            'i': '00:00',\n            's': '00:00:00'\n        }\n        rcqa.find('input.datetime-input-time').attr('placeholder', plh[precision]).attr('maxlength', plh[precision].length);;\n    }\n\n    const dtplh = {\n        'Y': '2000',\n        'm': '2000-01',\n        'd': '2000-01-01',\n        'H': '2000-01-01',\n        'i': '2000-01-01',\n        's': '2000-01-01'\n    }\n    rcqa.find('input.datetime-input-date').attr('placeholder', dtplh[precision]).attr('maxlength', dtplh[precision].length).attr('data-precision', precision);\n\n    // TODO: Set the precision of the date and use it for date and time\n    if (rcqa.find('[name=\"input-answer\"]').hasClass('rcbrowser-input--date--answer')) {\n        rcqa.find('[name=\"input-answer\"]').datepicker({\n            dateFormat: date_format,\n            beforeShow: function(input, inst) {\n                if ($(this).closest('.input-container').hasClass('invalid-selected')) {\n                    return false;\n                }\n            }, \n            onSelect: function(dateText) {\n                $(this).closest('.input-container').removeClass('is-error');\n            }\n        });\n    }\n\n}\n\nfunction category_text(question_json, target_el) {\n    const cat = question_json['category'];\n    let cat_txt = '';\n    if (cat == '') {\n        cat_txt = 'Unassigned';\n    } else {\n        cat_txt = $(\"#filter-list\").find(\"[data-category='\" + cat + \"']\").text();\n        if (cat_txt == '') {\n            cat_txt = '\"' + cat + '\"';\n        }\n    }\n    if (target_el) {\n        cat_txt = target_el.attr('data-prefix-text') + cat_txt;\n    }\n    return cat_txt;\n}\n\n// Returns arbitration metadata from the cache\n// Assumes it's already been loaded\nfunction arbitrationMetaDataFromCache(arb_addr) {\n    if (arb_addr.toLowerCase() in ARBITRATOR_METADATA) {\n        //console.log('found metadata for', arb_addr);\n        return ARBITRATOR_METADATA[arb_addr.toLowerCase()];\n    }\n    if (arb_addr.toLowerCase() == '0x0000000000000000000000000000000000000000') {\n        return {};\n    }\n    //console.log('no metadata for', arb_addr, ARBITRATOR_METADATA);\n    return null;\n}\n\nasync function loadArbitratorMetaData(arb_addr) {\n    const cached_md = arbitrationMetaDataFromCache(arb_addr);\n    if (cached_md) {\n        return cached_md;\n    }\n    //console.log('fetching metadata for arbitrator', arb_addr);\n    let metadata_json = {};\n    try {\n        const arb = ARBITRATOR_INSTANCE.attach(arb_addr);\n        const md_arr = await arb.functions.metadata();\n        const md = md_arr[0];\n        try {\n            if (md != '' && md != ' ') {\n                metadata_json = JSON.parse(md);\n            }\n        } catch (e) {\n            console.log('arbitrator', arb_addr, 'returned some metadata but it could not be parsed:', md);\n        }\n    } catch (e) {\n        console.log('Got an error trying to fetch arbitrator metadata, this is expected with some arbitrators', arb_addr);\n    }\n    ARBITRATOR_METADATA[arb_addr.toLowerCase()] = metadata_json;\n    // console.log('loaded metadata', arb_addr, metadata_json);\n    return metadata_json;\n}\n\nfunction isTitleLong(title) {\n    if (title.length > 300) {\n        return true;\n    }\n    const words = title.split(' ');\n    for (let i=0; i<words.length; i++) {\n        if (words[i].length > 50) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction populateQuestionWindow(rcqa, question_detail, is_refresh) {\n\n    // console.log('populateQuestionWindow with detail ', question_detail, is_refresh);\n    const question_id = question_detail.question_id;\n    const question_json = question_detail.question_json;\n    const question_type = question_json['type'];\n\n    //console.log('current list last item in history, which is ', question_detail['history'])\n    const idx = question_detail['history'].length - 1;\n\n    if (question_detail.has_invalid_option) {\n        rcqa.addClass('has-invalid-option');\n    }\n    if (question_detail.has_too_soon_option) {\n        rcqa.addClass('has-too-soon-option');\n    }\n\n    const cat_el = rcqa.find('.rcbrowser-main-header-category');\n    cat_el.text(category_text(question_json, cat_el)); \n\n    let date = new Date();\n    date.setTime(question_detail.creation_ts * 1000);\n    const date_str = MONTH_LIST[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n\n    rcqa.find('.rcbrowser-main-header-date').text(date_str);\n\n    if (isTitleLong(question_json['title'])) {\n        rcqa.addClass('long-title')\n    } else {\n        rcqa.removeClass('long-title')\n    }\n    rcqa.find('.question-title').text(question_json['title']).expander({\n        slicePoint: 200\n    });\n    rcqa.find('.reward-value').text(decimalizedBigNumberToHuman(question_detail.bounty));\n\n    if (question_detail.block_mined > 0) {\n        rcqa.removeClass('unconfirmed-transaction').removeClass('has-warnings');\n    }\n\n    const metadata = arbitrationMetaDataFromCache(question_detail.arbitrator);\n    if (metadata && 'tos' in metadata && metadata['tos']) {\n        populateTOSSection(rcqa, metadata['tos']);\n    } else {\n        populateTOSSection(rcqa, null);\n    }\n\n    let bond = ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']).div(2);\n    if (question_detail.min_bond && question_detail.min_bond.gt(0)) {\n        bond = question_detail.min_bond.div(2);\n    } else if (question_detail.bounty && question_detail.bounty.gt(0)) {\n        bond = question_detail.bounty.div(2);\n    }\n\n    if (isReopenable(question_detail)) {\n        rcqa.addClass('reopenable').removeClass('reopened');\n        console.log('add reopen section');\n    } else {\n        rcqa.removeClass('reopenable');\n        if (question_detail.reopened_by) {\n            rcqa.attr('data-reopened-by-question-id', question_detail.reopened_by);\n            rcqa.addClass('reopened');\n        } else {\n            rcqa.removeClass('reopened');\n        }\n    }\n\n    if (question_detail.reopener_of_question_id) {\n        rcqa.addClass('reopener');\n        rcqa.attr('data-reopener-of-question-id', question_detail.reopener_of_question_id);\n    }\n\n    if (isAnswerActivityStarted(question_detail)) {\n\n        const current_container = rcqa.find('.current-answer-container');\n\n        if (isAnswered(question_detail)) {\n            // label for show the current answer.\n            const label = rc_question.getAnswerString(question_json, question_detail.best_answer);\n            current_container.find('.current-answer-body').find('.current-answer').text(label);\n        }\n\n        bond = question_detail.bond;\n\n        if (question_detail['history'].length) {\n            //console.log('updateing aunswer');\n            const current_answer = historyItemForCurrentAnswer(question_detail);\n            if (current_answer) {\n                //console.log('current_answer is ', current_answer);\n                current_container.attr('id', 'answer-' + current_answer.answer);\n\n                timeago.cancel(current_container.find('.current-answer-item').find('.timeago')); // cancel the old timeago timer if there is one\n                current_container.find('.current-answer-item').find('.timeago').attr('datetime', rc_question.convertTsToString(current_answer.ts));\n                timeAgo.render(current_container.find('.current-answer-item').find('.timeago'));\n\n                // answerer data\n                const ans_data = rcqa.find('.current-answer-container').find('.answer-data');\n                ans_data.find('.answerer').text(current_answer.user);\n                const avjazzicon = jazzicon(32, parseInt(current_answer.user.toLowerCase().slice(2, 10), 16));\n                ans_data.find('.answer-data__avatar').html(avjazzicon);\n                if (current_answer.user == ACCOUNT) {\n                    ans_data.addClass('current-account');\n                } else {\n                    ans_data.removeClass('current-account');\n                }\n                ans_data.find('.answer-bond-value').text(decimalizedBigNumberToHuman(current_answer.bond));\n            }\n\n            const last_ans = question_detail['history'][idx];\n            const unrevealed_answer_container = rcqa.find('.unrevealed-top-answer-container');\n            if (last_ans.is_commitment && !last_ans.revealed_block) {\n                unrevealed_answer_container.find('.answer-bond-value').text(decimalizedBigNumberToHuman(last_ans.bond));\n                unrevealed_answer_container.find('.reveal-time.timeago').attr('datetime', rc_question.convertTsToString(commitExpiryTS(question_detail, last_ans['ts'])));\n                timeAgo.render(unrevealed_answer_container.find('.reveal-time.timeago'));\n                unrevealed_answer_container.find('.answerer').text(last_ans['user']);\n                const avjazzicon = jazzicon(32, parseInt(last_ans['user'].toLowerCase().slice(2, 10), 16));\n                unrevealed_answer_container.find('.answer-data__avatar').html(avjazzicon);\n            } else {\n                unrevealed_answer_container.find('.answer-bond-value').text('');\n                unrevealed_answer_container.find('.reveal-time.timeago').attr('datetime', 0);\n                unrevealed_answer_container.find('.answer-data__avatar').html('');\n                unrevealed_answer_container.find('.answerer').text('');\n                timeago.cancel(unrevealed_answer_container.find('.reveal-time.timeago')); \n            }\n\n            // TODO: Do duplicate checks and ensure order in case stuff comes in weird\n            for (let i = 0; i < idx; i++) {\n                const ans = question_detail['history'][i];\n                const hist_id = 'question-window-history-item-' + uiHash(question_id + ans.answer + ans.bond.toHexString());\n                if (rcqa.find('#' + hist_id).length) {\n                    //console.log('already in list, skipping', hist_id, ans);\n                    continue;\n                }\n                //console.log('not already in list, adding', hist_id, ans);\n                const hist_tmpl = rcqa.find('.answer-item.answered-history-item.template-item');\n                const hist_item = hist_tmpl.clone();\n                hist_item.attr('id', hist_id);\n                hist_item.find('.answerer').text(ans['user']);\n\n                const avjazzicon = jazzicon(32, parseInt(ans['user'].toLowerCase().slice(2, 10), 16));\n\n                hist_item.find('.answer-data__avatar').html(avjazzicon);\n\n                if (ans.is_commitment && !ans.revealed_block) {\n                    console.log('got a commitmet');\n                    if (isCommitExpired(question_detail, ans['ts'].toNumber())) {\n                        hist_item.find('.current-answer').text('Reveal timed out');\n                        hist_item.addClass('expired-commit');\n                    } else {\n                        hist_item.find('.current-answer').text('Wait for reveal...');\n                        hist_item.addClass('unrevealed-commit');\n                    }\n                } else {\n                    hist_item.find('.current-answer').text(rc_question.getAnswerString(question_json, ans.answer));\n                    hist_item.removeClass('unrevealed-commit');\n                }\n\n                hist_item.find('.answer-bond-value').text(decimalizedBigNumberToHuman(ans.bond));\n                hist_item.find('.answer-time.timeago').attr('datetime', rc_question.convertTsToString(ans['ts']));\n                timeAgo.render(hist_item.find('.answer-time.timeago'));\n                hist_item.removeClass('template-item');\n                hist_tmpl.after(hist_item);\n            }\n\n        }\n    }\n\n    rcqa.find('.bond-value').text(decimalizedBigNumberToHuman(question_detail.bond));\n    // Set the dispute value on a slight delay\n    // This ensures the latest entry was updated and the user had time to see it when arbitration was requested\n    window.setTimeout(function() {\n        rcqa.find('.arbitration-button').attr('data-last-seen-bond', question_detail.bond.toHexString());\n    }, 2000);\n\n    // question settings warning balloon\n    let balloon_html = '';\n    if (question_detail.timeout < 86400) {\n        balloon_html += 'The timeout is very low.<br /><br />This means there may not be enough time for people to correct mistakes or lies.<br /><br />';\n    }\n    if (isFinalized(question_detail) && question_detail.bounty.add(question_detail.bond).lt(ethers.BigNumber.from(\"\"+TOKEN_INFO[TOKEN_TICKER]['small_number']))) {\n        balloon_html += 'The reward was very low and no substantial bond was posted.<br /><br />This means there may not have been enough incentive to post accurate information.<br /><br />';\n    }\n    const valid_arbitrator = isArbitratorValidFast(question_detail.contract, question_detail.arbitrator);\n\n    if (ARBITRATOR_FAILED_BY_CONTRACT[question_detail.contract.toLowerCase()] && ARBITRATOR_FAILED_BY_CONTRACT[question_detail.contract.toLowerCase()][question_detail.arbitrator.toLowerCase()]) {\n        rcqa.addClass('failed-arbitrator');\n    }\n\n    if (!valid_arbitrator) {\n        balloon_html += 'We do not recognize this arbitrator.<br />Do not believe this information unless you trust them.';\n    }\n    if (balloon_html) {\n        rcqa.find('.question-setting-warning').css('display', 'block');\n        rcqa.find('.question-setting-warning').find('.balloon').css('z-index', ++ZINDEX);\n        rcqa.find('.question-setting-warning').find('.balloon').html(balloon_html);\n    }\n\n    let questioner = question_detail.question_creator\n    let timeout = question_detail.timeout;\n    let balloon = rcqa.find('.question-setting-info').find('.balloon')\n    balloon.find('.setting-info-bounty').text(decimalizedBigNumberToHuman(question_detail.bounty));\n    balloon.find('.setting-info-min-bond').text(decimalizedBigNumberToHuman(question_detail.min_bond));\n    balloon.find('.setting-info-bond').text(decimalizedBigNumberToHuman(question_detail.bond));\n    balloon.find('.setting-info-timeout').text(rc_question.secondsTodHms(question_detail.timeout));\n    balloon.find('.setting-info-content-hash').text(question_detail.content_hash);\n    balloon.find('.setting-info-question-id').text(question_detail.question_id);\n    balloon.find('.setting-info-contract-address').text(question_detail.contract);\n    balloon.find('.setting-info-arbitrator').text(arbitratorAddressToText(question_detail.contract, question_detail.arbitrator));\n    balloon.find('.setting-info-questioner').text(questioner);\n    balloon.find('.setting-info-created-ts').text(new Date(question_detail.creation_ts*1000).toUTCString().replace('GMT', 'UTC'));\n    let opening_ts_str = 'Unset';\n    if (question_detail.opening_ts.gt(0)) {\n        opening_ts_str = new Date(question_detail.opening_ts*1000).toUTCString().replace('GMT', 'UTC');\n    }\n    balloon.find('.setting-info-opening-ts').text(opening_ts_str);\n    balloon.css('z-index', ++ZINDEX);\n\n    const unconfirmed_container = rcqa.find('.unconfirmed-answer-container');\n    if (question_detail['history_unconfirmed'].length) {\n\n        const unconfirmed_answer = question_detail['history_unconfirmed'][question_detail['history_unconfirmed'].length - 1];\n\n        const txid = unconfirmed_answer.txid;\n        unconfirmed_container.find('.pending-answer-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        unconfirmed_container.find('.pending-answer-txid a').text(txid.substr(0, 12) + \"...\");\n        unconfirmed_container.attr('data-pending-txid', txid);\n\n        timeago.cancel(unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago')); // cancel the old timeago timer if there is one\n        unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago').attr('datetime', rc_question.convertTsToString(unconfirmed_answer.ts));\n        timeAgo.render(unconfirmed_container.find('.unconfirmed-answer-item').find('.timeago'));\n\n        // answerer data\n        const ans_data = rcqa.find('.unconfirmed-answer-container').find('.answer-data');\n        ans_data.find('.answerer').text(unconfirmed_answer.user);\n        const avjazzicon = jazzicon(32, parseInt(unconfirmed_answer.user.toLowerCase().slice(2, 10), 16));\n        ans_data.find('.answer-data__avatar').html(avjazzicon);\n        if (unconfirmed_answer.user == ACCOUNT) {\n            ans_data.addClass('unconfirmed-account');\n        } else {\n            ans_data.removeClass('unconfirmed-account');\n        }\n        ans_data.find('.answer-bond-value').text(decimalizedBigNumberToHuman(unconfirmed_answer.bond));\n\n        // label for show the unconfirmed answer.\n        const label = rc_question.getAnswerString(question_json, unconfirmed_answer.answer);\n        unconfirmed_container.find('.unconfirmed-answer-body').find('.unconfirmed-answer').text(label);\n\n        rcqa.addClass('has-unconfirmed-answer');\n\n    } else {\n\n        rcqa.removeClass('has-unconfirmed-answer');\n\n    }\n\n    // Arbitrator\n    if (question_detail.arbitrator.toLowerCase() == question_detail.contract.toLowerCase()) {\n        rcqa.addClass('no-arbitrator');\n    } else if (!isArbitrationPending(question_detail) && !isFinalized(question_detail)) {\n        console.log('getting arb stuff')\n        const arb = ARBITRATOR_INSTANCE.attach(question_detail.arbitrator);\n        // Normal arbitrators should respond correctly to getDisputeFee()\n        arb.functions.getDisputeFee(question_id).then(function(fee_arr) {\n            const fee = fee_arr[0];\n            console.log('got arbitration fee, rendering', fee)\n            //rcqa.find('.arbitrator').text(question_detail.arbitrator);\n            rcqa.find('.arbitration-fee').text(decimalizedBigNumberToHuman(fee, true));\n            rcqa.find('.arbitration-button').removeClass('unpopulated');\n            if (CHAIN_INFO.nativeCurrency && CHAIN_INFO.nativeCurrency.symbol) {\n                rcqa.find('.token-always-native').text(CHAIN_INFO.nativeCurrency.symbol);\n            }\n        }).catch(async function(err) {\n            // If it doesn't implement the getDisputeFee method, we might want to use foreignProxy\n            // If anything about this fails we just mark the arbitrator failed and tell the user to be careful.\n            // TODO: We should really be initially loading the metadata\n            // This will tell us if we have a foreign proxy or not\n\n            // Non-standard arbitrators should tell us how they're non-standard with their metadata\n            // console.log('caught error with getDisputeFee, question was', question_detail, err);\n            const metadata = await loadArbitratorMetaData(question_detail.arbitrator);\n            if (metadata.foreignProxy) {\n                const fp_abi = [\n                  \"function foreignProxy() view returns (address)\",\n                  \"function foreignChainId() view returns (uint256)\"\n                ];\n                const fpArb = new ethers.Contract(question_detail.arbitrator, fp_abi, provider);\n                const foreign_proxy_arr = await fpArb.functions.foreignProxy();\n                const foreign_proxy = foreign_proxy_arr[0];\n                console.log('using foreign proxy', foreign_proxy);\n                const foreign_chain_id_arr = await fpArb.functions.foreignChainId()\n                const foreign_chain_id = foreign_chain_id_arr[0].toNumber();\n                const btn = rcqa.find('.arbitration-button-foreign-proxy');\n                btn.click(async function(evt) {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n\n                    updateLastActionTS();\n\n                    const question_latest = await ensureQuestionDetailFetched(question_detail.contract, question_detail.question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n                    if (!question_latest) {\n                        console.log('Error, question detail not found');\n                        return false;\n                    }\n                    if (question_latest.bond.eq(0)) {\n                        $('body').addClass('error-request-arbitration-without-answer-error').addClass('error');\n                        return false;\n                    }\n                    const url_data = question_latest;\n                    url_data['network_id'] = foreign_chain_id\n                    url_data['foreign_proxy'] = foreign_proxy;\n                    //delete url_data['history_unconfirmed'];\n                    console.log('fpwin', url_data);\n                    const proxy_url = 'index.html#!/foreign-proxy/' + encodeURIComponent(JSON.stringify(url_data));\n                    console.log('proxy_url', proxy_url);\n                    window.open(proxy_url);\n                });\n                btn.removeClass('unpopulated').attr('data-foreign-proxy', foreign_proxy).attr('data-foreign-chain-id', foreign_chain_id);\n            } else {\n                // If it doesn't implement foreign proxy either, it's a contract or address without the proper interface.\n                // console.log('arbitrator failed with error', err);\n                markArbitratorFailed(question_detail.contract, question_detail.arbitrator, contractQuestionID(question_detail));\n            }\n        });\n    }\n\n    if (isQuestionBeforeOpeningDate(question_detail)) {\n        rcqa.find('.add-reward-button').removeClass('is-open')\n    } else {\n        rcqa.find('.add-reward-button').addClass('is-open')\n    }\n    \n    if (!is_refresh) {\n        // answer form\n        const ans_frm = makeSelectAnswerInput(question_json, question_detail.opening_ts.toNumber(), question_detail.has_invalid_option, question_detail.has_too_soon_option);\n        ans_frm.addClass('is-open');\n        ans_frm.removeClass('template-item');\n        rcqa.find('.answered-history-container').after(ans_frm);\n    }\n\n    // If the user has edited the field, never repopulate it underneath them\n    const bond_field = rcqa.find('.rcbrowser-input--number--bond.form-item');\n    if (!bond_field.hasClass('edited')) {\n        // console.log('min bond /2', bond.toString());\n        bond_field.val(decimalizedBigNumberToHuman(bond.mul(2)));\n    }\n\n    rcqa = updateQuestionState(question_detail, rcqa);\n\n    if (isFinalized(question_detail)) {\n        const tot = totalClaimable(question_detail);\n        if (tot.eq(0)) {\n            rcqa.removeClass('is-claimable');\n        } else {\n            rcqa.addClass('is-claimable');\n            rcqa.find('.answer-claim-button .claimable-eth').text(decimalizedBigNumberToHuman(tot));\n        }\n    } else {\n        rcqa.removeClass('is-claimable');\n    }\n\n    if (question_json.type == 'datetime') {\n        let precision = 'd';\n        if ('precision' in question_json) {\n            precision = question_json['precision']; \n        }\n        rcqa.attr('data-datetime-precision', precision);\n    }\n    \n    setupDatetimeDatePicker(rcqa);\n\n    //console.log(claimableItems(question_detail));\n\n    return rcqa;\n\n}\n\nfunction totalClaimable(question_detail) {\n    const poss = possibleClaimableItems(question_detail);\n    return poss['total'];\n}\n\nfunction possibleClaimableItems(question_detail) {\n\n    let ttl = ethers.BigNumber.from(0);\n    let is_your_claim = false;\n\n    if (ethers.BigNumber.from(question_detail.history_hash).eq(0)) {\n        //console.log('everything already claimed', question_detail.history_hash);\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    if (!isFinalized(question_detail)) {\n        //console.log('not finalized', question_detail);\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    //console.log('should be able to claim question ', question_detail);\n    //console.log('history_hash', question_detail.history_hash);\n\n    let question_ids = [];\n    let answer_lengths = [];\n    let claimable_bonds = [];\n    let claimable_answers = [];\n    let claimable_answerers = [];\n    let claimable_history_hashes = [];\n\n    let is_first = true;\n    let num_claimed = 0;\n    let is_yours = false;\n\n    let final_answer = question_detail.best_answer;\n    if (final_answer == null) {\n        console.log('skipping item with no final answer due to commit-reveal stuff');\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n\n\n//console.log('final_answer', question_detail.best_answer, question_detail);\n    for (let i = question_detail['history'].length - 1; i >= 0; i--) {\n\n        // TODO: Check the history hash, and if we haven't reached it, keep going until we do\n        // ...since someone may have claimed partway through\n\n        // console.log('considering claimable from', question_detail['history'][i]);\n        let answer = null;\n        // Only set on reveal, otherwise the answer field still holds the commitment ID for commitments\n        if (question_detail['history'][i].commitment_id) { \n            answer = question_detail['history'][i].commitment_id;\n        } else {\n            answer = question_detail['history'][i].answer;\n        }\n        const answerer = question_detail['history'][i].user;\n        const bond = question_detail['history'][i].bond;\n        const history_hash = question_detail['history'][i].history_hash;\n\n        const is_answerer_you = (ACCOUNT && (answerer.toLowerCase() == ACCOUNT.toLowerCase()));\n        if (is_yours) {\n            // Somebody takes over your answer\n            if (!is_answerer_you && final_answer == answer) {\n                is_yours = false;\n                //console.log(ttl.toString(), 'sub', bond.toString());\n                ttl = ttl.sub(bond); // pay them their bond\n            } else {\n                //console.log(ttl.toString(), 'add', bond.toString());\n                ttl = ttl.add(bond); // take their bond\n            }\n        } else {\n            // You take over someone else's answer\n//console.log('compare answers', final_answer, answer);\n            if (is_answerer_you && final_answer == answer) {\n                is_yours = true;\n                //console.log(ttl.toString(), 'add', bond.toString());\n                ttl = ttl.add(bond); // your bond back\n            }\n        }\n        if (is_first && is_yours) {\n            // console.log('adding your bounty');\n            //console.log(ttl.toString(), 'add', question_detail.bounty.toString());\n            ttl = ttl.add(question_detail.bounty);\n        }\n\n        claimable_bonds.push(bond);\n        claimable_answers.push(answer);\n        claimable_answerers.push(answerer);\n        claimable_history_hashes.push(history_hash);\n\n        is_first = false;\n    }\n\n    // Nothing for you to claim, so return nothing\n    if (!ttl.gt(0)) {\n    //console.log('claimable returns nothing');\n        return {\n            total: ethers.BigNumber.from(0)\n        };\n    }\n\n    question_ids.push(question_detail.question_id);\n    answer_lengths.push(claimable_bonds.length);\n\n    //console.log('item 0 should match question', claimable_history_hashes[0], question_detail.history_hash);\n\n    // For the history hash, each time we need to provide the previous hash in the history\n    // So delete the first item, and add 0x0 to the end.\n    claimable_history_hashes.shift();\n    claimable_history_hashes.push(\"0x0000000000000000000000000000000000000000000000000000000000000000\");\n\n    // TODO: Someone may have claimed partway, so we should really be checking against the contract state\n\n    const ret = {\n        'txid': null,\n        'total': ttl,\n        'question_ids': question_ids,\n        'answer_lengths': answer_lengths,\n        'answers': claimable_answers,\n        'answerers': claimable_answerers,\n        'bonds': claimable_bonds,\n        'history_hashes': claimable_history_hashes\n    }\n\n //   console.log('claimable returns', ret);\n\n    return ret;\n\n}\n\nfunction renderTimeAgo(i, ts) {\n    const old_attr = i.find('.timeago').attr('datetime');\n    if (old_attr != '') {\n        timeago.cancel(i.find('.timeago'));\n    }\n    i.find('.timeago').attr('datetime', rc_question.convertTsToString(ts));\n    timeAgo.render(i.find('.timeago'));\n}\n\n// Anything in the document with this class gets updated\n// For when there's a single thing changed, and it's not worth doing a full refresh\nfunction updateAnyDisplay(contract_question_id, txt, cls) {\n    $(\"[data-contract-question-id='\" + contract_question_id + \"']\").find('.' + cls).text(txt);\n}\n\n/*\nFinds any item with timeago and the given block number\nFetches the timestamp for the block if not already cached\nPopulates the timestamp attribute\nCalls the callback on it\n*/\nfunction populateWithBlockTimeForBlockNumber(item, num, cbk) {\n\n    if (BLOCK_TIMESTAMP_CACHE[num]) {\n        cbk(item, BLOCK_TIMESTAMP_CACHE[num]);\n    } else {\n        provider.getBlock('latest', function(err, result) {\n            if (err || !result) {\n                console.log('getBlock err', err, result);\n                return;\n            }\n            BLOCK_TIMESTAMP_CACHE[num] = result.timestamp\n            cbk(item, result.timestamp);\n        });\n    }\n\n}\n\nfunction answersByMaxBond(answer_logs) {\n    let ans = {};\n    for (let i = 0; i < answer_logs.length; i++) {\n        const an = answer_logs[i];\n        const aval = an.answer;\n        const bond = an.bond;\n        if (ans[aval] && ans[aval].bond.gt(bond)) {\n            continue;\n        }\n        ans[aval] = an;\n    }\n    return ans;\n}\n\nfunction resetAccountUI() {\n    USER_CLAIMABLE_BY_CONTRACT = {};\n    Q_MIN_ACTIVITY_BLOCKS = {};\n    $('#your-question-answer-window').find('.account-specific').remove();\n    $('.answer-claim-button.claim-all').find('.claimable-eth').text('');\n    $('.answer-claim-button.claim-all').hide();\n}\n\nfunction insertNotificationItem(evt, notification_id, ntext, block_number, contract, question_id, is_positive, timestamp) {\n\n    // console.log('insertNotificationItem', evt, notification_id, ntext, block_number, contract, question_id, is_positive, timestamp);\n\n    if ($('.no-notifications-item').length > 0) {\n        $('.no-notifications-item').remove();\n        $('.see-all-notifications').css('visibility', 'visible');\n    }\n\n    const notifications = $('#your-question-answer-window').find('.notifications');\n    if (document.getElementById(notification_id)) {\n        // Already in the doc;\n        return true;\n    }\n\n    //console.log('insertNotificationItem has contractd', contract,' from evt', evt);\n\n    const existing_notification_items = notifications.find('.notifications-item');\n\n    const item_to_insert = $('#your-question-answer-window .notifications-template-container .notifications-item.template-item').clone();\n    item_to_insert.addClass('notification-event-' + evt);\n    item_to_insert.attr('id', notification_id);\n    if (question_id) {\n        item_to_insert.attr('data-contract-question-id', cqToID(contract, question_id));\n    }\n    item_to_insert.find('.notification-text').text(ntext).expander();\n    item_to_insert.attr('data-timestamp', timestamp);\n    item_to_insert.removeClass('template-item').addClass('populated-item');\n    item_to_insert.addClass('account-specific');\n\n    // Template item has a positive badge\n    // Turn it from green to red if something bad happened\n    if (!is_positive) {\n        item_to_insert.find('.notification-badge').removeClass('notification-badge--positive').addClass('notification-badge--negative');\n    }\n\n    let inserted = false;\n    existing_notification_items.each(function() {\n        const exi = $(this);\n        //console.log('compare', exi.attr('data-block-number'),' with our block number', block_number);\n        if (ethers.BigNumber.from(exi.attr('data-timestamp')).lte(ethers.BigNumber.from(timestamp))) {\n            exi.before(item_to_insert);\n            inserted = true;\n            return false;\n        }\n        return true;\n    });\n\n    if (!inserted) {\n        notifications.append(item_to_insert);\n    }\n\n    renderTimeAgo(item_to_insert, timestamp);\n\n}\n\n// We use the standard ethereum hashing for IDs used in the UI but we could use anything, it's just to make unique IDs\nfunction uiHash(str) {\n    return ethers.utils.solidityKeccak256([\"string\"], [str]);\n}\n\nfunction userInvolvement(question) {\n    console.log('TODO: go through this question and find out what the user did');\n    if (!ACCOUNT) {\n        return false;\n    }\n    const acc = ACCOUNT.toLowerCase();\n    if (question.user.toLowerCase() == acc) {\n        //return true;\n    }\n    for(let i = 0; i< question.history.length; i++) {\n       console.log('hh', question.history[i]); \n    }\n    return false;\n\n}\n\n// Finalization doesn't create an event (unless triggered by arbitration).\n// So add the notification if required based on the (filled) question.\nfunction insertFinalizationNotification(question, q_involvement) {\n    // console.log('insert Finalization notification for', question, q_involvement);\n\n    const q_title = question.question_json['title'];\n    if (!q_title) {\n        console.log('Skipping notification for question with no title', question);\n        return;\n    }\n\n    let ntext = '';\n    if (q_involvement['asked']) {\n        ntext = 'A question you asked was finalized - ' + q_title;\n    } else if (q_involvement['answered']) {\n        ntext = 'A question you answered was finalized - ' + q_title;\n    } else if (q_involvement['funded']) {\n        ntext = 'A question you funded was finalized - ' + q_title;\n    } else if (q_involvement['arbitration']) {\n        ntext = 'A question you requested arbitration for was finalized - ' + q_title;\n    } else {\n        ntext = 'A question you were somehow involved in was finalized - ' + q_title;\n    }\n\n    // TODO: see if createdBlock is what we want  - if we don't have the block for finalization then see if we can avoid using blocks completely for ordering notifications\n    insertNotificationItem('FinalizeQuestion', 'user-action-finalize-'+contractQuestionID(question), ntext, question.question_created_block, question.contract, question.question_id, true, question.finalization_ts);\n}\n\n\nfunction renderNotificationsGraph(entry, fetched_ms) {\n\n    // This is the only case that doesn't involve a question\n    if (entry.actionType == 'CreateTemplate') {\n        ntext = 'You created a template - ' + entry.template.templateId + ': ' + entry.template.questionText;\n        insertNotificationItem('CreateTemplate', 'user-action-CreateTemplate-'+entry.id, ntext, entry['createdBlock'], entry.address, null, true, entry['createdTimestamp']);\n        return;\n    }\n\n    let question = filledQuestion(entry.question, fetched_ms);\n    if (!question) {\n        console.log('skipping notification for unparseable question');\n        return;\n    }\n\n    updateClaimableDataForQuestion(question);\n\n    const contract = question.contract;\n    const question_id = question.question_id;\n    //console.log('renderNotification', action, entry, qdata);\n\n    const question_json = question.question_json;\n\n    const your_qa_window = $('#your-question-answer-window');\n\n    // TODO: Handle whether you asked the question\n\n    let ntext = '';\n    const evt = entry['actionType']\n    let is_positive = true;\n    const notification_id = 'user-action-'+evt+'-'+entry.id;\n    // console.log('evt', evt);\n\n    if (!question_json) {\n        console.log('missing question_json for question, skipping notification', question);\n        return;\n    } else if (!question_json['title']) {\n        console.log('missing title for question, skipping notification', question, question_json);\n        return;\n    }\n\n    let q_involvement = {};\n\n    switch (evt) {\n        case 'AskQuestion':\n            ntext = 'You asked a question - \"' + question_json['title'] + '\"';\n            insertNotificationItem(evt, notification_id, ntext, entry.createdBlock, contract, question.question_id, true, entry['createdTimestamp']);\n            renderUserQandA(question, entry); \n            q_involvement['asked'] = true;\n            break;\n\n        case 'AnswerQuestion':\n            if (entry.user.toLowerCase() == ACCOUNT.toLowerCase()) {\n                if (entry.isCommitment && !entry.revealedBlock) {\n                    ntext = 'You committed to answering a question - \"' + question_json['title'] + '\"';\n                } else {\n                    if (entry.question.user == ACCOUNT) {\n                        ntext = 'You answered your own question - \"' + question_json['title'] + '\"';\n                    } else {\n                        ntext = 'You answered a question - \"' + question_json['title'] + '\"';\n                    }\n                }\n                insertNotificationItem(evt, notification_id, ntext, entry.createdBlock, contract, question.question_id, true, entry['createdTimestamp']);\n                renderUserQandA(question, entry); \n                q_involvement['answered'] = true;\n            } else {\n                // We should have all the answers in the question object\n                // NB We may have two notifications for this if somebody answers your question, overwriting your answer\n                // One of the cases has a tweaked notification ID for this case.\n                if (entry.question.user == ACCOUNT) {\n                    ntext = 'Someone answered your question - \"' + question_json['title'] + '\"';;\n                    insertNotificationItem(evt, notification_id+'-yourq', ntext, entry.blockNumber, contract, entry.question_id, true, entry['createdTimestamp']);\n                }\n                // TODO: Handle overwritten or not\n                const responses = entry.responses;\n                // Find out the point at which you start to care about this\n                let is_relevant_from = null;\n                for(const resp in responses) {\n                    if (resp.user == ACCOUNT) {\n                        is_relevant_from = ethers.BigNumber.from(entry.bond);;\n                        break;\n                    }\n                }\n                if (is_relevant_from) {\n                    const bond = ethers.BigNumber.from(entry.bond);\n                    if (bond.gt(is_relevant_from)) {\n                        ntext = 'Your answer was overwritten - \"' + question_json['title'] + '\"';;;\n                    }\n                }\n\n            }\n            break;\n\n        case 'FundAnswerBounty':\n            if (entry.user.toLowerCase() == ACCOUNT.toLowerCase()) {\n                ntext = 'You added reward - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.question_id, true, entry['createdTimestamp']);\n                q_involvement['funded'] = true;\n            } else {\n                ntext = 'Someone added a reward to the question - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.question_id, true, entry['createdTimestamp']);\n            }\n            break;\n\n        case 'RequestArbitration':\n            if (entry.user.toLowerCase() == ACCOUNT.toLowerCase()) {\n                ntext = 'You requested arbitration - \"' + question_json['title'] + '\"';\n                insertNotificationItem(evt, notification_id, ntext, entry.blockNumber, contract, entry.question_id, true, entry['createdTimestamp']);\n                q_involvement['arbitration'] = true;\n            } else {\n                ntext = 'Someone requested arbitration - \"' + question_json['title'] + '\"';\n            }\n            break;\n    }\n\n    // There isn't an event for this (except in case of arbitration), so just add a notification if we were involved in the question\n    if (isFinalized(question)) {\n        insertFinalizationNotification(question, q_involvement);\n    }\n\n}\n\nfunction insertQAItem(contract, question_id, item_to_insert, question_section, block_number, ts) {\n\n    const contract_question_id = cqToID(contract, question_id);\n    question_section.find('.your-qa__questions__item[data-contract-question-id=' + contract_question_id + ']').remove();\n\n    const question_items = question_section.find('.your-qa__questions__item');\n    let inserted = false;\n    question_items.each(function(idx, item) {\n        if ($(item).hasClass('template-item')) {\n            return true;\n        }\n        if ($(item).attr('data-block-number') <= block_number) {\n            $(item).before(item_to_insert);\n            inserted = true;\n            //console.log('inserted in loop');\n            return false;\n        } else {\n            return true;\n        }\n    });\n    if (!inserted) {\n        question_section.append(item_to_insert);\n        //console.log('inserted through fall through');\n    }\n    populateWithBlockTimeForBlockNumber(item_to_insert, block_number, renderTimeAgo);\n\n}\n\nfunction renderQAItemAnswer(contract, question_id, answer_history, question_json, is_finalized) {\n    const question_section = $('#your-question-answer-window').find('.your-qa__questions');\n    const answer_section = $('#your-question-answer-window').find('.your-qa__answers');\n    const sections = [question_section, answer_section];\n    const contract_question_id = cqToID(contract, question_id);\n\n    sections.forEach(function(section) {\n        const target = section.find('div[data-contract-question-id=' + contract_question_id + ']');\n        if (answer_history.length > 0) {\n            let user_answer;\n            for (let i = answer_history.length - 1; i >= 0; i--) {\n                if (answer_history[i].user.toLowerCase() == ACCOUNT.toLowerCase()) {\n                    user_answer = answer_history[i].answer;\n                    break;\n                }\n            }\n            let latest_answer = answer_history[answer_history.length - 1].answer;\n            target.find('.latest-answer-text').text(rc_question.getAnswerString(question_json, latest_answer));\n            if (typeof user_answer !== 'undefined') {\n                target.find('.user-answer-text').text(rc_question.getAnswerString(question_json, user_answer));\n            } else {\n                target.find('.your-qa__questions__item-body--user').css('display', 'none');\n            }\n\n            if (user_answer == latest_answer) {\n                target.find('.different-latest-answer-container').hide();\n            }\n\n            target.find('.your-qa__questions__item-body--latest').css('display', 'block');\n        } else {\n            target.find('.your-qa__questions__item-body--latest').css('display', 'none');\n            target.find('.your-qa__questions__item-body--user').css('display', 'none');\n        }\n\n        if (is_finalized) {\n            target.find('.your-qa__questions__item-status').addClass('.your-qa__questions__item-status--resolved');\n            target.find('.your-qa__questions__item-status').text('Resolved');\n        } else {\n            target.find('.your-qa__questions__item-status').text(answer_history.length + ' Answers');\n        }\n    });\n\n}\n\nfunction renderUserQandA(question, entry) {\n    const question_id = question.question_id;\n    const answer_history = question['history'];\n\n    const question_json = question.question_json;\n    const contract_question_id = contractQuestionID(question);\n\n    let question_section;\n    if (entry['actionType'] == 'AskQuestion') {\n        question_section = $('#your-question-answer-window').find('.your-qa__questions .your-qa__questions-inner');\n    } else if (entry['actionType'] == 'AnswerQuestion') {\n        question_section = $('#your-question-answer-window').find('.your-qa__answers .your-qa__answers-inner');\n    }\n    if (question_section.find('.no-your-qa__questions__item').length > 0) {\n        question_section.find('.no-your-qa__questions__item').remove();\n    }\n\n    const qitem = question_section.find('.your-qa__questions__item.template-item').clone();\n    qitem.attr('data-contract-question-id', contract_question_id);\n    qitem.find('.question-text').text(question_json['title']).expander();\n    qitem.attr('data-block-number', entry.createdBlock);\n    qitem.removeClass('template-item');\n    qitem.addClass('account-specific');\n    insertQAItem(question.contract, question_id, qitem, question_section, question.createdBlock, question.createdTimestamp);\n\n    const is_finalized = isFinalized(question);\n    renderQAItemAnswer(question.contract, question_id, answer_history, question_json, is_finalized);\n\n    let date = new Date();\n    date.setTime(entry.createdTimestamp * 1000);\n    let date_str = MONTH_LIST[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear() +\n        ' ' + date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();\n    qitem.find('.item-date').text(date_str);\n}\n\nfunction makeSelectAnswerInput(question_json, opening_ts, has_invalid, has_answered_too_soon) {\n    const type = question_json['type'];\n    const options = question_json['outcomes'];\n\n    let ans_frm;\n    if (opening_ts && isBeforeOpeningDate(opening_ts)) {\n        const template_name = '.answer-form-container.before-opening.template-item';\n        ans_frm = $(template_name).clone();\n        ans_frm.removeClass('template-item');\n        ans_frm.find('.opening-time-label .timeago').attr('datetime', rc_question.convertTsToString(opening_ts));\n        timeAgo.render(ans_frm.find('.opening-time-label .timeago'));\n    } else {\n        const template_name = '.answer-form-container.' + question_json['type'] + '.template-item';\n        ans_frm = $(template_name).clone();\n        ans_frm.removeClass('template-item');\n\n        switch (type) {\n            case 'single-select':\n                for (let i = 0; i < options.length; i++) {\n                    const option_elm = $('<option>');\n                    option_elm.val(i);\n                    option_elm.text(options[i]);\n                    ans_frm.find('.select-answer').find('.invalid-select').before(option_elm);\n                }\n                break;\n            case 'multiple-select':\n                for (let i = options.length - 1; i >= 0; i--) {\n                    const elmtpl = ans_frm.find('.input-entry.template-item');\n                    const elm = elmtpl.clone();\n                    elm.removeClass('template-item');\n                    const elinput = elm.find('input');\n                    elinput.attr('name', 'input-answer');\n                    elinput.val(i);\n                    const ellabel = elm.find('span');\n                    ellabel.text(options[i]);\n                    // Here we copy the content and throw away the container\n                    elmtpl.after(elm);\n                }\n                break;\n        }\n    }\n\n    if (!has_invalid) {\n        ans_frm.find('.invalid-select').remove();\n    }\n    if (!has_answered_too_soon) {\n        ans_frm.find('.too-soon-select').remove();\n    }\n\n    return ans_frm;\n}\n\n// show final answer button\n// TODO: Pass in the current data from calling question if we have it to avoid the unnecessary call\nfunction updateQuestionState(question, question_window) {\n    if (isAnswered(question)) {\n        question_window.addClass('has-answer');\n    } else {\n        question_window.removeClass('has-answer');\n    }\n\n    if (hasUnrevealedCommits(question)) {\n        question_window.addClass('has-unrevealed-commits');\n    } else {\n        question_window.removeClass('has-unrevealed-commits');\n    }\n\n    if (isTopAnswerRevealable(question)) {\n        question_window.addClass('top-entry-unrevealed');\n    } else {\n        question_window.removeClass('top-entry-unrevealed');\n    }\n\n    if (isAnsweredOrAnswerActive(question)) {\n        if (isFinalized(question)) {\n            timeago.cancel(question_window.find('.resolved-at-value.timeago'));\n            question_window.find('.resolved-at-value').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(question_window.find('.resolved-at-value.timeago')); // TODO: Does this work if we haven't displayed the item yet?\n        } else {\n            timeago.cancel(question_window.find('.answer-deadline.timeago'));\n            question_window.find('.answer-deadline').attr('datetime', rc_question.convertTsToString(question.finalization_ts));\n            timeAgo.render(question_window.find('.answer-deadline.timeago')); // TODO: Does this work if we haven't displayed the item yet?\n        }\n    } \n\n    // The first item is the current answer\n    // However we don't show it as current answer if it's unrevealed\n    if (question['history'].length > 1 || (question['history'].length  == 1 && hasUnrevealedCommits(question) ) ) {\n        question_window.addClass('has-history');\n    } else {\n        question_window.removeClass('has-history');\n    }\n\n    if (isArbitrationPending(question)) {\n        question_window.removeClass('question-state-open').addClass('question-state-pending-arbitration').removeClass('question-state-finalized');\n    } else {\n        if (!isFinalized(question)) {\n            question_window.addClass('question-state-open').removeClass('question-state-pending-arbitration').removeClass('question-state-finalized');\n        } else {\n            question_window.removeClass('question-state-open').removeClass('question-state-pending-arbitration').addClass('question-state-finalized');\n        }\n    }\n\n    return question_window;\n\n}\n\nfunction isBeforeOpeningDate(opening_ts) {\n    const opening_date = opening_ts * 1000\n    const now = new Date();\n    \n    return now.getTime() < opening_date\n}\n\nfunction isQuestionBeforeOpeningDate(question_detail) {    \n    return isBeforeOpeningDate(question_detail.opening_ts.toNumber())\n}\n\n// TODO\n// This is currently not called, as we just fetch everything back from logs\n// Potentially resurrect it with a more efficient flow\n// Also potentially do it before confirmation (See issue #44)\nfunction pushWatchedAnswer(answer) {\n    const question_id = answer.question_id;\n    let already_exists = false;\n    const length = QUESTION_DETAIL_CACHE[question_id]['history'].length;\n\n    for (let i = 0; i < length; i++) {\n        if (QUESTION_DETAIL_CACHE[question_id]['history'][i].answer == answer.answer) {\n            already_exists = true;\n            break;\n        }\n    }\n\n    if (!already_exists) {\n        QUESTION_DETAIL_CACHE[question_id]['history'].push(answer);\n    }\n}\n\n$(document).on('click', '.answer-item', function() {\n\n    updateLastActionTS();\n\n    //console.log('.answer-item clicked');\n    if ($(this).find('.answer-data').hasClass('is-bounce')) {\n        $(this).find('.answer-data').removeClass('is-bounce');\n        $(this).find('.answer-data').css('display', 'none');\n    } else {\n        $(this).find('.answer-data').addClass('is-bounce');\n        $(this).find('.answer-data').css('display', 'block');\n    }\n});\n\n// Do an initial validity check\nfunction isAnswerInputLookingValid(parent_div, question_json) {\n\n    if (parent_div.find('.invalid-selected').length > 0) {\n        return true;\n    }\n    if (parent_div.find('.too-soon-selected').length > 0) {\n        return true;\n    }\n\n    const answer_element = parent_div.find('[name=\"input-answer\"]');\n    if (question_json['type'] == 'uint') {\n        if (answer_element.val() == '') {\n            console.log('empty number');\n            return false;\n        } \n    } else if (question_json['type'] == 'bool') {\n        if ((answer_element.val() == '') || (answer_element.val() == 'default')) {\n            console.log('empty bool');\n            return false;\n        } \n    } else if (question_json['type'] == 'datetime') {\n        const dt_invalids = areDatetimeElementsInvalid(answer_element);            \n        if (dt_invalids[0] || dt_invalids[1]) {\n            console.log('bad datetime');\n            return false;\n        }\n    }\n    return true;\n\n}\n\nfunction formattedAnswerFromForm(parent_div, question_json) {\n\n    let new_answer;\n    const answer_element = parent_div.find('[name=\"input-answer\"]');\n\n    // Selects will just have \"invalid\" as an option in the pull-down.\n    // However, if there is no select we instead use a link underneath the input, and toggle the data-invalid-selected class on the input\n    const has_invalid_selection = (answer_element.attr('data-invalid-selected') == '1');\n    if (has_invalid_selection) {\n        new_answer = rc_question.getInvalidValue(question_json);\n        console.log('invalid selected, so submitting the invalid value ', new_answer);\n        return new_answer;\n    }\n\n    // Selects will just have \"invalid\" as an option in the pull-down.\n    // However, if there is no select we instead use a link underneath the input, and toggle the data-invalid-selected class on the input\n    const has_answered_too_soon_select = (answer_element.attr('data-too-soon-selected') == '1');\n    if (has_answered_too_soon_select) {\n        new_answer = rc_question.getAnsweredTooSoonValue(question_json);\n        console.log('answered too soon selected, so submitting the answered too soon value ', new_answer);\n        return new_answer;\n    }\n\n    if (question_json['type'] == 'multiple-select') {\n        let answer_input = [];\n        parent_div.find('.input-container--checkbox input[type=checkbox]').each(function() {\n            if ($(this).closest('label').hasClass('template-item')) {\n                return;\n            }\n            answer_input.push($(this).is(':checked'));\n        });\n        new_answer = rc_question.answerToBytes32(answer_input, question_json);\n    } else if (question_json['type'] == 'datetime') {\n        if (answer_element.val() == '') {\n            return null;\n        }\n        const ts = datetimeElementToTS(answer_element);\n        new_answer = rc_question.answerToBytes32(ts, question_json);\n    } else {\n        new_answer = rc_question.answerToBytes32(answer_element.val(), question_json);\n    }\n    console.log('submitting answer', new_answer);\n    return new_answer;\n\n}\n\nfunction areDatetimeElementsInvalid(answer_element) {\n    const precision = answer_element.attr('data-precision');\n    let ts;\n    let is_date_invalid = false;\n    let is_time_invalid = false;\n    try {\n        const dval = answer_element.val();\n        if (dval == '') {\n            throw new Exception(\"Date empty\");\n        }\n        let answer_date = new Date(dval);\n        ts = answer_date.getTime() / 1000;\n    } catch (e) {\n        is_date_invalid = true; \n    }\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        let time_element = answer_element.closest('.input-container').find('input.datetime-input-time');\n        let timets;\n        try {\n            const tval = time_element.val();\n            if (tval == '') {\n                throw new Exception(\"time empty\");\n            }\n            const dtd = new Date('1970-01-02T' + tval + 'Z'); // Use 02 not 01 because I'm not sure what happens if we're ahead of utc\n            timets = (dtd.getTime() / 1000) - 86400;\n        } catch (e) {\n            is_time_invalid = true;\n        }\n        //console.log('made time', timets);\n        // ts = ts + timets;\n    }\n    return [is_date_invalid, is_time_invalid];\n}\n\nfunction datetimeElementToTS(answer_element) {\n    let answer_date = new Date(answer_element.val());\n    let ts = answer_date.getTime() / 1000;\n    const precision = answer_element.attr('data-precision');\n    if (precision == 'H' || precision == 'i' || precision == 's') {\n        let time_element = answer_element.closest('.input-container').find('input.datetime-input-time');\n        //console.log('time el is ', time_element, 'val is ',time_element.val());\n        const dtd = new Date('1970-01-02T' + time_element.val()+ 'Z'); // Use 02 not 01 because I'm not sure what happens if we're ahead of utc\n        const timets = (dtd.getTime() / 1000) - 86400;\n        //console.log('made time', timets);\n        ts = ts + timets;\n    }\n    return ts; \n}\n\n// post an answer\n$(document).on('click', '.post-answer-button', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const parent_div = $(this).parents('div.rcbrowser--qa-detail');\n    await getAccount()\n\n    const contract_question_id = parent_div.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n\n    let bond = ethers.BigNumber.from(0);\n    const bond_field = parent_div.find('input[name=\"questionBond\"]');\n    try {\n        bond = humanToDecimalizedBigNumber(bond_field.val());\n    } catch (err) {\n        console.log('Could not parse bond field value', bond_field.val());\n    }\n    console.log('continuing with bond as ', bond.toString());\n    let is_err = false;\n\n    const block_before_send = CURRENT_BLOCK_NUMBER;\n\n    // console.log('refetching');\n    const question = ensureQuestionDetailFetched(contract, question_id, 0)\n    .catch(function() {\n        // If the question is unconfirmed, go with what we have\n        console.log('caught failure, trying unconfirmed');\n        return ensureQuestionDetailFetched(contract, question_id, 0)\n    })\n    .then(function(current_question) {\n        // console.log('refetching done');\n        //console.log('got current_question', current_question);\n\n        let current_answer;\n        let new_answer;\n\n        // This may not be defined for an unconfirmed question\n        if (current_question.bond == null) {\n            current_question.bond = ethers.BigNumber.from(0);\n        }\n\n        const question_json = current_question.question_json;\n        //console.log('got question_json', question_json);\n\n        if (!isAnswerInputLookingValid(parent_div, question_json)) {\n            parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n            return;\n        }\n\n\n        const minNum = ethers.BigNumber.from('0x'+rc_question.minNumber(question_json).integerValue().toString(16));\n        const maxNum = ethers.BigNumber.from('0x'+rc_question.maxNumber(question_json).integerValue().toString(16));\n        new_answer = formattedAnswerFromForm(parent_div, question_json);\n        const invalid_value = rc_question.getInvalidValue(question_json);\n        const answered_too_soon_value = rc_question.getAnsweredTooSoonValue(question_json);\n\n        let ans;\n        let err = false;\n        switch (question_json['type']) {\n            case 'bool':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (err || !(ans.eq(ethers.BigNumber.from(0)) || ans.eq(ethers.BigNumber.from(1)) || ans.eq(ethers.BigNumber.from(invalid_value)) || ans.eq(ethers.BigNumber.from(answered_too_soon_value)))) {\n                    parent_div.find('div.select-container.select-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'uint':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (!err) {\n                    if (!ans.eq(ethers.BigNumber.from(invalid_value)) && !ans.eq(ethers.BigNumber.from(answered_too_soon_value)) && (ans.lt(minNum) || ans.gt(maxNum))) {\n                        err = true;\n                    } else if (ans.lt(ethers.BigNumber.from(0))) {\n                        err = true;\n                    }\n                }\n                if (err) {\n                    parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'int':\n                try {\n                    ans = ethers.BigNumber.from(new_answer);\n                } catch(e) {\n                    err = true;\n                }\n                if (!err) {\n                    if (!ans.eq(ethers.BigNumber.from(invalid_value)) && !ans.eq(ethers.BigNumber.from(answered_too_soon_value)) && (ans.lt(minNum) || ans.gt(maxNum))) {\n                        err = true;\n                    }\n                }\n                if (err) {\n                    parent_div.find('div.input-container.input-container--answer').addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'single-select':\n                const sing_container = parent_div.find('div.select-container.select-container--answer');\n                const sing_select = sing_container.find('select[name=\"input-answer\"]');\n                if (sing_select.prop('selectedIndex') == 0) {\n                    sing_container.addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'multiple-select':\n                const mult_container = parent_div.find('div.input-container.input-container--checkbox');\n                const checked = mult_container.find('input[name=\"input-answer\"]:checked');\n                if (!invalid_value && checked.length == 0) {\n                    mult_container.addClass('is-error');\n                    is_err = true;\n                }\n                break;\n            case 'datetime': \n                // console.log('datetime is ', new_answer, ethers.BigNumber.from(new_answer).toString());\n                if (new_answer === null) {\n                    const dt_container = parent_div.find('div.input-container.input-container--answer');\n                    dt_container.addClass('is-error');\n                    is_err = true;\n                }\n        }\n\n        // UI shouldn't let you do this\n        if (new_answer == invalid_value && !rc_question.hasInvalidOption(question_json, current_question.version_number)) {\n            console.log('invalid not supported');\n            is_err = true;\n        }\n\n        if (new_answer == answered_too_soon_value && !rc_question.hasAnsweredTooSoonOption(question_json, current_question.version_number)) {\n            console.log('answered too soon not supported');\n            is_err = true;\n        }\n\n        let min_amount = current_question.bond.mul(2)\n        if (bond.lt(min_amount)) {\n            // console.log('val fail', min_amount, current_question);\n            parent_div.find('div.input-container.input-container--bond').addClass('is-error');\n            parent_div.find('div.input-container.input-container--bond').find('.min-amount').text(decimalizedBigNumberToHuman(min_amount));\n            is_err = true;\n        }\n\n        if (is_err) throw ('err on submitting answer');\n\n        SUBMITTED_QUESTION_ID_BY_TIMESTAMP[question_id] = new Date().getTime();\n\n        // Remove the edited note to allow the field to be automatically populated again\n        bond_field.removeClass('edited'); \n\n        const handleAnswerSubmit = function(tx_response) {\n            const txid = tx_response.hash;\n            storePendingTXID(txid, CHAIN_ID);\n            const contract = tx_response.to;\n            clearForm(parent_div, question_json);\n            const fake_entry = {\n                'answer': new_answer,\n                'questionId': question_id,\n                'historyHash': null, // TODO Do we need this?\n                'user': ACCOUNT,\n                'bond': bond,\n                'timestamp': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)),\n                'isCommitment': false,\n                'userAction': 'AnswerQuestion',\n                'blockNumber': block_before_send,\n                'txid': txid\n            };\n\n\t    //console.log('skip fillPendingUserTX', tx_response);\n\t    fillPendingUserTX(tx_response);\n\t    console.log('made PENDING_USER_TXES_BY_CQID', PENDING_USER_TXES_BY_CQID);\n\n            const fake_ua = filledAnswer(fake_entry, 0);\n            const cqid = contractQuestionID(current_question);\n\n            QUESTION_DETAIL_CACHE[cqid]['history_unconfirmed'].push(fake_ua);\n\n            updateQuestionWindowIfOpen(QUESTION_DETAIL_CACHE[cqid]);\n        };\n\n        const rc = RCInstance(contract, true);\n        if (USE_COMMIT_REVEAL) {\n            const answer_plaintext = new_answer;\n            const nonce = nonceFromSeed(uiHash(question_id + answer_plaintext + bond));\n            const answer_hash = rc_question.answerHash(answer_plaintext, nonce);\n\n            console.log('answerHash for is ',rc_question.answerHash(answer_plaintext, nonce));\n\n            console.log('made nonce', nonce);\n            console.log('made answer plaintext', answer_plaintext);\n            console.log('made bond', bond);\n            console.log('made answer_hash', answer_hash);\n\n            const commitment_id = rc_question.commitmentID(question_id, answer_hash, bond.toHexString());\n            console.log('resulting  commitment_id', commitment_id);\n\n            // TODO: We wait for the txid here, as this is not expected to be the main UI pathway.\n            // If USE_COMMIT_REVEAL becomes common, we should add a listener and do everything asychronously....\n            if (IS_TOKEN_NATIVE) {\n                return rc.functions.submitAnswerCommitment(question_id, answer_hash, current_question.bond, ACCOUNT, {\n                    from: ACCOUNT, \n                    // gas:200000, \n                    value:bond\n                }).then( function(tx_res) {\n                    console.log('got submitAnswerCommitment tx, waiting for confirmation', tx_res);\n                    tx_res.wait().then(function(tx_res) {\n                        rc.functions.submitAnswerReveal(question_id, answer_plaintext, nonce, bond, {\n                            from: ACCOUNT\n                            //gas:200000\n                        })\n                        .then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                    });\n                });\n            } else {\n                ensureAmountApproved(rc.address, ACCOUNT, bond).then(function() {\n                    return rc.functions.submitAnswerCommitmentERC20(question_id, answer_hash, current_question.bond, ACCOUNT, bond, {from:ACCOUNT}).then( function(tx_res) {\n                        console.log('got submitAnswerCommitment tx_res, waiting for confirmation', tx_res);\n                        tx_res.wait().then(function(tx_res) {\n                            rc.functions.submitAnswerReveal(question_id, answer_plaintext, nonce, bond, {from: ACCOUNT})\n                            .then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                        });\n                    });\n                });\n            }\n        } else {\n            if (IS_TOKEN_NATIVE) {\n                rc.functions.submitAnswer(question_id, new_answer, current_question.bond, {\n                    from: ACCOUNT,\n                    //gas: 200000,\n                    value: bond\n                }).then(function(tx_res) { handleAnswerSubmit(tx_res) });\n            } else {\n                ensureAmountApproved(rc.address, ACCOUNT, bond).then(function() {\n                    rc.functions.submitAnswerERC20(question_id, new_answer, current_question.bond, bond, {\n                        from: ACCOUNT\n                        //gas: 200000,\n                    }).then(function(tx_res) { handleAnswerSubmit(tx_res) });\n                });\n            }\n        }\n    });\n    /*\n    .catch(function(e){\n        console.log(e);\n    });\n    */\n});\n\n$(document).on('click', '.reopen-question-submit', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const parent_div = $(this).parents('div.rcbrowser--qa-detail');\n\n    const contract_question_id = parent_div.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n\n    // reopenQuestion(uint256 template_id, string memory question, address arbitrator, uint32 timeout, uint32 opening_ts, uint256 nonce, uint256 min_bond, bytes32 reopens_question_id)\n\n    await getAccount()\n    // TODO: Recheck in case it's already opened\n\n    const old_question = await ensureQuestionDetailFetched(contract, question_id, 0);\n\n    const handleReopenQuestionTX = async function(tx_response, old_question) {\n        parent_div.addClass('reopening');\n        await tx_response.wait();\n        parent_div.removeClass('reopening');\n\n        // Give the node time to catch up after we get the event\n        await delay(6000);\n\n        // Force a refresh\n        const question = await ensureQuestionDetailFetched(old_question.contract, old_question.question_id);\n        openQuestionWindow(contractQuestionID(old_question));\n    };\n\n\n    /*\n    const handleReopenQuestionTX = function(tx_response, old_question) {\n        //console.log('sent tx with id', txid);\n\n        const txid = tx_response.hash;\n        const contract = old_question.contract;\n\n        // Make a fake log entry\n        const fake_log = {\n            'entry': 'LogNewQuestion',\n            'blockNumber': 0, // unconfirmed\n            'args': {\n                'question_id': question_id,\n                'user': ACCOUNT,\n                'arbitrator': old_question.arbitrator,\n                'timeout': ethers.BigNumber.from(old_question.timeout),\n                'content_hash': old_question.content_hash,\n                'template_id': old_question.template_id,\n                'question': old_question.question_text,\n                'created': ethers.BigNumber.from(parseInt(new Date().getTime() / 1000)),\n                'opening_ts': old_question.opening_ts\n            },\n            'address': contract \n        }\n        const fake_call = [];\n        fake_call[Qi_finalization_ts] = ethers.BigNumber.from(0);\n        fake_call[Qi_is_pending_arbitration] = false;\n        fake_call[Qi_arbitrator] = old_question.arbitrator;\n        fake_call[Qi_timeout] = ethers.BigNumber.from(old_question.timeout);\n        fake_call[Qi_content_hash] = old_question.content_hash;\n        fake_call[Qi_bounty] = ethers.BigNumber.from(0);;\n        fake_call[Qi_best_answer] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_bond] = ethers.BigNumber.from(0);\n        fake_call[Qi_min_bond] = old_question.min_bond;\n        fake_call[Qi_history_hash] = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n        fake_call[Qi_opening_ts] = ethers.BigNumber.from(old_question.opening_ts);\n\n        let q = filledQuestionDetail(contract, question_id, 'question_log', 0, fake_log);\n        q = filledQuestionDetail(contract, question_id, 'question_call', 0, fake_call);\n        q = filledQuestionDetail(contract, question_id, 'question_json', 0, rc_question.populatedJSONForTemplate(CONTRACT_TEMPLATE_CONTENT[contract.toLowerCase()][old_question.template_id], old_question.question_text));\n\n        // Turn the post question window into a question detail window\n        let rcqa = $('.rcbrowser--qa-detail.template-item').clone();\n        win.html(rcqa.html());\n        win = populateQuestionWindow(win, q, false);\n\n        // TODO: Once we have code to know which network we're on, link to a block explorer\n        win.find('.pending-question-txid a').attr('href', BLOCK_EXPLORER + '/tx/' + txid);\n        win.find('.pending-question-txid a').text(txid.substr(0, 12) + \"...\");\n        win.addClass('unconfirmed-transaction').addClass('has-warnings');\n        win.attr('data-pending-txid', txid);\n\n        const contract_question_id = contractQuestionID(q);\n\n        win.find('.rcbrowser__close-button').on('click', function() {\n            let parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n            let left = parseInt(parent_div.css('left').replace('px', ''));\n            let top = parseInt(parent_div.css('top').replace('px', ''));\n            let data_x = (parseInt(parent_div.attr('data-x')) || 0);\n            let data_y = (parseInt(parent_div.attr('data-y')) || 0);\n            left += data_x;\n            top += data_y;\n            WINDOW_POSITION[contract_question_id] = {};\n            WINDOW_POSITION[contract_question_id]['x'] = left;\n            WINDOW_POSITION[contract_question_id]['y'] = top;\n            win.remove();\n            document.documentElement.style.cursor = \"\"; // Work around Interact draggable bug\n        });\n\n        set_hash_param({'question': contractQuestionID(q)});\n\n        const window_id = 'qadetail-' + contractQuestionID(q);\n        win.removeClass('rcbrowser--postaquestion').addClass('rcbrowser--qa-detail');\n        win.attr('id', window_id);\n        win.attr('data-contract-question-id', contractQuestionID(q));\n        Ps.initialize(win.find('.rcbrowser-inner').get(0));\n\n        // TODO: Add handling for tx_response.wait() \n        // See https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse\n\n    }\n    */\n\n    // TODO: Check if the arbitrator has a fee\n    const fee = ethers.BigNumber.from(0);\n\n    // We only want to reopen a question once, plus once for each time it was reopened then settled too soon.\n    // Hash that we don't get a zero which clashes with the normal askQuestion\n    let nonce_food = \"0x0000000000000000000000000000000000000000000000000000000000000000\";\n    if (old_question.reopened_by) {\n        const [rocon, ro_question_id] = parseContractQuestionID(old_question.reopened_by);\n        nonce_food = ro_question_id;\n    }\n    const nonce = ethers.utils.keccak256('0x' + nonce_food.replace('0x', ''));\n    // const nonce = ethers.utils.keccak256(ethers.BigNumber.from(parseInt(Date.now())).toHexString());\n\n    // TODO: The same question may be asked multiple times by the same account, so set the nonce as something other than zero\n    // You only ever want to \n\n    const signedRC = RCInstance(contract, true);\n    //console.log(old_question.template_id, old_question.question_text, old_question.arbitrator, old_question.timeout, old_question.opening_ts, 0, old_question.min_bond);\n    const tx_response = await signedRC.functions.reopenQuestion(old_question.template_id, old_question.question_text, old_question.arbitrator, old_question.timeout, old_question.opening_ts, nonce, old_question.min_bond, old_question.question_id, {\n        from: ACCOUNT,\n        // gas: 200000,\n    //    value: fee\n    });\n\n    handleReopenQuestionTX(tx_response, old_question);\n\n});\n\n$(document).on('click', '.reopened-question-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const cqid = $(this).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-reopened-by-question-id');\n    console.log('open window for', cqid);\n    openQuestionWindow(cqid);\n});\n\n$(document).on('click', '.reopener-question-link', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const cqid = $(this).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-reopener-of-question-id');\n    console.log('open window for', cqid);\n    openQuestionWindow(cqid);\n});\n\nfunction clearForm(parent_div, question_json) {\n    parent_div.find('div.input-container.input-container--answer').removeClass('is-error');\n    parent_div.find('div.select-container.select-container--answer').removeClass('is-error');\n    parent_div.find('div.input-container.input-container--bond').removeClass('is-error');\n    parent_div.find('div.input-container.input-container--checkbox').removeClass('is-error');\n    parent_div.find('.answer-payment-value').text('');\n    parent_div.removeClass('has-someone-elses-answer').removeClass('has-your-answer');\n\n    switch (question_json['type']) {\n        case 'bool':\n            parent_div.find('select[name=\"input-answer\"]').prop('selectedIndex', 0);\n            break;\n        case 'uint':\n            parent_div.find('input[name=\"input-answer\"]').val('');\n            break;\n        case 'int':\n            parent_div.find('input[name=\"input-answer\"]').val('');\n            break;\n        case 'single-select':\n            parent_div.find('select[name=\"input-answer\"]').prop('selectedIndex', 0);\n            break;\n        case 'multiple-select':\n            const container = parent_div.find('div.input-container.input-container--checkbox');\n            container.find('input[name=\"input-answer\"]:checked').prop('checked', false);\n            break;\n    }\n}\n\n\n// open/close/add reward\n$(document).on('click', '.add-reward-button', function(e) {\n\n    updateLastActionTS();\n\n    const container = $(this).closest('.rcbrowser--qa-detail').find('.add-reward-container');\n    container.addClass('is-open');\n    container.addClass('is-bounce');\n    container.css('display', 'block');\n});\n\n$(document).on('click', '.add-reward__close-button', function(e) {\n\n    updateLastActionTS();\n\n    const container = $(this).closest('.rcbrowser--qa-detail').find('.add-reward-container');\n    container.removeClass('is-open');\n    container.removeClass('is-bounce');\n    container.css('display', 'none');\n});\n\n$(document).on('click', '.notifications-item', function(e) {\n    if ($(e.target).hasClass('more-link') || $(e.target).hasClass('less-link')) {\n        return true;\n    }\n\n    updateLastActionTS();\n\n    //console.log('notifications-item clicked');\n    e.preventDefault();\n    e.stopPropagation();\n    const cqid = $(this).attr('data-contract-question-id');\n    // Template creation notifications don't have this\n    // TODO: Ideally we'd give you more detail about the template or something.\n    if (!cqid) {\n        return;\n    }\n    openQuestionWindow(cqid);\n});\n\n$(document).on('click', '.rcbrowser-submit.rcbrowser-submit--add-reward', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const rcqa = $(this).closest('.rcbrowser--qa-detail');\n    const [contract, question_id] = parseContractQuestionID(rcqa.attr('data-contract-question-id'));\n    const reward_inp = $(this).parent('div').prev('div.input-container').find('input[name=\"question-reward\"]').val();\n\n    let err = false;\n    let reward = ethers.BigNumber.from(0);\n    try {\n        reward = humanToDecimalizedBigNumber(reward_inp);\n    } catch(e) {\n        console.log('reward data conversion error', e);\n        err = true;\n    }\n\n    const signedRC = RCInstance(contract, true);\n    if (err || reward <= 0) {\n        $(this).parent('div').prev('div.input-container').addClass('is-error');\n    } else {\n        await getAccount();\n        if (!IS_TOKEN_NATIVE) {\n            await ensureAmountApproved(contract, ACCOUNT, reward);\n        }\n        let tx_response = null;\n        if (IS_TOKEN_NATIVE) {\n            tx_response = await signedRC.fundAnswerBounty(question_id, {from: ACCOUNT, value: reward});\n        } else {\n            tx_response = await signedRC.fundAnswerBountyERC20(question_id, reward, {from: ACCOUNT})\n        }\n        await tx_response.wait();\n        //console.log('fund bounty', result);\n        const container = rcqa.find('.add-reward-container');\n        //console.log('removing open', container.length, container);\n        container.removeClass('is-open');\n        container.removeClass('is-bounce');\n        container.css('display', 'none');\n    }\n});\n\n/*-------------------------------------------------------------------------------------*/\n// arbitration\n$(document).on('click', '.arbitration-button', async function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    updateLastActionTS();\n\n    const lnk = this;\n    await getAccount();\n\n    const contract_question_id = $(lnk).closest('div.rcbrowser.rcbrowser--qa-detail').attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n    const question_detail = await ensureQuestionDetailFetched(contract, question_id, 1, 1, CURRENT_BLOCK_NUMBER, CURRENT_BLOCK_NUMBER);\n    if (!question_detail) {\n        console.log('Error, question detail not found');\n        return false;\n    }\n\n    const last_seen_bond_hex = $(lnk).attr('data-last-seen-bond'); \n    if (!last_seen_bond_hex) {\n        console.log('Error, last seen bond not populated, aborting arbitration request');\n        return false;\n    }\n\n    if (question_detail.bond.gt(ethers.BigNumber.from(last_seen_bond_hex))) {\n        console.log('Answer has changed, please click again');\n        return false;\n    }\n\n    if (question_detail.bond.eq(0)) {\n        $('body').addClass('error-request-arbitration-without-answer-error').addClass('error');\n        return false;\n    }\n\n    //if (!question_detail.is_arbitration_pending) {}\n    const arb = ARBITRATOR_INSTANCE.attach(question_detail.arbitrator);\n    arb.functions.getDisputeFee(question_id).then(function(fee_arr) {\n        const arbitration_fee = fee_arr[0];\n        //console.log('got fee', arbitration_fee.toString());\n        console.log('requestArbitration(',question_id, ethers.BigNumber.from(last_seen_bond_hex), ACCOUNT, arbitration_fee);\n\n        const signed_arbitrator = arb.connect(signer);\n        signed_arbitrator.requestArbitration(question_id, ethers.BigNumber.from(last_seen_bond_hex), {from: ACCOUNT, value: arbitration_fee}).then(function(result) {\n            console.log('arbitration is requested.', result);\n        });\n    }).catch(function(err) {\n        console.log('arbitrator failed with error', err);\n        markArbitratorFailed(contract, question_detail.arbitrator, contract_question_id);\n    });\n});\n\nfunction show_bond_payments(ctrl) {\n    const frm = ctrl.closest('div.rcbrowser--qa-detail')\n    const contract_question_id = frm.attr('data-contract-question-id');\n    const [contract, question_id] = parseContractQuestionID(contract_question_id);\n    //console.log('got question_id', question_id);\n    ensureQuestionDetailFetched(contract, question_id).then(function(question) {\n        const question_json = question.question_json;\n        const existing_answers = answersByMaxBond(question['history']);\n        const new_answer = formattedAnswerFromForm(frm, question_json);\n        //console.log('new_answer', new_answer);\n        //console.log('existing_answers', existing_answers);\n        let payable = 0;\n        if (existing_answers[new_answer]) {\n            payable = existing_answers[new_answer].bond;\n            if (existing_answers[new_answer].user == ACCOUNT) {\n                frm.addClass('has-your-answer').removeClass('has-someone-elses-answer');\n                frm.find('.answer-credit-info .answer-payment-value').text(decimalizedBigNumberToHuman(payable));\n            } else {\n                frm.addClass('has-someone-elses-answer').removeClass('has-your-answer');\n                frm.find('.answer-debit-info .answer-payment-value').text(decimalizedBigNumberToHuman(payable));\n            }\n            frm.attr('data-answer-payment-value', payable.toHexString());\n        } else {\n            frm.removeClass('has-your-answer').removeClass('has-someone-elses-answer');\n            frm.find('.answer-payment-value').text('');\n            frm.attr('data-answer-payment-value', '');\n        }\n    }).catch(function(e) {\n        console.log('Could not fetch question, but continuing as it may be unconfirmed', question_id, e);\n    });\n\n}\n\n$('.rcbrowser-textarea').on('keyup', function(e) {\n    if ($(this).val() !== '') {\n        $(this).closest('div').removeClass('is-error');\n    }\n});\n\n$(document).on('keyup', '.rcbrowser-input.rcbrowser-input--number', function(e) {\n    let value = humanToDecimalizedBigNumber($(this).val());\n    //console.log($(this));\n    const bond_validation = function(ctrl){\n        ctrl.addClass('edited');\n        const contract_question_id = ctrl.closest('.rcbrowser.rcbrowser--qa-detail').attr('data-contract-question-id');\n        const [contract, question_id] = parseContractQuestionID(contract_question_id);\n        const current_idx = QUESTION_DETAIL_CACHE[contract_question_id]['history'].length - 1;\n        let current_bond = ethers.BigNumber.from(QUESTION_DETAIL_CACHE[contract_question_id].min_bond.div(2));\n        if (current_idx >= 0) {\n            current_bond = QUESTION_DETAIL_CACHE[contract_question_id]['history'][current_idx].bond;\n        }\n\n        const min_bond = current_bond.mul(2);\n        if (ctrl.val() === '' || value.lt(min_bond)) {\n            // console.log('The minimum bond is ', min_bond, 'rejecting value ',value);\n            ctrl.parent().parent().addClass('is-error');\n            ctrl.parent('div').next('div').find('.min-amount').text(decimalizedBigNumberToHuman(min_bond));\n        } else {\n            // console.log('The minimum bond is ', min_bond, 'accepting value ',value);\n            ctrl.parent().parent().removeClass('is-error');\n        }\n        show_bond_payments(ctrl);\n    }\n\n    if ($(this).val() === '') {\n        if ($(this).hasClass('rcbrowser-input--number--bond')) {\n            bond_validation($(this));\n        } else {\n            $(this).parent().parent().addClass('is-error');\n        }\n    }\n\n    if (($(this).closest('#post-a-question-window').length || $(this).hasClass('rcbrowser-input--number--answer'))\n        && value.lt(0)) {\n        $(this).parent().parent().addClass('is-error');\n    } else if ($(this).hasClass('rcbrowser-input--add-reward') && value.lte(0)) {\n        $(this).parent().parent().addClass('is-error');\n    } else if ($(this).hasClass('rcbrowser-input--number--bond')) {\n        bond_validation($(this));\n    } else {\n        $(this).parent().parent().removeClass('is-error');\n    }\n});\n\n$(document).on('click', '.invalid-switch-container a.invalid-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        if (!cont.hasClass('invalid-selected') && !cont.hasClass('too-soon-selected')) {\n            inp.attr('data-old-placeholder', inp.attr('placeholder'));\n        }\n        inp.val('');\n        inp.attr('readonly', true);\n        inp.attr('placeholder', 'Invalid');\n        inp.removeAttr('data-too-soon-selected');\n        inp.attr('data-invalid-selected', '1'); // will be read in processing\n    });\n    cont.addClass('invalid-selected').removeClass('too-soon-selected').removeClass('is-error');\n});\n\n$(document).on('click', '.invalid-switch-container a.valid-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        inp.attr('readonly', false);\n        let placeholder = inp.attr('data-old-placeholder');\n        if (typeof placeholder === typeof undefined || placeholder === false) {\n            placeholder = '';\n        }\n        inp.attr('placeholder', placeholder);\n        inp.removeAttr('data-old-placeholder');\n        inp.removeAttr('data-invalid-selected'); // will be read in processing\n    });\n    cont.removeClass('invalid-selected').removeClass('too-soon-selected').removeClass('is-error')\n});\n\n$(document).on('click', '.too-soon-switch-container a.too-soon-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        if (!cont.hasClass('invalid-selected') && !cont.hasClass('too-soon-selected')) {\n            inp.attr('data-old-placeholder', inp.attr('placeholder'));\n        }\n        inp.val('');\n        inp.attr('readonly', true);\n        inp.attr('placeholder', 'Answered too soon');\n        inp.attr('data-too-soon-selected', '1'); // will be read in processing\n        inp.removeAttr('data-invalid-selected');\n    });\n    cont.addClass('too-soon-selected').removeClass('invalid-selected').removeClass('is-error')\n});\n\n$(document).on('click', '.too-soon-switch-container a.not-too-soon-text-link', function(evt) {\n    evt.stopPropagation();\n    const cont = $(this).closest('.input-container');\n    cont.find('input').each(function() {\n        const inp = $(this);\n        inp.attr('readonly', false);\n        let placeholder = inp.attr('data-old-placeholder');\n        if (typeof placeholder === typeof undefined || placeholder === false) {\n            placeholder = '';\n        }\n        inp.attr('placeholder', placeholder);\n        inp.removeAttr('data-old-placeholder');\n        inp.removeAttr('data-too-soon-selected'); // will be read in processing\n    });\n    cont.removeClass('too-soon-selected').removeClass('invalid-selected').removeClass('is-error');\n});\n\n$(document).on('change', '#post-question-window .question-type,.step-delay,.arbitrator', function(e) {\n    if ($(this).prop('selectedIndex') != 0) {\n        $(this).parent().removeClass('is-error');\n    }\n});\n\n$(document).on('change', 'select[name=\"input-answer\"]', function(e) {\n    if ($(this).prop('selectedIndex') != 0) {\n        $(this).parent().removeClass('is-error');\n        show_bond_payments($(this));\n    }\n});\n\n$(document).on('change', 'input[name=\"input-answer\"]:checkbox', function() {\n    const parent_div = $(this).closest('div.rcbrowser.rcbrowser--qa-detail');\n    const container = parent_div.find('div.input-container.input-container--checkbox');\n    const checked = container.find('input[name=\"input-answer\"]:checked');\n    if (checked.length > 0) {\n        container.removeClass('is-error');\n    }\n    show_bond_payments($(this), checked);\n});\n\n// For now we force a reload\n// Probably better to handle the section arrays per category and display without moving\n$('#filter-list a').on('click', function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const cat = $(this).attr('data-category');\n    if (cat == 'all') {\n        window.location.hash = '';\n        set_hash_param({'category': null})\n    } else {\n        set_hash_param({'category': cat})\n    }\n    location.reload();\n});\n\n\n// This should be called with a question array containing, at a minimum, up-to-date versions of the changed_field and finalization_ts.\n// A full repopulate will work, but so will an array with these fields overwritten from a log event.\nfunction updateRankingSections(question, changed_field, changed_val) {\n    //console.log('in updateRankingSections', question, changed_field, changed_val);\n    // latest only change on new question\n    // resolved changes on finalization, this happens either with a timer or with arbitration. Also removes items from other section.\n    // closing soon changes when we add an answer\n    // high reward changes if we add reward. TODO: Should maybe include bond value, in which case it would also change on new answer\n\n    const question_id = question.question_id;\n    //console.log('updateRankingSections', question_id, changed_field, changed_val);\n    if (changed_field == 'finalization_ts') {\n        if (isFinalized(question)) {\n            //console.log('isFinalized');\n            const sections = ['questions-active', 'questions-closing-soon', 'questions-upcoming'];\n            for (let i = 0; i < sections.length; i++) {\n                const s = sections[i];\n                //console.log('doing section', s);\n                const existing_idx = DISPLAY_ENTRIES[s].ids.indexOf(question_id);\n                if (existing_idx !== -1) {\n                    DISPLAY_ENTRIES[s].ids.splice(existing_idx, 1);\n                    DISPLAY_ENTRIES[s].vals.splice(existing_idx, 1);\n                    //console.log('depopulating', s, question_id);\n                    depopulateSection(s, question_id);\n                }\n            }\n            const insert_before = update_ranking_data('questions-resolved', contractQuestionID(question), question.finalization_ts, 'desc');\n            //console.log('insert_before iss ', insert_before);\n            if (insert_before !== -1) {\n                //console.log('poulating', question);\n                // TODO: If question may not be populated, maybe we should refetch here first\n                populateSection('questions-resolved', question, insert_before);\n            }\n        } else {\n            //console.log('updating closing soon with timestamp', question_id, question.finalization_ts.toString());\n            const insert_before = update_ranking_data('questions-closing-soon', contractQuestionID(question), question.finalization_ts, 'asc');\n            //console.log('insert_before was', insert_before);\n            if (insert_before !== -1) {\n                populateSection('questions-closing-soon', question, insert_before);\n            }\n\n        }\n\n    } \n    if (changed_field == 'bounty' || changed_field == 'finalization_ts') {\n        //var insert_before = update_ranking_data('questions-upcoming', question_id, question.bounty.add(question.bond), 'desc');\n        const insert_before = update_ranking_data('questions-upcoming', contractQuestionID(question), question.opening_ts, 'desc');\n        //console.log('update for new bounty', question.bounty, 'insert_before is', insert_before);\n        if (insert_before !== -1) {\n            populateSection('questions-upcoming', question, insert_before);\n        }\n    }\n\n    // Things that don't need adding or removing, but may still need the content updating\n    updateSectionEntryDisplay(question);\n    reflectDisplayEntryChanges();\n    // TODO: Need to update sections that haven't changed position, but changed data\n\n}\n\n/*-------------------------------------------------------------------------------------*/\n// initial process\n\nfunction pageInit(only_contract) {\n\n    if ($('body').hasClass('foreign-proxy')) {\n        return;\n    }\n\n    //console.log('in pageInit for account', account);\n\n    /*\n        1) Start watching for all actions.\n           This will include questions that the user answered or funded, which will update list of user question_ids.\n           These will be pass into the ranking tables as they come it.\n           Ranking tables may temporarily flash with new actions, which will later be buried under others which we later fetch\n           We can handle this on the display side if it turns out to be a problem.\n\n        2) Get historical logs of user actions.\n           These may include duplicates of things we got from the watch() call.\n\n        3) Get other historical questions and update the rankings.\n           These may include duplicates of things we got from the watch() call.\n\n        NB When we come to display the user actions, we may have only a partial list of the questions they may have answered\n           This may be because the question info hasn't arrived yet\n           We will use a targetted get() to fill in anything we are missing at that time.\n\n    */\n\n/*\nTODO restore\n    var RealityCheckRealitio = contract(rc_json);\n    RealityCheckRealitio.setProvider(new Web3.providers.HttpProvider(HOSTED_RPC_NODE));\n    console.log('using network', HOSTED_RPC_NODE);\n    RealityCheckRealitio.deployed().then(function(instance) {\n        rcrealitio = instance;\n\n        var evts = rcrealitio.allEvents({}, {\n            fromBlock: 'latest',\n            toBlock: 'latest'\n        })\n\n        evts.watch(function(error, result) {\n            if (!error && result) {\n                console.log('got watch event', error, result);\n                // Give the node we're calling some time to catch up\n                window.setTimeout(\n                    function() {\n                        handleEvent(error, result);\n                    }, 5000\n                );\n            }\n        });\n\n    });\n*/\n\n    fetchQuestionListsFromGraph(0);\n};\n\nfunction fetchQuestionListsFromGraph(offset) {\n// TODO: Work out what to do about ranking - can we make this one query? If not how do we handle the paging?\n// Option: We do the sorting ourselves from the top candidates, so just fetch the full number of both?\n// \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-active-answered', offset, DISPLAY_ENTRIES['questions-active']['max_store']); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-active-unanswered', offset, DISPLAY_ENTRIES['questions-active']['max_store']); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-upcoming', offset, DISPLAY_ENTRIES['questions-upcoming']['max_store']); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-resolved', offset, DISPLAY_ENTRIES['questions-resolved']['max_store']); \n    fetchAndDisplayQuestionFromGraph(RC_DISPLAYED_CONTRACTS, 'questions-awaiting-arbitration', offset, DISPLAY_ENTRIES['questions-upcoming']['max_store']); \n};\n\nfunction reflectDisplayEntryChanges() {\n    //console.log('checking DISPLAY_ENTRIES', DISPLAY_ENTRIES);\n    //look at current sections and update blockchain scanning message to\n    //no questions found if no items exist\n    const detypes = Object.keys(DISPLAY_ENTRIES);\n    // console.log('no questions cateogry, DISPLAY_ENTRIES for detype', DISPLAY_ENTRIES, detypes);\n    for (let i=0; i<detypes.length; i++) {\n        const detype = detypes[i];\n        const has_items = ($('#' + detype).find('div.questions-list div.questions__item').length > 0);\n        if (has_items) {\n            $('#' + detype).find('.no-questions-category').css('display', 'none');\n            $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n        } else {\n            if (IS_INITIAL_LOAD_DONE) {\n                $('#' + detype).find('.no-questions-category').css('display', 'block');\n                $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n            } else {\n                $('#' + detype).find('.no-questions-category').css('display', 'none');\n                $('#' + detype).find('.scanning-questions-category').css('display', 'none');\n            }\n        }\n\n    } \n}\n\nfunction questionFetchFields() {\n    const txt = `\n        id,\n        questionId,\n        contract,\n        createdBlock,\n        createdTimestamp,\n        updatedBlock,\n        updatedTimestamp,\n        data,\n        qJsonStr,\n        qTitle,\n        qCategory,\n        qLang,\n        qType,\n        arbitrator,\n        user,\n        openingTimestamp,\n        timeout,\n        bounty,\n        currentAnswer,\n        currentAnswerBond,\n        currentAnswerTimestamp,\n        contentHash,\n        historyHash,\n        minBond,\n        lastBond,\n        cumulativeBonds,\n        arbitrationRequestedTimestamp,\n        arbitrationRequestedBy,\n        isPendingArbitration,\n        arbitrationOccurred,\n        answerFinalizedTimestamp,\n        currentScheduledFinalizationTimestamp,\n        template {\n            id, \n            templateId, \n            questionText\n        },\n        reopenedBy {\n          id\n        },\n        reopens {\n          id\n        },\n        responses {\n          id,\n          timestamp,\n          answer,\n          isUnrevealed,\n          isCommitment,\n          commitmentId,\n          bond,\n          user,\n          historyHash,\n          createdBlock,\n          revealedBlock\n        }\n    `;\n    return txt;\n}\n\nfunction userActionFields() {\n    const question_fetch_fields = questionFetchFields();\n    const txt = `\n        id,\n        actionType,\n        user,\n        question {\n           ${question_fetch_fields}, \n        },\n        template {\n            templateId,\n            questionText,\n        },\n        createdBlock,\n        createdTimestamp,\n        response {\n          id,\n          timestamp,\n          answer,\n          isUnrevealed,\n          isCommitment,\n          commitmentId,\n          bond,\n          user,\n          historyHash,\n          createdBlock,\n          revealedBlock\n      }\n    `;\n    return txt;\n}\n\nasync function fetchAndDisplayQuestionFromGraph(displayed_contracts, ranking, offset, max_store) {\n    //console.log('fetchAndDisplayQuestionFromGraph', displayed_contracts, ranking);\n\n    const ts_now = parseInt(new Date()/1000);\n    const contract_str = JSON.stringify(displayed_contracts);\n    const ranking_where = {\n        'questions-active-answered': `{contract_in: ${contract_str}, isPendingArbitration: false, answerFinalizedTimestamp_gt: ${ts_now}, openingTimestamp_lte: ${ts_now}}`,\n        'questions-active-unanswered': `{contract_in: ${contract_str}, isPendingArbitration: false, answerFinalizedTimestamp: null, openingTimestamp_lte: ${ts_now}}`,\n        'questions-upcoming': `{contract_in: ${contract_str}, isPendingArbitration: false, openingTimestamp_gt: ${ts_now}}`,\n        'questions-resolved': `{contract_in: ${contract_str}, answerFinalizedTimestamp_lt: ${ts_now}}`,\n        'questions-awaiting-arbitration': `{contract_in: ${contract_str}, isPendingArbitration: true}`,\n    }\n\n    const ranking_order = {\n        'questions-active-answered': 'lastBond', \n        'questions-active-unanswered': 'createdTimestamp',\n        'questions-upcoming': 'createdTimestamp',\n        'questions-resolved': 'answerFinalizedTimestamp',\n        'questions-awaiting-arbitration': 'lastBond'\n    }\n\n    const where = ranking_where[ranking];\n    const orderBy = ranking_order[ranking];\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n    const question_fetch_fields = questionFetchFields();\n\n    const query = `\n      {\n        questions(first: ${max_store}, skip: ${offset}, where: ${where}, orderBy: ${orderBy}, orderDirection: desc) {\n            ${question_fetch_fields}\n        }\n      }  \n      `;\n\n\n    const fetched_ms = Date.now();\n\n     // console.log('sending graph query', ranking, query);\n    const res = await axios.post(network_graph_url, {query: query});\n    // console.log('graph res', ranking, res.data);\n    for (const q of res.data.data.questions) {\n        handleQuestion(q, fetched_ms)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n    IS_INITIAL_LOAD_DONE = true;\n    reflectDisplayEntryChanges();\n\n}\n\nasync function ensureQuestionDetailFetched(ctr, question_id, max_cache_ms) {\n    const cqid = cqToID(ctr, question_id);\n\n    max_cache_ms = (typeof max_cache_ms === 'undefined') ? DEFAULT_MAX_CACHE_MS : parseInt(max_cache_ms);\n\n    if (QUESTION_DETAIL_CACHE[cqid]) {\n        // TODO: For closed and resolved questions we can probably be more aggressive, but be careful of what we need in claiming\n        if (QUESTION_DETAIL_CACHE[cqid].fetched_ms > (Date.now() - max_cache_ms)) {\n            return QUESTION_DETAIL_CACHE[cqid];\n        }\n    }\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n    const question_fetch_fields = questionFetchFields();\n\n    const fetched_ms = Date.now();\n    const query = `\n      {\n        questions(where: {id: \"${cqid}\"}) {\n            ${question_fetch_fields}\n        }\n      }  \n      `;\n\n     //console.log('sending single graph query', query);\n    const res = await axios.post(network_graph_url, {query: query});\n    // console.log('graph res ensureQuestionDetailFetched', res.data, query);\n    for (const q of res.data.data.questions) {\n        //console.log('got q data q');\n        let question = filledQuestion(q, fetched_ms);\n\n        // TODO: Should we run handleQuestion too?\n        // handleQuestion(q)\n        // console.log('filled individual qestion', question);\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n        return question;\n    }\n}\n\nasync function fetchChangedQuestionsSince(last_ts) {\n\n    const ts_now = parseInt(new Date()/1000);\n    const displayed_contracts = RC_DISPLAYED_CONTRACTS\n    const contract_str = JSON.stringify(displayed_contracts);\n\n    const query_since_ts = last_ts - REORG_ALLOWANCE_SECS;\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n    const question_fetch_fields = questionFetchFields();\n    const query = `\n      {\n        questions(first: 100, where: {updatedTimestamp_gt: ${query_since_ts}, contract_in: ${contract_str}}, orderBy: updatedTimestamp, orderDirection: desc) {\n            ${question_fetch_fields}\n        }\n      }  \n      `;\n\n    const fetched_ms = Date.now();\n\n     // console.log('sending graph query', ranking, query);\n    const res = await axios.post(network_graph_url, {query: query});\n    //console.log('fetchChangedQuestionsSince result', last_ts, res.data, query);\n    console.log('fetchChangedQuestionsSince result', last_ts, res.data, res.data.data.questions.length, fetched_ms);\n    for (const q of res.data.data.questions) {\n        console.log('handling updated question', q.id);\n        handleQuestion(q, fetched_ms)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n\n    return true;\n \n}\n\n// For normal fetches we check on loading whether finalized\n// However they may finalize by the passage of time after the page is loaded.\n// This doesn't trigger an event unless they're finalized by arbitration.\nasync function fetchFinalizedQuestionsSince(last_ts) {\n\n    const ts_now = parseInt(new Date()/1000);\n    const displayed_contracts = RC_DISPLAYED_CONTRACTS\n    const contract_str = JSON.stringify(displayed_contracts);\n\n    // Wait a few minutes after they should have been finalized in case they get answered at the last minute and graph is lagging\n    // We'll also filter for below 2147483647 which is a fake value we put in for unanswered questions so we can query on them\n    const ts_display_after = ts_now - (3*60);\n\n    const ts_last_polled = last_ts; // TODO: check this is right\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n    const question_fetch_fields = questionFetchFields();\n    const query = `\n      {\n        questions(first: 100, where: {currentScheduledFinalizationTimestamp_gte: ${ts_last_polled}, currentScheduledFinalizationTimestamp_gte: ${ts_display_after}, currentScheduledFinalizationTimestamp_lt: 2147483647, contract_in: ${contract_str}}, orderBy: updatedTimestamp, orderDirection: desc) {\n            ${question_fetch_fields}\n        }\n      }  \n      `;\n\n    const fetched_ms = Date.now();\n\n     // console.log('sending graph query', ranking, query);\n    const res = await axios.post(network_graph_url, {query: query});\n    //console.log('fetchChangedQuestionsSince result', last_ts, res.data, query);\n    console.log('fetchFinalizedSince result', last_ts, res.data, res.data.data.questions.length, fetched_ms);\n    for (const q of res.data.data.questions) {\n        console.log('handling updated question', q.id);\n        handleQuestion(q, fetched_ms)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n\n    return true;\n \n}\n\n\nasync function runPollingLoop(displayed_contracts, last_fetch_ts) {\n\n    const fetch_started_ts = parseInt(new Date().getTime()/1000);\n\n    // NB The fetch timestamp is when we actually did the fetching per our clock.\n    // The REORG_ALLOWANCE_SECS should be applied by the functions that do the fetching.\n    fetchChangedQuestionsSince(last_fetch_ts);\n    fetchFinalizedQuestionsSince(last_fetch_ts);\n\n    fetchUserEventsAndHandleGraph();\n\n    updatePollingInterval();\n    await delay(POLLING_INTERVAL*1000);\n\n    runPollingLoop(displayed_contracts, fetch_started_ts);\n    \n    /*\n    window.setTimeout(function() {\n        const to = (start_ts-interval);\n        runPollingLoop(displayed_contracts, to)\n    }, (interval*1000));\n    */\n\n    /*\n    evts.get(function(error, result) {\n        console.log('got evts', error, result);\n        LAST_POLLED_BLOCK = CURRENT_BLOCK_NUMBER;\n        if (error === null && typeof result !== 'undefined') {\n            for (var i = 0; i < result.length; i++) {\n                handleEvent(error, result[i]);\n            }\n        } else {\n            console.log(error);\n        }\n        window.setTimeout(runPollingLoop, 30000, contract_instance);\n    });\n    */\n\n}\n\nfunction updateLastActionTS() {\n    LAST_ACTION_TS = parseInt(new Date().getTime()/1000);\n    updatePollingInterval();\n}\n\nfunction updatePollingInterval() {\nconsole.log('updatePollingInterval');\n    const tsnow = parseInt(new Date().getTime()/1000);\n    const secs_since_last_action = tsnow - LAST_ACTION_TS \n    if (secs_since_last_action < SECS_TO_UX_IDLE_STATE) {\n        POLLING_INTERVAL = POLLING_INTERVAL_ACTIVE; \n    } else {\n        POLLING_INTERVAL = POLLING_INTERVAL_IDLE; \n    }\nconsole.log('updatePollingInterval', POLLING_INTERVAL);\n}\n\n\n// Sometimes things go wrong getting events\n// To mitigate the damage, run a refresh of the currently-open window etc\n\n\nasync function fetchUserEventsAndHandleGraph() {\n    //console.log('fetchAndDisplayQuestionFromGraph', displayed_contracts, ranking);\n\n    const acc = ACCOUNT;\n    if (!acc) {\n        console.log('No account found, not fetching user events');\n        return;\n    }\n\n    const ts_now = parseInt(new Date()/1000); // TODO: Handle skipping stuff we already have\n    //const contract_str = JSON.stringify(displayed_contracts);\n\n    const fetch_start_ts = LAST_POLLED_USER_TS ? LAST_POLLED_USER_TS - REORG_ALLOWANCE_SECS : 0;\nconsole.log('fetch user events from', fetch_start_ts);\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n\n\n/*\nid: ID!\nactionType: String!\nuser: Bytes!\nquestion: Question\nresponse: Response\nclaim: Claim\nwithdrawal: Withdrawal\nfund: Fund\ntemplate: Template\ncreatedBlock: BigInt!\ncreatedTimestamp: BigInt!\n*/\n\n    //  GRAPH_TODO Add contract field to UserAction\n    const user_action_fields = userActionFields();\n    const displayed_contracts = RC_DISPLAYED_CONTRACTS\n    const contract_str = JSON.stringify(displayed_contracts);\n\n    const query = `\n      {\n        userActions(first: 1000, where: {user: \"${acc}\", createdTimestamp_gt: ${fetch_start_ts} }, orderBy: createdBlock, orderDirection: desc) {\n            ${user_action_fields}\n        }\n      }\n      `;\n\n    // console.log('sending usergraph query', query);\n    const res = await axios.post(network_graph_url, {query: query});\n    // console.log('graph res', res.data);\n    let user_question_blocks = [];\n\n    let active_contracts = {};\n    for(let ci = 0; ci<RC_DISPLAYED_CONTRACTS.length; ci++) {\n        const ct = RC_DISPLAYED_CONTRACTS[ci];\n        active_contracts[ct.toLowerCase()] = true;\n    }\n\n    const fetched_ms = Date.now();\n\n    if (typeof res.data.data === 'undefined') {\n        console.log('Fetching user events from graph failed', res, query);\n        return false;\n    }\n\n    for (const a of res.data.data.userActions) {\n         // console.log('got useraction', a);\n\n        // TODO: Move this logic to the query - we may need a graph update to put the contract in UserAction\n        if (a.question) { // Anything except LogNewTemplate\n            const contr = a.question.contract;\n            if (!active_contracts[contr]) {\n                // console.log('skip action', a);\n                continue;\n            }\n        }\n\n        renderNotificationsGraph(a, fetched_ms);\n        const qid = a.questionId;\n        if (!user_question_blocks[qid]) {\n            user_question_blocks[qid] = a.createdTimestamp; // Should be the first time - TODO: Check we're getting these in ascending order\n        }\n        //handleQuestion(q)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n\n\n    // Now fetch events for questions the user interacted with, but not done by the user\n\n    let question_id_in_str = '';\n    let delim = ''; \n    for(const qid in user_question_blocks) {\n        question_id_in_str = question_id_in_str + delim + '\"' + qid + '\"';\n        delim = ','; \n    }\n    if (question_id_in_str == '') {\n        console.log('no questions');\n        return;\n    }\n\n    // NB We don't need AskQuestion as it must have happened prior to the user's involvement\n    const query2 = `\n      {\n        userActions(first: 1000, where: {user_not: \"${acc}\", actionType_not: \"AskQuestion\", question_in: [${question_id_in_str}], createdTimestamp_gt: ${fetch_start_ts} }, orderBy: createdBlock, orderDirection: desc) {\n           ${user_action_fields}\n        }\n      }\n      `;\n\n    // console.log('sending other graph query', query2);\n    const res2 = await axios.post(network_graph_url, {query: query2});\n    console.log('graph res', res2.data);\n    for (const a of res2.data.data.userActions) {\n        console.log('got useraction for other', a);\n        renderNotificationsGraph(a);\n        const qid = a.questionId;\n        if (!user_question_blocks[qid]) {\n            user_question_blocks[qid] = a.createdTimestamp; // Should be the first time - TODO: Check we're getting these in ascending order\n        }\n        //handleQuestion(q)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n\n    for (const ctr in RC_DISPLAYED_CONTRACTS) {\n        updateClaimableDisplay(RC_DISPLAYED_CONTRACTS[ctr]);\n    }\n\n    LAST_POLLED_USER_TS = ts_now;\n\n}\n\nasync function changedQuestionsByUserEventStartingAt(displayed_contracts, start_ts) {\n    //console.log('fetchAndDisplayQuestionFromGraph', displayed_contracts, ranking);\n\n    //const contract_str = JSON.stringify(displayed_contracts);\n\n    const network_graph_url = CHAIN_INFO.graphURL;\n    if (!network_graph_url) {\n        console.log('No graph endpoint found for this network, skipping graph fetch');\n        return false;\n    }\n    // console.log('graph url is ', network_graph_url);\n\n    //  GRAPH_TODO Add contract field to UserAction\n    const user_action_fields = userActionFields();\n    const contract_str = JSON.stringify(displayed_contracts);\nconsole.log('made contract_str', contract_str);\n\n    const query = `\n      {\n        userActions(first: 1000, where: {createdTimestamp_gt: \"${start_ts}\" }, orderBy: createdBlock, orderDirection: desc) {\n           ${user_action_fields}\n        }\n      }\n      `;\n\n    // console.log('sending usergraph query', query);\n    const res = await axios.post(network_graph_url, {query: query});\n    // console.log('graph res', res.data);\n    let user_question_blocks = [];\n\n\n    let active_contracts = {};\n    for(let ci = 0; ci<RC_DISPLAYED_CONTRACTS.length; ci++) {\n        const ct = RC_DISPLAYED_CONTRACTS[ci];\n        active_contracts[ct.toLowerCase()] = true;\n    }\n\n    const fetched_ms = Date.now();\n\n    for (const a of res.data.data.userActions) {\n         // console.log('got useraction', a);\n\n        // TODO: Move this logic to the query - we may need a graph update to put the contract in UserAction\n        if (a.question) { // Anything except LogNewTemplate\n            const contr = a.question.contract;\n            if (!active_contracts[contr]) {\n                // console.log('skip action', a);\n                continue;\n            }\n        }\n\n        renderNotificationsGraph(a, fetched_ms);\n        const qid = a.questionId;\n        if (!user_question_blocks[qid]) {\n            user_question_blocks[qid] = a.createdTimestamp; // Should be the first time - TODO: Check we're getting these in ascending order\n        }\n        //handleQuestion(q)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n\n\n/*\n    // Now fetch events for questions the user interacted with, but not done by the user\n\n    let question_id_in_str = '';\n    let delim = ''; \n    for(const qid in user_question_blocks) {\n        question_id_in_str = question_id_in_str + delim + '\"' + qid + '\"';\n        delim = ','; \n    }\n    if (question_id_in_str == '') {\n        console.log('no questions');\n        return;\n    }\n\n    // NB We don't need AskQuestion as it must have happened prior to the user's involvement\n    const query2 = `\n      {\n        userActions(first: 1000, where: {user_not: \"${acc}\", actionType_not: \"AskQuestion\", question_in: [${question_id_in_str}] }, orderBy: createdBlock, orderDirection: desc) {\n            id,\n            actionType,\n            user,\n            question {\n               ${question_fetch_fields}, \n            }\n            createdBlock\n            createdTimestamp,\n            response {\n              id,\n              timestamp,\n              answer,\n              isUnrevealed,\n              isCommitment,\n              commitmentId,\n              bond,\n              user,\n              historyHash,\n              createdBlock,\n              revealedBlock\n            }\n        }\n      }\n      `;\n\n    // console.log('sending other graph query', query2);\n    const res2 = await axios.post(network_graph_url, {query: query2});\n    console.log('graph res', res2.data);\n    for (const a of res2.data.data.userActions) {\n        console.log('got useraction for other', a);\n        renderNotificationsGraph(a);\n        const qid = a.questionId;\n        if (!user_question_blocks[qid]) {\n            user_question_blocks[qid] = a.createdTimestamp; // Should be the first time - TODO: Check we're getting these in ascending order\n        }\n        //handleQuestion(q)\n        // const question_posted = RCInstance(q.contract).filters.LogNewQuestion(q.questionId);\n        // const result = await RCInstance(q.contract).queryFilter(question_posted, parseInt(q.createdBlock), parseInt(q.createdBlock));\n    }\n*/\n\n// TODO: This should probably be happening in a shared event handling function\n    for (const ctr in RC_DISPLAYED_CONTRACTS) {\n        updateClaimableDisplay(RC_DISPLAYED_CONTRACTS[ctr]);\n    }\n\n}\n\n\n\nfunction isForCurrentUser(entry) {\n    const actor_arg = 'user';\n    return (entry[actor_arg] == ACCOUNT);\n}\n\nfunction parseHash() {\n    // Alternate args should be names and values\n    if (location.hash.substring(0, 3) != '#!/') {\n        return {};\n    }\n    const arg_arr = location.hash.substring(3).split('/');\n    const args = {};\n    for (let i = 0; i < arg_arr.length + 1; i = i + 2) {\n        const n = arg_arr[i];\n        const v = arg_arr[i + 1];\n        if (n && v) {\n            args[n] = v;\n        }\n    }\n    return args;\n}\n\nfunction set_hash_param(args) {\n    let current_args = parseHash();\n    let h = '!';\n    for (const a in args) {\n        if (args.hasOwnProperty(a)) {\n            current_args[a] = args[a];\n        }\n    }\n    for (const ca in current_args) {\n        if (current_args.hasOwnProperty(ca)) {\n            if (current_args[ca] != null) {\n                h = h + '/' + ca + '/' + current_args[ca];\n            }\n        }\n    }\n    document.location.hash = h;\n}\n\nfunction populateArbitratorOptionLabel(op, fee, txt, tos) {\n    if (txt) {\n        op.attr('data-text-main', txt);\n    } else {\n        txt = op.attr('data-text-main');\n    }\n    if (fee.gt(ethers.BigNumber.from(0))) {\n        txt = txt + ' (' + humanReadableWei(fee) + ')';\n    }\n    op.text(txt);\n    op.attr('data-question-fee', fee.toHexString());\n    if (tos) {\n        op.attr('data-tos-url', formatPossibleIPFSLink(tos));\n    }\n}\n\nfunction appendBeforeOption(sel, weight) {\n    let last_el = null;\n    // Go down the select until we find something with a higher weight than ourselves, then slot in before that\n    // There should always be something there because we have the \"other\" option at 1000001\n    sel.find('option').each(function(){\n        const el = $(this);\n        if (parseInt(el.attr('data-weight')) > parseInt(weight)) {\n            last_el = el;\n            return false;\n        }\n    });\n    // Always append before the final option if there were no others\n    return last_el;\n}\n\nfunction populateArbitratorSelect(arb_contract, network_arbs) {\n    console.log('got network_arbs', network_arbs);\n    $(\"select[name='arbitrator']\").each(function() {\n        const as = $(this);\n        const a_template = as.find('.arbitrator-template-item');\n        const a_select = $(this);\n        const other_option = a_template.parent().find('.arbitrator-other-select');\n        a_template.remove();\n\n        // Assign weights governing the order in the select, lowest to be displayed last.\n        // The contract address used for \"no arbitrator\" should be displayed last (and will be set to 1000000)\n        // The \"other\" option will be 1000001, already in the HTML\n        let arb_weights = {};\n        let arb_i = 0;\n        for(const na in network_arbs) {\n            arb_weights[na.toLowerCase()] = arb_i;\n            arb_i++;\n        }\n\n        $.each(network_arbs, function(na_addr, na_title) {\n            if (na_addr.toLowerCase() == RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase()) {\n                const arb_item = a_template.clone().removeClass('arbitrator-template-item').addClass('arbitrator-option');\n                arb_item.attr('data-weight', '1000000');\n                populateArbitratorOptionLabel(arb_item, ethers.BigNumber.from(0), na_title, \"\");\n                arb_item.val(na_addr);\n                other_option.before(arb_item);\n                return true;\n            }\n            const mya = arb_contract.attach(na_addr);\n            mya.functions.realitio().then(function(call_response) {\n                const rc_addr = call_response[0];\n                console.log('arb has rc addr', rc_addr);\n                const is_arb_valid = (rc_addr.toLowerCase() == RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase());\n                ARBITRATOR_VERIFIED_BY_CONTRACT[RC_DEFAULT_ADDRESS.toLowerCase()][na_addr.toLowerCase()] = is_arb_valid;\n                // For faster loading, we give arbitrators in our list the benefit of the doubt when rendering the page list arbitrator warning\n                // For this we'll check our original list for the network, then just check against the failed list\n                // TODO: Once loaded, we should really go back through the page and update anything failed\n                if (!is_arb_valid) {\n                    markArbitratorFailed(RC_DEFAULT_ADDRESS, na_addr);\n                }\n                console.log(ARBITRATOR_VERIFIED_BY_CONTRACT);\n                return is_arb_valid;\n            }).then(function(is_arb_valid) {\n                if (is_arb_valid) {\n                    RCInstance(RC_DEFAULT_ADDRESS).functions.arbitrator_question_fees(na_addr).then(async function(fee_call_response) {\n                        const fee = fee_call_response[0];\n                        const metadata = await loadArbitratorMetaData(na_addr);\n                        const tos = ('tos' in metadata) ? metadata['tos'] : null;\n                        const arb_item = a_template.clone().removeClass('arbitrator-template-item').addClass('arbitrator-option');\n                        arb_item.val(na_addr);\n                        if (na_addr.toLowerCase() in arb_weights) {\n                            arb_item.attr('data-weight', arb_weights[na_addr.toLowerCase()]);\n                        }\n                        populateArbitratorOptionLabel(arb_item, fee, na_title, tos);\n                        //if (arb_item.attr('data-weight') == '1') {\n                        //    arb_item.attr('selected', true);\n                        //}\n                        const append_before = appendBeforeOption(a_select, arb_item.attr('data-weight'));\n                        // append before the item with the highest weight greater than this one\n                        append_before.before(arb_item);\n                    });\n                } else {\n                    console.log('Arbitrator does not work for this contract:', na_addr);\n                }\n            }).catch(function(err) {\n                console.log('arbitrator failed with error', err);\n                markArbitratorFailed(RC_DEFAULT_ADDRESS, na_addr);\n            });\n        });\n    });\n}\n\nasync function validateArbitratorForContract(contract, arb_addr) {\n    if (ARBITRATOR_VERIFIED_BY_CONTRACT[contract.toLowerCase()] && ARBITRATOR_VERIFIED_BY_CONTRACT[contract.toLowerCase()][arb_addr.toLowerCase()]) {\n        return true;\n    }\n    const ar = ARBITRATOR_INSTANCE.attach(arb_addr);\n    const rslt_arr = await ar.functions.realitio();\n    const rslt = rslt_arr[0];\n    return (RCInstance(RC_DEFAULT_ADDRESS).address.toLowerCase() == rslt.toLowerCase());\n}\n\nfunction initChain(cid) {\n    console.log('Initializing for chain', cid);\n    CHAIN_ID = cid;\n    const net_cls = '.network-id-' + cid;\n    if ($('.network-status'+net_cls).length == 0) {\n        return false;\n    }\n    $('.network-status'+net_cls).show();\n    $('.network-status-container').addClass('initialized');\n\n    const current_chain_text = $('.network-status'+net_cls).text();\n    $('.current-chain-text').text(current_chain_text);\n    $('.chain-item.network-id-'+cid).addClass('selected-chain');\n\n    if (typeof ethereum !== 'undefined') {\n        ethereum.on('chainChanged', () => {\n          document.location.reload()\n        })\n    }\n\n    return true;\n}\n\nfunction getAccount(fail_soft) {\n    console.log('in getAccount');\n    return new Promise((resolve, reject)=>{\n        if (ACCOUNT) {\n            resolve(ACCOUNT);\n        }\n\n        if (typeof ethereum === 'undefined') {\n            if (!fail_soft) {\n                $('body').addClass('error-no-metamask-plugin').addClass('error');\n            }\n            reject('Could not find an up-to-date version of metamask, account functionality disabled.');\n        }\n\n        ethereum.enable().then(function() {\n\n            ethereum.on('accountsChanged', function (accounts) {\n                ACCOUNT = null;                     \n                resetAccountUI();\n                getAccount();\n            })\n\n            provider.listAccounts().then(function(acc) {\n                console.log('accounts were', acc);\n                if (acc && acc.length > 0) {\n                    //console.log('accounts', acc);\n                    ACCOUNT = acc[0];\n                    $('.account-balance-link').attr('href', BLOCK_EXPLORER + '/address/' + ACCOUNT);\n                } else {\n                    if (!IS_WEB3_FALLBACK) {\n                        console.log('no accounts');\n                        $('body').addClass('error-no-metamask-accounts').addClass('error');\n                    }\n                }\n\n                accountInit(ACCOUNT);\n                resolve(ACCOUNT);\n            });\n\n        });\n    });\n}\n\nfunction accountInit(account) {\n\n    fetchUserEventsAndHandleGraph();\n\n    updateUserBalanceDisplay();\n\n}\n\nfunction initContractSelect(available_configs, selected_config, show_all) {\n    const sel = $('select#contract-selection');\n    let only_have_default = true;\n    for(const ac in available_configs) {\n        const acobj = available_configs[ac];\n        const is_selected = (ac.toLowerCase() == selected_config.address.toLowerCase());\n        if (!is_selected) {\n            only_have_default = false;\n        }\n        let op = $('<option>');\n        op.attr('value', ac).text('reality.eth v'+acobj.version_number);\n        if (!show_all) {\n            if (is_selected) {\n                op.prop('selected', 'selected');\n            }\n        }\n        sel.append(op);\n    }\n\n    sel.attr('data-old-val', sel.val());\n    if (only_have_default) {\n        sel.find('.all-contracts').remove();\n    }\n    sel.removeClass('uninitialized');\n}\n\n// We show the claim button section for each contract\n// It's a bit hokey but having multiple contracts to claim from should be pretty unusual\nfunction setupContractClaimSections(rc_contracts) {\n    for(let i=0; i<rc_contracts.length; i++) {\n        const rcaddr = rc_contracts[i];\n        const tmpl = $('.contract-claim-section-template');\n        const sec = tmpl.clone();\n        sec.attr('data-contract', rcaddr.toLowerCase());\n        sec.removeClass('contract-claim-section-template');\n        tmpl.after(sec);\n    }\n}\n\nfunction initToken(curr) {\n    $('.token-ticker-text').text(TOKEN_TICKER);\n    for(const t in TOKEN_INFO) {\n        const op = $('<option>');\n        op.attr('value', t).text(t);\n        if (t == curr) {\n            if (TOKEN_INFO[t].is_native) {\n                console.log('is_native');\n                IS_TOKEN_NATIVE = true;\n            } else {\n                console.log('not native');\n            }\n            op.prop('selected', 'selected');\n        }\n        $('select#token-selection').append(op);\n    }\n    //$('select#token-selection').val(curr);\n}\n\nfunction displayForeignProxy(datastr) {\n    $('body').addClass('foreign-proxy');\n    const dec = decodeURIComponent(datastr);\n    const qdata = JSON.parse(dec);\n    for (const d in qdata) {\n        if (qdata[d].type && qdata[d].type == 'BigNumber') {\n            qdata[d] = ethers.BigNumber.from(qdata[d].hex); \n        }\n    }\n    FOREIGN_PROXY_DATA = qdata;\n    $('body').attr('data-foreign-proxy-network-id', qdata['network_id']);\n    const netid_label = 'network-id-'+parseInt(qdata['network_id']);\n    const txt = $('.network-status-container .network-status.'+netid_label).first().text();\n    console.log(netid_label, txt);\n    const fpsec = $('div.foreign-proxy-section');\n    const qjson = qdata.question_json;\n    fpsec.find('.foreign-proxy-network-text').text(txt);\n    fpsec.find('.question-title').text(qjson['title']);\n    console.log('ss', $('div.foreign-proxy-section .foreign-proxy-network-text').length);\n    console.log('displayForeignProxy', qdata);\n}\n\nasync function foreignProxyInitChain(cid) {\nconsole.log('in foreignProxyInitChain');\n    if (!$('body').hasClass('foreign-proxy')) {\n        return;\n    }\n    if (parseInt(cid) != $('body').attr('data-foreign-proxy-network-id')) {\n        $('body').addClass('foreign-proxy-network-mismatch');\n        return;\n    }\n    const arb_addr = FOREIGN_PROXY_DATA['foreign_proxy'];\n    const question_id = FOREIGN_PROXY_DATA.question_id;\n    let arbitrator;\n\n    console.log('foreign proxy arbitrator is', arb_addr, 'bond', FOREIGN_PROXY_DATA.bond, 'qid', question_id);\n\n    let dispute_exists = false;\n    let old_version = false;\n\n    // The Kleros mainnet contract for this has some extra features that we want to display like showing the status of the request\n    let arb = new ethers.Contract(arb_addr, PROXIED_ARBITRATOR_ABI_NEW, provider);\n\n    console.log('Checking for an existing dispute');\n    try {\n        console.log('Trying new contract API');\n        const existing_arr = await arb.functions.arbitrationIDToDisputeExists(ethers.BigNumber.from(question_id));\n        // console.log('got ', existing_arr, question_id);\n        dispute_exists = existing_arr[0];\n    } catch (e) {\n        console.log('Error trying new contract API, trying old API');\n        arb = new ethers.Contract(arb_addr, PROXIED_ARBITRATOR_ABI_OLD, provider);\n        old_version = true;\n        const existing_arr = await arb.functions.questionIDToDisputeExists(question_id);\n        dispute_exists = existing_arr[0];\n    }\n\n    // See if it was requested but hasn't been handled yet\n    if (!dispute_exists) {\n        const arb_req_filter = arb.filters.ArbitrationRequested(question_id);\n        const arb_requests = await arb.queryFilter(arb_req_filter);\n        if (arb_requests.length > 0) {\n            for(const arb_req in arb_requests) {\n                const req_addr = arb_requests[arb_req].args._requester;\n                const existing_2 = await arb.functions.arbitrationRequests(ethers.BigNumber.from(question_id), req_addr);\n                if (existing_2.status && existing_2.status > 0 && existing_2.status < 4) { // Created and not failed\n                    dispute_exists = true;\n                    break;\n                }\n            }        \n        }\n    }\n\n    console.log('existing dispute_exists?', dispute_exists);\n    if (dispute_exists) {\n        $('body').addClass('foreign-proxy-transaction-complete').removeClass('foreign-proxy-ready').removeClass('foreign-proxy-transaction-sent');\n        return;\n    } else {\n        try {\n            const fee_arr = await arb.functions.getDisputeFee(question_id);\n            const fee = fee_arr[0];\n            $('.proxy-arbitration-fee').text(humanReadableWei(fee));\n            $('.proxy-request-arbitration-button').attr('data-question-fee', fee.toHexString());\n            $('.proxy-contested-answer').text(rc_question.getAnswerString(FOREIGN_PROXY_DATA.question_json, FOREIGN_PROXY_DATA.best_answer));\n           \n            $('.proxy-request-arbitration-button').click(function() {\n                console.log('fee si', fee.toHexString());\n                // Normally would be, but Kleros didn't like the max_previous method\n                //  arb.requestArbitration(question_id, ethers.BigNumber.from(last_seen_bond_hex, 16), {from:ACCOUNT, value: arbitration_fee})\n                const SignedArbitrator = arb.connect(signer);\n                if (false && old_version) {\n                    console.log('Sending arbitration request using old API');\n                    // console.log('using best answer', FOREIGN_PROXY_DATA.best_answer);\n                    SignedArbitrator.functions.requestArbitration(question_id, FOREIGN_PROXY_DATA.best_answer, {from:ACCOUNT, value: fee}).then(function(result_tx) {\n                        $('body').addClass('foreign-proxy-transaction-sent').removeClass('foreign-proxy-ready');\n                    });\n                } else {\n                    console.log('Sending arbitration request using new API');\n                    SignedArbitrator.functions.requestArbitration(question_id, FOREIGN_PROXY_DATA.bond, {from:ACCOUNT, value: fee}).then(function(result_tx) {\n                        $('body').addClass('foreign-proxy-transaction-sent').removeClass('foreign-proxy-ready');\n                    });\n                }\n            });\n\n            $('body').addClass('foreign-proxy-ready');\n        } catch (err) {\n            console.log('Arbitrator failed with error', err);\n            markArbitratorFailed(RC_DEFAULT_ADDRESS, arb_addr);\n        }\n    }\n}\n\nfunction displayWrongChain(specified, detected) {\n    console.log('displayWrongChain', specified, detected);\n    let specified_network_txt = $('.network-status.network-id-'+specified).text();\n    let detected_network_txt = $('.network-status.network-id-'+detected).text();\n    if (specified_network_txt == '') {\n        specified_network_txt = '[unknown network]';\n    }\n    if (detected_network_txt == '') {\n        detected_network_txt = 'another network';\n    }\n    console.log(specified_network_txt, detected_network_txt);\n\n    const wallet_info = rc_contracts.walletAddParameters(specified);\n    if (wallet_info) {\n        const lnk = $('<a>');\n        lnk.text($('.add-network-button').text());\n        lnk.bind('click', function(evt) {\n            console.log('add net');\n            evt.stopPropagation();\n            console.log('getting', specified);\n            ethereum.request({\n                method: 'wallet_addEthereumChain',\n                params: [wallet_info]\n            }).then((result) => {\n                console.log('result was', result);\n                location.reload();\t\n            }).catch((error) => {\n                console.log('error', error)\n            });\n            return false;\n        });\n        $('.add-network-button').empty().append(lnk);\n    }\n\n    $('.network-specified-text').text(specified_network_txt);\n    $('.network-detected-text').text(detected_network_txt);\n    $('body').addClass('error-not-specified-network').addClass('error');\n\n    return;\n}\n\nwindow.addEventListener('load', async function() {\n\n    let cid;\n\n    const args = parseHash();\n    if (args['token'] && args['token'] != 'ETH') {\n        TOKEN_TICKER = args['token'];\n    }\n    \n    // Get a provider from metamask etc if possible, we'll detect the network ID from it\n    // If there isn't one, use the specified network with the hosted RPC node\n    if (window.ethereum) {\n        provider = new ethers.providers.Web3Provider(window.ethereum)\n    } else  {\n        IS_WEB3_FALLBACK = true;\n\n        // Default to mainnet\n        let want_cid = 1;\n        if (args['network'] && parseInt(args['network'])) {\n            want_cid = parseInt(args['network']);\n        }\n\n        CHAIN_INFO = rc_contracts.chainData(want_cid);\n        // TODO: Handle a supplied unsupported network\n        HOSTED_RPC_NODE = CHAIN_INFO['hostedRPC'];\n        cid = want_cid;\n\n        provider = new ethers.providers.JsonRpcProvider(HOSTED_RPC_NODE);\n        console.log('no window.ethereum, using node ', HOSTED_RPC_NODE);\n    }\n\n    signer = provider.getSigner()\n\n    if (args['foreign-proxy']) {\n        displayForeignProxy(args['foreign-proxy']);\n    }\n\n    provider.on(\"block\", (blockNumber) => {\n        if (blockNumber > CURRENT_BLOCK_NUMBER) {\n            CURRENT_BLOCK_NUMBER = blockNumber;\n            //console.log('updated CURRENT_BLOCK_NUMBER to ', CURRENT_BLOCK_NUMBER);\n        }\n    })\n\n    provider.on(\"network\", async function(network, old_network_id) {\n\n        cid = network.chainId;\n\n        if (old_network_id) {\n            window.location.reload();\n        }\n        console.log('cid is ', cid);\n\n        if (args['category']) {\n            $(\"#filter-list\").find(\"[data-category='\" + args['category'] + \"']\").addClass(\"selected\")\n        } else {\n            $(\"#filter-list\").find(\"[data-category='all']\").addClass(\"selected\")\n        }\n\n        if (args['network'] && (parseInt(args['network']) != parseInt(cid))) {\n            if (!rc_contracts.isChainSupported(parseInt(args['network']))) {\n                $('body').addClass('error-invalid-network').addClass('error');\n                return;\n            } else {\n                displayWrongChain(parseInt(args['network']), parseInt(cid));\n            }\n            return;\n        }\n\n        if (!rc_contracts.isChainSupported(cid)) {\n            $('body').addClass('error-invalid-network').addClass('error');\n            return;\n        }\n\n        if (!TOKEN_TICKER) {\n            TOKEN_TICKER = rc_contracts.defaultTokenForChain(cid);\n            console.log('picked token', TOKEN_TICKER);\n        }\n\n        const all_rc_configs = rc_contracts.realityETHConfigs(cid, TOKEN_TICKER);\n        let rc_config = null;\n        let show_all = true;\n        if (args['contract']) {\n            for(const cfg_addr in all_rc_configs) {\n                // If we got a valid version number for the contract, switch that out for the address and pretend we got that\n                if (args['contract'] == 'v' + all_rc_configs[cfg_addr].version_number) {\n                    args['contract'] = cfg_addr;\n                }\n                if (cfg_addr.toLowerCase() == args['contract'].toLowerCase()) {\n                    rc_config = all_rc_configs[cfg_addr];\n                    show_all = false;\n                    break;\n                }\n            }\n        }\n\n        for(const cfg_addr in all_rc_configs) {\n            const cfg = all_rc_configs[cfg_addr]; \n            START_BLOCKS[cfg.address.toLowerCase()] = cfg.block;\n            RC_INSTANCE_VERSIONS[cfg.address.toLowerCase()] = cfg.version_number;\n        }\n\n        // If not found, load the default\n        if (!rc_config) {\n            rc_config = rc_contracts.realityETHConfig(cid, TOKEN_TICKER);\n        }\n        \n        if (!rc_config) {\n            $('body').addClass('error-invalid-network-for-token').addClass('error');\n            return;\n        }\n\n        initContractSelect(all_rc_configs, rc_config, show_all);\n\n        TOKEN_INFO = rc_contracts.chainTokenList(cid);\nconsole.log('TOKEN_INFO', TOKEN_INFO);\n        console.log('got token info', TOKEN_INFO);\n\n        const rc_json = rc_contracts.realityETHInstance(rc_config);\n        const arb_json = rc_contracts.arbitratorInstance();\n\n        if (!rc_json) {\n            console.log('Token not recognized', TOKEN_TICKER);\n            return;\n        }\n\n        initToken(TOKEN_TICKER);\n        if (!IS_TOKEN_NATIVE) {\n            TOKEN_JSON = rc_contracts.erc20Instance(rc_config);\n        }\n\n        CHAIN_INFO = rc_contracts.chainData(cid);\n        HOSTED_RPC_NODE = CHAIN_INFO['hostedRPC'];\n        BLOCK_EXPLORER = CHAIN_INFO['blockExplorerUrls'][0];\n\n        if (!initChain(cid)) {\n            $('body').addClass('error-invalid-network').addClass('error');\n            return;\n        } \n\n        if (!$('body').hasClass('foreign-proxy')) {\n            $('select#token-selection').removeClass('uninitialized');\n        }\n\n        USE_COMMIT_REVEAL = (parseInt(args['commit']) == 1);\n\n        if (args['category']) {\n            CATEGORY = args['category'];\n            $('body').addClass('category-' + category);\n            const cat_txt = $(\"#filter-list\").find(\"[data-category='\" + category + \"']\").text();\n            $('#filterby').text(cat_txt);\n        }\n\n        RC_DEFAULT_ADDRESS = rc_json.address;\n        for(const cfg_addr in all_rc_configs) {\n            const cfg = all_rc_configs[cfg_addr];\n            const inst = rc_contracts.realityETHInstance(cfg);\n            RC_INSTANCES[cfg_addr.toLowerCase()] = new ethers.Contract(cfg_addr, inst.abi, provider);\n            if (show_all || cfg_addr == RC_DEFAULT_ADDRESS) {\n                RC_DISPLAYED_CONTRACTS.push(cfg_addr);\n            }\n\n            // Everyone gets the initial config\n            CONTRACT_TEMPLATE_CONTENT[cfg_addr.toLowerCase()] = TEMPLATE_CONFIG.content;\n\n            ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()][cfg_addr.toLowerCase()] = 'No arbitration (highest bond wins)';\n            ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()][cfg_addr.toLowerCase()] = true;\n            ARBITRATOR_FAILED_BY_CONTRACT[cfg_addr.toLowerCase()] = {}\n            if ('arbitrators' in cfg) {\n                for(const arb_addr in cfg['arbitrators']) {\n                    ARBITRATOR_LIST_BY_CONTRACT[cfg_addr.toLowerCase()][arb_addr.toLowerCase()] = cfg['arbitrators'][arb_addr];\n                    ARBITRATOR_VERIFIED_BY_CONTRACT[cfg_addr.toLowerCase()][arb_addr.toLowerCase()] = true;\n                }\n            } else {\n                console.log('no arbs in config', cfg);\n            }\n\n        }\n        //console.log('arb init', ARBITRATOR_LIST_BY_CONTRACT, ARBITRATOR_FAILED_BY_CONTRACT, ARBITRATOR_VERIFIED_BY_CONTRACT);\n        \n        // Set up dummy contract objects, we'll make copies of them with the correct addresses when we need them\n        ARBITRATOR_INSTANCE = new ethers.Contract(rc_json.address, arb_json.abi, provider); \n        populateArbitratorSelect(ARBITRATOR_INSTANCE, ARBITRATOR_LIST_BY_CONTRACT[RC_DEFAULT_ADDRESS.toLowerCase()]);\n        foreignProxyInitChain(cid);\n\n        const block = await provider.getBlock('latest');\n\n        if (block.number > CURRENT_BLOCK_NUMBER) {\n            CURRENT_BLOCK_NUMBER = block.number;\n        }\n\n        if (rc_contracts.versionHasFeature(RC_INSTANCE_VERSIONS[RC_DEFAULT_ADDRESS.toLowerCase()], 'min-bond')) {\n            $('.rcbrowser--postaquestion').addClass('version-supports-min-bond');\n        } \n\n        const limit_to_contract = show_all ? null : RC_DEFAULT_ADDRESS;\n\n        // Keep a note of when we started fetching stuff so we know when to start fetching stuff that might have changed since from\n        let fetch_start_ts = parseInt(new Date().getTime()/1000);\n\n        pageInit(limit_to_contract);\n\n        setupContractClaimSections(RC_DISPLAYED_CONTRACTS);\n\n        //console.log('args', args);\n        if (args['question']) {\n            //console.log('loading question');\n            try {\n                const [ctr, qid] = parseContractQuestionID(args['question'], RC_DEFAULT_ADDRESS);\n                const question = await ensureQuestionDetailFetched(ctr, qid);\n                //console.log('display question', question);\n                openQuestionWindow(contractQuestionID(question));\n            } catch (err) {\n                console.log('could not open question in URL', err);\n            }\n        }\n\n\n        // NB If this fails we'll try again when we need to do something using the account\n        getAccount(true);\n\n        loadPendingTransactions(cid);\n        \n        runPollingLoop(RC_DISPLAYED_CONTRACTS, fetch_start_ts);\n    });\n});\n\n$('.continue-read-only-message').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    $('body').removeClass('error-no-metamask-plugin').removeClass('error');\n});\n\n$('.continue-message').click(function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const clear_cls = $(this).attr('data-clear-error');\n    if (clear_cls) {\n        $('body').removeClass('error-' + clear_cls);\n    }\n    $('body').removeClass('error');\n});\n\n$('#token-selection').change(function(e) { \n    e.preventDefault();\n    e.stopPropagation();\n    const tkn = $(this).val();\n    if (tkn == TOKEN_TICKER) {\n        // already selected\n        return;\n    }\n    window.location.hash = '#!/token/'+tkn;\n    location.reload();\n});\n\n$('#contract-selection').change(function(e) { \n    e.preventDefault();\n    e.stopPropagation();\n    const ctr = $(this).val();\n    if ($(this).attr('data-old-val') == ctr) {\n        // already selected\n        return;\n    }\n    if (ctr == '') {\n        set_hash_param({'contract': null});\n    } else {\n        set_hash_param({'contract': ctr});\n    }\n    location.reload();\n});\n\n// When on the legacy site, show the moved warning, use the full link url\nif (window.location.href.indexOf('realitio') != -1) {\n    $('.moved-to-reality-eth').show();\n    $('.logo .logo-link').attr('href', $('.logo .logo-link').attr('data-full-url'));\n} else if (window.location.href.indexOf('ipfs.io') != -1) {\n    $('.logo .logo-link').attr('href', $('.logo .logo-link').attr('data-full-url'));\n}\n\nfunction setCookie(cname, cvalue, exdays) {\n  const d = new Date();\n  d.setTime(d.getTime() + (exdays*24*60*60*1000));\n  let expires = \"expires=\"+ d.toUTCString();\n  document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n}\n\n$('.graph-node-switch-link').click(function() {\n    if ($('body').hasClass('via-node')) {\n        setCookie('graph', 1, 365*10);\n    } else {\n        setCookie('graph', 0, 365*10);\n    }\n    location.reload();\n});\n\n};\n","import '../styles/index.scss';\n\n'use strict';\n\nimport common from './common.js';\nimport rpc from './rpc.js';\nimport graph from './graph.js';\n\nconst cookie = document.cookie;\n\n// If you have a cookie we'll obey the cookie. Otherwise use graph.\nif (cookie && cookie.indexOf('graph=0') !== -1) {\n   console.log('using rpc');\n   rpc();\n} else {\n   console.log('using graph');\n   graph();\n}\n\ncommon();\n","'use strict';\n\nexport default function() {\n\n    $(\".main-nav a\").click(function(e){\n       $(\".main-nav a\").removeClass(\"selected\");\n       $(this).addClass(\"selected\");\n       $(\".questions\").hide();\n       var selector = \"#\" + $(this).data(\"menu\");\n       $(selector).show();\n       //alert($(this).data(\"menu\"));\n    });\n\n    $(function() {\n\t$(\"#filter-list a\").removeClass(\"selected\");\n\tvar category_name = window.location.hash.split(\"#!/category/\")[1];\n\tif(category_name){\n\t    var selector = \"[data-category=\\\"\"+category_name+\"\\\"]\";\n\t    $(selector).addClass(\"selected\");\n\t} else {\n\t    $(\"[data-category=\\\"all\\\"]\").addClass(\"selected\");\n\t}\n    });\n\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.amdO = {};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_reality_eth_dapp\"] = self[\"webpackChunk_reality_eth_dapp\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [15], function() { return __webpack_require__(6911); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","cookie","document","indexOf","console","log","provider","signer","ethers","require","timeago","timeAgo","jazzicon","axios","randomBytes","$","addClass","rc_question","rc_template","rc_contracts","TOKEN_INFO","CHAIN_INFO","TOKEN_JSON","IS_TOKEN_NATIVE","IS_WEB3_FALLBACK","ARBITRATOR_LIST_BY_CONTRACT","ARBITRATOR_VERIFIED_BY_CONTRACT","ARBITRATOR_FAILED_BY_CONTRACT","FOREIGN_PROXY_DATA","ARBITRATOR_METADATA","PENDING_USER_TXES_BY_CQID","TEMPLATE_CONFIG","templateConfig","PROXIED_ARBITRATOR_ABI_OLD","base_ids","PROXIED_ARBITRATOR_ABI_NEW","SUBMITTED_QUESTION_ID_BY_TIMESTAMP","USER_CLAIMABLE_BY_CONTRACT","CATEGORY","CONTRACT_TEMPLATE_CONTENT","content","LAST_POLLED_BLOCK","IS_INITIAL_LOAD_DONE","USE_COMMIT_REVEAL","HOSTED_RPC_NODE","START_BLOCKS","CHAIN_ID","BLOCK_EXPLORER","FETCH_NUMBERS","LAST_DISPLAYED_BLOCK_NUMBER","CURRENT_BLOCK_NUMBER","TOKEN_TICKER","BLOCK_TIMESTAMP_CACHE","Q_MIN_ACTIVITY_BLOCKS","RC_INSTANCES","RC_INSTANCE_VERSIONS","RC_DEFAULT_ADDRESS","RC_DISPLAYED_CONTRACTS","ARBITRATOR_INSTANCE","ACCOUNT","DISPLAY_ENTRIES","QUESTION_DETAIL_CACHE","QUESTION_EVENT_TIMES","WINDOW_POSITION","loadPendingTransactions","chain_id","txliststr","window","localStorage","getItem","txlist","split","i","length","txid","getTransaction","fillPendingUserTX","tx","hash","inst","RCInstance","to","dec","interface","parseTransaction","functionFragment","name","cqid","cqToID","args","question_id","bond","value","fake_history","answer","BigNumber","from","parseInt","Date","getTime","blockNumber","toHexString","mergeConfirmedTXes","updateQuestionWindowIfOpen","question","history_bond_to_idx","history_unconfirmed_bond_to_idx","hi","ui","pending_entries_by_bond","contractQuestionID","b","idx","clearPendingTXID","push","storePendingTXID","Error","current","includes","MAX_PENDING_STORE","substr","setItem","replace","ZINDEX","MONTH_LIST","formatPossibleIPFSLink","u","toLowerCase","markArbitratorFailed","contract","addr","contract_question_id","setRcBrowserPosition","rcbrowser","hasClass","attr","parseContractQuestionID","left","top","css","winWidth","documentElement","clientWidth","winHeight","clientHeight","rcb_width","rcb_height","itemWidth","Math","min","itemHeight","RCStartBlock","ctr","signed","ret","connect","populateTOSSection","container","tos","tos_section","find","removeClass","getViewedBlockNumber","network_id","markViewedToDate","block_number","vbn","humanToDecimalizedBigNumber","num","force_eth","decimals","utils","parseUnits","decimalizedBigNumberToHuman","formatUnits","humanReadableWei","amt","isArbitratorValidFast","test_arb","a","isArbitrationPending","is_pending_arbitration","isAnswerActivityStarted","isAnswered","history_hash","gt","hasUnrevealedCommits","item","is_commitment","revealed_block","finalization_ts","toNumber","isCommitExpired","posted_ts","commit_secs","timeout","isFinalized","fin","isReopenCandidate","best_answer","getAnsweredTooSoonValue","versionHasFeature","validate","win","valid","qtext","val","closest","reward","parent","min_bond_inp","is_bond_err","e","options_num","question_type","answer_options","toArray","id","handlePotentialUserAction","entry","is_watch","invalid_data","address","isForCurrentUser","fetchUserEventsAndHandle","updateUserBalanceDisplay","lastViewedBlockNumber","ensureQuestionDetailFetched","displayQuestionDetail","renderUserAction","updateClaimableDataForQuestion","updateClaimableDisplay","answer_entry","poss","possibleClaimableItems","isZero","unclaimed","mergePossibleClaimable","claiming","sec","filter","total","txids","text","join","show","fadeOut","functions","balanceOf","balance_arr","balance","ttl","add","posses","pending","combined","qid","hasOwnProperty","question_ids","answer_lengths","answers","answerers","bonds","history_hashes","scheduleFinalizationDisplayUpdate","is_done","clearTimeout","timeout_id","update_time","setTimeout","then","updateRankingSections","getBlock","err","result","number","timestamp","fake_entry","event","renderNotifications","_ensureAnswerRevealsFetched","freshness","start_block","found_at_block","earliest_block","bond_indexes","bond_hex","reveal_filter","filters","LogAnswerReveal","queryFilter","answer_arr","j","Object","assign","commitment_id","commitmentID","filledQuestionDetail","data_type","data","question_log","arbitrator","creation_ts","question_creator","question_created_block","content_hash","question_text","template_id","block_mined","opening_ts","version_number","reopener_of_question_id","question_json","has_invalid_option","hasInvalidOption","has_too_soon_option","hasAnsweredTooSoonOption","question_call","bounty","min_bond","ubond","gte","splice","reopened_by","also_too_soon","is_reopener","last_reopened_by","isDataFreshEnough","_ensureQuestionLogFetched","called_block","question_filter","LogNewQuestion","question_arr","blocknum","reopener_questions","ro_result","qarr","reopen_filter","LogReopenQuestion","reopen_arr","reopened_question_id","_ensureQuestionDataFetched","questions","eq","q","reopened_questions","reopener_q_result","reopener_q","replacement_data","rq","is_reopener_result","loadArbitratorMetaData","_ensureQuestionTemplateFetched","populatedJSONForTemplate","templates","template_block_num_bn_arr","template_block_num","template_filter","LogNewTemplate","cat_logs","populatedq","_ensureAnswersFetched","injected_data","answer_filter","LogNewAnswer","done_txhashes","inj_ans_arr","inj_ans","ans","transactionHash","ql","qi","qc","al","undefined","qdat","qans","delay","ms","Promise","resolve","ensureAmountApproved","spender","account","amount","erc20","getERC20TokenInstance","mybal","toString","allowance","allowed_arr","allowed","signedERC20","approve","wait","bal","getBalance","bal_arr","Contract","abi","populateSection","section_name","before_item","ids","max_show","question_item_id","before_item_id","section","existing_in_doc","next","remove","is_found","clone","populateSectionEntry","before","children","append","each","this","activateSection","fadeIn","balloon_html","lt","html","options","expander","expandText","slicePoint","getAnswerString","isQuestionBeforeOpeningDate","is_answered","cancel","convertTsToString","render","depopulateSection","current_last_qid","last","next_idx","add_qid","calculateActiveRank","created","rank","mul","now","age","sub","boost","div","handleQuestionLog","category","is_finalized","is_before_opening","insert_before","update_ranking_data","reflectDisplayEntryChanges","arr_name","ord","existing_idx","arr","max_entries","lte","previd","pop","fallback_contract","bits","openQuestionWindow","contract_addr","window_id","rcqa","populateQuestionWindow","question_detail","on","parent_div","style","cursor","Ps","get","set_hash_param","arbitrationMetaDataFromCache","arb_addr","cached_md","metadata_json","arb","attach","metadata","md_arr","md","JSON","parse","is_refresh","cat_el","target_el","cat","cat_txt","category_text","date","setTime","date_str","getMonth","getDate","getFullYear","title","words","isTitleLong","current_container","label","current_answer","historyItemForCurrentAnswer","ts","ans_data","user","avjazzicon","slice","last_ans","unrevealed_answer_container","commitExpiryTS","hist_id","uiHash","hist_tmpl","hist_item","after","valid_arbitrator","questioner","balloon","secondsTodHms","arbitratorAddressToText","toUTCString","opening_ts_str","unconfirmed_container","unconfirmed_answer","getDisputeFee","fee_arr","fee","nativeCurrency","symbol","catch","foreignProxy","fp_abi","fpArb","foreign_proxy_arr","foreign_proxy","foreignChainId","foreign_chain_id_arr","foreign_chain_id","btn","click","evt","preventDefault","stopPropagation","question_latest","url_data","proxy_url","encodeURIComponent","stringify","open","ans_frm","has_invalid","has_answered_too_soon","type","isBeforeOpeningDate","template_name","option_elm","elmtpl","elm","elinput","makeSelectAnswerInput","bond_field","question_window","isTopAnswerRevealable","isAnsweredOrAnswerActive","updateQuestionState","tot","totalClaimable","precision","date_format","plh","dtplh","datepicker","dateFormat","beforeShow","input","onSelect","dateText","setupDatetimeDatePicker","claimable_bonds","claimable_answers","claimable_answerers","claimable_history_hashes","is_first","is_yours","final_answer","answerer","shift","renderTimeAgo","populateWithBlockTimeForBlockNumber","cbk","qdata","question_section","answer_history","qitem","item_to_insert","question_items","inserted","insertQAItem","sections","forEach","target","user_answer","latest_answer","hide","renderQAItemAnswer","getHours","getMinutes","getSeconds","renderUserQandA","insertNotificationItem","notification_id","ntext","is_positive","notifications","getElementById","existing_notification_items","exi","str","solidityKeccak256","qfilter","result2","bounty_added","prev_hist_idx","history_idx","opening_date","isAnswerInputLookingValid","answer_element","dt_invalids","is_date_invalid","is_time_invalid","dval","Exception","time_element","tval","areDatetimeElementsInvalid","formattedAnswerFromForm","new_answer","getInvalidValue","answer_input","is","answerToBytes32","datetimeElementToTS","clearForm","prop","show_bond_payments","ctrl","frm","existing_answers","answer_logs","an","aval","answersByMaxBond","payable","changed_field","changed_val","s","vals","updateSectionEntryDisplay","handleEvent","error","waitForBlock","pageInit","only_contract","fetchAndDisplayQuestionFromGraph","fetchAndDisplayQuestionsFromLogs","detypes","keys","detype","displayed_contracts","ranking","ts_now","contract_str","ranking_where","where","orderBy","network_graph_url","graphURL","query","post","res","question_posted","questionId","createdBlock","end_block","fetch_i","scheduleFallbackTimer","runPollingLoop","contract_instance","setInterval","handleUserFilterItem","rcinst","results","acc","LogFundAnswerBounty","LogNotifyOfArbitrationRequest","LogFinalize","parseHash","location","substring","arg_arr","n","v","current_args","h","ca","populateArbitratorOptionLabel","op","txt","appendBeforeOption","sel","weight","last_el","el","populateArbitratorSelect","arb_contract","network_arbs","a_template","a_select","other_option","arb_weights","arb_i","na","na_addr","na_title","arb_item","realitio","call_response","rc_addr","is_arb_valid","arbitrator_question_fees","fee_call_response","reject","attempt","triesLeft","bind","validateArbitratorForContract","ar","rslt_arr","rslt","initChain","cid","net_cls","current_chain_text","ethereum","reload","getAccount","fail_soft","enable","accounts","listAccounts","accountInit","initContractSelect","available_configs","selected_config","show_all","only_have_default","ac","acobj","is_selected","setupContractClaimSections","rcaddr","tmpl","initToken","curr","t","is_native","displayForeignProxy","datastr","decodeURIComponent","d","hex","netid_label","first","fpsec","qjson","foreignProxyInitChain","dispute_exists","arbitrationIDToDisputeExists","existing_arr","questionIDToDisputeExists","arb_req_filter","ArbitrationRequested","arb_requests","arb_req","req_addr","_requester","arbitrationRequests","existing_2","status","SignedArbitrator","requestArbitration","result_tx","displayWrongChain","specified","detected","specified_network_txt","detected_network_txt","wallet_info","walletAddParameters","lnk","request","method","params","empty","setCookie","cname","cvalue","exdays","expires","rcbrowsers","querySelectorAll","len","addEventListener","initScrollBars","interact","draggable","inertia","restrict","restriction","right","bottom","endOnly","elementRect","autoScroll","onmove","parentNode","x","parseFloat","getAttribute","dx","y","dy","webkitTransform","transform","setAttribute","arb_text","sel_cont","test","rcaddr_arr","tos_url","yourwin","winheight","height","change","optionLabel","option","optionText","question_body","reward_val","timeout_val","expected_question_fee_attr","expected_question_fee","opening_ts_val","outcomes","qtype","defaultTemplateIDForType","encodeText","rcver","min_bond_val","questionID","fee_response","handleAskQuestionTX","tx_response","fake_log","contentHash","fake_call","signedRC","askQuestionWithMinBond","askQuestion","cost","askQuestionWithMinBondERC20","askQuestionERC20","is_single_question","doClaim","claim_args","claimMultipleAndWithdrawBalance","new_max","num_in_doc","next_ctr","next_question_id","element","parents","is_err","block_before_send","current_question","minNum","minNumber","integerValue","maxNum","maxNumber","invalid_value","answered_too_soon_value","sing_container","mult_container","checked","min_amount","paramstr","seed","handleAnswerSubmit","rc","answer_plaintext","nonce","answer_hash","answerHash","submitAnswerCommitment","tx_res","submitAnswerReveal","submitAnswerCommitmentERC20","submitAnswer","submitAnswerERC20","old_question","handleReopenQuestionTX","nonce_food","keccak256","reopenQuestion","reward_inp","prev","fundAnswerBounty","fundAnswerBountyERC20","last_seen_bond_hex","arbitration_fee","bond_validation","current_idx","current_bond","cont","inp","removeAttr","placeholder","providers","Web3Provider","want_cid","chainData","JsonRpcProvider","getSigner","network","old_network_id","chainId","isChainSupported","defaultTokenForChain","all_rc_configs","realityETHConfigs","rc_config","cfg_addr","cfg","block","realityETHConfig","chainTokenList","rc_json","realityETHInstance","arb_json","arbitratorInstance","erc20Instance","eventObject","clear_cls","tkn","href","rpc","REORG_ALLOWANCE_SECS","POLLING_INTERVAL","LAST_ACTION_TS","LAST_POLLED_USER_TS","setViewedBlockNumber","filledAnswer","fetched_ms","isCommitment","commitmentId","revealedBlock","historyHash","filledQuestion","createdTimestamp","template","templateId","questionText","openingTimestamp","reopens","reopenedBy","respi","answerFinalizedTimestamp","isPendingArbitration","currentAnswer","lastBond","minBond","history","responses","sort","unconf","highest_bond","unconf2","bidx","clearClobberedUnconfirmed","handleQuestion","isReopenable","updateLastActionTS","is_answerer_you","renderNotificationsGraph","actionType","q_involvement","is_relevant_from","resp","q_title","insertFinalizationNotification","fetchQuestionListsFromGraph","offset","userActionFields","max_store","max_cache_ms","fetchChangedQuestionsSince","last_ts","query_since_ts","fetchFinalizedQuestionsSince","ts_display_after","ts_last_polled","last_fetch_ts","fetch_started_ts","fetchUserEventsAndHandleGraph","updatePollingInterval","tsnow","fetch_start_ts","user_action_fields","user_question_blocks","active_contracts","ci","ct","userActions","contr","question_id_in_str","delim","query2","res2","fake_question","currentAnswerBond","currentAnswerTimestamp","cumulativeBonds","arbitrationRequestedTimestamp","arbitrationRequestedBy","arbitrationOccurred","currentScheduledFinalizationTimestamp","old_max","old_max_store","nextid","fake_ua","ro_question_id","graph","selector","category_name","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","loaded","__webpack_modules__","call","m","amdO","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","every","key","r","getter","__esModule","definition","o","defineProperty","enumerable","g","globalThis","Function","obj","prototype","Symbol","toStringTag","nmd","paths","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","__webpack_exports__"],"sourceRoot":""}